;/*FB_PKG_DELIM*/

__d("BaseToastContentWrapper.react",["BaseTheme.react","BaseView.react","react","useCurrentDisplayMode"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j={dark:"__fb-dark-mode ",light:"__fb-light-mode ",type:"CLASSNAMES"};b=i.forwardRef(a);function a(a,b){var d=a.children,e=a.testid;e=a.useInvertedDisplayMode;a=a.xstyle;var f=c("useCurrentDisplayMode")();f=f==="dark"?"light":"dark";return e?i.jsx(c("BaseTheme.react"),{config:j,displayMode:f,ref:b,testid:void 0,xstyle:a,children:d}):i.jsx(c("BaseView.react"),{ref:b,testid:void 0,xstyle:a,children:d})}a.displayName=a.name+" [from "+f.id+"]";e=b;g["default"]=e}),98);
__d("BaseToast.react",["BaseInlinePressable.react","BaseToastContentWrapper.react","BaseView.react","XPlatReactFocusRegion.react","focusScopeQueries","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));b=h;var j=b.useId,k=b.useMemo,l={item:{display:"x78zum5",flexDirection:"xdt5ytf",paddingBottom:"x19yoh24",paddingStart:"xrxijuk",paddingEnd:"xpowjs8",paddingLeft:null,paddingRight:null,paddingTop:"x6enp1t",$$css:!0},itemText:{flexGrow:"x1iyjqo2",$$css:!0},link:{wordBreak:"xdnwjd9",$$css:!0},root:{alignItems:"x6s0dn4",backgroundColor:"x1wkzo03",borderTopColor:"xlnzwam",borderEndColor:"x12rs7x4",borderBottomColor:"xm9qwu6",borderStartColor:"xup3dfi",borderTopStartRadius:"x1192kqh",borderTopEndRadius:"xjfsc2c",borderBottomEndRadius:"xg8fqjl",borderBottomStartRadius:"x1kdh5me",borderTopStyle:"xhf2mca",borderEndStyle:"xrf2tuc",borderBottomStyle:"x13y0ya8",borderStartStyle:"x1pyzo2z",borderTopWidth:"xmqxc35",borderEndWidth:"x7gbks2",borderBottomWidth:"x21fg80",borderStartWidth:"x1q3d8fi",boxShadow:"xi1c1fh",display:"x78zum5",flexShrink:"x2lah0s",maxWidth:"x1cs6qxi",minWidth:"x1hqenl9",paddingTop:"x192rfv7",paddingBottom:"x13jxccy",paddingStart:"xuv3zuj",paddingEnd:"xd3owfx",paddingLeft:null,paddingRight:null,$$css:!0},rootFullWidth:{width:"xh8yej3",$$css:!0}};function a(a){var b=a.action,e=a.addOnStart,f=a.closeButton,g=a.linkWrapper,h=a.message,m=a.onDismiss,n=a.size;n=n===void 0?"full-width":n;var o=a.testid;o=a.toastRef;a=a.useInvertedDisplayMode;a=a===void 0?!0:a;var p=j(),q=k(function(){return b!=null?{}:{"aria-atomic":!0,role:"alert"}},[b]);e=i.jsxs(i.Fragment,{children:[e!=null&&i.jsx(c("BaseView.react"),{xstyle:l.item,children:e}),i.jsx(c("BaseView.react"),babelHelpers["extends"]({xstyle:[l.item,l.itemText]},q,{children:h({toastMessageId:p})})),b!=null&&i.jsx(c("XPlatReactFocusRegion.react"),{autoFocusQuery:d("focusScopeQueries").tabbableScopeQuery,children:i.jsx(c("BaseView.react"),{xstyle:l.item,children:b.element!=null?b.element:b.labelRenderer&&i.jsx(c("BaseInlinePressable.react"),{onPress:function(a){m(),b.onPress(a)},testid:void 0,xstyle:l.link,children:b.labelRenderer(b.label)})})}),f!=null&&i.jsx(c("BaseView.react"),{xstyle:l.item,children:f})]});e=g!=null?g(e):e;return i.jsx(c("BaseToastContentWrapper.react"),{ref:o,testid:void 0,useInvertedDisplayMode:a,xstyle:[l.root,n==="full-width"&&l.rootFullWidth],children:e})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("BladeRunnerConfig",["RTISubscriptionManagerConfig","WebDriverConfig","cr:3024","gkx","isEmpty"],(function(a,b,c,d,e,f,g){var h,i="javascript-sandbox",j="OverrideServer",k="www_sandbox",l="www_tier";a=function(){function a(){}var d=a.prototype;d.patchRequestHeaders=function(a){var d={},e=c("RTISubscriptionManagerConfig").bladerunner_www_sandbox,f=c("RTISubscriptionManagerConfig").is_intern;if(!(h||(h=c("isEmpty")))(c("WebDriverConfig").auxiliaryServiceInfo)){var g;g=(g=c("WebDriverConfig").auxiliaryServiceInfo.BladeRunner)!=null?g:c("WebDriverConfig").auxiliaryServiceInfo["BladeRunner-sandcastle"];g!=null?(typeof g.ip_address==="string"?d[j]=g.ip_address+":18295":typeof g.hostname==="string"&&(d[j]=g.hostname+":18295"),typeof c("WebDriverConfig").originHost==="string"&&(d[k]="www."+c("WebDriverConfig").originHost)):e!=null&&(d[i]=e)}else e!=null&&(d[i]=e);f===!0&&(d[l]="intern");if(c("WebDriverConfig").isTestRunning&&c("gkx")("20919")){g=b("cr:3024")==null?void 0:b("cr:3024").get();g!=null&&(d.is_test="true",d.original_request_id=g)}c("gkx")("20929")&&(d["Accept-Ack"]="RSAck");for(e in a)d[e]=a[e];d.http_referer=window.location.href;return d};return a}();d=new a();e=d;g["default"]=e}),98);
__d("BladeRunnerLogger",["FBLogger","ODS"],(function(a,b,c,d,e,f,g){var h,i="bladerunner_js_client",j={info:"info",warning:"warning",exception:"exception"};a=function(){function a(){this.setFBLoggerLevel(1)}var b=a.prototype;b.info=function(a){this.$2>=2&&c("FBLogger")(i).info("BladeRunner info: %s",a),this.$3(j.info,a)};b.warn=function(a){this.$2>=1&&c("FBLogger")(i).warn("BladeRunner warn: %s",a),this.$3(j.warning,a)};b.exception=function(a,b){b===void 0&&(b="");var d=b+" "+a.toString();this.$2>=0&&c("FBLogger")(i).warn("BladeRunner exception: %s, %s",b,a.toString());this.$3(j.exception,d)};b.trimForLogging=function(a){var b=1024;return typeof a==="string"&&a.length>b?"[trimmed]:"+a.substring(0,b)+"...":a};b.bumpCounter=function(a,b){b===void 0&&(b=1),(h||(h=d("ODS"))).bumpEntityKey(2966,"BladeRunnerClient",a,b)};b.setClientSessionId=function(a){this.$1=a};b.setFBLoggerLevel=function(a){this.$2=a};b.$3=function(a,b){};return a}();b=new a();e=b;g["default"]=e}),98);
__d("BladeRunnerTypes",[],(function(a,b,c,d,e,f,g){a={REQUEST:1,DATA:2,DATA_ACK:3,STATUS_UPDATE:4,REWRITE_REQUEST:5,LOG:6};b={BLADE_RUNNER:1,GATEWAY:2};g.StreamFrameType=a;g.StreamRequestType=b}),98);
__d("BladeRunnerTypesInternal",["Base64","BladeRunnerLogger","BladeRunnerTypes"],(function(a,b,c,d,e,f,g){var h=function(){function a(){}var b=a.prototype;b.getHeaders=function(){if(this.headers!=null)return this.headers;throw new Error("Expected headers")};b.getInstrumentationData=function(){if(this.instrumentationData!=null&&this.instrumentationData.length>0)try{return JSON.parse(this.instrumentationData)}catch(a){return null}else return null};b.updateRetryRequestPayload=function(a){a!=null?this.payload=c("Base64").encode(a):this.payload=null};a.readObject=function(b){var c=new a();c.streamId=o(b.streamId);c.requestType=o(b.requestType);c.payload=r(b.payload);c.headers=u(b.headers);c.extraHeader=r(b.extraHeader);c.requestTarget=r(b.requestTarget);c.instrumentationData=r(b.instrumentationData);return c};return a}(),i=function(){function a(){}a.readObject=function(b){var c=new a();c.streamId=o(b.streamId);c.dataId=p(b.dataId);c.data=r(b.data);c.shouldAck=w(b.shouldAck);return c};var b=a.prototype;b.rawData=function(){if(this.data==null)throw new Error("Expected data");return this.data};b.rawDataSize=function(){return this.data==null?0:this.data.length};b.decodeData=function(){if(this.data==null)throw new Error("Expected data");return c("Base64").decode(this.data)};b.setData=function(a){this.data=c("Base64").encode(a)};b.getInstrumentationData=function(){if(this.instrumentationData!=null)return JSON.parse(this.instrumentationData);else return null};return a}(),j=function(){function a(){}a.readObject=function(b){var c=new a();c.streamId=o(b.streamId);c.dataId=o(b.dataId);c.success=v(b.success);c.message=r(b.message);c.code=p(b.code);return c};return a}();j.ACK_CODE_LANDED_AND_ACCEPTED=20;j.ACK_CODE_LANDED_BUT_NOT_ACCEPTED=21;j.ACK_CODE_FAILED_TO_LAND=50;var k=function(){function a(){}a.readObject=function(b){var c=new a();c.streamId=p(b.streamId);c.message=r(b.message);return c};return a}(),l=function(){function a(){}a.readObject=function(b){var c=new a();c.streamId=o(b.streamId);c.status=o(b.status);c.message=r(b.message);c.code=p(b.code);c.shouldRetry=w(b.shouldRetry);c.retryDelayMs=p(b.retryDelayMs);return c};return a}(),m=function(){function a(){}a.readObject=function(b){var c=new a();c.streamId=o(b.streamId);c.newBody=r(b.newBody);c.newExtraHeader=r(b.newExtraHeader);c.patchExtraHeader=r(b.patchExtraHeader);c.killBody=w(b.killBody);c.temporary=w(b.temporary);return c};return a}(),n=function(){function a(){}var b=a.prototype;b.getRequest=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.REQUEST&&this.request!=null)return this.request;throw new Error("Expected request")};b.getData=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.DATA&&this.data!=null)return this.data;throw new Error("Expected data")};b.getDataAck=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.DATA_ACK&&this.dataAck!=null)return this.dataAck;throw new Error("Expected dataAck")};b.getStatusUpdate=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE&&this.statusUpdate!=null)return this.statusUpdate;throw new Error("Expected status update")};b.getLog=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.LOG&&this.log!=null)return this.log;throw new Error("Expected log")};b.getRewriteRequest=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.REWRITE_REQUEST&&this.rewriteRequest!=null)return this.rewriteRequest;throw new Error("Expected rewrite request")};b.getStreamId=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.REQUEST&&this.request!=null)return this.request.streamId;if(this.type==d("BladeRunnerTypes").StreamFrameType.DATA&&this.data!=null)return this.data.streamId;if(this.type==d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE&&this.statusUpdate!=null)return this.statusUpdate.streamId;if(this.type==d("BladeRunnerTypes").StreamFrameType.LOG&&this.log!=null)return this.log.streamId;if(this.type==d("BladeRunnerTypes").StreamFrameType.REWRITE_REQUEST&&this.rewriteRequest!=null)return this.rewriteRequest.streamId;if(this.type==d("BladeRunnerTypes").StreamFrameType.DATA_ACK&&this.dataAck!=null)return this.dataAck.streamId;throw new Error("Frame with unexpected type")};b.isInstrumented=function(){if(this.type===d("BladeRunnerTypes").StreamFrameType.REQUEST)return this.getRequest().instrumentationData!=null;else if(this.type===d("BladeRunnerTypes").StreamFrameType.DATA)return this.getData().instrumentationData!=null;else return!1};a.readObject=function(b){var e=new a();e.type=o(b.type);switch(e.type){case d("BladeRunnerTypes").StreamFrameType.REQUEST:e.request=h.readObject(s(b.request));break;case d("BladeRunnerTypes").StreamFrameType.DATA:e.data=i.readObject(s(b.data));break;case d("BladeRunnerTypes").StreamFrameType.DATA_ACK:e.dataAck=j.readObject(s(b.dataAck));break;case d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE:e.statusUpdate=l.readObject(s(b.statusUpdate));break;case d("BladeRunnerTypes").StreamFrameType.LOG:e.log=k.readObject(s(b.log));break;case d("BladeRunnerTypes").StreamFrameType.REWRITE_REQUEST:e.rewriteRequest=m.readObject(s(b.rewriteRequest));break;default:c("BladeRunnerLogger").warn("Frame with unexpected type: "+e.type);return null}return e};a.newRequestFrame=function(b){var c=new a();c.type=d("BladeRunnerTypes").StreamFrameType.REQUEST;c.request=b;return c};a.newDataFrame=function(b){var c=new a();c.type=d("BladeRunnerTypes").StreamFrameType.DATA;c.data=b;return c};a.newDataAckFrame=function(b){var c=new a();c.type=d("BladeRunnerTypes").StreamFrameType.DATA_ACK;c.dataAck=b;return c};a.newStatusUpdateFrame=function(b){var c=new a();c.type=d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE;c.statusUpdate=b;return c};a.newLogFrame=function(b){var c=new a();c.type=d("BladeRunnerTypes").StreamFrameType.LOG;c.log=b;return c};a.newRewriteRequestFrame=function(b){var c=new a();c.type=d("BladeRunnerTypes").StreamFrameType.REWRITE_REQUEST;c.rewriteRequest=b;return c};return a}();a=function(){function a(a,b,c){this.batchId=a,this.frames=b,this.instrumentationData=c}var b=a.prototype;b.getFrames=function(){if(this.frames!=null)return this.frames;throw new Error("Expected frames")};b.getInstrumentationData=function(){if(this.instrumentationData!=null)try{return JSON.parse(this.instrumentationData)}catch(a){return null}else return null};b.getInstrumentationDataDfTraceId=function(){if(this.instrumentationData!=null)try{var a=JSON.parse(this.instrumentationData);return(a=a.dataFlowTracingData)==null?void 0:a.traceId}catch(a){return null}else return null};b.write=function(){return JSON.stringify(this)};b.isInstrumented=function(){return this.getFrames().some(function(a){return a.isInstrumented()})};a.read=function(b){b=JSON.parse(b);var c=b.batchId||0,d=[];for(var e=b.frames,f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=e.length)break;h=e[g++]}else{g=e.next();if(g.done)break;h=g.value}h=h;h=n.readObject(h);h!=null&&d.push(h)}h=b.instrumentationData||null;return new a(c,d,h)};return a}();function o(a){if(typeof a==="number")return a;throw new Error("Expected number")}function p(a){return a==null?null:o(a)}function q(a){if(typeof a==="string")return a;throw new Error("Expected string")}function r(a){return a==null?null:q(a)}function s(a){if(typeof a==="object"&&a!=null)return a;throw new Error("Expected object")}function t(a){if(typeof a==="object"&&a!=null){var b=a,c={};Object.keys(b).forEach(function(a){var d=b[a];typeof d==="string"&&d!=null&&(c[a]=d)});return c}throw new Error("Expected string map")}function u(a){return a==null?null:t(a)}function v(a){if(typeof a==="boolean"&&a!=null)return a;throw new Error("Expected boolean")}function w(a){return a==null?null:v(a)}g.GatewayStreamRequest=h;g.GatewayStreamData=i;g.GatewayStreamDataAck=j;g.GatewayStreamLog=k;g.GatewayStreamStatusUpdate=l;g.GatewayStreamRewriteRequest=m;g.GatewayStreamFrame=n;g.GatewayStreamBatch=a}),98);
__d("RequestStreamE2EClientLoggerEvent",[],(function(a,b,c,d,e,f){a=Object.freeze({RECEIVED:"received",SENT:"sent",FAILURE:"failure",PUBACK:"puback"});f["default"]=a}),66);
__d("RequestStreamE2EClientLoggerMessageType",[],(function(a,b,c,d,e,f){a=Object.freeze({REQUEST_STREAM:"request_stream",AMENDMENT:"amendment",AMENDMENT_ACK:"amendment_ack",CANCEL:"cancel",RESPONSE:"response",RESPONSE_ACK:"response_ack",TIMED_REQUEST:"timed_request",INTERRUPT:"interrupt"});f["default"]=a}),66);
__d("BladeRunnerEventHandler",["BladeRunnerLogger","BladeRunnerStreamStatus","BladeRunnerTypes","BladeRunnerTypesInternal","RequestStreamE2EClientLoggerEvent","RequestStreamE2EClientLoggerMessageType","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g){var h=1e3;a=function(){function a(a,b,c){this.$2=a,this.$1=b,this.$3=c}var b=a.prototype;b.onProxyResponse=function(a){this.$4(a);var b=[];for(var e=a.getFrames(),f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=e.length)break;h=e[g++]}else{g=e.next();if(g.done)break;h=g.value}h=h;this.$2.witnessFrame(h)&&b.push(h)}h=this.$2.getRequest();(g=h.e2eLogger)==null?void 0:g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").SENT,{},(f=a.getInstrumentationData())==null?void 0:f.auxId,null,a.getInstrumentationDataDfTraceId());b.length>0&&this.$5(new(d("BladeRunnerTypesInternal").GatewayStreamBatch)(a.batchId,b,a.instrumentationData))};b.onDisconnect=function(){this.$2.resetErrors();var a=new(d("BladeRunnerTypesInternal").GatewayStreamStatusUpdate)();a.streamId=this.$2.getRequest().streamId;a.status=d("BladeRunnerStreamStatus").StreamStatus.CLOSED;a.shouldRetry=!0;a.retryDelayMs=0;a=new(d("BladeRunnerTypesInternal").GatewayStreamBatch)(null,[d("BladeRunnerTypesInternal").GatewayStreamFrame.newStatusUpdateFrame(a)]);this.onProxyResponse(a)};b.$4=function(a){var b=this;a=a.getFrames().filter(function(a){return a.type==d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE});for(var a=a,e=Array.isArray(a),f=0,a=e?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=a.length)break;g=a[f++]}else{f=a.next();if(f.done)break;g=f.value}g=g;g=g.getStatusUpdate();if(g.status==d("BladeRunnerStreamStatus").StreamStatus.CLOSED||g.status==d("BladeRunnerStreamStatus").StreamStatus.REJECTED){this.$2.onError();var i=g.shouldRetry!=null&&g.shouldRetry,j=g.message!=null?g.message:"null";if(i&&this.$2.getErrorCount()<=this.$2.getRetriesAllowed()){g.status=d("BladeRunnerStreamStatus").StreamStatus.STOPPED;var k=h;g.retryDelayMs!=null&&(k=g.retryDelayMs);c("BladeRunnerLogger").info("Can retry: stream "+g.streamId+" closed with status "+g.status+", message "+j+". Error count: "+this.$2.getErrorCount()+", retryDelay "+k+"ms. Already retrying: "+this.$2.getRetryRequestScheduled().toString());this.$2.getRetryRequestScheduled()?c("BladeRunnerLogger").bumpCounter("stream_closed_already_retrying"):(c("BladeRunnerLogger").bumpCounter("stream_closed_will_retry"),this.$2.setRetryRequestScheduled(!0),k>0?c("setTimeoutAcrossTransitions")(function(){return b.$6()},k):this.$6())}else c("BladeRunnerLogger").info("Will not retry: stream "+g.streamId+" closed with status "+g.status+", message "+j+". Error count: "+this.$2.getErrorCount()+", shouldRetry "+i.toString()+". Already retrying: "+this.$2.getRetryRequestScheduled().toString()),i?c("BladeRunnerLogger").bumpCounter("stream_closed_retry_exceeded"):c("BladeRunnerLogger").bumpCounter("stream_closed_no_retry"),this.$3.removeStream(g.streamId)}}};b.$6=function(){this.$2.setRetryRequestScheduled(!1);if(this.$2.isAlive()){var a=this.$1.getUpdatedRequestBody();a!=null&&this.$2.updateRetryRequestPayload(a);this.$3.sendRetryStreamRequest(this.$2)}};b.$5=function(a){c("BladeRunnerLogger").bumpCounter("send_to_handler");var b=[];this.$1.onBatch(a);for(var a=a.getFrames(),e=Array.isArray(a),f=0,a=e?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=a.length)break;g=a[f++]}else{f=a.next();if(f.done)break;g=f.value}g=g;try{switch(g.type){case d("BladeRunnerTypes").StreamFrameType.DATA:this.$1.onData(g.getData());b.push(g.getData());break;case d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE:this.$1.onStatusUpdate(g.getStatusUpdate().status);break;case d("BladeRunnerTypes").StreamFrameType.LOG:g=g.getLog().message;g!=null&&this.$1.onLog(g);break;case d("BladeRunnerTypes").StreamFrameType.DATA_ACK:break;default:throw new Error("Frame with unexpected type")}}catch(a){c("BladeRunnerLogger").bumpCounter("send_to_handler_error"),c("BladeRunnerLogger").exception(a,"Failed sending frame to stream handler")}}this.$7(b)};b.$7=function(a){var b=[];for(var c=0;c<a.length;c++){var e=a[c];if(e.shouldAck===!0&&e.dataId!=null){var f=new(d("BladeRunnerTypesInternal").GatewayStreamDataAck)();f.streamId=e.streamId;f.dataId=e.dataId;f.success=!0;b.push(f)}}this.$3.sendDataAcks(b)};return a}();g["default"]=a}),98);
__d("RtiRequestStreamE2eClientBatchFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("819");b=d("FalcoLoggerInternal").create("rti_request_stream_e2e_client_batch",a);e=b;g["default"]=e}),98);
__d("RtiRequestStreamE2eClientFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1857112");b=d("FalcoLoggerInternal").create("rti_request_stream_e2e_client",a);e=b;g["default"]=e}),98);
__d("RequestStreamE2ELogger",["ConstUriUtils","RequestStreamE2EClientLoggerEvent","RequestStreamE2EClientLoggerMessageType","RtiRequestStreamE2eClientBatchFalcoEvent","RtiRequestStreamE2eClientFalcoEvent"],(function(a,b,c,d,e,f,g){"use strict";var h=["FBGQLS:COMMENT_CREATE_SUBSCRIBE","FBGQLS:COMMENT_LIKE_SUBSCRIBE","FBGQLS:FEEDBACK_COMMENT_PERMISSION_TOGGLE_SUBSCRIBE","FBGQLS:FEEDBACK_TYPING_SUBSCRIBE","FBLQ:comet_notifications_live_query_experimental"],i=0;function j(){var a=Date.now();i>=a?i+=1:i=a;return i.toString()}var k=function(){function a(a,b,c,e,f,g,h,i,j,k){this.$10=[];this.$11=!1;this.$1=a;this.$2=b;this.$3=c;this.$4=e;this.$5=f;this.$6=g;this.$7=h;this.$8=i;this.$9=j;this.$12=(a=k)!=null?a:!1;b=d("ConstUriUtils").getUri(window.location.href);b&&(this.$13=b.getDomain())}var b=a.prototype;b.logE2EEvent=function(a,b,c,d,e,f){c===void 0&&(c=null);d===void 0&&(d=null);e===void 0&&(e=null);f===void 0&&(f=null);if(this.$3==="Falco")return;e={request_id:this.$1,resume_id:"0",retry_id:e,transport:this.$2,method:this.$3,use_case:this.$4,request_log_context:this.$5,force_log_context:this.$6,e2e_sample_rate:this.$7,message_type:a,event:b,timestamp_ms:j(),aux_id:d,additional_data:c,dgw_stream_group_logging_id:this.$8,dgw_count_prior_streams_in_group:this.$9,domain:this.$13,df_trace_id:f};this.$14(e)};b.$14=function(a){if(!this.$12){c("RtiRequestStreamE2eClientFalcoEvent").log(function(){return a});return}this.$10.push(a);if(this.$11||a.event==c("RequestStreamE2EClientLoggerEvent").FAILURE||a.message_type==c("RequestStreamE2EClientLoggerMessageType").RESPONSE){var b={events:this.$10};c("RtiRequestStreamE2eClientBatchFalcoEvent").log(function(){return b});this.$10=[];this.$11=!0}};b.getRequestId=function(){return this.$1};return a}();function a(a,b,c){if(a==null||a.method==null)return null;var d=!1;h.includes(a.method)&&(d=!0);if(b==null||b.length==0)return null;b=JSON.parse(b);return b.requestId==null?null:new k(b.requestId,c,a.method,l(a.method,a),b.requestLogContext,b.forceLogContext,b.sampleRate,b.dgwStreamGroupLoggingId,b.dgwCountPriorStreamsInGroup,d)}function l(a,b){if(a==="FBLQ"&&b.config_id)return b.config_id;if(a==="SKY"){if(b.topic){var c=b.topic.lastIndexOf("/");return c>0?b.topic.substr(0,c):b.topic}return}return a}function b(a,b,d,e,f,g){f===void 0&&(f=null);g===void 0&&(g=null);if(a==null||a.requestId==null||a.clientLoggingDisabled!=null)return;var h={request_id:a.requestId,resume_id:"0",transport:b,e2e_sample_rate:a.sampleRate,message_type:d,event:e,timestamp_ms:j(),aux_id:a.auxId,additional_data:f,df_trace_id:g};c("RtiRequestStreamE2eClientFalcoEvent").log(function(){return h})}g.RequestStreamE2ELogger=k;g.createStreamLogger=a;g.logRequestStreamE2EEventStatic=b}),98);
__d("RequestStreamTransport",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["WEB_BR_MQTT","WEB_RS_MQTT","WEB_RS_STARGATE"]);f.RequestStreamTransport=a}),66);
__d("BladeRunnerSocket",["BladeRunnerEventHandler","BladeRunnerLogger","BladeRunnerStreamStatus","BladeRunnerTypes","BladeRunnerTypesInternal","CurrentUser","FBMqttChannel","MqttPublishListener","Promise","RequestStreamE2EClientLoggerEvent","RequestStreamE2EClientLoggerMessageType","RequestStreamE2ELogger","RequestStreamTransport","justknobx","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i="Connected",j="Disconnected",k="/br_sr",l="/sr_res",m=null;function n(a){var b;switch(a.type){case d("BladeRunnerTypes").StreamFrameType.REQUEST:return(b=a.request)==null?void 0:b.getInstrumentationData();case d("BladeRunnerTypes").StreamFrameType.DATA:return(b=a.data)==null?void 0:b.getInstrumentationData()}return null}function o(a){switch(a.type){case d("BladeRunnerTypes").StreamFrameType.REQUEST:return c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM;case d("BladeRunnerTypes").StreamFrameType.DATA:return c("RequestStreamE2EClientLoggerMessageType").AMENDMENT}return null}function p(a){if(a===null)return null;switch(a){case d("BladeRunnerStreamStatus").StreamStatus.ACCEPTED:return"Accepted";case d("BladeRunnerStreamStatus").StreamStatus.REJECTED:return"Rejected";case d("BladeRunnerStreamStatus").StreamStatus.STARTED:return"Started";case d("BladeRunnerStreamStatus").StreamStatus.STOPPED:return"Stopped";case d("BladeRunnerStreamStatus").StreamStatus.CLOSED:return"Closed"}return null}function q(a){var b={};a==null?void 0:(a=a.frames)==null?void 0:a.forEach(function(a){if(a.type===d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE){a=(a=a.statusUpdate)==null?void 0:a.status;a=p(a);a!==null&&(b.flow_status=a)}});return b}function r(a,b){var c;switch(a.type){case d("BladeRunnerTypes").StreamFrameType.REQUEST:b.data_base64_size=(c=a.request)==null?void 0:(c=c.payload)==null?void 0:(c=c.length)==null?void 0:c.toString();break;case d("BladeRunnerTypes").StreamFrameType.DATA:b.data_base64_size=(c=a.data)==null?void 0:(b=c.rawDataSize())==null?void 0:b.toString();break}return null}function s(a,b,e){var f=n(a);if(f==null)return;var g=o(a);if(g==null)return;var h=null;switch(b){case d("MqttPublishListener").MqttPublishEvent.SENT:h=c("RequestStreamE2EClientLoggerEvent").SENT;break;case d("MqttPublishListener").MqttPublishEvent.ACKED:h=c("RequestStreamE2EClientLoggerEvent").PUBACK;break;case d("MqttPublishListener").MqttPublishEvent.NOT_ACKED:case d("MqttPublishListener").MqttPublishEvent.NOT_CONNECTED:case d("MqttPublishListener").MqttPublishEvent.PUBLISH_ERROR:h=c("RequestStreamE2EClientLoggerEvent").FAILURE;e.reason==null&&(e.reason=b);break}if(h==null)return;r(a,e);if(((b=a.request)==null?void 0:b.e2eLogger)!=null&&f.clientLoggingDisabled==null){(b=a.request)==null?void 0:b.e2eLogger.logE2EEvent(g,h,e,f.auxId)}else d("RequestStreamE2ELogger").logRequestStreamE2EEventStatic(f,d("RequestStreamTransport").RequestStreamTransport.WEB_BR_MQTT,g,h,e)}a=function(){function a(a){this.$1=[],this.$2=0,this.$3=0,this.$4=null,this.$5=0,this.$6=new Map(),this.$7=a!=null?a:c("FBMqttChannel"),this.$8=new Map(),c("BladeRunnerLogger").setClientSessionId(c("uuidv4")()),this.$9()}a.get=function(){m==null&&(m=new a(c("FBMqttChannel")));return m};var e=a.prototype;e.sendNewStreamRequest=function(b,d){d=new(c("BladeRunnerEventHandler"))(b,d,this);var e=b.getRequest();this.$6.set(e.streamId,d);if(!this.$10()){this.$11(d,e.streamId);return}this.getStreamCount()<=a.maxStreamCount?this.$12(e):(c("BladeRunnerLogger").bumpCounter("socket_request_throttled_max_streams"),c("BladeRunnerLogger").warn("Maximum stream count reached, will not send request: "+JSON.stringify(b.getRequest().getHeaders())),this.$11(d,e.streamId))};e.sendRetryStreamRequest=function(a){this.$12(a.getRequest())};e.sendCancel=function(a){c("BladeRunnerLogger").bumpCounter("socket_send_cancel");var b=new(d("BladeRunnerTypesInternal").GatewayStreamStatusUpdate)();b.streamId=a.streamId;b.status=d("BladeRunnerStreamStatus").StreamStatus.CLOSED;this.$13(b,a);this.removeStream(a.streamId)};e.sendAmendment=function(a,b,e){c("BladeRunnerLogger").bumpCounter("socket_send_amendment");var f=new(d("BladeRunnerTypesInternal").GatewayStreamData)();f.streamId=a;f.setData(b);e!=null&&(f.instrumentationData=e);this.$14(f)};e.sendAmendmentWithAck=function(a,e,f){var g=this;c("BladeRunnerLogger").bumpCounter("socket_send_amendment");var i=this.$15(),j=new(d("BladeRunnerTypesInternal").GatewayStreamData)();j.streamId=a;j.setData(e);j.shouldAck=!0;j.dataId=i;f!=null&&(j.instrumentationData=f);a=new(h||(h=b("Promise")))(function(a,b){g.$8.set(i,{resolve:a,reject:b})});this.$14(j);return a};e.$14=function(a){this.$1.push(d("BladeRunnerTypesInternal").GatewayStreamFrame.newDataFrame(a)),this.$16()};e.sendDataAcks=function(a){c("BladeRunnerLogger").bumpCounter("socket_send_data_ack",a.length),this.$17(a)};e.removeStream=function(a){this.$6["delete"](a)};e.getStreamCount=function(){return this.$6.size};e.getNextStreamId=function(){this.$5++;return this.$5};e.onMQTTStateChanged=function(a){this.$16();if(a!=j&&a!=i||this.$4==a)return;this.$4=a;c("BladeRunnerLogger").info("MQTTStateChanged: "+a);a==j?(c("BladeRunnerLogger").bumpCounter("mqtt_state_disconnected"),this.$18()):a==i&&c("BladeRunnerLogger").bumpCounter("mqtt_state_connected")};e.$12=function(a){c("BladeRunnerLogger").bumpCounter("socket_send_request");this.$1.push(d("BladeRunnerTypesInternal").GatewayStreamFrame.newRequestFrame(a));if(!this.$16()){(a=a.e2eLogger)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"MQTT Not Connected"})}};e.$13=function(a,b){this.$1.push(d("BladeRunnerTypesInternal").GatewayStreamFrame.newStatusUpdateFrame(a));if(this.$16()){(a=b.e2eLogger)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").CANCEL,c("RequestStreamE2EClientLoggerEvent").SENT)}};e.$17=function(a){for(var b=0;b<a.length;b++){var c=a[b];this.$1.push(d("BladeRunnerTypesInternal").GatewayStreamFrame.newDataAckFrame(c))}this.$16()};e.$19=function(){this.$2++;return this.$2};e.$15=function(){this.$3++;return this.$3};e.$16=function(){var a=!1;if(this.$7.getConnectionState()===i&&this.$1.length>0)try{this.$20(this.$1),a=!0}catch(a){}finally{this.$1=[]}return a};e.$20=function(a){var b=this,e=new(d("BladeRunnerTypesInternal").GatewayStreamBatch)(this.$19(),a),f=e.write();if(f.length>this.$21()){var g=Math.floor(a.length/2);if(g===0){a.forEach(function(a){return s(a,d("MqttPublishListener").MqttPublishEvent.PUBLISH_ERROR,{reason:"too long"})});var h=new Error("Publish is too long: "+f.length);h.stack;this.$22(e,h,"Publish is too long");throw h}this.$20(a.slice(0,g));this.$20(a.slice(g,a.length))}else try{c("BladeRunnerLogger").info("send message to "+k+" ("+f.length+" bytes)");h={qos:1,skipBuffer:!1};if(e.isInstrumented()){var i=Date.now();h.listener={onEvent:function(b){var c=(Date.now()-i).toString();a.forEach(function(a){s(a,b,{latency:c})})}}}this.$7.publish(k,f,h)["catch"](function(a){b.$22(e,a,"Failed publishing to MQTT")});c("BladeRunnerLogger").bumpCounter("mqtt_publish_success")}catch(a){this.$22(e,a,"Failed publishing to MQTT");throw a}};e.$9=function(){var a=this;c("BladeRunnerLogger").info("Starting socket with endpoint "+this.$7.getEndpoint()+" useragent "+navigator.userAgent);this.onMQTTStateChanged(this.$7.getConnectionState());this.$7.subscribeChannelEvents({onMQTTStateChanged:function(b){a.onMQTTStateChanged(b)},onJSError:function(a){var b=a!=null&&typeof a.isRecoverable==="boolean"?a.isRecoverable:!1;b?c("BladeRunnerLogger").bumpCounter("mqtt_channel_recoverable_error"):(c("BladeRunnerLogger").warn("JS error in MQTTChannel: "+(typeof a=="object"&&a!=null?a.toString():"unknown error")+", "+JSON.stringify(a)),c("BladeRunnerLogger").bumpCounter("mqtt_channel_error"))}});this.$7.subscribe(k,function(a){throw new Error("Unexpected response: "+k+" "+a.toString())});this.$7.subscribe(l,function(b){a.$23(b)})};e.$23=function(a){a=d("BladeRunnerTypesInternal").GatewayStreamBatch.read(a);this.processBatch(a)};e.$22=function(a,b,e){for(var a=a.getFrames(),f=Array.isArray(a),g=0,a=f?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=a.length)break;h=a[g++]}else{g=a.next();if(g.done)break;h=g.value}h=h;if(h.type===d("BladeRunnerTypes").StreamFrameType.REQUEST){var i=h.getRequest(),j=this.$6.get(i.streamId);j!=null&&this.$24(j,i.streamId,d("BladeRunnerStreamStatus").StreamStatus.CLOSED,!0,null)}else if(h.type===d("BladeRunnerTypes").StreamFrameType.DATA){j=h.getData();i=j.dataId;if(j.shouldAck!=null&&j.shouldAck&&i!=null){h=new(d("BladeRunnerTypesInternal").GatewayStreamDataAck)();h.streamId=j.streamId;h.dataId=i;h.success=!1;h.code=d("BladeRunnerTypesInternal").GatewayStreamDataAck.ACK_CODE_FAILED_TO_LAND;h.message=e;this.$25(h)}}}c("BladeRunnerLogger").info("Failed publishing to MQTT: "+b.message);c("BladeRunnerLogger").bumpCounter("mqtt_publish_error")};e.$25=function(a){var b=this.$8.get(a.dataId);b!=null&&(this.$8["delete"](a.dataId),a.success?b.resolve(!0):a.code===d("BladeRunnerTypesInternal").GatewayStreamDataAck.ACK_CODE_LANDED_BUT_NOT_ACCEPTED?b.resolve(!1):b.reject(a.message))};e.processBatch=function(a){try{d("RequestStreamE2ELogger").logRequestStreamE2EEventStatic(a.getInstrumentationData(),d("RequestStreamTransport").RequestStreamTransport.WEB_BR_MQTT,c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").RECEIVED,q(a),a.getInstrumentationDataDfTraceId());c("BladeRunnerLogger").bumpCounter("socket_process_batch");var b=JSON.stringify(a);c("BladeRunnerLogger").info("Received batch ("+b.length+" bytes)");b=null;for(var e=a.getFrames(),f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=e.length)break;h=e[g++]}else{g=e.next();if(g.done)break;h=g.value}h=h;var i=h.getStreamId();b==null&&(b=i);if(i!=null&&b!=i)throw new Error("Received batch with frames for multiple streams");h.type==d("BladeRunnerTypes").StreamFrameType.DATA_ACK&&this.$25(h.getDataAck())}if(b!=null){i=this.$6.get(b);i!=null?i.onProxyResponse(a):c("BladeRunnerLogger").info("Received batch with frames for unknown stream id: "+b)}else c("BladeRunnerLogger").info("Received batch with no frames")}catch(a){c("BladeRunnerLogger").exception(a,"Failed processing batch from MQTT");c("BladeRunnerLogger").bumpCounter("socket_process_batch_error");throw a}};e.$18=function(){this.$6.forEach(function(a,b,c){a.onDisconnect()})};e.$11=function(a,b){this.$24(a,b,d("BladeRunnerStreamStatus").StreamStatus.REJECTED,!1,0)};e.$24=function(a,b,c,e,f){var g=new(d("BladeRunnerTypesInternal").GatewayStreamStatusUpdate)();g.streamId=b;g.status=c;g.shouldRetry=e;g.retryDelayMs=f;b=new(d("BladeRunnerTypesInternal").GatewayStreamBatch)(null,[d("BladeRunnerTypesInternal").GatewayStreamFrame.newStatusUpdateFrame(g)]);a.onProxyResponse(b)};e.$10=function(){if(!c("CurrentUser").isLoggedIn()){c("BladeRunnerLogger").bumpCounter("request_stream_user_logged_out");return!1}return!0};e.$21=function(){var a=1024*1024,b=512*1024;try{var d=c("justknobx")._("317");b=d*a}catch(a){}return Math.max(b-1024,0)};return a}();a.maxStreamCount=2e3;g["default"]=a}),98);
__d("BladeRunnerStream",["Promise","regeneratorRuntime"],(function(a,b,c,d,e,f){var g;a=function(){function a(a){this.$1=a}var c=a.prototype;c.getStreamHandler=function(){return this.$1};c.cancel=function(){};c.amendWithAck=function(a){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:return a.abrupt("return",!1);case 1:case"end":return a.stop()}},null,this)};c.amendFireAndForget=function(a){};c.amendWithoutAck=function(a){};c.start=function(){return(g||(g=b("Promise"))).resolve()};c.isAlive=function(){return!1};c.canAmend=function(){return!1};c.getStatus=function(){return null};c.getStreamId=function(){return 0};return a}();f["default"]=a}),66);
__d("BladeRunnerStreamState",["BladeRunnerLogger","BladeRunnerStreamStatus","BladeRunnerTypes"],(function(a,b,c,d,e,f,g){a=function(){function a(a){this.$1=a,this.$2=null,this.$3=0,this.$4=!1,this.$5=0,this.$6=!1}var b=a.prototype;b.getRequest=function(){return this.$1};b.updateRetryRequestPayload=function(a){this.$1.updateRetryRequestPayload(a)};b.isAlive=function(){return!(this.$2==d("BladeRunnerStreamStatus").StreamStatus.CLOSED||this.$2==d("BladeRunnerStreamStatus").StreamStatus.REJECTED)};b.canAmend=function(){return this.$2==d("BladeRunnerStreamStatus").StreamStatus.ACCEPTED||this.$2==d("BladeRunnerStreamStatus").StreamStatus.STARTED||this.$2==d("BladeRunnerStreamStatus").StreamStatus.STOPPED};b.getLastStatus=function(){return this.$2};b.setLastStatus=function(a){this.$2=a};b.onError=function(){this.$3+=1};b.getErrorCount=function(){return this.$3};b.resetErrors=function(){this.$3=0};b.getRetryRequestScheduled=function(){return this.$6};b.setRetryRequestScheduled=function(a){this.$6=a};b.witnessFrame=function(a){switch(a.type){case d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE:var b=a.getStatusUpdate(),c=!0;switch(b.status){case d("BladeRunnerStreamStatus").StreamStatus.ACCEPTED:c=!this.$4;this.$4||(this.$4=!0);break;case d("BladeRunnerStreamStatus").StreamStatus.STARTED:c=this.getLastStatus()!=d("BladeRunnerStreamStatus").StreamStatus.STARTED;break;case d("BladeRunnerStreamStatus").StreamStatus.STOPPED:c=this.getLastStatus()==d("BladeRunnerStreamStatus").StreamStatus.STARTED;break;case d("BladeRunnerStreamStatus").StreamStatus.CLOSED:case d("BladeRunnerStreamStatus").StreamStatus.REJECTED:default:c=!0}this.setLastStatus(b.status);return c;case d("BladeRunnerTypes").StreamFrameType.REWRITE_REQUEST:this.$7(a.getRewriteRequest());return!1;default:return!0}};b.setRetriesAllowed=function(a){this.$5=a};b.getRetriesAllowed=function(){return this.$5};b.$7=function(a){if(!(a.temporary!=null||a.temporary==!0)){a.newBody!=null&&(this.$1.payload=a.newBody);a.newExtraHeader!=null&&(this.$1.extraHeader=a.newExtraHeader,this.$1.headers=JSON.parse(a.newExtraHeader));if(a.patchExtraHeader!=null)try{var b=JSON.parse(a.patchExtraHeader),d=this.$1.extraHeader!=null?JSON.parse(this.$1.extraHeader):{};this.$1.headers==null&&(this.$1.headers={});var e=Object.keys(b);for(var f=0;f<e.length;f++){var g=e[f];this.$1.headers[g]=b[g];d[g]=b[g]}this.$1.extraHeader=JSON.stringify(d)}catch(b){c("BladeRunnerLogger").warn("Failed to patch header: "+a.patchExtraHeader)}a.killBody!=null&&a.killBody==!0&&(this.$1.payload=null)}};return a}();g["default"]=a}),98);
__d("BladeRunnerSocketStream",["BladeRunnerStream","BladeRunnerStreamState","BladeRunnerStreamStatus","Promise","RequestStreamE2EClientLoggerEvent","RequestStreamE2EClientLoggerMessageType","regeneratorRuntime","uuidv4"],(function(a,b,c,d,e,f,g){var h,i=4,j={reason:"stream_dead"};a=function(a){babelHelpers.inheritsLoose(e,a);function e(b,d,e){b=a.call(this,b)||this;b.$BladeRunnerSocketStream1=e;b.$BladeRunnerSocketStream2=new(c("BladeRunnerStreamState"))(d);b.$BladeRunnerSocketStream2.setRetriesAllowed(i);return b}var f=e.prototype;f.start=function(){var a=this;return new(h||(h=b("Promise")))(function(b){a.send(),b()})};f.send=function(){var a,b=this.$BladeRunnerSocketStream2.getRequest();(a=b.e2eLogger)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").RECEIVED,{data_base64_size:(a=b.payload)==null?void 0:(b=a.length)==null?void 0:b.toString()});this.$BladeRunnerSocketStream1.sendNewStreamRequest(this.$BladeRunnerSocketStream2,this.getStreamHandler())};f.amendWithAck=function(a){var d,e,f,g,i,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:e=this.$BladeRunnerSocketStream2.getRequest();f=e.getInstrumentationData();f&&(f.auxId=c("uuidv4")(),(g=e.e2eLogger)==null?void 0:g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").RECEIVED,{data_size:a==null?void 0:(i=a.length)==null?void 0:i.toString()},f.auxId));if(!this.canAmend()){m.next=6;break}f&&((k=e.e2eLogger)==null?void 0:k.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").SENT,{data_size:a==null?void 0:(l=a.length)==null?void 0:l.toString()},f.auxId));return m.abrupt("return",this.$BladeRunnerSocketStream1.sendAmendmentWithAck(e.streamId,this.$BladeRunnerSocketStream3(a),f==null?null:JSON.stringify(f)));case 6:(d=e.e2eLogger)==null?void 0:d.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").FAILURE,j,f==null?void 0:f.auxId);return m.abrupt("return",(h||(h=b("Promise"))).reject("Stream is closed or not accepted"));case 8:case"end":return m.stop()}},null,this)};f.amendFireAndForget=function(a){var b=this.$BladeRunnerSocketStream2.getRequest(),d=b.getInstrumentationData();if(d){var e;d.auxId=c("uuidv4")();(e=b.e2eLogger)==null?void 0:e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").RECEIVED,{data_size:a==null?void 0:(e=a.length)==null?void 0:e.toString()},d.auxId)}if(this.canAmend()){this.$BladeRunnerSocketStream1.sendAmendment(this.$BladeRunnerSocketStream2.getRequest().streamId,this.$BladeRunnerSocketStream3(a),d==null?null:JSON.stringify(d));if(d){(e=b.e2eLogger)==null?void 0:e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").SENT,{data_size:a==null?void 0:(e=a.length)==null?void 0:e.toString()},d.auxId)}}else{(a=b.e2eLogger)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").FAILURE,j,d==null?void 0:d.auxId);throw new Error("Stream is closed or not accepted")}};f.amendWithoutAck=function(a){this.amendFireAndForget(a)};f.$BladeRunnerSocketStream3=function(a){return typeof a=="object"?btoa(new TextDecoder("utf8").decode(a)):a};f.cancel=function(){var a=this.$BladeRunnerSocketStream2.getRequest();(a=a.e2eLogger)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").CANCEL,c("RequestStreamE2EClientLoggerEvent").RECEIVED);this.isAlive()&&(this.$BladeRunnerSocketStream1.sendCancel(this.$BladeRunnerSocketStream2.getRequest()),this.$BladeRunnerSocketStream2.setLastStatus(d("BladeRunnerStreamStatus").StreamStatus.CLOSED),this.getStreamHandler().onClientCancel())};f.isAlive=function(){return this.$BladeRunnerSocketStream2.isAlive()};f.canAmend=function(){return this.$BladeRunnerSocketStream2.canAmend()};f.getStatus=function(){return this.$BladeRunnerSocketStream2.getLastStatus()};f.getStreamId=function(){return this.$BladeRunnerSocketStream2.getRequest().streamId};return e}(c("BladeRunnerStream"));g["default"]=a}),98);
__d("RequestStreamE2ESampling",["invariant","Random","RequestStreamE2EClientSamplingConfig","uuidv4"],(function(a,b,c,d,e,f,g,h){"use strict";function i(a){return a==null?!1:a.requestId!=null&&typeof a.requestId=="string"&&a.forceLogContext!=null&&typeof a.forceLogContext=="string"}function j(a,b){var d=c("RequestStreamE2EClientSamplingConfig").sampleRate;if(d>1&&a!=null){a=c("RequestStreamE2EClientSamplingConfig").methodToSamplingMultiplier[a];a==0?d=0:a!=null&&(d/=a)}return d==1?1:d/b}function k(a,b,d,e){var f=c("uuidv4")();(b.requestId==null||b.requestId===""||typeof b.requestId!="string")&&(a.requestId!=null&&typeof a.requestId=="string"?b.requestId=a.requestId:b.requestId=f);b.requestId+="/_"+f.substring(0,4);b.resumeId="0";d!=null?b.sampleRate=d:b.sampleRate=void 0;f="";e!=null&&e.length>0&&(f=e);f.length>0&&(b.requestLogContext!=null&&b.requestLogContext.length>0?b.requestLogContext+=":":b.requestLogContext="",b.requestLogContext+=f);(a==null?void 0:a.method)==="Falco"&&(b.clientLoggingDisabled="Falco");d={};for(e=Object.keys(b).sort(),f=Array.isArray(e),a=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(f){if(a>=e.length)break;g=e[a++]}else{a=e.next();if(a.done)break;g=a.value}g=g;d[g]=b[g]}return JSON.stringify(d)}function a(a,b,d,e){b&&(!b.requestId.includes("/")&&!b.requestId.includes("#")||h(0,41721));e=j(a.method,(e=e)!=null?e:1);if(c("Random").coinflip(e))return k(a,b||{requestId:""},e,d);return i(b)?k(a,b||{requestId:""},null,d):""}g.isForceLogged=i;g.getSampleRateForLogging=j;g.normalizeInstrumentationData=k;g.validateInstrumentationData=a}),98);
__d("BladeRunnerClient",["Base64","BladeRunnerConfig","BladeRunnerLogger","BladeRunnerSocket","BladeRunnerSocketStream","BladeRunnerTypes","BladeRunnerTypesInternal","RequestStreamE2ELogger","RequestStreamE2ESampling","RequestStreamTransport","cr:2046346"],(function(a,b,c,d,e,f,g){a=function(){function a(a,b){this.$2=d("RequestStreamTransport").RequestStreamTransport.WEB_BR_MQTT,this.$1=a!=null?a:c("BladeRunnerSocket").get(),b&&(this.$2=b)}var e=a.prototype;e.createStream=function(a,b,c,d){return this.$3(a,b,c,d)};e.requestStream=function(a,c,d,e){a=this.$3(a,c,d,e);a.send();b("cr:2046346")!=null&&b("cr:2046346").startPulsarTest();return a};e.logInfo=function(a){c("BladeRunnerLogger").info(a)};e.bumpCounter=function(a){c("BladeRunnerLogger").bumpCounter(a)};e.$3=function(a,b,e,f){var g=new(d("BladeRunnerTypesInternal").GatewayStreamRequest)();g.streamId=this.$1.getNextStreamId();g.requestType=d("BladeRunnerTypes").StreamRequestType.BLADE_RUNNER;g.headers=c("BladeRunnerConfig").patchRequestHeaders(a);g.extraHeader=JSON.stringify(g.headers);g.payload=b!=null?c("Base64").encode(b):null;f!=null&&(f.transport="WEB_RS_MQTT");g.instrumentationData=d("RequestStreamE2ESampling").validateInstrumentationData(g.headers||{},f);g.e2eLogger=d("RequestStreamE2ELogger").createStreamLogger(g.headers,g.instrumentationData,this.$2);return new(c("BladeRunnerSocketStream"))(e,g,this.$1)};return a}();g["default"]=a}),98);
__d("BootloaderEventsPerf",["invariant","Bootloader","BootloaderEvents","ResourceTimingStore","objectEntries","objectValues"],(function(a,b,c,d,e,f,g,h){var i={total_count:0,total_bytes:0,downloaded_count:0,downloaded_bytes:0,cached_count:0,cached_bytes:0,inlined_count:0,inlined_bytes:0,duration:0,missing_count:0};function j(a,b,c){return Math.max(0,((c=c)!=null?c:0)-Math.max(a,(c=b)!=null?c:0))}function k(){return{blocking:babelHelpers["extends"]({},i),nonblocking:babelHelpers["extends"]({},i),"default":babelHelpers["extends"]({},i)}}function l(a,b,c){var e,f;if(c==null)e=0,f="downloaded";else if(c[1])e=c[0].length,f="inlined";else{c=d("ResourceTimingStore").getEntryForURL(c[0]);c?(e=c.encodedBodySize,f=c.transferSize===0?"cached":"downloaded"):(e=0,f="downloaded",a.missing_count++)}a.total_count++;a.total_bytes+=e;if(!b)return;a.duration=Math.max(a.duration,b);switch(f){case"downloaded":a.downloaded_count++;a.downloaded_bytes+=e;break;case"inlined":a.inlined_count++;a.inlined_bytes+=e;break;case"cached":a.cached_count++;a.cached_bytes+=e;break}}function m(a,b,d,e,f){var g=c("Bootloader").getResourceState(b);l(a,j(d,g.loadStart,g.loadEnd),e);g.loadError!=null&&f.add(b)}function n(a,b,d,e){var f=k();for(var a=c("objectEntries")(a),g=Array.isArray(a),i=0,a=g?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var j;if(g){if(i>=a.length)break;j=a[i++]}else{i=a.next();if(i.done)break;j=i.value}j=j;var l=j[0];j=j[1];for(var j=j,n=Array.isArray(j),o=0,j=n?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var p;if(n){if(o>=j.length)break;p=j[o++]}else{o=j.next();if(o.done)break;p=o.value}p=p;var q=p[0];p=p[1];var r=void 0,s=void 0;switch(p.type){case"async":s=null;r=d;break;case"js":case"css":s=[p.src,p.d===1];r=f;break;default:p,h(0,3721)}m(r[l],q,b,s,e)}}return f}function o(a,b){var e={unpredicted:d("BootloaderEvents").newResourceMapSet(),ef:d("BootloaderEvents").newResourceMapSet(),overpredicted:d("BootloaderEvents").newResourceMapSet()};for(var f=c("objectEntries")(b),g=Array.isArray(f),h=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=f.length)break;i=f[h++]}else{h=f.next();if(h.done)break;i=h.value}i=i;var j=i[0];i=i[1];for(var i=i.entries(),k=Array.isArray(i),l=0,i=k?i:i[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var m;if(k){if(l>=i.length)break;m=i[l++]}else{l=i.next();if(l.done)break;m=l.value}m=m;var n=m[0];m=m[1];a[j].has(n)?e.ef[j].set(n,m):e.overpredicted[j].set(n,m)}}for(n=c("objectEntries")(a),m=Array.isArray(n),l=0,n=m?n:n[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(m){if(l>=n.length)break;k=n[l++]}else{l=n.next();if(l.done)break;k=l.value}i=k;j=i[0];h=i[1];for(g=h.entries(),f=Array.isArray(g),a=0,g=f?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(f){if(a>=g.length)break;k=g[a++]}else{a=g.next();if(a.done)break;k=a.value}i=k;h=i[0];k=i[1];b[j].has(h)||e.unpredicted[j].set(h,k)}}return e}function a(a){var b=a.efData,c=a.rsrcs,d=a.startTime,e=new Set(),f;if(b){var g=o(c,b.tierOne);f=g.unpredicted;g={ef:n(g.ef,b.fetchRsrcsStart,k(),e),overpredicted:n(g.overpredicted,b.fetchRsrcsStart,k(),e)};b={ef_fetch_predictions:b.fetchPredictionsEnd-b.fetchPredictionsStart,ef_fetch_start_wait:b.fetchPredictionsEnd-b.fetchRsrcsStart,ef_head_start:d-b.fetchRsrcsStart}}else f=c,g={},b={};c=babelHelpers["extends"]({unpredicted:n(f,d,k(),e)},g);return{source:a.source,source_detail:a.sourceDetail,is_first_identical:a.isFirstIdentical,timeslice_context:(f=a.timesliceContext)==null?void 0:f.name,start_time:d,err_count:e.size,resources:c,durations:babelHelpers["extends"]({jsmods_wait:a.jsmodsStart-d,jsmods:a.jsmodsEnd-a.jsmodsStart,jsmods_done_wait:a.jsmodsEnd-d,download_done_wait:a.logTime-d},b),payloadStats:a.payloadStats}}function b(a){var b=a.startTime,e=0,f=0,g=0,h=0;for(var i=a.components,m=Array.isArray(i),o=0,i=m?i:i[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var p;if(m){if(o>=i.length)break;p=i[o++]}else{o=i.next();if(o.done)break;p=o.value}p=p;p=c("Bootloader").getComponentTiming(p);var q=p.tierTwoStart,r=p.tierTwoEnd,s=p.tierThreeStart;p=p.tierThreeEnd;e=Math.max(e,j(b,q,r));f=Math.max(f,j(b,b,r));g=Math.max(g,j(b,s,p));h=Math.max(h,j(b,b,p))}q=new Set();r=k();s=n(a.tierOne,b,r,q);p=n(a.tierTwo,b,r,q);o=n(a.tierThree,b,r,q);m=r.blocking.downloaded_count!=0;i=k();var t=d("BootloaderEvents").newResourceMapSet(),u=new Set(),v=[a.tierOne,a.tierTwo,a.tierThree];for(var w=0;w<v.length;w++){var x=v[w];for(var x=c("objectValues")(x),y=Array.isArray(x),z=0,x=y?x:x[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var A;if(y){if(z>=x.length)break;A=x[z++]}else{z=x.next();if(z.done)break;A=z.value}A=A;for(var A=A.keys(),B=Array.isArray(A),C=0,A=B?A:A[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var D;if(B){if(C>=A.length)break;D=A[C++]}else{C=A.next();if(C.done)break;D=C.value}D=D;u.add(D)}}}D=0;C=0;B=0;for(A=a.beRequests.values(),z=Array.isArray(A),y=0,A=z?A:A[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(z){if(y>=A.length)break;x=A[y++]}else{y=A.next();if(y.done)break;x=y.value}v=x;D+=j(b,b,v.requestStart);C+=v.serverGenTime;B+=v.jsmodsEnd-v.jsmodsStart;l(i[m?"blocking":"nonblocking"],v.responseStart-v.requestStart,[v.uri,!1]);for(w=c("objectEntries")(v.rsrcs),x=Array.isArray(w),v=0,w=x?w:w[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var E;if(x){if(v>=w.length)break;E=w[v++]}else{v=w.next();if(v.done)break;E=v.value}E=E;var F=E[0];E=E[1];for(var E=E,G=Array.isArray(E),H=0,E=G?E:E[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var I;if(G){if(H>=E.length)break;I=E[H++]}else{H=E.next();if(H.done)break;I=H.value}I=I;var J=I[0];I=I[1];u.has(J)||t[F].set(J,I)}}}J=n(t,b,r,q);return{ref:a.ref,components:a.components,timeslice_context:(I=a.timesliceContext)==null?void 0:I.name,start_time:b,err_count:q.size,resources:{t1:s,t2:p,t3:o,be:i,unpredicted:J,async:r},durations:{fetch_start_wait:a.fetchStartTime-b,be_start_wait:D,be_server_gen:C,be_jsmods:B,callback_wait:a.callbackStart-b,callback:a.callbackEnd-a.callbackStart,bootload_done_wait:a.callbackEnd-b,rdfd_requirelazy:e,rdfd_done_wait:f,rd_requirelazy:g,rd_done_wait:h}}}function e(a){a.start_time;var b=a.resources,d=a.durations;a=babelHelpers.objectWithoutPropertiesLoose(a,["start_time","resources","durations"]);for(var b=c("objectEntries")(b),e=Array.isArray(b),f=0,b=e?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=b.length)break;g=b[f++]}else{f=b.next();if(f.done)break;g=f.value}g=g;var h=g[0];g=g[1];for(var g=c("objectEntries")(g),i=Array.isArray(g),j=0,g=i?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var k;if(i){if(j>=g.length)break;k=g[j++]}else{j=g.next();if(j.done)break;k=j.value}k=k;var l=k[0];k=k[1];for(var k=c("objectEntries")(k),m=Array.isArray(k),n=0,k=m?k:k[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var o;if(m){if(n>=k.length)break;o=k[n++]}else{n=k.next();if(n.done)break;o=n.value}o=o;var p=o[0];o=o[1];a[h+"_"+l+"_resources_"+p]=Math.round(Number(o))}}}for(p=c("objectEntries")(d),o=Array.isArray(p),n=0,p=o?p:p[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(o){if(n>=p.length)break;m=p[n++]}else{n=p.next();if(n.done)break;m=n.value}k=m;l=k[0];j=k[1];a[l+"_duration"]=Math.round(Number(j))}if(a.payloadStats){for(i=c("objectEntries")(a.payloadStats),g=Array.isArray(i),h=0,i=g?i:i[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(g){if(h>=i.length)break;f=i[h++]}else{h=i.next();if(h.done)break;f=h.value}e=f;b=e[0];d=e[1];for(m=c("objectEntries")(d),k=Array.isArray(m),l=0,m=k?m:m[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(k){if(l>=m.length)break;j=m[l++]}else{l=m.next();if(l.done)break;j=l.value}n=j;o=n[0];p=n[1];a[b+"_"+o+"_count"]=Math.round(Number(p))}}delete a.payloadStats}return a}g.computeHRData=a;g.computeBLData=b;g.flattenData=e}),98);
__d("BootloaderLoggingStatusEnum",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["SUCCESS","TIMEOUT"]);c=a;f["default"]=c}),66);
__d("CometBootloaderEventsTypedLoggerLite",["generateLiteTypedLogger"],(function(a,b,c,d,e,f){"use strict";e.exports=b("generateLiteTypedLogger")("logger:CometBootloaderEventsLoggerConfig")}),null);
__d("HasteResponseFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1823926");b=d("FalcoLoggerInternal").create("haste_response",a);e=b;g["default"]=e}),98);
__d("CometBootloaderLoggerUtil",["BootloaderEvents","BootloaderEventsPerf","CometBootloaderEventsTypedLoggerLite","CometTimeSpentNavigation","HasteResponseFalcoEvent","ResourceTimingStore","SiteData","performanceNavigationStart"],(function(a,b,c,d,e,f,g){"use strict";var h=!1;function a(a){var b=a.bl_sample_rate,e=a.hr_sample_rate,f=a.parent_lid;if(h||!(b||e))return;h=!0;d("ResourceTimingStore").init();var g=function(a){return{ms_since_navstart:Math.round(a-c("performanceNavigationStart")()),parent_lid:f,pkg_cohort:c("SiteData").pkg_cohort,request_path:(a=c("CometTimeSpentNavigation").getPathInfo())==null?void 0:a.name,svn_rev:c("SiteData").client_revision}};e&&d("BootloaderEvents").onHasteResponse(function(a){return c("HasteResponseFalcoEvent").log(function(){var b=d("BootloaderEventsPerf").computeHRData(a),c=d("BootloaderEventsPerf").flattenData(b);return babelHelpers["extends"]({},c,g(b.start_time))})});var i=function(a,b,e){a=d("BootloaderEventsPerf").computeBLData(a);var f=d("BootloaderEventsPerf").flattenData(a);c("CometBootloaderEventsTypedLoggerLite").log(babelHelpers["extends"]({},f,g(a.start_time),{status:b}),{weight:e})};b&&d("BootloaderEvents").onBootload(function(a){return i(a,"SUCCESS",b)});var j=1;d("BootloaderEvents").onBootloaderCallbackTimeout(function(a){return i(a,"TIMEOUT",j)})}g.initLogging=a}),98);
__d("CometSSREntrypoint",["objectValues","relay-runtime/util/withProvidedVariables"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b,d=c("relay-runtime/util/withProvidedVariables")(a.variables,a.parameters.params.providedVariables);return{actor_id:(b=(b=a.environmentProviderOptions)==null?void 0:b.actorID)!=null?b:null,exclude_from_ssr:(b=(b=a.environmentProviderOptions)==null?void 0:b.excludeFromSSR)!=null?b:!1,graphql_env_override_ref:(b=(b=a.environmentProviderOptions)==null?void 0:b.graphQLEnvOverrideRef)!=null?b:null,id:a.parameters.params.id,name:a.parameters.params.name,num_connections_for_ssr:(a=(b=a.environmentProviderOptions)==null?void 0:b.numConnectionsForSSR)!=null?a:null,variables:d}}function i(a,b){b=a.getPreloadProps(b);var d=b.entryPoints;b=b.queries;b=(b=b)!=null?b:{};var e=c("objectValues")(b).filter(function(a){return a!=null}),f=[a.root.getModuleId()];if(d!=null){b=Object.keys(d);b.forEach(function(a){a=d[a];if(a==null)return;var b=a.entryPoint;a=a.entryPointParams;b=i(b,a);e=e.concat(b.queries);f=f.concat(b.roots)})}return{queries:e,roots:f}}function a(a,b){a=i(a,b);b=a.queries;return b.map(h)}function b(a){a=a.map(function(a){return i(a.entryPoint,a.entryPointParams)});return a.map(function(a){var b=a.queries;a=a.roots;return{quries:b.map(h),roots:a}})}function d(a,b){a=i(a,b);b=a.queries;a=a.roots;return{queries:b.map(h),roots:a}}function e(){throw new Error("This function should not be called. It exists solely for the type-generation")}function f(a,b){var d;a=a.map(function(a){return i(a.entryPoint,a.entryPointParams)});a=a.map(function(a){var b=a.queries;a=a.roots;return{queries:b.map(h),roots:a}});d=c("objectValues")((d=b==null?void 0:b.getDisplayQueries())!=null?d:{}).filter(function(a){return a!=null}).map(h);b=c("objectValues")((b=b==null?void 0:b.getDeferredQueries())!=null?b:{}).filter(function(a){return a!=null}).map(h);return{appshellQueries:{deferred:b,display:d},routeObjects:a}}g.processRootEntryPoint=a;g.processRootEntryPoints=b;g.processRootEntryPointData=d;g.preloadQuery=e;g.processServerEntryPoints=f}),98);
__d("CometRouterSSREntrypoint",["CometSSREntrypoint"],(function(a,b,c,d,e,f){"use strict";a=importNamespace("CometSSREntrypoint").processRootEntryPoint;b=importNamespace("CometSSREntrypoint").processRootEntryPointData;f.processRootEntryPoint=a;f.processRootEntryPointData=b}),66);
__d("CometRelayEF",["Bootloader","BootloaderEvents","ClientConsistencyEventEmitter","CometRouterSSREntrypoint","cometAsyncFetch","gkx","performanceAbsoluteNow","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Map();function j(a,b){if(!c("gkx")("26332"))return;a=d("CometRouterSSREntrypoint").processRootEntryPoint(a,b);var e=[];a.forEach(function(a){a=a.name;i.has(a)||(e.push(a),d("BootloaderEvents").notifyHasteResponseEFStart("relay_3d",a))});if(e.length===0)return;var f=(h||(h=c("performanceAbsoluteNow")))(),g=c("cometAsyncFetch")("/ajax/relay-ef/",{data:{queries:e},method:"POST"}).then(function(a){return{fetchPredictionsEnd:(h||(h=c("performanceAbsoluteNow")))(),fetchPredictionsStart:f,payload:a}});e.forEach(function(a){return i.set(a,g)})}function a(a,b){if(!c("gkx")("26332"))return;var e=(h||(h=c("performanceAbsoluteNow")))();j(a,b);a=d("CometRouterSSREntrypoint").processRootEntryPoint(a,b);a.forEach(function(a){var b=a.name,f=i.get(b);f&&f!==!0&&c("promiseDone")(f,function(a){var f=a.fetchPredictionsEnd,g=a.fetchPredictionsStart;a=a.payload;if(a!=null&&typeof a==="object"){var h;c("Bootloader").loadPredictedResourceMap(a.predictions[b],{onLog:function(a){return d("BootloaderEvents").notifyHasteResponseEF("relay_3d",b,{fetchPredictionsEnd:f,fetchPredictionsStart:g,fetchRsrcsStart:e,tierOne:a})}},(h=(h=a.consistency)==null?void 0:h.rev)!=null?h:null);a.consistency!=null&&c("ClientConsistencyEventEmitter").emit("newEntry",a.consistency)}});i.set(a.name,!0)})}b={fetchPredictedResources:a,fetchPredictions:j};g["default"]=b}),98);
__d("CometToast.react",["fbt","ix","BaseToast.react","CometPressable.react","FDSCircleButton.react","FDSText.react","fbicon","react"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||(j=d("react")),l=j.useMemo,m={pressable:{alignItems:"x6s0dn4",display:"x78zum5",flexDirection:"x1q0g3np",width:"xh8yej3",$$css:!0}};function a(a){var b=a.action,e=a.href,f=a.icon,g=a.impressionLoggingRef,j=a.message,n=a.onDismiss,o=a.supressCloseButton;o=o===void 0?!1:o;var p=a.target,q=a.testid;q=q===void 0?"Toast":q;q=a.truncateText;var r=q===void 0?!0:q,s=babelHelpers.objectWithoutPropertiesLoose(a,["action","href","icon","impressionLoggingRef","message","onDismiss","supressCloseButton","target","testid","truncateText"]),t=l(function(){return e!=null?{target:p,url:e}:void 0},[e,p]);return k.jsx(c("BaseToast.react"),{action:b!=null?{label:b.label,labelRenderer:function(a){return k.jsx(c("FDSText.react"),{color:"blueLink",numberOfLines:1,type:"bodyLink3",children:a})},onPress:b.onPress,testid:b.testid}:void 0,addOnStart:f,closeButton:o!==!0&&k.jsx(c("FDSCircleButton.react"),{icon:d("fbicon")._(i("478231"),12),label:h._(/*BTDS*/"__JHASH__cCrSTii9yXy__JHASH__"),onPress:n,size:24,testid:void 0}),linkWrapper:s.onPress!=null||t!=null?function(a){return k.jsx(c("CometPressable.react"),babelHelpers["extends"]({},s,{expanding:!0,linkProps:t,xstyle:m.pressable,children:a}))}:void 0,message:function(a){a=a.toastMessageId;return k.jsx(c("FDSText.react"),{color:"primary",id:a,numberOfLines:r?4:void 0,type:"body3",children:j})},onDismiss:n,testid:void 0,toastRef:g})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("ContextualConfigConstants",[],(function(a,b,c,d,e,f){"use strict";a=1e3;b=", ";c={SAME:"same",NULL:"null",NNULL:"nnull",CATCH_ALL:"catch_all",EQ:"eq",NEQ:"neq",LT:"lt",LTE:"lte",GT:"gt",GTE:"gte",COR:"cor",CONTAINS:"contains",REGEX:"regex",IN:"in",NIN:"nin"};d={DENSE:"dense",MULTI_OUTPUT_RESOLVED:"multi-output-resolved",TABLE:"table"};e=[];var g=[],h=[],i={BAD_BOOLEAN_FORMAT:"Bad boolean format",BAD_CONFIG:"Bad config",BAD_CONTEXT_IDENTIFIER:"Bad context identifier",BAD_CONTEXT_VALUE:"Bad context value",BAD_MONITORED_CONTEXTS:"Bad monitored contexts",BAD_NUMBER_FORMAT:"Bad number format",BAD_OUTPUT_NAME:"Bad output name",BAD_OUTPUT_TYPE:"Bad output type",BAD_VALUE_ORDER:"Bad values order",DUPLICATE_OUTPUT_NAME:"Duplicate output name",ILLEGAL_BOOLEAN_STRATEGY:"Illegal boolean strategy",ILLEGAL_BUCKET_VALUES:"Illegal bucket values",ILLEGAL_NUMERIC_STRATEGY:"Illegal numeric strategy",ILLEGAL_STRING_STRATEGY:"Illegal string strategy",INVALID_BOOLEAN:"Invalid boolean",INVALID_FLOAT:"Invalid float",INVALID_INTEGER:"Invalid integer",INVALID_STRING:"Invalid string",INVALID_VALUE_TYPE:"Invalid value type",MISMATCH_NUMBER_OF_VALUES:"Mismatching number of values",MISSING_BUCKETS:"Missing buckets",MISSING_BUCKET_MATCH:"Missing bucket match",MISSING_BUCKET_NAME:"Missing bucket name",MISSING_BUCKET_STRATEGY:"Missing bucket strategy",MISSING_CONTEXT_IN_CONFIG:"Missing context in config",MISSING_DEFAULT_VALUE:"Missing default value",MISSING_OUTPUTS_DEFINITION:"Missing outputs field definition",MISSING_RESULTS:"Missing results",MISSING_TABLE:"Missing table",MISSING_TABLE_ITEM_BUCKET:"Missing table item bucket",MISSING_TABLE_ITEM_VALUES:"Missing table item values",MISSING_VECTOR:"Missing vector",REGEX_SYNTAX_ERROR:"Regex syntax error",REQUESTED_PARAM_NOT_FOUND:"Requested param not found",RESULTS_VECTOR_SIZE_MISMATCH:"Results vector size mismatch",UNDECLARED_OUTPUT_PARAM:"Undeclared output param",UNKNOWN_BUCKET_DEFINITION:"Unknown bucket definition",UNKNOWN_CONFIG_TYPE:"Unknown config type",UNSUPPORTED_CONFIG_VERSION:"Unsupported config version"},j=10,k=", ",l={BOOL:"BOOL",FLOAT:"FLOAT",INT:"INT",STRING:"STRING"};f.ANALYTICS_SAMPLE_RATE=a;f.BUCKET_DELIMITER=b;f.CONTEXT_BUCKET_STRATEGY=c;f.CONFIG_TYPE=d;f.EMPTY_RESOLVED_CONTEXTS=e;f.EMPTY_RESOLVED_MONITORS=g;f.EMPTY_RESULT_PARAMS=h;f.ERROR=i;f.JSON_SUB_SAMPLE_RATE=j;f.LIST_DELIMITER=k;f.TYPE=l}),66);
__d("ContextualConfigResolvedContextsUtils",[],(function(a,b,c,d,e,f){"use strict";a=function(a){var b=[];for(var a=a,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;e=e.bucketIndex;if(e==void 0)break;b.push(e)}return b};b=function(a){var b=[];for(var a=a,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;e=e.bucketName;if(e===void 0)break;b.push(e)}return b};var g=function(a){return a.name};c=function(a){return a.map(g)};d=function(a){var b=[];for(var a=a,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;e=e.value;if(e===void 0)break;b.push(e)}return b};f.getBucketIndices=a;f.getBucketNames=b;f.getContextNames=c;f.getContextValues=d}),66);
__d("ContextualConfigCollateExposureData",["ContextualConfigConstants","ContextualConfigResolvedContextsUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=["cfg_ver_timestamp","policy_id","version","sample_rate"],i=function(a){return a.join(d("ContextualConfigConstants").LIST_DELIMITER)},j=function(a,b){for(var c=0;c<h.length;c++){var d=h[c];b[d]!=null&&(a[d]=b[d])}b.name&&(a.config_name=b.name)},k=function(a,b){var c=b[0],e=b[1],f=b[2];b=b[3];c!=null&&(a.exception=c.message);a.result=i(e.map(function(a){return a.value}))||"INVALID";a.context=i(d("ContextualConfigResolvedContextsUtils").getContextNames(f));a.context_value=i(d("ContextualConfigResolvedContextsUtils").getContextValues(f));a.bucket_name=i(d("ContextualConfigResolvedContextsUtils").getBucketNames(f));a.monitor=i(d("ContextualConfigResolvedContextsUtils").getContextNames(b));a.monitor_value=i(d("ContextualConfigResolvedContextsUtils").getContextValues(b))};function a(a,b,c){var e={sample_rate:d("ContextualConfigConstants").ANALYTICS_SAMPLE_RATE};j(e,a);k(e,b);c&&(e.config_contents=JSON.stringify(a));return e}g["default"]=a}),98);
__d("ContextualConfigExposureEvent",["Random"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b,c){this.$2=a,this.$4=d("Random").random()<1/a.sample_rate,this.$3=b,this.$1=c}var b=a.prototype;b.getData=function(){return this.$2};b.log=function(a){var b=this.$2,c=this.$3,d=this.$4;a&&c(b);d&&this.$1(b);return this};b.isSampled=function(){return this.$4};return a}();g["default"]=a}),98);
__d("ContextualConfigExposureLoggerFactory",["ContextualConfigExposureEvent"],(function(a,b,c,d,e,f,g){"use strict";var h=function(){function a(a,b){this.$2=a,this.$1=b}var b=a.prototype;b.createEvent=function(a){var b=this.$1,d=this.$2;a=new(c("ContextualConfigExposureEvent"))(a,d,b);return a};return a}();function a(a,b){return new h(a,b)}g["default"]=a}),98);
__d("MarauderLogger",["Banzai","CacheStorage","MarauderConfig"],(function(a,b,c,d,e,f){var g="client_event",h="navigation",i=18e4,j="marauder",k="marauder_last_event_time",l="marauder_last_session_id",m={},n=[],o=!1,p=null,q=null,r=null,s=0,t,u,v=!1,w=null;function a(){F().set(k,x())}b("Banzai").subscribe(b("Banzai").SHUTDOWN,a);function x(){t=t||F().get(k)||0;return t}function y(){v||(u=F().get(l),v=!0);var a=Date.now();(!u||a-i>x())&&(u=a.toString(16)+"-"+(~~(Math.random()*16777215)).toString(16),F().set(l,u));return u}function z(){return{user_agent:window.navigator.userAgent,screen_height:window.screen.availHeight,screen_width:window.screen.availWidth,density:window.screen.devicePixelRatio||null,platform:window.navigator.platform||null,locale:window.navigator.language||null}}function A(){return{locale:navigator.language}}function B(a,b,c,d,e,f,g){var h=g!=null&&g!=0?g:Date.now();t=g!=null&&g!=0?Date.now():h;g=b!=null&&b!=""?b:p;return{name:a,time:h/1e3,module:g,obj_type:d,obj_id:e,uuid:f,extra:c}}function C(a,b,c){return B("content",null,{flags:b},null,null,a,c)}function D(a){var b=window.__mrdr;if(b)for(var c in b){var d=b[c];if(d[3]!==0){delete b[c];if(c==="1")if(r!==null)c=r;else continue;a.push(C(c,1,d[1]));a.push(C(c,2,d[2]));a.push(C(c,3,d[3]))}}}function E(a,c){D(a);if(a.length===0)return;o&&a.push(B("counters",null,m));var d=b("Banzai").BASIC;c==="vital"&&(d=b("Banzai").VITAL);var e=b("MarauderConfig").gk_enabled;s===0&&e&&(a.push(B("device_status",null,A())),d={delay:5e3});c==="signal"&&(d={signal:!0});e&&Math.random()<.01&&a.push(B("device_info",null,z()));if(r!==null)for(c=0;c<a.length;c++){e=a[c];(e.uuid===null||e.uuid===void 0)&&(e.uuid=r)}e={app_ver:b("MarauderConfig").app_version,data:a,device_id:void 0,log_type:g,seq:s++,session_id:y()};c=F().get("device_id");c&&(e.device_id=c);m={};o=!1;b("Banzai").post(j,e,d)}function F(){w||(w=new(b("CacheStorage"))("localstorage",""));return w}function c(a){m[a]||(m[a]=0),m[a]++,o=!0}function G(b,a,c,d,f,g,h,i){E([B(b,a,c,d,f,g,h)],i)}function H(a,b){p!==b&&(n.push(B(h,p,{dest_module:b,source_url:q,destination_url:a})),p=b,q=a)}function d(a,b){p!==b&&(r=null,H(a,b))}function f(a,b,c){G(b?"show_module":"hide_module",a,c)}function I(a){p=a}function J(){return p}function K(a){r===null&&(r=a,a!==null&&(E(n),n=[]))}e.exports={count:c,log:G,navigateTo:d,navigateWithinSession:H,toggleModule:f,setUUID:K,setNavigationModule:I,getNavigationModule:J}}),null);
__d("ContextualConfigExposureLogger",["ContextualConfigExposureLoggerFactory","MarauderLogger"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){};b=function(a){d("MarauderLogger").log("contextual_config_exposure","",a)};e=c("ContextualConfigExposureLoggerFactory")(a,b);g["default"]=e}),98);
__d("ContextualConfigAssert",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){if(a===!1)throw new Error(b)}f["default"]=a}),66);
__d("ContextualConfigValidators",["ContextualConfigConstants"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return Array.isArray(a)};b=function(a){return typeof a==="boolean"};c=function(a){return a!=null};e=function(a){return function(b){return Object.prototype.hasOwnProperty.call(a,b)}};f=function(a){return i(a)&&a%1===0};var h=function(a){return j(a)&&a.length>0},i=function(a){return typeof a==="number"&&!isNaN(a)&&a!==Infinity&&a!==-Infinity},j=function(a){return typeof a==="string"},k=function(a){switch(a){case d("ContextualConfigConstants").TYPE.BOOL:case d("ContextualConfigConstants").TYPE.FLOAT:case d("ContextualConfigConstants").TYPE.INT:case d("ContextualConfigConstants").TYPE.STRING:return!0;default:return!1}};g.isArray=a;g.isBoolean=b;g.isDefined=c;g.isKey=e;g.isInteger=f;g.isNonEmptyString=h;g.isNumber=i;g.isString=j;g.isType=k}),98);
__d("ContextualConfigParseBoolean",["ContextualConfigConstants"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a.toUpperCase()){case"TRUE":return!0;case"FALSE":return!1;default:throw new Error(d("ContextualConfigConstants").ERROR.BAD_BOOLEAN_FORMAT)}}g["default"]=a}),98);
__d("ContextualConfigParsePredBoolean",["ContextualConfigConstants","ContextualConfigParseBoolean"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e;switch(b){case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.SAME:var f=c("ContextualConfigParseBoolean")(a);e=function(a){return a===f};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NULL:e=function(a){return a==null};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NNULL:e=function(a){return a!=null};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.CATCH_ALL:e=function(a){return!0};break;default:throw new Error(d("ContextualConfigConstants").ERROR.ILLEGAL_BOOLEAN_STRATEGY)}return function(a){return e(a)}}g["default"]=a}),98);
__d("ContextualConfigParseFloat",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=/^[-\+]?([1-9]\d*|0)(\.\d+)?$/,j=function(a){return i.test(a)};function a(a){(h||(h=c("ContextualConfigAssert")))(j(a),d("ContextualConfigConstants").ERROR.BAD_NUMBER_FORMAT);a=parseFloat(a);h(d("ContextualConfigValidators").isNumber(a),d("ContextualConfigConstants").ERROR.BAD_NUMBER_FORMAT);return a}g["default"]=a}),98);
__d("ContextualConfigParseInteger",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=/^[-\+]?([1-9]\d*|0)$/,j=function(a){return i.test(a)};function a(a){(h||(h=c("ContextualConfigAssert")))(j(a),d("ContextualConfigConstants").ERROR.BAD_NUMBER_FORMAT);a=parseInt(a,10);h(d("ContextualConfigValidators").isNumber(a),d("ContextualConfigConstants").ERROR.BAD_NUMBER_FORMAT);return a}g["default"]=a}),98);
__d("ContextualConfigPredAssertions",["ContextualConfigAssert","ContextualConfigConstants"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a){return(h||(h=c("ContextualConfigAssert")))(a>0,d("ContextualConfigConstants").ERROR.MISMATCH_NUMBER_OF_VALUES)};b=function(a,b){return(h||(h=c("ContextualConfigAssert")))(a===b,d("ContextualConfigConstants").ERROR.MISMATCH_NUMBER_OF_VALUES)};e=function(a,b){return(h||(h=c("ContextualConfigAssert")))(a<b,d("ContextualConfigConstants").ERROR.BAD_VALUE_ORDER)};g.assertHasValues=a;g.assertNumberOfValues=b;g.assertValueOrder=e}),98);
__d("ContextualConfigParsePredNumeric",["ContextualConfigConstants","ContextualConfigParseFloat","ContextualConfigParseInteger","ContextualConfigPredAssertions","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e,f){var g=e.map(f?c("ContextualConfigParseInteger"):h||(h=c("ContextualConfigParseFloat"))),i;switch(b){case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.SAME:var j=f?c("ContextualConfigParseInteger")(a):(h||(h=c("ContextualConfigParseFloat")))(a);i=function(a){return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a===j};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NULL:i=function(a){return a==null};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NNULL:i=function(a){return a!=null};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.CATCH_ALL:i=function(a){return!0};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.COR:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,2);d("ContextualConfigPredAssertions").assertValueOrder(g[0],g[1]);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a>=g[0]&&a<g[1]};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.LT:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,1);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a<g[0]};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.LTE:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,1);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a<=g[0]};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.EQ:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,1);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a===g[0]};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NEQ:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,1);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a!==g[0]};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.GT:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,1);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a>g[0]};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.GTE:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,1);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a>=g[0]};break;default:throw new Error(d("ContextualConfigConstants").ERROR.ILLEGAL_NUMERIC_STRATEGY)}return function(a){return i(a)}}g["default"]=a}),98);
__d("ContextualConfigParseRegExp",["ContextualConfigConstants"],(function(a,b,c,d,e,f,g){"use strict";var h=/^\/(.+)\/(.*)$/;function a(a){try{var b=a.match(h);if(b!=null)return new RegExp(b[1],b[2]);else return new RegExp(a)}catch(a){throw new Error(d("ContextualConfigConstants").ERROR.REGEX_SYNTAX_ERROR)}}g["default"]=a}),98);
__d("ContextualConfigParsePredString",["ContextualConfigConstants","ContextualConfigParseRegExp","ContextualConfigPredAssertions"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a){if(typeof a!=="string")throw new Error(d("ContextualConfigConstants").ERROR.INVALID_VALUE_TYPE);return a},i=function(a){var b=[];for(var a=a,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;b.push(h(e))}return b};function a(a,b,e){var f=i(e),g;switch(b){case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.SAME:g=function(b){return typeof b!=="string"?!1:b===a};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NULL:g=function(a){return a==null};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NNULL:g=function(a){return a!=null};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.CATCH_ALL:g=function(a){return!0};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.IN:d("ContextualConfigPredAssertions").assertHasValues(f.length);g=function(a){return typeof a!=="string"?!1:f.indexOf(a)!==-1};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NIN:d("ContextualConfigPredAssertions").assertHasValues(f.length);g=function(a){return typeof a!=="string"?!1:f.indexOf(a)===-1};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.CONTAINS:d("ContextualConfigPredAssertions").assertNumberOfValues(f.length,1);g=function(a){return typeof a!=="string"?!1:a.indexOf(f[0])!==-1};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.REGEX:d("ContextualConfigPredAssertions").assertNumberOfValues(f.length,1);var h=c("ContextualConfigParseRegExp")(f[0]);g=function(a){return typeof a!=="string"?!1:h.test(a)};break;default:throw new Error(d("ContextualConfigConstants").ERROR.ILLEGAL_STRING_STRATEGY)}return function(a){return g(a)}}g["default"]=a}),98);
__d("ContextualConfigParseContextBuckets",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParsePredBoolean","ContextualConfigParsePredNumeric","ContextualConfigParsePredString","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.MISSING_BUCKETS)},j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.MISSING_BUCKETS)},k=d("ContextualConfigValidators").isKey(d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY),l=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isString(a)&&k(a.toUpperCase()),d("ContextualConfigConstants").ERROR.MISSING_BUCKET_STRATEGY)},m=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.ILLEGAL_BUCKET_VALUES)},n=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isNonEmptyString(a),d("ContextualConfigConstants").ERROR.MISSING_BUCKET_NAME)},o=function(a,b){var e=b.name;n(e);var f=b.strategy;l(f);b=b.values||[];m(b);switch(a){case d("ContextualConfigConstants").TYPE.BOOL:return c("ContextualConfigParsePredBoolean")(e,f);case d("ContextualConfigConstants").TYPE.FLOAT:return c("ContextualConfigParsePredNumeric")(e,f,b,!1);case d("ContextualConfigConstants").TYPE.INT:return c("ContextualConfigParsePredNumeric")(e,f,b,!0);case d("ContextualConfigConstants").TYPE.STRING:return c("ContextualConfigParsePredString")(e,f,b);default:throw new Error(d("ContextualConfigConstants").ERROR.UNKNOWN_BUCKET_DEFINITION)}},p=function(a,b){i(b);var c=b.name;n(c);return{name:c,pred:o(a,b)}};function a(a,b){j(b);return b.map(function(b){return p(a,b)})}g["default"]=a}),98);
__d("ContextualConfigParseContexts",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseContextBuckets","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_IDENTIFIER)},j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a)&&a.length>0,d("ContextualConfigConstants").ERROR.MISSING_CONTEXT_IN_CONFIG)},k=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isNonEmptyString(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_IDENTIFIER)},l=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isType(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_IDENTIFIER)},m=function(a){i(a);var b=a.name,d=a.type;a=a.buckets;k(b);l(d);return{name:b,type:d,buckets:c("ContextualConfigParseContextBuckets")(d,a)}};function a(a){j(a);return a.map(m)}g["default"]=a}),98);
__d("ContextualConfigIsEqualParams",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c+=1){var d=a[c],e=b[c];if(d.name!==e.name||d.type!==e.type)return!1}return!0}f["default"]=a}),66);
__d("ContextualConfigParseResultParamValue",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseBoolean","ContextualConfigParseFloat","ContextualConfigParseInteger","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isString(a),d("ContextualConfigConstants").ERROR.INVALID_STRING)};function a(a,b){j(b);switch(a){case d("ContextualConfigConstants").TYPE.BOOL:return c("ContextualConfigParseBoolean")(b);case d("ContextualConfigConstants").TYPE.FLOAT:return(i||(i=c("ContextualConfigParseFloat")))(b);case d("ContextualConfigConstants").TYPE.INT:return c("ContextualConfigParseInteger")(b);case d("ContextualConfigConstants").TYPE.STRING:return b;default:throw new Error(d("ContextualConfigConstants").ERROR.INVALID_VALUE_TYPE)}}g["default"]=a}),98);
__d("ContextualConfigParseResultParams",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseResultParamValue","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.MISSING_RESULTS)},k=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_VALUE)},l=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isNonEmptyString(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_VALUE)},m=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isType(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_VALUE)},n=function(a,b){for(var a=a,c=Array.isArray(a),e=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(c){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;if(f.name===b)return f.type}throw new Error(d("ContextualConfigConstants").ERROR.UNDECLARED_OUTPUT_PARAM)},o=function(a){return function(b){k(b);var d=b.name;l(d);var e=n(a,d);m(e);b=(i||(i=c("ContextualConfigParseResultParamValue")))(e,b.value);return{name:d,type:e,value:b}}};function a(a,b){j(b);return b.map(o(a))}g["default"]=a}),98);
__d("ContextualConfigParseDenseResultParams",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigIsEqualParams","ContextualConfigParseResultParams"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a,b){return(h||(h=c("ContextualConfigAssert")))(c("ContextualConfigIsEqualParams")(a,b),d("ContextualConfigConstants").ERROR.RESULTS_VECTOR_SIZE_MISMATCH)};function a(a,b){b=c("ContextualConfigParseResultParams")(a,b.map(function(b,c){return{name:a[c].name,value:b}}));i(a,b);return b}g["default"]=a}),98);
__d("ContextualConfigParseDenseDefaults",["ContextualConfigConstants","ContextualConfigParseDenseResultParams"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){try{return c("ContextualConfigParseDenseResultParams")(a,b)}catch(a){throw new Error(d("ContextualConfigConstants").ERROR.MISSING_DEFAULT_VALUE)}}g["default"]=a}),98);
__d("ContextualConfigParseMonitors",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_IDENTIFIER)},j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.BAD_MONITORED_CONTEXTS)},k=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isNonEmptyString(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_IDENTIFIER)},l=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isType(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_IDENTIFIER)},m=function(a){i(a);var b=a.name;a=a.type;k(b);l(a);return{name:b,type:a}};function a(a){j(a);return a.map(m)}g["default"]=a}),98);
__d("ContextualConfigParseOutputParams",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.MISSING_OUTPUTS_DEFINITION)},j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isType(a),d("ContextualConfigConstants").ERROR.BAD_OUTPUT_TYPE)},k=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isNonEmptyString(a),d("ContextualConfigConstants").ERROR.BAD_OUTPUT_NAME)},l=function(a){return(h||(h=c("ContextualConfigAssert")))(m(a),d("ContextualConfigConstants").ERROR.DUPLICATE_OUTPUT_NAME)},m=function(a){var b={};for(var a=a,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;if(b[e.name])return!1;b[e.name]=!0}return!0},n=function(a){k(a.name);j(a.type);return a};function a(a){i(a);a=a.map(n);l(a);return a}g["default"]=a}),98);
__d("ContextualConfigParseVector",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseResultParamValue","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.MISSING_VECTOR)},k=function(a,b){return(h||(h=c("ContextualConfigAssert")))(a===b,d("ContextualConfigConstants").ERROR.RESULTS_VECTOR_SIZE_MISMATCH)},l=function(a,b){k(a.length,b.length);for(var d=0;d<a.length;d+=1){var e=a[d].type,f=b[d];(i||(i=c("ContextualConfigParseResultParamValue")))(e,f)}},m=function(a){return a.reduce(function(a,b){b=b.buckets;return a*b.length},1)};function a(a,b,c){j(c);b=m(b);var d=a.length;k(b*d,c.length);for(var e=0;e<b;e+=1){var f=e*d;l(a,c.slice(f,f+d))}return c}g["default"]=a}),98);
__d("ContextualConfigResolveContexts",["ContextualConfigConstants"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,b){for(var c=0;c<a.length;c+=1){var d=a[c];try{if(d.pred(b))return[d.name,c]}catch(a){return null}}return null};function a(a,b,c){var e=null;a=a.map(function(a){var f=a.name,g={name:f};if(e!=null)return g;var i;c[f]!=null?i=c[f]:b[f]!=null?i=b[f]():i=null;g.value=i;if(a.buckets!=null){f=h(a.buckets,i);if(f==null){e=new Error(d("ContextualConfigConstants").ERROR.MISSING_BUCKET_MATCH);return g}a=f[0];i=f[1];g.bucketName=a;g.bucketIndex=i}return g});return[e,a]}g["default"]=a}),98);
__d("DenseContextualConfig",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseContexts","ContextualConfigParseDenseDefaults","ContextualConfigParseDenseResultParams","ContextualConfigParseMonitors","ContextualConfigParseOutputParams","ContextualConfigParseVector","ContextualConfigResolveContexts","ContextualConfigResolvedContextsUtils","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.BAD_CONFIG)},j=function(a){var b=[],c=1;for(var d=a.length-1;d>=0;d-=1)b.push(c),c*=a[d].buckets.length;return b.reverse()},k=function(a,b,d,e){try{b=b.slice(d,d+a.length);return[null,c("ContextualConfigParseDenseResultParams")(a,b)]}catch(a){return[a,e]}},l=function(a,b,d){try{d=d.reduce(function(b,d,e){(h||(h=c("ContextualConfigAssert")))(e<a.length,"Auxillery index out of range.");return b+a[e]*d},0);return[null,d*b]}catch(a){return[a,-1]}};a=function(){function a(a,b){i(a);this.globalContextProviders=babelHelpers["extends"]({},b);b=c("ContextualConfigParseOutputParams")(a.outputs);var d=c("ContextualConfigParseContexts")(a.contexts);this.aux=j(d);this.contexts=d;this.defaults=c("ContextualConfigParseDenseDefaults")(b,a.vectorDefaults);this.monitors=a.monitors!=null?c("ContextualConfigParseMonitors")(a.monitors):[];this.outputs=b;this.vector=c("ContextualConfigParseVector")(b,d,a.vector)}var b=a.prototype;b.resolve=function(a){try{return this.unsafeResolve(a)}catch(a){return[a,this.defaults,d("ContextualConfigConstants").EMPTY_RESOLVED_CONTEXTS,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS]}};b.unsafeResolve=function(a){var b=this.aux,e=this.globalContextProviders,f=this.contexts,g=this.defaults,h=this.monitors,i=this.outputs,j=this.vector;f=c("ContextualConfigResolveContexts")(f,e,a);var m=f[0];f=f[1];if(m!=null)return[m,g,f,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS];m=l(b,i.length,d("ContextualConfigResolvedContextsUtils").getBucketIndices(f));b=m[0];m=m[1];if(b!=null)return[b,g,f,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS];b=k(i,j,m,g);i=b[0];j=b[1];if(i!=null)return[i,j,f,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS];m=c("ContextualConfigResolveContexts")(h,e,a);g=m[0];b=m[1];return g!=null?[g,j,f,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS]:[null,j,f,b]};return a}();g["default"]=a}),98);
__d("MultiOutputResolvedContextualConfig",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseMonitors","ContextualConfigParseOutputParams","ContextualConfigParseResultParams","ContextualConfigResolveContexts","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.BAD_CONFIG)};a=function(){function a(a,b){i(a);this.globalContextProviders=babelHelpers["extends"]({},b);b=c("ContextualConfigParseOutputParams")(a.outputs);this.monitors=a.monitors!=null?c("ContextualConfigParseMonitors")(a.monitors):[];this.values=c("ContextualConfigParseResultParams")(b,a.values)}var b=a.prototype;b.resolve=function(a){try{return this.unsafeResolve(a)}catch(a){return[a,this.values,d("ContextualConfigConstants").EMPTY_RESOLVED_CONTEXTS,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS]}};b.unsafeResolve=function(a){var b=this.globalContextProviders,e=this.monitors,f=this.values;e=c("ContextualConfigResolveContexts")(e,b,a);b=e[0];a=e[1];return b!=null?[b,f,d("ContextualConfigConstants").EMPTY_RESOLVED_CONTEXTS,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS]:[null,f,d("ContextualConfigConstants").EMPTY_RESOLVED_CONTEXTS,a]};return a}();g["default"]=a}),98);
__d("ContextualConfigMergePartialResultParams",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c={};for(var b=b,d=Array.isArray(b),e=0,b=d?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=b.length)break;f=b[e++]}else{e=b.next();if(e.done)break;f=e.value}f=f;c[f.name]=f}f=[];for(e=a,d=Array.isArray(e),b=0,e=d?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(d){if(b>=e.length)break;a=e[b++]}else{b=e.next();if(b.done)break;a=b.value}a=a;var g=c[a.name];f.push(g!=null&&g.name===a.name&&g.type===a.type?g:a)}return f}f["default"]=a}),66);
__d("ContextualConfigParseDefaults",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigIsEqualParams","ContextualConfigParseResultParams"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a,b){return(h||(h=c("ContextualConfigAssert")))(c("ContextualConfigIsEqualParams")(a,b),d("ContextualConfigConstants").ERROR.MISSING_DEFAULT_VALUE)};function a(a,b){b=c("ContextualConfigParseResultParams")(a,b);i(a,b);return b}g["default"]=a}),98);
__d("ContextualConfigParseTable",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseResultParams","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.MISSING_TABLE)},j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.MISSING_TABLE)},k=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isNonEmptyString(a),d("ContextualConfigConstants").ERROR.MISSING_TABLE_ITEM_BUCKET)},l=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.MISSING_TABLE_ITEM_VALUES)},m=function(a,b){j(b);var d=b.bucket;b=b.values;k(d);l(b);return{bucket:d,values:c("ContextualConfigParseResultParams")(a,b)}};function a(a,b){i(b);return b.reduce(function(b,c){c=m(a,c);b[c.bucket]=c.values;return b},{})}g["default"]=a}),98);
__d("TableContextualConfig",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigMergePartialResultParams","ContextualConfigParseContexts","ContextualConfigParseDefaults","ContextualConfigParseMonitors","ContextualConfigParseOutputParams","ContextualConfigParseTable","ContextualConfigResolveContexts","ContextualConfigResolvedContextsUtils","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=[],j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.BAD_CONFIG)};a=function(){function a(a,b){j(a);this.globalContextProviders=babelHelpers["extends"]({},b);b=c("ContextualConfigParseOutputParams")(a.outputs);this.contexts=c("ContextualConfigParseContexts")(a.contexts);this.defaults=c("ContextualConfigParseDefaults")(b,a.defaults);this.monitors=a.monitors!=null?c("ContextualConfigParseMonitors")(a.monitors):[];this.table=c("ContextualConfigParseTable")(b,a.table)}var b=a.prototype;b.resolve=function(a){try{return this.unsafeResolve(a)}catch(a){return[a,this.defaults,d("ContextualConfigConstants").EMPTY_RESOLVED_CONTEXTS,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS]}};b.unsafeResolve=function(a){var b=this.globalContextProviders,e=this.contexts,f=this.defaults,g=this.monitors,h=this.table;e=c("ContextualConfigResolveContexts")(e,b,a);var j=e[0];e=e[1];if(j!=null)return[j,f,e,[]];j=d("ContextualConfigResolvedContextsUtils").getBucketNames(e).join(d("ContextualConfigConstants").BUCKET_DELIMITER);h=h[j]||i;j=c("ContextualConfigMergePartialResultParams")(f,h);f=c("ContextualConfigResolveContexts")(g,b,a);h=f[0];g=f[1];return h!=null?[h,j,e,[]]:[null,j,e,g]};return a}();g["default"]=a}),98);
__d("ContextualConfigParseConfig",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigValidators","DenseContextualConfig","MultiOutputResolvedContextualConfig","TableContextualConfig"],(function(a,b,c,d,e,f,g){"use strict";var h,i=[1],j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a)&&d("ContextualConfigValidators").isDefined(a.version),d("ContextualConfigConstants").ERROR.BAD_CONFIG)},k=function(a){return(h||(h=c("ContextualConfigAssert")))(i.indexOf(a)!==-1,d("ContextualConfigConstants").ERROR.UNSUPPORTED_CONFIG_VERSION)};function a(a,b){j(a);k(a.version);switch(a.cctype){case d("ContextualConfigConstants").CONFIG_TYPE.DENSE:return new(c("DenseContextualConfig"))(a,b);case d("ContextualConfigConstants").CONFIG_TYPE.MULTI_OUTPUT_RESOLVED:return new(c("MultiOutputResolvedContextualConfig"))(a,b);case d("ContextualConfigConstants").CONFIG_TYPE.TABLE:return new(c("TableContextualConfig"))(a,b);default:throw new Error(d("ContextualConfigConstants").ERROR.UNKNOWN_CONFIG_TYPE)}}g["default"]=a}),98);
__d("ContextualConfigWarn",[],(function(a,b,c,d,e,f){"use strict";function a(a){}f["default"]=a}),66);
__d("ContextualConfigResult",["ContextualConfigConstants","ContextualConfigWarn"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.$1=a.reduce(function(a,b){var c=b.name;b=b.value;a[c]=b;return a},{}),this.$2=a}var b=a.prototype;b.get=function(a,b){try{a=this.$1[a];if(typeof a!==typeof b){c("ContextualConfigWarn")(d("ContextualConfigConstants").ERROR.REQUESTED_PARAM_NOT_FOUND);return b}return a}catch(a){c("ContextualConfigWarn")(a.message);return b}};b.getParams=function(){return this.$2};return a}();g["default"]=a}),98);
__d("ErrorContextualConfig",["ContextualConfigConstants"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.error=a}var b=a.prototype;b.resolve=function(a){return[this.error,d("ContextualConfigConstants").EMPTY_RESULT_PARAMS,d("ContextualConfigConstants").EMPTY_RESOLVED_CONTEXTS,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS]};return a}();g["default"]=a}),98);
__d("ContextualConfig",["ContextualConfigCollateExposureData","ContextualConfigConstants","ContextualConfigExposureLogger","ContextualConfigParseConfig","ContextualConfigResult","ErrorContextualConfig","Random"],(function(a,b,c,d,e,f,g){"use strict";var h=1/d("ContextualConfigConstants").JSON_SUB_SAMPLE_RATE,i=1;a=function(){function a(a,b){b===void 0&&(b={}),this.isDebugLoggingEnabled=!1,this.$3=!1,this.$4=a,this.$2=b}var b=a.prototype;b.$5=function(){if(this.$1)return this.$1;var a=this.$2,b=this.$4;try{b=c("ContextualConfigParseConfig")(b,a)}catch(a){b=new(c("ErrorContextualConfig"))(a)}this.$1=b;return b};b.$6=function(a){var b=this.isDebugLoggingEnabled,e=this.$4,f=this.$3;f=!f&&d("Random").random()<h;f&&(this.$3=!0);e=c("ContextualConfigCollateExposureData")(e,a,f);a=c("ContextualConfigExposureLogger").createEvent(e);a.log(b)};b.resolve=function(a){a===void 0&&(a={});var b=this.$1||this.$5();b=b.resolve(a);this.$6(b);return new(c("ContextualConfigResult"))(b[i])};return a}();g["default"]=a}),98);
__d("DgwClientFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1755537");b=d("FalcoLoggerInternal").create("dgw_client",a);e=b;g["default"]=e}),98);
__d("DGWLoggingContext",["$InternalEnum","DgwClientFalcoEvent","ODS","Random"],(function(a,b,c,d,e,f,g){"use strict";var h;a="dgw_client";var i=b("$InternalEnum")({STREAM_GROUP_COMPONENT:"WebStreamGroup",GROUPED_STREAM_COMPONENT:"GroupedWebStream",WEBSOCKET_TRANSPORT_COMPONENT:"WebSocketTransport",ACK_MANAGER_COMPONENT:"WebStreamAckManager",CODEC_COMPONENT:"WebCodec",RAW_CLIENT:"RAWDGWClient",PINGER:"DGWPinger"}),j={VERBOSE:-1,INFO:0,WARNING:1,ERROR:2,FATAL:3};function k(a){switch(a){case i.GROUPED_STREAM_COMPONENT:case i.ACK_MANAGER_COMPONENT:return!0;default:return!1}}e=function(){function a(a,b,c,d,e,f,g){f===void 0&&(f=!1),g===void 0&&(g=!1),this.$5=""+a,this.$1=b,this.$4=c,this.$3=d,this.$6=e,this.$2=f,this.$7=g}a.bumpODSKey=function(a,b,c){c===void 0&&(c=1);if(!d("Random").coinflip(c))return;a=a+"."+b;(h||(h=d("ODS"))).bumpEntityKey(3589,"dgw_web_client",a,c)};var b=a.prototype;b.bumpODSKey=function(a,b,c){c===void 0&&(c=1);if(!d("Random").coinflip(c))return;a=this.$4+"."+a+"."+b;(h||(h=d("ODS"))).bumpEntityKey(3589,"dgw_web_client",a,c)};b.logEvent=function(a,b,c,d,e){d===void 0&&(d=!1),this.$2||this.$8(a,b,null,j.INFO,c,d,e)};b.$8=function(a,b,d,e,f,g,h){var i=this;g===void 0&&(g=!1);if(g&&!this.$7)return;(k(a)&&this.$1!=null||!k(a)&&this.$6!=null)&&c("DgwClientFalcoEvent").log(function(){var c;return{event:b,logging_id:(c=h)!=null?c:i.$1,dgw_version:i.$5,message:d,severity:e,uuid:i.$3,dgw_component:a,extra_info:f,destination_tier:i.$4,sg_transport_id:i.$6,source:2}})};b.logError=function(a,b,c,d,e,f){e===void 0&&(e=!1),this.$2||this.$8(a,b,c,j.ERROR,d,e,f)};b.logWarn=function(a,b,c,d,e){e===void 0&&(e=!1),this.$2||this.$8(a,b,c,j.WARNING,d,e)};return a}();g.DGW_MODULE=a;g.DGWLoggingComponent=i;g.DGWLoggingContext=e}),98);
__d("DGWAckManager",["DGWLoggingContext","Promise","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(){var b=a.prototype;b.stopTracking=function(a){window.clearTimeout(this.$1),this.$3(a)};function a(a,b,c){var d=this;this.$3=c;this.sendId=a;this.$2=b;this.handleAckReceived=function(){d.stopTracking(!0)};this.$1=window.setTimeout(function(){d.stopTracking(!1)},b)}return a}();a=function(){function a(a){this.$1=new Map(),this.$2=a}var c=a.prototype;c.waitForAck=function(a,c){var e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:this.$2.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ack_expected");e=this.$1;g.prev=2;g.next=5;return b("regeneratorRuntime").awrap(new(h||(h=b("Promise")))(function(b,d){e.set(a,new i(a,c,b))}));case 5:f=g.sent;f===!0?this.$2.logEvent(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"Received ACK","sendId:"+a,!0):(this.$2.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ack_timeout"),this.$2.logWarn(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ACK timeout","Request "+a+" timed out after "+c+"ms"));e["delete"](a);return g.abrupt("return",f);case 11:g.prev=11;g.t0=g["catch"](2);this.$2.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ack_error");e["delete"](a);throw g.t0;case 16:case"end":return g.stop()}},null,this,[[2,11]])};c.handleAckReceived=function(a){this.$2.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ack_received");var b=this.$1.get(a);if(b===void 0){this.$2.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ack_received.not_tracked");this.$2.logWarn(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"untracked ACK","Received ACK for ackId "+a+" which was not being tracked");return}b.handleAckReceived()};c.clearPendingAcks=function(){var a=this;this.$2.logEvent(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"Clearing pending acks","ACKs cleared size: "+this.$1.size);this.$1.forEach(function(b,c,e){a.$2.logEvent(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"Clearing pending ACK with ackId "+b.sendId,null,!0),b.stopTracking(!1),e["delete"](c)})};return a}();g.DGWAckManager=a}),98);
__d("DGWAuth",["$InternalEnum","err"],(function(a,b,c,d,e,f,g){"use strict";var h=b("$InternalEnum")({TEST:"0:0",FACEBOOK:"1:0",INTERNALFB:"2:0",OCULUS:"3:0",ENTERPRISEFB:"7:0",RECRUITINGFB:"8:0",INSTAGRAM:"6:0",HORIZON_WEB:"12:0",SPARK_WEB:"13:0",ABRA:"15:0"});function a(a){if(a==="TEST")return h.TEST;else if(a==="FACEBOOK")return h.FACEBOOK;else if(a==="INTERNALFB")return h.INTERNALFB;else if(a==="OCULUS")return h.OCULUS;else if(a==="ENTERPRISEFB")return h.ENTERPRISEFB;else if(a==="RECRUITINGFB")return h.RECRUITINGFB;else if(a==="INSTAGRAM")return h.INSTAGRAM;else if(a==="HORIZON_WEB")return h.HORIZON_WEB;else if(a==="SPARK_WEB")return h.SPARK_WEB;else if(a==="ABRA")return h.ABRA;else throw c("err")("failed to convert string ("+a+") to DGWAuth Type")}function d(a){if(a===h.FACEBOOK)return"FACEBOOK";else if(a===h.INTERNALFB)return"INTERNALFB";else if(a===h.OCULUS)return"OCULUS";else if(a===h.ENTERPRISEFB)return"ENTERPRISEFB";else if(a===h.RECRUITINGFB)return"RECRUITINGFB";else if(a===h.INSTAGRAM)return"INSTAGRAM";else if(a===h.HORIZON_WEB)return"HORIZON_WEB";else if(a===h.SPARK_WEB)return"SPARK_WEB";else if(a===h.ABRA)return"ABRA";else return"TEST"}g.DGWAuth=h;g.fromStringToDGWAuth=a;g.fromDGWAuthToString=d}),98);
__d("DGWStream",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";var g=b("$InternalEnum").Mirrored(["ABNORMAL_CLOSURE","GOING_AWAY","SERVER_INTERNAL_ERROR","PREMATURE_CLOSE","UNKNOWN_ERROR","KEEPALIVE_TIMEOUT","TRANSPORT_CLOSED_BEFORE_STREAM_INIT","ESTABLISHMENT_TIMEOUT","UNAUTHENTICATED","UNAUTHORIZED","REJECTED","BAD_REQUEST","DGW_SERVER_ERROR","ESTABLISHMENT_ERROR"]);function a(a){switch(a){case g.UNAUTHENTICATED:case g.UNAUTHORIZED:case g.REJECTED:case g.BAD_REQUEST:case g.UNKNOWN_ERROR:case g.SERVER_INTERNAL_ERROR:return!1;default:return!0}}f.StreamError=g;f.isRetryableError=a}),66);
__d("DGWCppBridge",[],(function(l,m,n,o,p,q){var r=function(){var l=typeof document!=="undefined"&&document.currentScript?document.currentScript.src:void 0;return function(m){m=m||{};var m=typeof m!=="undefined"?m:{},n=function(){function m(){}function n(l,m){return function(){l.apply(m,arguments)}}function l(m){if(!(this instanceof l))throw new TypeError("Promises must be constructed via new");if(typeof m!=="function")throw new TypeError("not a function");this._state=0;this._handled=!1;this._value=void 0;this._deferreds=[];t(m,this)}function o(m,n){while(m._state===3)m=m._value;if(m._state===0){m._deferreds.push(n);return}m._handled=!0;l._immediateFn(function(){var l=m._state===1?n.onFulfilled:n.onRejected;if(l===null){(m._state===1?p:q)(n.promise,m._value);return}var o;try{o=l(m._value)}catch(l){q(n.promise,l);return}p(n.promise,o)})}function p(m,o){try{if(o===m)throw new TypeError("A promise cannot be resolved with itself.");if(o&&(typeof o==="object"||typeof o==="function")){var p=o.then;if(o instanceof l){m._state=3;m._value=o;r(m);return}else if(typeof p==="function"){t(n(p,o),m);return}}m._state=1;m._value=o;r(m)}catch(l){q(m,l)}}function q(l,m){l._state=2,l._value=m,r(l)}function r(m){m._state===2&&m._deferreds.length===0&&l._immediateFn(function(){m._handled||l._unhandledRejectionFn(m._value)});for(var n=0,p=m._deferreds.length;n<p;n++)o(m,m._deferreds[n]);m._deferreds=null}function s(l,m,n){this.onFulfilled=typeof l==="function"?l:null,this.onRejected=typeof m==="function"?m:null,this.promise=n}function t(l,m){var n=!1;try{l(function(l){if(n)return;n=!0;p(m,l)},function(l){if(n)return;n=!0;q(m,l)})}catch(l){if(n)return;n=!0;q(m,l)}}l.prototype["catch"]=function(l){return this.then(null,l)};l.prototype.then=function(l,n){var p=new this.constructor(m);o(this,new s(l,n,p));return p};l.all=function(m){return new l(function(l,n){if(!Array.isArray(m))return n(new TypeError("Promise.all accepts an array"));var o=Array.prototype.slice.call(m);if(o.length===0)return l([]);var p=o.length;function q(m,r){try{if(r&&(typeof r==="object"||typeof r==="function")){var s=r.then;if(typeof s==="function"){s.call(r,function(l){q(m,l)},n);return}}o[m]=r;--p===0&&l(o)}catch(l){n(l)}}for(var r=0;r<o.length;r++)q(r,o[r])})};l.resolve=function(m){return m&&typeof m==="object"&&m.constructor===l?m:new l(function(l){l(m)})};l.reject=function(m){return new l(function(l,n){n(m)})};l.race=function(m){return new l(function(n,o){if(!Array.isArray(m))return o(new TypeError("Promise.race accepts an array"));for(var p=0,q=m.length;p<q;p++)l.resolve(m[p]).then(n,o)})};l._immediateFn=typeof setImmediate==="function"&&function(l){setImmediate(l)}||function(l){setTimeout(l,0)};l._unhandledRejectionFn=function(l){typeof console!=="undefined"&&console};return l}(),o,s;m.ready=new n(function(l,m){o=l,s=m});var t={},u;for(u in m)Object.prototype.hasOwnProperty.call(m,u)&&(t[u]=m[u]);var v=[];(function(l,m){throw m});var w=!0,x=!1,y="";function z(l){return m.locateFile?m.locateFile(l,y):y+l}var A;(w||x)&&(x?y=self.location.href:typeof document!=="undefined"&&document.currentScript&&(y=document.currentScript.src),l&&(y=l),y.indexOf("blob:")!==0?y=y.substr(0,y.lastIndexOf("/")+1):y="",(function(l){try{var m=new XMLHttpRequest();m.open("GET",l,!1);m.send(null);return m.responseText}catch(n){m=ga(l);if(m)return fa(m);throw n}},x&&(A=function(l){try{var m=new XMLHttpRequest();m.open("GET",l,!1);m.responseType="arraybuffer";m.send(null);return new Uint8Array(m.response)}catch(n){m=ga(l);if(m)return m;throw n}}),function(l,m,n){var o=new XMLHttpRequest();o.open("GET",l,!0);o.responseType="arraybuffer";o.onload=function(){if(o.status==200||o.status==0&&o.response){m(o.response);return}var p=ga(l);if(p){m(p.buffer);return}n()};o.onerror=n;o.send(null)}),function(l){document.title=l});m.print||emptyFunction.bind(console);var B=m.printErr||emptyFunction.bind(console);for(u in t)Object.prototype.hasOwnProperty.call(t,u)&&(m[u]=t[u]);t=null;m.arguments&&(v=m.arguments);m.thisProgram&&m.thisProgram;m.quit&&m.quit;var C;m.wasmBinary&&(C=m.wasmBinary);m.noExitRuntime||!0;var D={Memory:function(l){this.buffer=new ArrayBuffer(l.initial*65536)},Module:function(l){},Instance:function(l,m){this.exports=function(l){function m(l){l.set=function(l,m){this[l]=m};l.get=function(l){return this[l]};return l}var n,o=new Uint8Array(123);for(var p=25;p>=0;--p)o[48+p]=52+p,o[65+p]=p,o[97+p]=26+p;o[43]=62;o[47]=63;function q(m,n,p){var q,r,l=0,s=n,t=p.length;n=n+(t*3>>2)-(p[t-2]=="=")-(p[t-1]=="=");for(;l<t;l+=4)q=o[p.charCodeAt(l+1)],r=o[p.charCodeAt(l+2)],m[s++]=o[p.charCodeAt(l)]<<2|q>>4,s<n&&(m[s++]=q<<4|r>>2),s<n&&(m[s++]=r<<6|o[p.charCodeAt(l+3)])}function r(l){q(n,1024,"U3Q5dHlwZV9pbmZvAAAAAOAEAAAABAAATjEwX19jeHhhYml2MTE2X19zaGltX3R5cGVfaW5mb0UAAAAACAUAABgEAAAQBAAATjEwX19jeHhhYml2MTE3X19jbGFzc190eXBlX2luZm9FAAAACAUAAEgEAAA8BAAATjEwX19jeHhhYml2MTE3X19wYmFzZV90eXBlX2luZm9FAAAACAUAAHgEAAA8BAAATjEwX19jeHhhYml2MTE5X19wb2ludGVyX3R5cGVfaW5mb0UACAUAAKgEAACcBAAAAAAAAGwEAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAAAAABQBQAAAQAAAAkAAAADAAAABAAAAAUAAAAKAAAACwAAAAwAAABOMTBfX2N4eGFiaXYxMjBfX3NpX2NsYXNzX3R5cGVfaW5mb0UAAAAACAUAACgFAABsBA=="),q(n,1372,"gAkQ")}function s(l){var o=l.a,p=o.buffer;o.grow=xa;var q=new Int8Array(p),s=new Int16Array(p),t=new Int32Array(p),u=new Uint8Array(p),v=new Uint16Array(p),w=new Uint32Array(p);new Float32Array(p);new Float64Array(p);var x=Math.imul;Math.fround;Math.abs;var y=Math.clz32;Math.min;Math.max;Math.floor;Math.ceil;Math.trunc;Math.sqrt;l.abort;NaN;Infinity;var z=l.b,A=1051008,B;function C(o,p,l,r,m,n){o=o|0;p=p|0;l=l|0;r=r|0;m=m|0;n=n|0;var y=0,z=0,B;y=A-80|0;A=y;t[y+72>>2]=o;t[y+68>>2]=p;t[y+64>>2]=l;t[y+60>>2]=r;t[y+56>>2]=m;t[y+52>>2]=n;a:{if(t[y+52>>2]?!t[y+56>>2]|(!t[y+72>>2]|!t[y+68>>2]|(!t[y+64>>2]|!t[y+60>>2])):1){t[y+76>>2]=5;break a}t[t[y+64>>2]>>2]=0;t[t[y+60>>2]>>2]=0;p=t[y+68>>2];l=t[y+56>>2];r=t[y+52>>2];o=A+-64|0;A=o;t[o+56>>2]=t[y+72>>2];t[o+52>>2]=p;t[o+48>>2]=l;t[o+44>>2]=r;t[o+40>>2]=0;t[o+36>>2]=t[o+56>>2];b:{c:{d:{while(1){if(!t[o+52>>2])break c;t[o+32>>2]=t[o+36>>2];q[o+31|0]=u[t[o+36>>2]];t[o+52>>2]=t[o+52>>2]-1;t[o+36>>2]=t[o+36>>2]+1;if(u[o+31|0]!=10?u[o+31|0]==2|u[o+31|0]==4|u[o+31|0]==9:1){t[o+40>>2]=t[o+40>>2]+1;continue}t[o+24>>2]=1;if(V(u[o+31|0])&1){z=o,B=X(u[o+31|0])&1,q[z+23|0]=B;t[o+16>>2]=q[o+23|0]&1?1:2;if(w[o+52>>2]<w[o+16>>2]){t[t[o+48>>2]>>2]=t[o+32>>2];t[t[o+44>>2]>>2]=t[o+52>>2]+t[o+24>>2];break b}t[o+52>>2]=t[o+52>>2]-t[o+16>>2];t[o+24>>2]=t[o+16>>2]+t[o+24>>2];t[o+36>>2]=t[o+16>>2]+t[o+36>>2];if(!(u[o+31|0]!=14?u[o+31|0]!=8:0)){t[o+40>>2]=t[o+40>>2]+1;continue}}if(w[o+52>>2]<3)break d;t[o+12>>2]=0;p=t[o+36>>2];l=u[p|0]|u[p+1|0]<<8;q[o+12|0]=l;q[o+13|0]=l>>>8;q[o+14|0]=u[p+2|0];t[o+52>>2]=t[o+52>>2]-3;t[o+24>>2]=t[o+24>>2]+3;t[o+36>>2]=t[o+36>>2]+3;if(w[o+12>>2]<=w[o+52>>2]){t[o+40>>2]=t[o+40>>2]+1;t[o+36>>2]=t[o+12>>2]+t[o+36>>2];t[o+52>>2]=t[o+52>>2]-t[o+12>>2];continue}break}t[t[o+48>>2]>>2]=t[o+32>>2];t[t[o+44>>2]>>2]=t[o+52>>2]+t[o+24>>2];break b}t[t[o+48>>2]>>2]=t[o+32>>2];t[t[o+44>>2]>>2]=t[o+52>>2]+t[o+24>>2];break b}t[t[o+44>>2]>>2]=t[o+52>>2]}t[o+60>>2]=t[o+40>>2];A=o- -64|0;t[y+48>>2]=t[o+60>>2];if(!t[y+48>>2]){t[y+76>>2]=0;break a}z=y,B=D(x(t[y+48>>2],20)),t[z+44>>2]=B;if(!t[y+44>>2]){t[y+76>>2]=3;break a}t[y+40>>2]=t[y+44>>2];t[y+36>>2]=t[y+72>>2];t[y+32>>2]=t[y+68>>2]-t[t[y+52>>2]>>2];t[y+28>>2]=0;while(1){if(w[y+28>>2]<w[y+48>>2]){if(w[y+32>>2]<1){O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=1;break a}q[y+27|0]=u[t[y+36>>2]];t[y+36>>2]=t[y+36>>2]+1;t[y+32>>2]=t[y+32>>2]-1;e:{if(!u[y+27|0]|u[y+27|0]==1|(u[y+27|0]==2|u[y+27|0]==3)|(u[y+27|0]==4|u[y+27|0]==9|u[y+27|0]==10))break e;if(V(u[y+27|0])&1)break e;O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=6;break a}o=t[y+40>>2];t[o>>2]=u[y+27|0]&15|t[o>>2]&-16;f:{if(u[y+27|0]!=10?u[y+27|0]==2|u[y+27|0]==4|u[y+27|0]==9:1){o=t[y+40>>2];t[o>>2]=t[o>>2]&-268435441;t[y+40>>2]=t[y+40>>2]+20;break f}if(V(u[y+27|0])&1){o=A-48|0;A=o;t[o+40>>2]=t[y+40>>2];t[o+36>>2]=y+36;t[o+32>>2]=y+32;g:{if(!(V(t[t[o+40>>2]>>2]&15)&1)){t[o+44>>2]=1;break g}z=o,B=X(t[t[o+40>>2]>>2]&15)&1,q[z+31|0]=B;t[o+24>>2]=q[o+31|0]&1?1:2;if(w[t[o+32>>2]>>2]<w[o+24>>2]){t[o+44>>2]=1;break g}ba(t[o+40>>2]+4|0,t[t[o+36>>2]>>2],t[o+24>>2]);p=t[o+36>>2];t[p>>2]=t[o+24>>2]+t[p>>2];p=t[o+32>>2];t[p>>2]=t[p>>2]-t[o+24>>2];if((t[t[o+40>>2]>>2]&15)==8){p=t[o+40>>2];t[p>>2]=t[p>>2]&-268435441;t[o+44>>2]=0;break g}if((t[t[o+40>>2]>>2]&15)==14){p=t[o+40>>2];t[p>>2]=t[p>>2]&-268435441;t[o+44>>2]=0;break g}if(w[t[o+32>>2]>>2]<3){t[o+44>>2]=11;break g}t[o+20>>2]=0;p=t[t[o+36>>2]>>2];l=u[p|0]|u[p+1|0]<<8;q[o+20|0]=l;q[o+21|0]=l>>>8;q[o+22|0]=u[p+2|0];p=t[o+36>>2];t[p>>2]=t[p>>2]+3;p=t[o+32>>2];t[p>>2]=t[p>>2]-3;p=t[o+40>>2];t[p>>2]=t[p>>2]&-268435441|(t[o+20>>2]&16777215)<<4;if(w[t[o+32>>2]>>2]<w[o+20>>2]){t[o+44>>2]=11;break g}if((t[t[o+40>>2]>>2]&15)==15){t[t[o+40>>2]+12>>2]=t[o+20>>2];p=D(t[o+20>>2]);t[t[o+40>>2]+8>>2]=p;if(!t[t[o+40>>2]+8>>2]){t[o+44>>2]=3;break g}ba(t[t[o+40>>2]+8>>2],t[t[o+36>>2]>>2],t[o+20>>2]);p=t[o+36>>2];t[p>>2]=t[o+20>>2]+t[p>>2];p=t[o+32>>2];t[p>>2]=t[p>>2]-t[o+20>>2];t[o+44>>2]=0;break g}if((t[t[o+40>>2]>>2]&15)==5){t[t[o+40>>2]+12>>2]=t[o+20>>2];p=D(t[o+20>>2]);t[t[o+40>>2]+8>>2]=p;if(!t[t[o+40>>2]+8>>2]){t[o+44>>2]=3;break g}ba(t[t[o+40>>2]+8>>2],t[t[o+36>>2]>>2],t[o+20>>2]);p=t[o+36>>2];t[p>>2]=t[o+20>>2]+t[p>>2];p=t[o+32>>2];t[p>>2]=t[p>>2]-t[o+20>>2];t[o+44>>2]=0;break g}h:{if(!((t[t[o+40>>2]>>2]&15)!=6?(t[t[o+40>>2]>>2]&15)!=7:0)){z=o,B=Q(t[o+36>>2],t[o+32>>2],o+19|0,o+18|0),t[z+12>>2]=B;if(t[o+12>>2]){t[o+44>>2]=t[o+12>>2];break g}break h}if(!((t[t[o+40>>2]>>2]&15)!=13?(t[t[o+40>>2]>>2]&15)!=12:0)){l=t[o+32>>2];p=A-32|0;t[p+24>>2]=t[o+36>>2];t[p+20>>2]=l;t[p+16>>2]=o+19;t[p+12>>2]=o+16;s[p+10>>1]=0;i:{if(w[t[p+20>>2]>>2]<2){t[p+28>>2]=1;break i}l=t[t[p+24>>2]>>2];l=u[l|0]|u[l+1|0]<<8;q[p+10|0]=l;q[p+11|0]=l>>>8;l=t[p+24>>2];t[l>>2]=t[l>>2]+2;l=t[p+20>>2];t[l>>2]=t[l>>2]-2;q[t[p+16>>2]]=(v[p+10>>1]&32768)==32768;s[t[p+12>>2]>>1]=v[p+10>>1]&32767;t[p+28>>2]=0}t[o+12>>2]=t[p+28>>2];if(t[o+12>>2]){t[o+44>>2]=t[o+12>>2];break g}}}if((t[t[o+40>>2]>>2]&15)==12){p=t[o+40>>2];s[p+8>>1]=s[p+8>>1]&1|v[o+16>>1]<<1;t[o+44>>2]=0;break g}if((t[t[o+40>>2]>>2]&15)==7){p=t[o+40>>2];q[p+8|0]=q[p+8|0]&1|u[o+18|0]<<1;t[o+44>>2]=0;break g}if((t[t[o+40>>2]>>2]&15)==13){l=t[o+32>>2];r=t[o+20>>2];m=t[o+40>>2]+12|0;n=t[o+40>>2];p=A-32|0;A=p;t[p+24>>2]=t[o+36>>2];t[p+20>>2]=l;t[p+16>>2]=r;t[p+12>>2]=m;t[p+8>>2]=n+16;j:{if(w[p+16>>2]<2){t[p+28>>2]=9;break j}t[t[p+8>>2]>>2]=t[p+16>>2]-2;if(w[t[p+20>>2]>>2]<w[t[p+8>>2]>>2]){t[p+28>>2]=1;break j}l=D(t[t[p+8>>2]>>2]);t[t[p+12>>2]>>2]=l;if(!t[t[p+12>>2]>>2]){t[p+28>>2]=3;break j}ba(t[t[p+12>>2]>>2],t[t[p+24>>2]>>2],t[t[p+8>>2]>>2]);l=t[p+24>>2];t[l>>2]=t[t[p+8>>2]>>2]+t[l>>2];l=t[p+20>>2];t[l>>2]=t[l>>2]-t[t[p+8>>2]>>2];t[p+28>>2]=0}A=p+32|0;t[o+8>>2]=t[p+28>>2];if(t[o+8>>2]){t[o+44>>2]=t[o+8>>2];break g}p=t[o+40>>2];s[p+8>>1]=q[o+19|0]&1|v[p+8>>1]&65534;p=t[o+40>>2];s[p+8>>1]=s[p+8>>1]&1|v[o+16>>1]<<1;t[o+44>>2]=0;break g}if((t[t[o+40>>2]>>2]&15)==6){z=o,B=M(t[o+36>>2],t[o+32>>2],t[o+20>>2],t[o+40>>2]+12|0,t[o+40>>2]+16|0),t[z+4>>2]=B;if(t[o+4>>2]){t[o+44>>2]=t[o+4>>2];break g}p=t[o+40>>2];q[p+8|0]=q[o+19|0]&1|u[p+8|0]&254;p=t[o+40>>2];q[p+8|0]=q[p+8|0]&1|u[o+18|0]<<1;t[o+44>>2]=0;break g}t[o+44>>2]=1}A=o+48|0;t[y+20>>2]=t[o+44>>2];if(!t[y+20>>2]){t[y+40>>2]=t[y+40>>2]+20;break f}O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=t[y+20>>2];break a}t[y+16>>2]=0;if(w[y+32>>2]<3){O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=1;break a}o=t[y+36>>2];p=u[o|0]|u[o+1|0]<<8;q[y+16|0]=p;q[y+17|0]=p>>>8;q[y+18|0]=u[o+2|0];t[y+36>>2]=t[y+36>>2]+3;t[y+32>>2]=t[y+32>>2]-3;if(!(t[y+16>>2]==1|u[y+27|0]!=1)){O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=7;break a}o=t[y+40>>2];t[o>>2]=t[o>>2]&-268435441|(t[y+16>>2]&16777215)<<4;if(u[y+27|0]==3){if(t[y+16>>2]!=1){O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=10;break a}q[y+15|0]=0;if(w[y+32>>2]<1){J(t[y+44>>2]);t[y+76>>2]=1;break a}q[y+15|0]=u[t[y+36>>2]];t[y+36>>2]=t[y+36>>2]+1;t[y+32>>2]=t[y+32>>2]-1;k:{if(u[y+15|0]<=4){q[t[y+40>>2]+4|0]=u[y+15|0];break k}q[t[y+40>>2]+4|0]=4}t[y+40>>2]=t[y+40>>2]+20;break f}z=y,B=Q(y+36|0,y+32|0,y+14|0,y+13|0),t[z+8>>2]=B;if(t[y+8>>2]){O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=t[y+8>>2];break a}if(u[y+27|0]==1){o=t[y+40>>2];q[o+4|0]=q[o+4|0]&1|u[y+13|0]<<1;t[y+40>>2]=t[y+40>>2]+20;break f}if(!u[y+27|0]){z=y,B=M(y+36|0,y+32|0,t[y+16>>2],t[y+40>>2]+8|0,t[y+40>>2]+12|0),t[z+4>>2]=B;if(t[y+4>>2]){O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=t[y+4>>2];break a}o=t[y+40>>2];q[o+4|0]=q[y+14|0]&1|u[o+4|0]&254;o=t[y+40>>2];q[o+4|0]=q[o+4|0]&1|u[y+13|0]<<1;t[y+40>>2]=t[y+40>>2]+20}}t[y+28>>2]=t[y+28>>2]+1;continue}break}if(t[y+32>>2]){O(t[y+44>>2],t[y+48>>2]);t[y+76>>2]=1;break a}t[t[y+64>>2]>>2]=t[y+44>>2];t[t[y+60>>2]>>2]=t[y+48>>2];t[y+76>>2]=0}A=y+80|0;return t[y+76>>2]}function D(o){var q=0,l=0,r=0,m=0,n=0,s=0,u=0,v,w=0,x,p;w=8;a:{b:{if(o>>>0>4294967239)break b;while(1){w=w>>>0>8?w:8;l=t[603];n=l;m=t[602];u=m;o=o>>>0>8?o+3&-4:8;c:{if(o>>>0<=127){s=(o>>>3|0)-1|0;break c}r=y(o);s=((o>>>29-r^4)-(r<<2)|0)+110|0;if(o>>>0<=4095)break c;r=((o>>>30-r^2)-(r<<1)|0)+71|0;s=r>>>0<63?r:63}q=s;r=q&31;(q&63)>>>0>=32?(q=0,l=l>>>r|0):(q=l>>>r|0,l=((1<<r)-1&l)<<32-r|u>>>r);r=q;if(l|q){while(1){n=l;q=r;d:{if(q|l){m=q-1|0;v=m+1|0;u=m;m=l-1|0;u=(m|0)!=-1?v:u;m=y(l^m)+32|0;l=y(q^u);l=(l|0)==32?m:l;q=63-l|0;0-(l>>>0>63)|0;break d}q=64}m=q;q=m;l=q&31;(q&63)>>>0>=32?(q=0,u=r>>>l|0):(q=r>>>l|0,u=((1<<l)-1&r)<<32-l|n>>>l);r=q;s=m+s|0;n=s<<4;q=t[n+1384>>2];m=n+1376|0;e:{if((q|0)!=(m|0)){l=I(q,w,o);if(l)break b;l=t[q+4>>2];t[l+8>>2]=t[q+8>>2];t[t[q+8>>2]+4>>2]=l;t[q+8>>2]=m;l=n+1380|0;t[q+4>>2]=t[l>>2];t[l>>2]=q;t[t[q+4>>2]+8>>2]=q;s=s+1|0;l=(r&1)<<31|u>>>1;r=r>>>1|0;break e}x=t[603];q=s;v=q&63;l=v;n=l&31;l>>>0>=32?(l=0,m=-1>>>n|0):(l=-1>>>n|0,m=(1<<n)-1<<32-n|-1>>>n);m=m&-2;n=v&31;v>>>0>=32?(l=m<<n,v=0):(l=(1<<n)-1&m>>>32-n|l<<n,v=m<<n);n=l;m=0-q&63;l=m;q=l&31;l>>>0>=32?(l=-1<<q,q=0):(l=(1<<q)-1&-1>>>32-q|-1<<q,q=-1<<q);p=q&-2;q=m&31;m>>>0>=32?(m=0,q=l>>>q|0):(m=l>>>q|0,q=((1<<q)-1&l)<<32-q|p>>>q);l=q|v;B=n|m;t[602]=t[602]&l;t[603]=B&x;l=u^1}if(l|r)continue;break}m=t[602];n=t[603]}f:{if(n|m){r=y(n);r=63-((r|0)==32?y(m)+32|0:r)<<4;q=r+1376|0;r=t[r+1384>>2];g:{if(!n&m>>>0<1073741824)break g;s=98;if((q|0)==(r|0))break g;while(1){l=I(r,w,o);if(l)break b;r=t[r+8>>2];if(!s)break g;s=s-1|0;if((q|0)!=(r|0))continue;break}}if(G(o+48|0))break f;if(!r|(q|0)==(r|0))break a;while(1){l=I(r,w,o);if(l)break b;r=t[r+8>>2];if((q|0)!=(r|0))continue;break}break a}if(!G(o+48|0))break a}l=0;if(o>>>0>4294967239)break b;r=w;q=0;while(1){s=q;if(r){r=r-1&r;q=q+1|0;continue}break}if(s>>>0<=1)continue;break}}return l}return 0}function E(o,p,l,r,m,n,x){o=o|0;p=p|0;l=l|0;r=r|0;m=m|0;n=n|0;x=x|0;var y=0,z=0;y=A-32|0;A=y;s[y+26>>1]=o;t[y+20>>2]=p;t[y+16>>2]=l;q[y+15|0]=r;s[y+12>>1]=m;t[y+8>>2]=n;t[y+4>>2]=x;a:{if(!(!(q[y+15|0]&1)|v[y+12>>1]<=32767)){t[y+28>>2]=4;break a}p=t[y+20>>2];l=t[y+16>>2];r=t[y+8>>2];m=t[y+4>>2];n=q[y+15|0]&1;o=A+-64|0;A=o;t[o+56>>2]=y+26;t[o+52>>2]=p;t[o+48>>2]=l;t[o+44>>2]=r;t[o+40>>2]=m;q[o+39|0]=2;q[o+38|0]=13;t[o+32>>2]=y+12;q[o+31|0]=n;q[o+30|0]=2;b:{c:{if(!(!t[o+52>>2]|(!t[o+44>>2]|!t[o+40>>2]))&&w[o+48>>2]<=16777215)break c;t[o+60>>2]=5;break b}t[o+24>>2]=t[o+48>>2]+(u[o+39|0]+(u[o+30|0]+4|0)|0);z=o,x=D(t[o+24>>2]),t[z+20>>2]=x;if(!t[o+20>>2]){t[o+60>>2]=3;break b}t[o+16>>2]=t[o+20>>2];q[t[o+16>>2]]=u[o+38|0];t[o+16>>2]=t[o+16>>2]+1;ba(t[o+16>>2],t[o+56>>2],u[o+30|0]);t[o+16>>2]=u[o+30|0]+t[o+16>>2];t[o+12>>2]=u[o+39|0]+t[o+48>>2];if(w[o+12>>2]<w[o+48>>2]){J(t[o+20>>2]);t[o+60>>2]=9;break b}p=t[o+16>>2];l=u[o+12|0]|u[o+13|0]<<8;q[p|0]=l;q[p+1|0]=l>>>8;q[p+2|0]=u[o+14|0];t[o+16>>2]=t[o+16>>2]+3;if(q[o+31|0]&1)d:{if(u[o+38|0]==6){p=t[o+32>>2];q[p|0]=u[p|0]|128;break d}e:{if(u[o+38|0]==13){p=t[o+32>>2];s[p>>1]=v[p>>1]|32768;break e}J(t[o+20>>2]);t[o+60>>2]=1;break b}}ba(t[o+16>>2],t[o+32>>2],u[o+39|0]);t[o+16>>2]=u[o+39|0]+t[o+16>>2];ba(t[o+16>>2],t[o+52>>2],t[o+48>>2]);t[t[o+44>>2]>>2]=t[o+20>>2];t[t[o+40>>2]>>2]=t[o+24>>2];t[o+60>>2]=0}A=o- -64|0;t[y+28>>2]=t[o+60>>2]}A=y+32|0;return t[y+28>>2]}function F(o,p,l,r,m){o=o|0;p=p|0;l=l|0;r=r|0;m=m|0;var n=0,v=0;n=A-32|0;A=n;s[n+30>>1]=o;t[n+24>>2]=p;t[n+20>>2]=l;t[n+16>>2]=r;t[n+12>>2]=m;p=t[n+24>>2];l=t[n+20>>2];r=t[n+16>>2];m=t[n+12>>2];o=A-48|0;A=o;t[o+40>>2]=n+30;t[o+36>>2]=p;t[o+32>>2]=l;t[o+28>>2]=r;t[o+24>>2]=m;q[o+23|0]=2;q[o+22|0]=15;a:{if(!(t[o+24>>2]?t[o+28>>2]:0)){t[o+44>>2]=5;break a}t[t[o+28>>2]>>2]=0;t[t[o+24>>2]>>2]=0;if(!(w[o+32>>2]<=16777215?t[o+36>>2]:0)){t[o+44>>2]=5;break a}t[o+16>>2]=t[o+32>>2]+(u[o+23|0]+4|0);v=o,r=D(t[o+16>>2]),t[v+12>>2]=r;if(!t[o+12>>2]){t[o+44>>2]=3;break a}t[o+8>>2]=t[o+12>>2];q[t[o+8>>2]]=u[o+22|0];t[o+8>>2]=t[o+8>>2]+1;ba(t[o+8>>2],t[o+40>>2],u[o+23|0]);t[o+8>>2]=u[o+23|0]+t[o+8>>2];p=t[o+8>>2];l=u[o+32|0]|u[o+33|0]<<8;q[p|0]=l;q[p+1|0]=l>>>8;q[p+2|0]=u[o+34|0];t[o+8>>2]=t[o+8>>2]+3;ba(t[o+8>>2],t[o+36>>2],t[o+32>>2]);t[o+8>>2]=t[o+32>>2]+t[o+8>>2];t[t[o+28>>2]>>2]=t[o+12>>2];t[t[o+24>>2]>>2]=t[o+16>>2];t[o+44>>2]=0}A=o+48|0;A=n+32|0;return t[o+44>>2]}function G(o){var p=0,l,r=0,m=0,n,s=0;r=t[343];l=o+3&-4;p=r+l|0;a:{b:{if(p>>>0<=r>>>0?l:0)break b;if(p>>>0>wa()<<16>>>0&&!(z(p|0)|0))break b;t[343]=p;break a}t[604]=48;r=-1}if((r|0)!=-1){l=o+r|0;p=l-16|0;t[p+12>>2]=16;t[p>>2]=16;o=t[600];o?s=t[o+8>>2]:s=0;c:{d:{if((s|0)==(r|0)){m=r-(t[r-4>>2]&-2)|0;n=t[m-4>>2];t[o+8>>2]=l;o=m-(n&-2)|0;l=-16;if(!(q[(o+t[o>>2]|0)-4|0]&1))break d;l=t[o+4>>2];t[l+8>>2]=t[o+8>>2];t[t[o+8>>2]+4>>2]=l;p=p-o|0;t[o>>2]=p;break c}t[r+12>>2]=16;t[r>>2]=16;t[r+8>>2]=l;t[r+4>>2]=o;t[600]=r;l=16}o=r+l|0;p=p-o|0;t[o>>2]=p}t[((p&-4)+o|0)-4>>2]=p|1;s=o;m=t[o>>2]-8|0;e:{if(m>>>0<=127){p=(m>>>3|0)-1|0;break e}n=y(m);p=((m>>>29-n^4)-(n<<2)|0)+110|0;if(m>>>0<=4095)break e;p=((m>>>30-n^2)-(n<<1)|0)+71|0;p=p>>>0<63?p:63}l=p<<4;t[s+4>>2]=l+1376;l=l+1384|0;t[o+8>>2]=t[l>>2];t[l>>2]=o;t[t[o+8>>2]+4>>2]=o;l=t[603];o=p&31;(p&63)>>>0>=32?(p=1<<o,o=0):(p=(1<<o)-1&1>>>32-o,o=1<<o);t[602]=o|t[602];t[603]=p|l}return(r|0)!=-1}function la(o,p,l,r){o=o|0;p=p|0;l=l|0;r=r|0;var m=0,n=0;m=A-16|0;A=m;s[m+10>>1]=o;s[m+8>>1]=p;t[m+4>>2]=l;t[m>>2]=r;a:{if(v[m+8>>1]>32767){t[m+12>>2]=4;break a}p=t[m+4>>2];l=t[m>>2];o=A-48|0;A=o;t[o+40>>2]=m+10;t[o+36>>2]=p;t[o+32>>2]=l;q[o+31|0]=2;q[o+30|0]=12;t[o+24>>2]=m+8;q[o+23|0]=2;b:{if(!(t[o+32>>2]?t[o+36>>2]:0)){t[o+44>>2]=5;break b}t[o+16>>2]=u[o+31|0]+(u[o+23|0]+4|0);n=o,r=D(t[o+16>>2]),t[n+12>>2]=r;if(!t[o+12>>2]){t[o+44>>2]=3;break b}t[o+8>>2]=t[o+12>>2];q[t[o+8>>2]]=u[o+30|0];t[o+8>>2]=t[o+8>>2]+1;ba(t[o+8>>2],t[o+40>>2],u[o+23|0]);t[o+8>>2]=u[o+23|0]+t[o+8>>2];t[o+4>>2]=u[o+31|0];p=t[o+8>>2];l=u[o+4|0]|u[o+5|0]<<8;q[p|0]=l;q[p+1|0]=l>>>8;q[p+2|0]=u[o+6|0];t[o+8>>2]=t[o+8>>2]+3;ba(t[o+8>>2],t[o+24>>2],u[o+31|0]);t[t[o+32>>2]>>2]=t[o+16>>2];t[t[o+36>>2]>>2]=t[o+12>>2];t[o+44>>2]=0}A=o+48|0;t[m+12>>2]=t[o+44>>2]}A=m+16|0;return t[m+12>>2]}function H(o,p,l){o=o|0;p=p|0;l=l|0;var q=0,m=0,n=0,r=0,s=0;n=A+-64|0;A=n;m=1;a:{if(R(o,p,0))break a;m=0;if(!p)break a;q=A+-64|0;A=q;m=t[p>>2];r=t[m-4>>2];s=t[m-8>>2];t[q+20>>2]=0;t[q+16>>2]=1084;t[q+12>>2]=p;t[q+8>>2]=1132;m=0;ca(q+24|0,39);p=p+s|0;b:{if(R(r,1132,0)){t[q+56>>2]=1;ka[t[t[r>>2]+20>>2]](r,q+8|0,p,p,1,0);m=t[q+32>>2]==1?p:0;break b}ka[t[t[r>>2]+24>>2]](r,q+8|0,p,1,0);c:switch(t[q+44>>2]){case 0:m=t[q+48>>2]==1?t[q+36>>2]==1?t[q+40>>2]==1?t[q+28>>2]:0:0:0;break b;case 1:break c;default:break b}if(t[q+48>>2]|t[q+36>>2]!=1|t[q+40>>2]!=1?t[q+32>>2]!=1:0)break b;m=t[q+24>>2]}A=q- -64|0;p=m;m=0;if(!p)break a;ca(n+8|4,52);t[n+56>>2]=1;t[n+20>>2]=-1;t[n+16>>2]=o;t[n+8>>2]=p;ka[t[t[p>>2]+28>>2]](p,n+8|0,t[l>>2],1);o=t[n+32>>2];(o|0)==1&&(t[l>>2]=t[n+24>>2]);m=(o|0)==1}o=m;A=n- -64|0;return o|0}function I(o,p,l){var q=0,m,n=0,r=0;q=o+4|0;m=(q+p|0)-1&0-p;p=t[o>>2];if(m+l>>>0<=(p+o|0)-4>>>0){n=t[o+4>>2];t[n+8>>2]=t[o+8>>2];t[t[o+8>>2]+4>>2]=n;(q|0)!=(m|0)&&(m=m-q|0,n=o-(t[o-4>>2]&-2)|0,q=m+t[n>>2]|0,t[n>>2]=q,t[(n+(q&-4)|0)-4>>2]=q,o=o+m|0,p=p-m|0,t[o>>2]=p);a:{if(l+24>>>0<=p>>>0){q=(o+l|0)+8|0;p=(p-l|0)-8|0;t[q>>2]=p;t[(q+(p&-4)|0)-4>>2]=p|1;r=q;n=t[q>>2]-8|0;b:{if(n>>>0<=127){m=(n>>>3|0)-1|0;break b}p=y(n);m=((n>>>29-p^4)-(p<<2)|0)+110|0;if(n>>>0<=4095)break b;p=((n>>>30-p^2)-(p<<1)|0)+71|0;m=p>>>0<63?p:63}p=m;m=p<<4;t[r+4>>2]=m+1376;m=m+1384|0;t[q+8>>2]=t[m>>2];t[m>>2]=q;t[t[q+8>>2]+4>>2]=q;m=t[603];q=p&31;(p&63)>>>0>=32?(p=1<<q,r=0):(p=(1<<q)-1&1>>>32-q,r=1<<q);t[602]=r|t[602];t[603]=p|m;p=l+8|0;t[o>>2]=p;t[((p&-4)+o|0)-4>>2]=p;break a}t[(o+p|0)-4>>2]=p}o=o+4|0}else o=0;return o}function J(o){var p=0,l,q=0,m,n=0;if(o){l=o-4|0;m=t[l>>2];q=m;p=l;n=t[o-8>>2];o=n&-2;(o|0)!=(n|0)&&(p=l-o|0,q=t[p+4>>2],t[q+8>>2]=t[p+8>>2],t[t[p+8>>2]+4>>2]=q,q=o+m|0);o=l+m|0;l=t[o>>2];(l|0)!=t[(o+l|0)-4>>2]&&(m=t[o+4>>2],t[m+8>>2]=t[o+8>>2],t[t[o+8>>2]+4>>2]=m,q=q+l|0);t[p>>2]=q;t[((q&-4)+p|0)-4>>2]=q|1;n=p;q=t[p>>2]-8|0;a:{if(q>>>0<=127){o=(q>>>3|0)-1|0;break a}m=y(q);o=((q>>>29-m^4)-(m<<2)|0)+110|0;if(q>>>0<=4095)break a;o=((q>>>30-m^2)-(m<<1)|0)+71|0;o=o>>>0<63?o:63}l=o<<4;t[n+4>>2]=l+1376;l=l+1384|0;t[p+8>>2]=t[l>>2];t[l>>2]=p;t[t[p+8>>2]+4>>2]=p;l=t[603];p=o&31;(o&63)>>>0>=32?(o=1<<p,p=0):(o=(1<<p)-1&1>>>32-p,p=1<<p);t[602]=p|t[602];t[603]=o|l}}function K(n,o,l){n=n|0;o=o|0;l=l|0;var p=0,m=0;p=A-48|0;A=p;t[p+40>>2]=n;t[p+36>>2]=o;t[p+32>>2]=l;a:{if(!(t[p+32>>2]?t[p+36>>2]:0)){t[p+44>>2]=5;break a}if(w[p+40>>2]>4){t[p+44>>2]=8;break a}t[p+28>>2]=5;m=p,l=D(t[p+28>>2]),t[m+24>>2]=l;if(!t[p+24>>2]){t[p+44>>2]=3;break a}t[p+20>>2]=t[p+24>>2];q[p+19|0]=3;q[t[p+20>>2]]=u[p+19|0];t[p+20>>2]=t[p+20>>2]+1;t[p+12>>2]=1;n=t[p+20>>2];o=u[p+12|0]|u[p+13|0]<<8;q[n|0]=o;q[n+1|0]=o>>>8;q[n+2|0]=u[p+14|0];t[p+20>>2]=t[p+20>>2]+3;q[p+11|0]=t[p+40>>2];q[t[p+20>>2]]=u[p+11|0];t[t[p+36>>2]>>2]=t[p+24>>2];t[t[p+32>>2]>>2]=t[p+28>>2];t[p+44>>2]=0}A=p+48|0;return t[p+44>>2]}function L(n,o,l,p,m){n=n|0;o=o|0;l=l|0;p=p|0;m=m|0;if(R(n,t[o+8>>2],m)){da(o,l,p);return}a:{if(R(n,t[o>>2],m)){if(!(t[o+20>>2]!=(l|0)?t[o+16>>2]!=(l|0):0)){if((p|0)!=1)break a;t[o+32>>2]=1;return}t[o+32>>2]=p;b:{if(t[o+44>>2]==4)break b;s[o+52>>1]=0;n=t[n+8>>2];ka[t[t[n>>2]+20>>2]](n,o,l,l,1,m);if(u[o+53|0]){t[o+44>>2]=3;if(!u[o+52|0])break b;break a}t[o+44>>2]=4}t[o+20>>2]=l;t[o+40>>2]=t[o+40>>2]+1;if(t[o+36>>2]!=1|t[o+24>>2]!=2)break a;q[o+54|0]=1;return}n=t[n+8>>2];ka[t[t[n>>2]+24>>2]](n,o,l,p,m)}}function M(o,p,l,q,m){var n=0;n=A-32|0;A=n;t[n+24>>2]=o;t[n+20>>2]=p;t[n+16>>2]=l;t[n+12>>2]=q;t[n+8>>2]=m;a:{if(w[n+16>>2]<1){t[n+28>>2]=9;break a}t[t[n+8>>2]>>2]=t[n+16>>2]-1;if(w[t[n+20>>2]>>2]<w[t[n+8>>2]>>2]){t[n+28>>2]=1;break a}o=D(t[t[n+8>>2]>>2]);t[t[n+12>>2]>>2]=o;if(!t[t[n+12>>2]>>2]){t[n+28>>2]=3;break a}ba(t[t[n+12>>2]>>2],t[t[n+24>>2]>>2],t[t[n+8>>2]>>2]);o=t[n+24>>2];t[o>>2]=t[t[n+8>>2]>>2]+t[o>>2];o=t[n+20>>2];t[o>>2]=t[o>>2]-t[t[n+8>>2]>>2];t[n+28>>2]=0}A=n+32|0;return t[n+28>>2]}function N(n,o,l){n=n|0;o=o|0;l=l|0;var p=0,m=0;p=A-32|0;A=p;s[p+26>>1]=n;t[p+20>>2]=o;t[p+16>>2]=l;t[t[p+16>>2]>>2]=3;m=p,l=D(t[t[p+16>>2]>>2]),t[m+12>>2]=l;a:{if(!t[p+12>>2]){t[p+28>>2]=3;break a}t[t[p+20>>2]>>2]=t[p+12>>2];q[p+11|0]=14;q[t[p+12>>2]]=u[p+11|0];t[p+12>>2]=t[p+12>>2]+1;n=t[p+12>>2];o=u[p+26|0]|u[p+27|0]<<8;q[n|0]=o;q[n+1|0]=o>>>8;t[p+28>>2]=0}A=p+32|0;return t[p+28>>2]}function O(m,n){var l=0;l=A-16|0;A=l;t[l+12>>2]=m;t[l+8>>2]=n;t[l+4>>2]=0;while(1){if(w[l+4>>2]<w[l+8>>2]){t[l>>2]=t[l+12>>2]+x(t[l+4>>2],20);a:{if(!(t[t[l>>2]>>2]&15)){J(t[t[l>>2]+8>>2]);break a}b:{if((t[t[l>>2]>>2]&15)==5){J(t[t[l>>2]+8>>2]);break b}(t[t[l>>2]>>2]&15)==6&&J(t[t[l>>2]+12>>2])}}t[l+4>>2]=t[l+4>>2]+1;continue}break}J(t[l+12>>2]);A=l+16|0}function P(m,n,l,o){q[m+53|0]=1;a:{if(t[m+4>>2]!=(l|0))break a;q[m+52|0]=1;l=t[m+16>>2];if(!l){t[m+36>>2]=1;t[m+24>>2]=o;t[m+16>>2]=n;if((o|0)!=1|t[m+48>>2]!=1)break a;q[m+54|0]=1;return}if((n|0)==(l|0)){l=t[m+24>>2];(l|0)==2&&(t[m+24>>2]=o,l=o);if(t[m+48>>2]!=1|(l|0)!=1)break a;q[m+54|0]=1;return}q[m+54|0]=1;t[m+36>>2]=t[m+36>>2]+1}}function Q(n,o,l,p){var m;m=A-32|0;t[m+24>>2]=n;t[m+20>>2]=o;t[m+16>>2]=l;t[m+12>>2]=p;q[m+11|0]=0;a:{if(w[t[m+20>>2]>>2]<1){t[m+28>>2]=1;break a}q[m+11|0]=u[t[t[m+24>>2]>>2]];n=t[m+24>>2];t[n>>2]=t[n>>2]+1;n=t[m+20>>2];t[n>>2]=t[n>>2]-1;q[t[m+16>>2]]=(u[m+11|0]&128)==128;q[t[m+12>>2]]=u[m+11|0]&127;t[m+28>>2]=0}return t[m+28>>2]}function ma(n,o,l,p,m){n=n|0;o=o|0;l=l|0;p=p|0;m=m|0;if(R(n,t[o+8>>2],m)){da(o,l,p);return}a:{if(!R(n,t[o>>2],m))break a;if(!(t[o+20>>2]!=(l|0)?t[o+16>>2]!=(l|0):0)){if((p|0)!=1)break a;t[o+32>>2]=1;return}t[o+20>>2]=l;t[o+32>>2]=p;t[o+40>>2]=t[o+40>>2]+1;t[o+36>>2]!=1|t[o+24>>2]!=2||(q[o+54|0]=1);t[o+44>>2]=4}}function R(m,n,l){var o;if(!l)return t[m+4>>2]==t[n+4>>2];if((m|0)==(n|0))return 1;l=t[m+4>>2];m=u[l|0];n=t[n+4>>2];o=u[n|0];a:{if(!m|(o|0)!=(m|0))break a;while(1){o=u[n+1|0];m=u[l+1|0];if(!m)break a;n=n+1|0;l=l+1|0;if((m|0)==(o|0))continue;break}}return(m|0)==(o|0)}function na(m,n){m=m|0;n=n|0;var l=0,o=0;l=A-32|0;A=l;t[l+24>>2]=m;t[l+20>>2]=n;o=l,m=D(1),t[o+16>>2]=m;a:{if(!t[l+16>>2]){t[l+28>>2]=3;break a}q[l+15|0]=9;q[t[l+16>>2]]=u[l+15|0];t[t[l+24>>2]>>2]=t[l+16>>2];t[t[l+20>>2]>>2]=1;t[l+28>>2]=0}A=l+32|0;return t[l+28>>2]}function S(m,n){m=m|0;n=n|0;var l=0,o=0;l=A-32|0;A=l;t[l+24>>2]=m;t[l+20>>2]=n;o=l,m=D(1),t[o+16>>2]=m;a:{if(!t[l+16>>2]){t[l+28>>2]=3;break a}q[l+15|0]=10;q[t[l+16>>2]]=u[l+15|0];t[t[l+24>>2]>>2]=t[l+16>>2];t[t[l+20>>2]>>2]=1;t[l+28>>2]=0}A=l+32|0;return t[l+28>>2]}function T(m,n){m=m|0;n=n|0;var l=0,o=0;l=A-32|0;A=l;t[l+24>>2]=m;t[l+20>>2]=n;o=l,m=D(1),t[o+16>>2]=m;a:{if(!t[l+16>>2]){t[l+28>>2]=3;break a}q[l+15|0]=2;q[t[l+16>>2]]=u[l+15|0];t[t[l+24>>2]>>2]=t[l+16>>2];t[t[l+20>>2]>>2]=1;t[l+28>>2]=0}A=l+32|0;return t[l+28>>2]}function U(m,n){m=m|0;n=n|0;var l=0,o=0;l=A-32|0;A=l;t[l+24>>2]=m;t[l+20>>2]=n;o=l,m=D(1),t[o+16>>2]=m;a:{if(!t[l+16>>2]){t[l+28>>2]=3;break a}q[l+15|0]=4;q[t[l+16>>2]]=u[l+15|0];t[t[l+24>>2]>>2]=t[l+16>>2];t[t[l+20>>2]>>2]=1;t[l+28>>2]=0}A=l+32|0;return t[l+28>>2]}function V(l){var m=0;m=A-16|0;A=m;t[m+12>>2]=l;l=1;a:{if(X(t[m+12>>2])&1)break a;l=1;if(t[m+12>>2]==15)break a;l=1;if(t[m+12>>2]==13)break a;l=1;if(t[m+12>>2]==12)break a;l=t[m+12>>2]==14}A=m+16|0;return l}function W(m,n,l){var o;o=t[m+16>>2];if(!o){t[m+36>>2]=1;t[m+24>>2]=l;t[m+16>>2]=n;return}a:{if((n|0)==(o|0)){if(t[m+24>>2]!=2)break a;t[m+24>>2]=l;return}q[m+54|0]=1;t[m+24>>2]=2;t[m+36>>2]=t[m+36>>2]+1}}function X(l){var m;m=A-16|0;t[m+12>>2]=l;l=1;a:{if(t[m+12>>2]==5)break a;l=1;if(t[m+12>>2]==6)break a;l=1;if(t[m+12>>2]==7)break a;l=t[m+12>>2]==8}return l}function Y(o,p,l,q,m,n){o=o|0;p=p|0;l=l|0;q=q|0;m=m|0;n=n|0;if(R(o,t[p+8>>2],n)){P(p,l,q,m);return}o=t[o+8>>2];ka[t[t[o>>2]+20>>2]](o,p,l,q,m,n)}function Z(){var m=0,n,l;while(1){n=m<<4;l=n+1376|0;t[n+1380>>2]=l;t[n+1384>>2]=l;m=m+1|0;if((m|0)!=64)continue;break}G(48)}function $(m,n,l,o){m=m|0;n=n|0;l=l|0;o=o|0;if(R(m,t[n+8>>2],0)){W(n,l,o);return}m=t[m+8>>2];ka[t[t[m>>2]+28>>2]](m,n,l,o)}function aa(o,p,l,q,m,n){o=o|0,p=p|0,l=l|0,q=q|0,m=m|0,n=n|0,R(o,t[p+8>>2],n)&&P(p,l,q,m)}function ba(m,n,l){if(l)while(1){q[m|0]=u[n|0];m=m+1|0;n=n+1|0;l=l-1|0;if(l)continue;break}}function ca(l,m){if(m)while(1){q[l|0]=0;l=l+1|0;m=m-1|0;if(m)continue;break}}function oa(m,n,l,o){m=m|0,n=n|0,l=l|0,o=o|0,R(m,t[n+8>>2],0)&&W(n,l,o)}function da(m,n,l){t[m+28>>2]==1|t[m+4>>2]!=(n|0)||(t[m+28>>2]=l)}function pa(l,m){l=l|0;m=m|0;return x(m,20)+l|0}function ea(l){l=l|0;return v[l+8>>1]>>>1|0}function qa(l){l=l|0;return s[l+8>>1]&1}function fa(l){l=l|0;return t[l+12>>2]}function ra(l){l=l|0;return t[l>>2]&15}function sa(l){l=l|0;return t[l+16>>2]}function ga(l){l=l|0;return v[l+4>>1]}function ha(l){l=l|0;return t[l+8>>2]}function ia(l){l=l|0;return u[l+4|0]}function ja(l){l=l|0;return l|0}function ta(l){return D(l)}function ua(l){l=l|0,J(l)}function va(l){l|0}n=u;r(l);var ka=m([null,ja,ua,va,va,H,aa,ma,oa,ua,Y,L,$]);function wa(){return p.byteLength/65536|0}function xa(l){l=l|0;var m=wa()|0;l=m+l|0;if(m<l&&l<65536){l=new ArrayBuffer(x(l,65536));var r=new Int8Array(l);r.set(q);q=new Int8Array(l);s=new Int16Array(l);t=new Int32Array(l);u=new Uint8Array(l);v=new Uint16Array(l);w=new Uint32Array(l);new Float32Array(l);new Float64Array(l);p=l;o.buffer=p;n=u}return m}return{c:Z,d:ta,e:ua,f:T,g:U,h:K,i:F,j:N,k:E,l:la,m:na,n:S,o:C,p:ra,q:ia,r:pa,s:ga,t:ha,u:fa,v:fa,w:sa,x:ea,y:qa,z:ea,A:ka}}return s(l)}(ha)},instantiate:function(l,m){return{then:function(n){var m=new D.Module(l);n({instance:new D.Instance(m)})}}},RuntimeError:Error};C=[];typeof D!=="object"&&Y("no native wasm support detected");var E,F=!1;function G(l,m){l||Y("Assertion failed: "+m)}function la(l,m){l%m>0&&(l+=m-l%m);return l}var H,I;function J(l){H=l,m.HEAP8=new Int8Array(l),m.HEAP16=new Int16Array(l),m.HEAP32=new Int32Array(l),m.HEAPU8=I=new Uint8Array(l),m.HEAPU16=new Uint16Array(l),m.HEAPU32=new Uint32Array(l),m.HEAPF32=new Float32Array(l),m.HEAPF64=new Float64Array(l)}u=m.INITIAL_MEMORY||2097152;m.wasmMemory?E=m.wasmMemory:E=new D.Memory({initial:u/65536,maximum:2147483648/65536});E&&(H=E.buffer);H.byteLength;J(H);var K,L=[],M=[],N=[];function O(){if(m.preRun){typeof m.preRun=="function"&&(m.preRun=[m.preRun]);while(m.preRun.length)ma(m.preRun.shift())}da(L)}function P(){da(M)}function Q(){if(m.postRun){typeof m.postRun=="function"&&(m.postRun=[m.postRun]);while(m.postRun.length)na(m.postRun.shift())}da(N)}function ma(l){L.unshift(l)}function R(l){M.unshift(l)}function na(l){N.unshift(l)}(!Math.imul||Math.imul(4294967295,5)!==-5)&&(Math.imul=function(l,m){var n=l>>>16;l=l&65535;var o=m>>>16;m=m&65535;return l*m+(n*m+l*o<<16)|0});if(!Math.fround){var S=new Float32Array(1);Math.fround=function(l){S[0]=l;return S[0]}}Math.clz32||(Math.clz32=function(l){var m=32,n=l>>16;n&&(m-=16,l=n);n=l>>8;n&&(m-=8,l=n);n=l>>4;n&&(m-=4,l=n);n=l>>2;n&&(m-=2,l=n);n=l>>1;return n?m-2:m-l});Math.trunc||(Math.trunc=function(l){return l<0?Math.ceil(l):Math.floor(l)});var T=0,U=null,V=null;function W(l){T++,m.monitorRunDependencies&&m.monitorRunDependencies(T)}function X(l){T--;m.monitorRunDependencies&&m.monitorRunDependencies(T);if(T==0){U!==null&&(clearInterval(U),U=null);if(V){l=V;V=null;l()}}}m.preloadedImages={};m.preloadedAudios={};function Y(l){m.onAbort&&m.onAbort(l);l+="";B(l);F=!0;l="abort("+l+"). Build with -s ASSERTIONS=1 for more info.";l=new D.RuntimeError(l);s(l);throw l}var Z="data:application/octet-stream;base64,";function $(l){return l.startsWith(Z)}var aa="dgwcppbridge.wasm";$(aa)||(aa=z(aa));function ba(l){try{if(l==aa&&C)return new Uint8Array(C);var m=ga(l);if(m)return m;if(A)return A(l);else throw"both async and sync fetching of the wasm failed"}catch(l){Y(l)}}function ca(){return!C&&(w||x)&&typeof fetch==="function"?fetch(aa,{credentials:"same-origin"}).then(function(l){if(!l.ok)throw"failed to load wasm binary file at '"+aa+"'";return l.arrayBuffer()})["catch"](function(){return ba(aa)}):n.resolve().then(function(){return ba(aa)})}function oa(){var n={a:ha};function o(n,l){l=n.exports;m.asm=l;K=m.asm.A;R(m.asm.c);X("wasm-instantiate")}W("wasm-instantiate");function r(l){o(l.instance)}function t(l){return ca().then(function(l){l=D.instantiate(l,n);return l}).then(l,function(l){B("failed to asynchronously prepare wasm: "+l),Y(l)})}function u(){if(!C&&typeof D.instantiateStreaming==="function"&&!$(aa)&&typeof fetch==="function")return fetch(aa,{credentials:"same-origin"}).then(function(l){l=D.instantiateStreaming(l,n);return l.then(r,function(l){B("wasm streaming compile failed: "+l);B("falling back to ArrayBuffer instantiation");return t(r)})});else return t(r)}if(m.instantiateWasm)try{var l=m.instantiateWasm(n,o);return l}catch(l){B("Module.instantiateWasm callback failed with error: "+l);return!1}u()["catch"](s);return{}}function da(l){while(l.length>0){var n=l.shift();if(typeof n=="function"){n(m);continue}var o=n.func;typeof o==="number"?n.arg===void 0?K.get(o)():K.get(o)(n.arg):o(n.arg===void 0?null:n.arg)}}function pa(l){try{E.grow(l-H.byteLength+65535>>>16);J(E.buffer);return 1}catch(l){}}function ea(l){var m=I.length;l=l>>>0;var n=2147483648;if(l>n)return!1;for(var o=1;o<=4;o*=2){var p=m*(1+.2/o);p=Math.min(p,l+100663296);p=Math.min(n,la(Math.max(l,p),65536));p=pa(p);if(p)return!0}return!1}var qa=!1;function fa(l){var m=[];for(var n=0;n<l.length;n++){var o=l[n];o>255&&(qa&&G(!1,"Character code "+o+" ("+String.fromCharCode(o)+")  at offset "+n+" not in 0x00-0xFF."),o&=255);m.push(String.fromCharCode(o))}return m.join("")}var ra=typeof atob==="function"?atob:function(l){var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="",o,p,q,r,s,t=0;l=l.replace(/[^A-Za-z0-9\+\/\=]/g,"");do p=m.indexOf(l.charAt(t++)),q=m.indexOf(l.charAt(t++)),r=m.indexOf(l.charAt(t++)),s=m.indexOf(l.charAt(t++)),p=p<<2|q>>4,q=(q&15)<<4|r>>2,o=(r&3)<<6|s,n=n+String.fromCharCode(p),r!==64&&(n=n+String.fromCharCode(q)),s!==64&&(n=n+String.fromCharCode(o));while(t<l.length);return n};function sa(l){try{l=ra(l);var m=new Uint8Array(l.length);for(var n=0;n<l.length;++n)m[n]=l.charCodeAt(n);return m}catch(l){throw new Error("Converting base64 string to bytes failed.")}}function ga(l){if(!$(l))return;return sa(l.slice(Z.length))}var ha={b:ea,a:E};oa();m.___wasm_call_ctors=function(){return(m.___wasm_call_ctors=m.asm.c).apply(null,arguments)};m.__malloc=function(){return(m.__malloc=m.asm.d).apply(null,arguments)};m.__free=function(){return(m.__free=m.asm.e).apply(null,arguments)};m.__DgwCodecEncodeEmpty=function(){return(m.__DgwCodecEncodeEmpty=m.asm.f).apply(null,arguments)};m.__DgwCodecEncodeDeauth=function(){return(m.__DgwCodecEncodeDeauth=m.asm.g).apply(null,arguments)};m.__DgwCodecEncodeDrain=function(){return(m.__DgwCodecEncodeDrain=m.asm.h).apply(null,arguments)};m.__DgwCodecEncodeStreamGroup_EstabStream=function(){return(m.__DgwCodecEncodeStreamGroup_EstabStream=m.asm.i).apply(null,arguments)};m.__DgwCodecEncodeStreamGroup_EndOfData=function(){return(m.__DgwCodecEncodeStreamGroup_EndOfData=m.asm.j).apply(null,arguments)};m.__DgwCodecEncodeStreamGroup_Data=function(){return(m.__DgwCodecEncodeStreamGroup_Data=m.asm.k).apply(null,arguments)};m.__DgwCodecEncodeStreamGroup_Ack=function(){return(m.__DgwCodecEncodeStreamGroup_Ack=m.asm.l).apply(null,arguments)};m.__DgwCodecEncodePing=function(){return(m.__DgwCodecEncodePing=m.asm.m).apply(null,arguments)};m.__DgwCodecEncodePong=function(){return(m.__DgwCodecEncodePong=m.asm.n).apply(null,arguments)};m.__DgwCodecDecode=function(){return(m.__DgwCodecDecode=m.asm.o).apply(null,arguments)};m.__getFrameType=function(){return(m.__getFrameType=m.asm.p).apply(null,arguments)};m.__getDrainReasonFromDrainFrame=function(){return(m.__getDrainReasonFromDrainFrame=m.asm.q).apply(null,arguments)};m.__getDGWFramePtr=function(){return(m.__getDGWFramePtr=m.asm.r).apply(null,arguments)};m.__getStreamIdFromStreamGroupFrame=function(){return(m.__getStreamIdFromStreamGroupFrame=m.asm.s).apply(null,arguments)};m.__getEncodedParamsFromEstablishStreamFrame=function(){return(m.__getEncodedParamsFromEstablishStreamFrame=m.asm.t).apply(null,arguments)};m.__getEncodedParamsSizeFromEstablishStreamFrame=function(){return(m.__getEncodedParamsSizeFromEstablishStreamFrame=m.asm.u).apply(null,arguments)};m.__getDataFromGroupedStreamDataFrame=function(){return(m.__getDataFromGroupedStreamDataFrame=m.asm.v).apply(null,arguments)};m.__getDataSizeFromGroupedStreamDataFrame=function(){return(m.__getDataSizeFromGroupedStreamDataFrame=m.asm.w).apply(null,arguments)};m.__getAckIdFromGroupedStreamDataFrame=function(){return(m.__getAckIdFromGroupedStreamDataFrame=m.asm.x).apply(null,arguments)};m.__getRequiresAckFromGroupedStreamDataFrame=function(){return(m.__getRequiresAckFromGroupedStreamDataFrame=m.asm.y).apply(null,arguments)};m.__getAckIdFromGroupedStreamAckFrame=function(){return(m.__getAckIdFromGroupedStreamAckFrame=m.asm.z).apply(null,arguments)};var ia;V=function l(){ia||ja(),ia||(V=l)};function ja(l){l||v;if(T>0)return;O();if(T>0)return;function n(){if(ia)return;ia=!0;m.calledRun=!0;if(F)return;P();o(m);m.onRuntimeInitialized&&m.onRuntimeInitialized();Q()}m.setStatus?(m.setStatus("Running..."),setTimeout(function(){setTimeout(function(){m.setStatus("")},1),n()},1)):n()}m.run=ja;if(m.preInit){typeof m.preInit=="function"&&(m.preInit=[m.preInit]);while(m.preInit.length>0)m.preInit.pop()()}ja();return m.ready}}();typeof q==="object"&&typeof p==="object"?p.exports=r:typeof define==="function"&&define.amd?define([],function(){return r}):typeof q==="object"&&(q.Module=r)}),null);
__d("DGWUtils",["Base64","DGWConstants","DGWCppBridge","DGWLoggingContext","Promise","Random","URI","gkx","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=4;function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=d("Random").random()*16|0;a=a==="x"?b:b&3|8;return a.toString(16)})}function k(a){var b=new TextDecoder();b=b.decode(a);a=c("Base64").encode(b);b=a.replace(/\+/gi,"-").replace(/\//gi,"_").replace(/=/gi,"");return b}var l=null,m=null;function n(){m==null&&(m=(i||(i=b("Promise"))).resolve().then(function(){return c("DGWCppBridge")()}).then(function(a){l=a}));return m}e=function(){function a(){}a.initialize=function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:if(!c("gkx")("9999")){a.next=4;break}return a.abrupt("return",n());case 4:if(!(l!=null)){a.next=6;break}return a.abrupt("return");case 6:a.next=8;return b("regeneratorRuntime").awrap(c("DGWCppBridge")());case 8:l=a.sent;case 9:case"end":return a.stop()}},null,this)};a.constructConnectUrl=function(a){var b,e,f=a.appId,g=a.appVersion,i=a.authType,j=a.deviceId,l=a.dgwVersion,m=a.fbId,n=a.tier,o=a.loggingId,p=a.headers,q=a.endpoint,r=a.serviceId,s=a.regionHint;a=a.establishStreamFrame;var t=(b={},b[(e=d("DGWConstants")).HEADER_CONSTANTS.HEADER_APPID]=f,b[e.HEADER_CONSTANTS.HEADER_APPVERSION]=g,b[e.HEADER_CONSTANTS.HEADER_AUTHTYPE]=i,b[e.HEADER_CONSTANTS.HEADER_DGW_VERSION]=""+l,b[e.HEADER_CONSTANTS.HEADER_UUID]=m,b[e.HEADER_CONSTANTS.HEADER_TARGET_TIER]=n,b);a!==void 0&&(t[d("DGWConstants").HEADER_CONSTANTS.HEADER_ESTABLISH_STREAM_FRAME_BASE64]=k(a));o!==void 0&&(t[d("DGWConstants").HEADER_CONSTANTS.HEADER_LOGGING_ID]=o);s!==void 0&&(t[d("DGWConstants").HEADER_CONSTANTS.HEADER_REGIONHINT]=s);j!==void 0&&(t[d("DGWConstants").HEADER_CONSTANTS.HEADER_DEVICE_ID]=j);Object.keys(p).forEach(function(a){var b=d("DGWConstants").HEADER_CONSTANTS.APPHEADER_PREFIX+a;Object.prototype.hasOwnProperty.call(t,b)||(t[b]=p[a])});f=new(h||(h=c("URI")))(q);f.setQueryData(t);f.setPath(f.getPath()+"/"+r);f.toString().length>2e3&&(delete t[d("DGWConstants").HEADER_CONSTANTS.HEADER_ESTABLISH_STREAM_FRAME_BASE64],f.setQueryData(t));return f.toString()};return a}();f=function(){function a(a,b,c){this.$1=null,this.$2=a,this.$3=b,this.$4=c}a.initialize=function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:if(!c("gkx")("9999")){a.next=4;break}return a.abrupt("return",n());case 4:if(!(l!=null)){a.next=6;break}return a.abrupt("return");case 6:a.next=8;return b("regeneratorRuntime").awrap(c("DGWCppBridge")());case 8:l=a.sent;case 9:case"end":return a.stop()}},null,this)};var e=a.prototype;e.malloc=function(a){try{a=l.__malloc(a);if(a===0){var b;(b=this.$2)==null?void 0:b.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"wasm malloc failure","malloc returned 0");return-1}return a}catch(a){(b=this.$2)==null?void 0:b.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"wasm malloc failure","exception during malloc",a.toString());return-1}};e.free=function(a){l.__free(a)};e.append=function(a){if(this.$1==null){this.$1=a;return}var b=this.$1.length,c=new Uint8Array(b+a.length);c.set(this.$1,0);c.set(a,b);this.$1=c};e.processData=function(){var a=this;if(this.$1==null)return;var b=this.$1.length,c=this.malloc(b);if(c===-1)return;var e=l.HEAPU8.subarray(c,c+b);if(this.$1)for(var f=0;f<e.length;++f)e[f]=this.$1[f];f=this.malloc(j*4);if(f===-1)return;e=f;var g=e+j,h=g+j,i=h+j;b=l.__DgwCodecDecode(c,b,e,g,h,i);this.free(c);if(b!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){this.free(f);(h=this.$2)==null?void 0:h.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Codec Decode Failure","Failed to decode Frame(s). Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(b));return}c=l.HEAPU32.subarray(i/j,i/j+1)[0];if(this.$1==null){this.free(f);return}h=this.$1.length-c;if(this.$1&&this.$1.length>h){this.$1=new Uint8Array(((b=this.$1)==null?void 0:b.subarray(h))||[])}else this.$1=null;i=l.HEAPU32.subarray(g/j,g/j+1)[0];c=l.HEAPU32.subarray(e/j,e/j+1)[0];var k=[];for(b=0;b<i;++b){var m=l.__getDGWFramePtr(c,b);h=l.__getFrameType(m);switch(h){case d("DGWConstants").DgwFrameType.DgwFrameType_Drain:g=function(){var b=l.__getDrainReasonFromDrainFrame(m),c=d("DGWConstants").drainReasonToDrainReasonString(b);(b=a.$2)==null?void 0:b.logEvent(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Received Drain Frame from server","DrainReason: "+c);k.push(function(){var b;return(b=a.$3)==null?void 0:b.receivedDrainSignal(c)});return"break"}();if(g==="break")break;case d("DGWConstants").DgwFrameType.DgwFrameType_StreamGroup_EstabStream:e=function(){var b=l.__getStreamIdFromStreamGroupFrame(m),c=l.__getEncodedParamsFromEstablishStreamFrame(m),d=new Uint8Array(l.HEAPU8.subarray(c,c+l.__getEncodedParamsSizeFromEstablishStreamFrame(m)));a.free(c);k.push(function(){var c;return(c=a.$3)==null?void 0:c.onGroupedStreamEstablishStreamReceived(b,d)});return"break"}();if(e==="break")break;case d("DGWConstants").DgwFrameType.DgwFrameType_StreamGroup_Data:h=function(){var b=l.__getStreamIdFromStreamGroupFrame(m),c=l.__getDataFromGroupedStreamDataFrame(m),d=new Uint8Array(l.HEAPU8.subarray(c,c+l.__getDataSizeFromGroupedStreamDataFrame(m)));a.free(c);var e=l.__getRequiresAckFromGroupedStreamDataFrame(m)?l.__getAckIdFromGroupedStreamDataFrame(m):null;k.push(function(){var c;return(c=a.$3)==null?void 0:c.onGroupedStreamDataReceived(b,d,e)});return"break"}();if(h==="break")break;case d("DGWConstants").DgwFrameType.DgwFrameType_StreamGroup_Ack:g=function(){var b=l.__getStreamIdFromStreamGroupFrame(m),c=l.__getAckIdFromGroupedStreamAckFrame(m);k.push(function(){var d;return(d=a.$3)==null?void 0:d.onGroupedStreamAckReceived(b,c)});return"break"}();if(g==="break")break;case d("DGWConstants").DgwFrameType.DgwFrameType_StreamGroup_EndOfData:e=function(){var b=l.__getStreamIdFromStreamGroupFrame(m);k.push(function(){var c;return(c=a.$3)==null?void 0:c.onGroupedStreamEndOfDataReceived(b)});return"break"}();if(e==="break")break;case d("DGWConstants").DgwFrameType.DgwFrameType_Ping:k.push(function(){var b;return(b=a.$3)==null?void 0:b.onPingReceived()});break;case d("DGWConstants").DgwFrameType.DgwFrameType_Pong:k.push(function(){var b;return(b=a.$3)==null?void 0:b.onPongReceived()});break;default:break}this.free(m)}this.free(f);for(h=0;h<k.length;h++)k[h]()};e.encodeData=function(a,b,c,e){var f=this.malloc(a.length);if(f===-1)return null;var g=l.HEAPU8.subarray(f,f+a.length);for(var h=0;h<g.length;++h)g[h]=a[h];a=this.malloc(j*2);h=a;var i=a+j;e=l.__DgwCodecEncodeStreamGroup_Data(e,f,g.length,b,c,h,i);this.free(f);if(e!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){(g=this.$2)==null?void 0:g.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Data Frame encode failure","Failed to decode DGW Data Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(e));return null}b=l.HEAPU32.subarray(h/j,h/j+1)[0];c=l.HEAPU32.subarray(i/j,i/j+1)[0];f=new Uint8Array(l.HEAPU8.subarray(b,b+c));this.free(b);this.free(a);return f};e.encodeAck=function(a,b){var c=this.malloc(j*2);if(c===-1)return null;var e=c,f=c+j;b=l.__DgwCodecEncodeStreamGroup_Ack(b,a,e,f);if(b!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){(a=this.$2)==null?void 0:a.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"ACK Frame encode failure","Failed to encode ACK Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(b));return null}a=l.HEAPU32.subarray(e/j,e/j+1)[0];b=l.HEAPU32.subarray(f/j,f/j+1)[0];e=new Uint8Array(l.HEAPU8.subarray(a,a+b));this.free(a);this.free(c);return e};e.encodeDrain=function(a){var b=this.malloc(j*2);if(b===-1)return null;var c=b,e=b+j;a=l.__DgwCodecEncodeDrain(a,c,e);if(a!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){var f;(f=this.$2)==null?void 0:f.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Drain Frame encode failure","Failed to encode Drain Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(a));return null}f=l.HEAPU32.subarray(c/j,c/j+1)[0];a=l.HEAPU32.subarray(e/j,e/j+1)[0];c=new Uint8Array(l.HEAPU8.subarray(f,f+a));this.free(f);this.free(b);return c};e.encodeEstablishStream=function(a,b){var c=this.malloc(b.length);if(c===-1)return null;var e=l.HEAPU8.subarray(c,c+b.length);for(var f=0;f<b.length;++f)e[f]=b[f];e=this.malloc(j*2);f=e;var g=e+j;b=l.__DgwCodecEncodeStreamGroup_EstabStream(a,c,b.length,f,g);this.free(c);if(b!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){(c=this.$2)==null?void 0:c.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"EstablishStream Frame encode failure","Failed to encode EstablishStream Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(b)+" for StreamId "+a);return null}c=l.HEAPU32.subarray(f/j,f/j+1)[0];b=l.HEAPU32.subarray(g/j,g/j+1)[0];a=new Uint8Array(l.HEAPU8.subarray(c,c+b));this.free(c);this.free(e);return a};e.encodeEndOfData=function(a){var b=this.malloc(j*2);if(b===-1)return null;var c=b,e=b+j;a=l.__DgwCodecEncodeStreamGroup_EndOfData(a,c,e);if(a!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){var f;(f=this.$2)==null?void 0:f.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"EndOfData Frame encode failure","Failed to encode EndOfData Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(a));return null}f=l.HEAPU32.subarray(c/j,c/j+1)[0];a=l.HEAPU32.subarray(e/j,e/j+1)[0];c=new Uint8Array(l.HEAPU8.subarray(f,f+a));this.free(f);this.free(b);return c};e.encodePing=function(){if(this.$5!=null)return this.$5;var a=this.malloc(j*2);if(a===-1)return null;var b=a,c=a+j,e=l.__DgwCodecEncodePing(b,c);if(e!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){var f;(f=this.$2)==null?void 0:f.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Ping Frame encode failure","Failed to encode Ping Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(e));return null}f=l.HEAPU32.subarray(b/j,b/j+1)[0];e=l.HEAPU32.subarray(c/j,c/j+1)[0];b=new Uint8Array(l.HEAPU8.subarray(f,f+e));this.free(f);this.free(a);this.$5=b;return b};e.encodePong=function(){if(this.$6!=null)return this.$6;var a=this.malloc(j*2);if(a===-1)return null;var b=a,c=a+j,e=l.__DgwCodecEncodePong(b,c);if(e!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){var f;(f=this.$2)==null?void 0:f.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Pong Frame encode failure","Failed to encode Pong Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(e));return null}f=l.HEAPU32.subarray(b/j,b/j+1)[0];e=l.HEAPU32.subarray(c/j,c/j+1)[0];b=new Uint8Array(l.HEAPU8.subarray(f,f+e));this.free(f);this.free(a);this.$6=b;return b};return a}();g.uuidv4=a;g.Uint8ArrayToBase64UrlStr=k;g.DGWUtils=e;g.DGWCodec=f}),98);
__d("DGWExponentialBackoff",["Promise","regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g,h={maxRetries:5,baseRetryInterval:1e3,backoffFactor:Math.sqrt(2)},i=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){a=b.call(this,a)||this;a.errors=c;return a}return a}(babelHelpers.wrapNativeSuper(Error));function a(a,c){return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:c===void 0&&(c=h);d.prev=1;d.next=4;return b("regeneratorRuntime").awrap(j(a,c));case 4:return d.abrupt("return",d.sent);case 7:d.prev=7;d.t0=d["catch"](1);throw d.t0.errors[d.t0.errors.length-1];case 10:case"end":return d.stop()}},null,this,[[1,7]])}function j(a,c){var d,e,f,g,h;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:d=0,e=[],f=c.baseRetryInterval,g=c.backoffFactor;case 4:if(!(d<=c.maxRetries)){j.next=20;break}j.prev=5;j.next=8;return b("regeneratorRuntime").awrap(a());case 8:h=j.sent;return j.abrupt("return",h);case 12:j.prev=12,j.t0=j["catch"](5),e.push(j.t0);case 15:j.next=17;return b("regeneratorRuntime").awrap(k(f*Math.pow(g,d)));case 17:++d;j.next=4;break;case 20:throw new i("Max call count exceeded",e);case 21:case"end":return j.stop()}},null,this,[[5,12]])}function k(a){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=2;return b("regeneratorRuntime").awrap(new(g||(g=b("Promise")))(function(b){return window.setTimeout(b,a)}));case 2:case"end":return c.stop()}},null,this)}f.callWithExponentialBackoff=a}),66);
__d("DGWPinger",["DGWLoggingContext"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b,c){this.$1=a,this.$4=b,this.$5=c,this.$3=!1}var b=a.prototype;b.$6=function(){var a=this;if(this.$3){var b;(b=d("DGWLoggingContext")).DGWLoggingContext.bumpODSKey(b.DGWLoggingComponent.PINGER,"timeout_fired.reset");this.$3=!1;this.$4();b.DGWLoggingContext.bumpODSKey(b.DGWLoggingComponent.PINGER,"timeout.newtimeout");this.$2=window.setTimeout(function(){a.$6()},this.$1)}else d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.PINGER,"timeout_fired.disconnect"),this.$5()};b.reset=function(){var a=this;this.$3=!0;this.$2&&(d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.PINGER,"reset"),window.clearTimeout(this.$2),this.$2=null);this.$1>0&&(d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.PINGER,"reset.newtimeout"),this.$2=window.setTimeout(function(){a.$6()},this.$1))};b.cancel=function(){this.$2&&(d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.PINGER,"canceled"),window.clearTimeout(this.$2),this.$2=null)};return a}();g.DGWPinger=a}),98);
__d("DGWStreamGroupCallbacks",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";var g=b("$InternalEnum")({TRANSPORT_SERVER_INTERNAL_ERROR:0,TRANSPORT_ABNORMAL_CLOSURE:1,TRANSPORT_GOING_AWAY:2,TRANSPORT_UNKNOWN_ERROR:3,TRANSPORT_KEEPALIVE_TIMEOUT:4,TRANSPORT_UNAUTHORIZED:5,TRANSPORT_REJECTED:6,TRANSPORT_BAD_REQUEST:7,TRANSPORT_DGW_SERVER_ERROR:8});function a(a){switch(a){case g.TRANSPORT_UNAUTHORIZED:return!1;default:return!0}}c=function(){function a(){}var b=a.prototype;b.onStreamGroupError=function(){};b.onStreamGroupMustDrain=function(){};b.onStreamGroupTransportClose=function(){};return a}();f.DGWStreamGroupError=g;f.isRetryableError=a;f.NoOpDGWStreamGroupCallbacks=c}),66);
__d("DGWTransportEvents",["DGWLoggingContext","NetworkStatus"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.$3=a}var b=a.prototype;b.transportEstablished=function(a){this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"open","readyState:"+a),this.$2=Date.now(),this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"stream_group_establishment_success")};b.transportEstablishmentPending=function(){this.$1=Date.now(),this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"transportPending",null,!0),this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"stream_group_establishment_pending")};b.transportClosed=function(a,b){this.$4=Date.now(),a?(this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"transport_close_graceful"),this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Transport closed gracefully",null,!0)):(this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"transport_close_with_error"),this.$3.logError(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Transport closed abnormally",b))};b.transportEstablishmentFailure=function(a){this.$3.logError(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"WebSocket transport establishment failure","WebSocket close code: "+a+" onLine:"+String(c("NetworkStatus").isOnline())),this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"stream_group_establishment_failure")};b.streamEstablishmentTimeout=function(a,b,e){this.$3.logError(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Grouped Stream establishment timeout",a,"streamId:"+b+", onLine:"+String(c("NetworkStatus").isOnline()),!1,e),this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"stream_establishment_timeout")};b.streamEstablishmentPending=function(a,b){this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Grouped Stream establishment pending","streamId:"+a,!0,b),this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"stream_establishment_pending")};b.streamEstablishmentSuccess=function(a,b){this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Grouped Stream establishment success","streamId:"+a,!0,b),this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"stream_establishment_success")};b.transportError=function(a,b,c){this.$3.logError(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,a,b,c)};b.receivedFrameForInactiveStream=function(a,b,c){this.$3.logWarn(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Frame received for inactive stream","frameType: "+a+", streamID: "+b,c)};b.ranOutOfStreamIds=function(a){this.$3.logWarn(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Hit max StreamId limit","Hit max StreamId limit",a)};return a}();g.DGWTransportEvents=a}),98);
__d("DGWWebSocketTransport",[],(function(a,b,c,d,e,f){"use strict";function a(a){a=new WebSocket(a);a.binaryType="arraybuffer";a.onopen=function(){};a.onclose=function(){};a.onerror=function(){};return a}f.getWebSocketConnection=a}),66);
__d("DGWStreamEvents",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b,c){this.$4=new Map(),this.$5=new Map(),this.$6=a,this.$1=b,c!=null&&(this.$8="streamId:"+c+"::")}var b=a.prototype;b.dataSent=function(a,b,c){var d=c?"sendWithAckRequested":"sendWithoutAckRequested";this.$6.logEvent(this.$1,d,((d=this.$8)!=null?d:"")+"sendId:"+a+", payloadSize:"+b,!0);this.$4.set(a,{ackRequested:c,payloadSize:b,sendTimestamp:Date.now()})};b.ackReceived=function(a){var b;this.$6.logEvent(this.$1,"AckReceived",((b=this.$8)!=null?b:"")+"sendId:"+a,!0);this.$6.bumpODSKey(this.$1,"ack_received");b=this.$4.get(a);b!=null&&(b.ackReceivedTimestamp=Date.now())};b.ackSent=function(a){var b;this.$6.bumpODSKey(this.$1,"ack_sent");this.$6.logEvent(this.$1,"ACK sent",((b=this.$8)!=null?b:"")+"ackId:"+a,!0)};b.drainSent=function(a){var b;this.$6.logEvent(this.$1,"Drain sent",((b=this.$8)!=null?b:"")+"drainReason: "+a)};b.dataReceived=function(a,b,c){var d;this.$6.bumpODSKey(this.$1,"data_received");this.$6.logEvent(this.$1,"Data received",((d=this.$8)!=null?d:"")+"sendId:"+((d=c)!=null?d:"null")+", ackRequested:"+b.toString()+", payloadSize:"+a,!0);c!=null&&this.$5.set(c,{ackRequested:b,payloadSize:a,receiveTimestamp:Date.now()})};b.endOfDataReceived=function(){this.$6.bumpODSKey(this.$1,"end_of_data_received"),this.$6.logEvent(this.$1,"EndOfDataReceived",this.$8,!0)};b.endOfDataSent=function(){this.$6.bumpODSKey(this.$1,"end_of_data_sent"),this.$6.logEvent(this.$1,"EndOfDataSent",this.$8,!0)};b.streamClosed=function(a,b){this.$7=Date.now();var c=this.$9();if(a){this.$6.bumpODSKey(this.$1,"stream_closed_gracefully");this.$6.logEvent(this.$1,"Stream closed gracefully",""+((a=this.$8)!=null?a:"")+c)}else{this.$6.bumpODSKey(this.$1,"stream_closed_with_error");this.$6.logError(this.$1,"Stream closed abnormally",b,""+((a=this.$8)!=null?a:"")+c)}};b.connectionEstablishmentFailure=function(a){this.$6.logEvent(this.$1,"WebSocket connection establishment failure","WebSocket close code: "+a)};b.streamEstablishmentFailure=function(a,b){this.$6.logError(this.$1,"Failed to establish DGW Stream","Last seen error: "+a.toString(),""+((a=this.$8)!=null?a:"")+b);this.$6.bumpODSKey(this.$1,"stream_establishment_failure")};b.error=function(a,b){b={msg:b,state:this.$9()};this.$6.logError(this.$1,a,JSON.stringify(b),this.$8)};b.$9=function(){var a={currentNetworkCondition:window.navigator&&window.navigator.onLine===!0,establishRequestTimestamp:this.$2,establishedTimestamp:this.$3,streamClosedTimestamp:this.$7,sendHistory:JSON.stringify(Array.from(this.$4.entries())),receiveHistory:JSON.stringify(Array.from(this.$5.entries()))};return JSON.stringify(a)};return a}();f.DGWStreamEvents=a}),66);
__d("GroupedStream",["DGWAckManager","DGWConstants","DGWLoggingContext","DGWStream","DGWStreamEvents","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b,c,e,f,g,h){this.$1=a,this.$3=!1,this.$4=!1,this.$5=!1,this.$6=b,this.$7=c,this.$8=e,this.$2=g,this.$9=f,this.$10=new(d("DGWAckManager").DGWAckManager)(this.$9),this.$12=new(d("DGWStreamEvents").DGWStreamEvents)(this.$9,d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,this.$1),this.$11=0,this.$13=h}var c=a.prototype;c.send=function(a,c){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:f=this.$11++%d("DGWConstants").MAX_ACK_ID;if(this.$14(a,!0,f)){h.next=3;break}return h.abrupt("return",!1);case 3:h.next=5;return b("regeneratorRuntime").awrap(this.$10.waitForAck(f,(e=c)!=null?e:d("DGWConstants").DEFAULT_ACK_TIMEOUT_MS));case 5:g=h.sent;return h.abrupt("return",g);case 7:case"end":return h.stop()}},null,this)};c.sendAndForget=function(a){return this.$14(a,!1)};c.close=function(){var a=this.$2.encodeEndOfData(this.$1);if(a==null){this.$9.logError(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to encode EndOfData","streamId: "+this.$1);return}a=this.$8.send(a);if(!a){this.$9.logError(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to send EndOfData","streamId: "+this.$1+". StreamGroupTransport not open during send");return}this.$12.endOfDataSent();this.$5=!0;this.$4&&this.$15()};c.loggingContext=function(){return this.$9};c.__sendDrain=function(a){var b=d("DGWConstants").drainReasonToDrainReasonString(a);if(this.$5)return!1;a=this.$2.encodeDrain(a);if(a==null)return!1;this.$12.drainSent(b);b=this.$8.send(a);return b};c.__transportCloseHook=function(a){this.$13(),this.$10.clearPendingAcks(),a?(this.$12.error("Received StreamError","StreamErrorType: "+a),this.$6.onError(a)):this.$5&&this.$4?this.$15():(this.$12.streamClosed(!1,"Stream closed: ClosedLocally: "+this.$5.toString()+", EndOfDataReceived: "+this.$4.toString()),this.$6.onError(d("DGWStream").StreamError.PREMATURE_CLOSE))};c.$15=function(){this.$13(),this.$12.streamClosed(!0,"Graceful close"),this.$6.onClose(this)};c.__dataReceivedHook=function(a,b){this.$12.dataReceived(a.length,b!=null,b),b!=null&&this.$16(b),this.$6.onDataReceived(a)};c.__ackReceivedHook=function(a){this.$12.ackReceived(a),this.$10.handleAckReceived(a)};c.__drainReceivedHook=function(a){this.$3===!1&&(this.$6.onStreamMustDrain(this,a),this.$3=!0)};c.__endOfDataHook=function(){this.$12.endOfDataReceived(),this.$4=!0,this.$5?this.$15():this.$6.onServerHasFinishedSendingData(this)};c.$14=function(a,b,c){b===void 0&&(b=!1);c===void 0&&(c=0);if(this.$5){this.$9.logError(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to send data","Stream closed locally");return!1}a=this.$2.encodeData(a,b,c,this.$1);if(a==null)return!1;var e=this.$8.send(a);if(!e){this.$9.logError(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to send data","ClosedLocally: "+this.$5.toString());return!1}this.$12.dataSent(c,a.length,b);return!0};c.$16=function(a){var b=this.$2.encodeAck(a,this.$1);if(b==null){this.$9.logError(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to encode ACK","ackId: "+a);return!1}b=this.$8.send(b);if(!b){this.$9.logError(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to send ACK","ackId: "+a);return!1}this.$12.ackSent(a);return!0};return a}();g.GroupedStream=a}),98);
__d("StreamIdGenerator",["err"],(function(a,b,c,d,e,f,g){"use strict";var h=65535;a=function(){function a(){this.$1=new Set(),this.$2=0,this.$1.add(this.$2)}var b=a.prototype;b.getNextStreamId=function(){var a;if(!this.streamIdAvailable())throw c("err")("Max number of stream IDs reached");if(this.$1.size===0)return++this.$2;a=(a=this.$1.values().next().value)!=null?a:0;this.$1["delete"](a);return a};b.putBackStreamId=function(a){this.$1.add(a)};b.streamIdAvailable=function(){return this.$1.size>0||this.$2<h};return a}();g.MAX_STREAM_ID=h;g.StreamIdGeneratorImpl=a}),98);
__d("StreamGroupWebSocketTransport",["DGWConstants","DGWExponentialBackoff","DGWLoggingContext","DGWPinger","DGWStream","DGWStreamGroupCallbacks","DGWTransportEvents","DGWUtils","DGWWebSocketTransport","GroupedStream","Promise","StreamIdGenerator","err","gkx","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("gkx")("4657"),j=function(a,b,c,e,f){var g=this;this.groupedStream=a;this.$1=window.setTimeout(function(){c(d("DGWStream").StreamError.ESTABLISHMENT_TIMEOUT)},e);this.handleEstablishFrameReceived=function(){window.clearTimeout(g.$1),b(g.groupedStream)};this.abortStream=function(a){f(),c(a)}};a=function(){function a(b,e,f,g,h,j,k,l){var m=this;this.$14=h;this.$16=this.__getStreamIdGenerator();this.$5=new Map();this.$6=new Map();this.$7=g.keepAliveMs;this.$8=!1;this.$3=!0;this.$4=!1;this.$12=f;this.$10=new TextEncoder();this.$11=new TextDecoder();this.$13=g;h={onDataReceived:function(){},handleAckReceived:function(){},receivedDrainSignal:function(a){m.$13.streamGroupCallbacks.onStreamGroupMustDrain(a),m.$5.forEach(function(b){b.__drainReceivedHook(a)})},onGroupedStreamDataReceived:function(a,b,c){if(m.$5.has(a)){var d=m.$5.get(a);d==null?void 0:d.__dataReceivedHook(b,c)}else{m.$12.receivedFrameForInactiveStream("Data",a,"sendAckID: "+((d=c)!=null?d:"null"))}},onGroupedStreamAckReceived:function(a,b){if(m.$5.has(a)){var c=m.$5.get(a);c==null?void 0:c.__ackReceivedHook(b)}else{m.$12.receivedFrameForInactiveStream("ACK",a,"ackId: "+((c=b)!=null?c:"null"))}},onGroupedStreamEndOfDataReceived:function(a){if(m.$5.has(a)){var b=m.$5.get(a);b==null?void 0:b.__endOfDataHook()}else m.$12.receivedFrameForInactiveStream("EndOfData",a)},onGroupedStreamEstablishStreamReceived:function(a,b){if(m.$6.has(a)){var c=m.$6.get(a);m.$6["delete"](a);b=JSON.parse(m.$11.decode(b));(b.code===void 0||b.code!==200)&&(c==null?void 0:c.abortStream(d("DGWStream").StreamError.ABNORMAL_CLOSURE));c==null?void 0:c.handleEstablishFrameReceived()}else m.$12.receivedFrameForInactiveStream("EstablishStream",a,"EstablishStream received for non-inflight stream")},onPingReceived:function(){var a=m.$2.encodePing();if(a==null)return;m.send(a)},onPongReceived:function(){i&&(m.$3=!1)}};this.$2=new(d("DGWUtils").DGWCodec)(j,h,g.dgwVersion);if(g.enableFirstStreamOnWsHandshake){if(k===void 0)throw c("err")("Missing grouped stream options");if(l===void 0)throw c("err")("Missing grouped stream callbacks");var n=this.$16.getNextStreamId();f=this.createEstablishStreamFrame(n,k);h=d("DGWUtils").DGWUtils.constructConnectUrl({appId:g.appId,appVersion:g.appVersion,authType:g.authType,deviceId:(j=g.deviceId)!=null?j:void 0,dgwVersion:g.dgwVersion,fbId:g.fbId,tier:g.tier,loggingId:(h=g.loggingId)!=null?h:void 0,headers:a.__prefixAppHeaders(g.headers),endpoint:g.connectEndpoint,serviceId:g.serviceId,regionHint:(j=g.regionHint)!=null?j:void 0,establishStreamFrame:f});this.$1=e(h);if(!h.includes(d("DGWConstants").HEADER_CONSTANTS.HEADER_ESTABLISH_STREAM_FRAME_BASE64))return;this.$15=this.waitForEstablishStream(n,l,k,new(d("DGWLoggingContext").DGWLoggingContext)(this.$13.dgwVersion,k.loggingId,this.$13.serviceId,this.$13.fbId,this.$13.loggingId,k.disableFalcoLogging),function(a){m.$5.set(n,a)},function(){m.$16.putBackStreamId(n)})}else this.$1=e(b)}var e=a.prototype;e.send=function(a){try{this.$1.send(a);return!0}catch(a){this.$12.transportError("Failed to send over transport","readyState: "+this.$1.readyState,a.toString());return!1}};e.close=function(){this.$1.close(d("DGWConstants").WebsocketCloseCodes.GRACEFUL_CLOSE)};e.abort=function(a,b,c,d){this.$8=!0,this.$12.transportClosed(!1,d),this.$5.forEach(function(a){a.__transportCloseHook(b)}),this.$6.forEach(function(a){a.abortStream(b)}),this.$13.streamGroupCallbacks.onStreamGroupError(a),this.$5.clear(),this.$6.clear(),this.$1.close(c)};e.cleanup=function(){var a;(a=this.$9)==null?void 0:a.cancel();this.$1!=null&&(this.$1.onopen=function(a){},this.$1.onmessage=function(a){},this.$1.onerror=function(a){},this.$1.onclose=function(a){},this.$1.close())};a.getTransportWithInitialStream=function(c,e,f,g,h,i){var j,k,l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:n.next=2;return b("regeneratorRuntime").awrap(d("DGWUtils").DGWCodec.initialize());case 2:j=new(d("DGWTransportEvents").DGWTransportEvents)(g);j.transportEstablishmentPending();k=function(){return a.$17("",f,j,h,g,c,e)};n.prev=5;n.next=8;return b("regeneratorRuntime").awrap(d("DGWExponentialBackoff").callWithExponentialBackoff(k,i));case 8:l=n.sent;m=l.$15!=null?l.$15:l.establishGroupedStream(e,c,new(d("DGWLoggingContext").DGWLoggingContext)(f.dgwVersion,c.loggingId,f.serviceId,f.fbId,f.loggingId,c.disableFalcoLogging));return n.abrupt("return",{transport:l,streamPromise:m});case 13:n.prev=13;n.t0=n["catch"](5);throw n.t0;case 16:case"end":return n.stop()}},null,this,[[5,13]])};a.getTransport_DEPRECATED=function(c,e,f,g,h){var i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:k.next=2;return b("regeneratorRuntime").awrap(d("DGWUtils").DGWCodec.initialize());case 2:i=new(d("DGWTransportEvents").DGWTransportEvents)(f);i.transportEstablishmentPending();j=function(){return a.$17(c,e,i,g,f)};k.prev=5;k.next=8;return b("regeneratorRuntime").awrap(d("DGWExponentialBackoff").callWithExponentialBackoff(j,h));case 8:return k.abrupt("return",k.sent);case 11:k.prev=11;k.t0=k["catch"](5);throw k.t0;case 14:case"end":return k.stop()}},null,this,[[5,11]])};e.establishGroupedStream=function(a,d,e){var f=this,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:g=this.getStreamId();h=this.createEstablishStreamFrame(g,d);i=this.waitForEstablishStream(g,a,d,e,function(a){f.$5.set(g,a)},function(){f.$16.putBackStreamId(g)});if(this.send(h)){k.next=5;break}throw c("err")("Websocket connection closed before stream established");case 5:k.next=7;return b("regeneratorRuntime").awrap(i);case 7:j=k.sent;return k.abrupt("return",j);case 9:case"end":return k.stop()}},null,this)};a.__prefixAppHeaders=function(a){return Object.keys(a).reduce(function(b,c){b[""+d("DGWConstants").HEADER_CONSTANTS.APPHEADER_PREFIX+c]=a[c];return b},{})};e.waitForEstablishStream=function(a,c,d,e,f,g){var i=this,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:this.$12.streamEstablishmentPending(a,d.loggingId);k=this.__createGroupedStream(a,c,d,e);m.prev=2;m.next=5;return b("regeneratorRuntime").awrap(new(h||(h=b("Promise")))(function(b,c){i.$6.set(a,new j(k,b,c,3e4,function(){i.streamEndCallback(a)}))}));case 5:l=m.sent;f(k);this.$12.streamEstablishmentSuccess(a,d.loggingId);return m.abrupt("return",l);case 11:m.prev=11;m.t0=m["catch"](2);g();this.$12.streamEstablishmentTimeout("Stream establishment timeout. readyState: "+this.$1.readyState,a,d.loggingId);throw m.t0;case 16:case"end":return m.stop()}},null,this,[[2,11]])};a.$17=function(c,e,f,g,h,j,k){var l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:l=new a(c,d("DGWWebSocketTransport").getWebSocketConnection,f,e,g,h,j,k);l.$1.onmessage=a.$18(l);l.$1.onopen=function(){f.transportEstablished(l.$1.readyState),i||(l.$3=!1),l.$7!=null&&(l.$9=new(d("DGWPinger").DGWPinger)(l.$7,function(){l.$19()},function(){l.abort(d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_KEEPALIVE_TIMEOUT,d("DGWStream").StreamError.KEEPALIVE_TIMEOUT,d("DGWConstants").WebsocketCloseCodes.KEEPALIVE_TIMEOUT,"Aborting transport because of keepalive timeout")}))};l.$1.onerror=function(){l.$12.transportError("onerror","readyState: "+l.$1.readyState)};l.$1.onclose=a.$20(l);n.next=7;return b("regeneratorRuntime").awrap(a.getTransportPromise(l));case 7:m=n.sent;return n.abrupt("return",m);case 9:case"end":return n.stop()}},null,this)};a.getTransportPromise=function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(new(h||(h=b("Promise")))(function(b,c){var e=a.$1.onerror;if(i){var f=a.$1.onmessage,g=a.$1.onclose;a.$1.onerror=function(){window.clearTimeout(k),e(),c(d("DGWStream").StreamError.ESTABLISHMENT_ERROR)};a.$1.onclose=function(a){window.clearTimeout(k),g(a),a.code===d("DGWConstants").WebsocketCloseCodes.UNAUTHORIZED?c(d("DGWStream").StreamError.UNAUTHORIZED):c(d("DGWStream").StreamError.ESTABLISHMENT_ERROR)};var h=!1;a.$1.onmessage=function(c){f(c),!h&&!a.$3&&(window.clearTimeout(k),b(a),h=!0)}}else{var j=a.$1.onopen;a.$1.onerror=function(){window.clearTimeout(k),e(),c(d("DGWStream").StreamError.ESTABLISHMENT_ERROR)};a.$1.onopen=function(){window.clearTimeout(k),j(),b(a)}}var k=window.setTimeout(function(){a.cleanup(),c(d("DGWStream").StreamError.ESTABLISHMENT_TIMEOUT)},2e4)}));case 2:c=e.sent;return e.abrupt("return",c);case 4:case"end":return e.stop()}},null,this)};a.$18=function(a){return function(b){var c;(c=a.$9)==null?void 0:c.reset();if(!(b.data instanceof ArrayBuffer)){a.$12.transportError("Incorrect Data Protocol","Received "+typeof b.data+" instead of ArrayBuffer");return}a.$2.append(new Uint8Array(b.data));a.$2.processData()}};a.$20=function(a){return function(b){var c;(c=a.$9)==null?void 0:c.cancel();if(a.$8===!0||a.$4)return;if(a.$3===!0){a.$12.transportEstablishmentFailure(b.code);a.$5.clear();a.$14();return}a.$14();a.$3=!0;if(b.code!==d("DGWConstants").WebsocketCloseCodes.GRACEFUL_CLOSE){a.$12.transportClosed(!1,"Websocket connection failure with code "+b.code);c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_UNKNOWN_ERROR;var e=d("DGWStream").StreamError.UNKNOWN_ERROR;switch(b.code){case d("DGWConstants").WebsocketCloseCodes.NORMAL_CLOSURE:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_ABNORMAL_CLOSURE;e=d("DGWStream").StreamError.ABNORMAL_CLOSURE;break;case d("DGWConstants").WebsocketCloseCodes.ABNORMAL_CLOSURE:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_ABNORMAL_CLOSURE;e=d("DGWStream").StreamError.ABNORMAL_CLOSURE;break;case d("DGWConstants").WebsocketCloseCodes.SERVER_INTERNAL_ERROR:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_SERVER_INTERNAL_ERROR;e=d("DGWStream").StreamError.SERVER_INTERNAL_ERROR;break;case d("DGWConstants").WebsocketCloseCodes.GOING_AWAY:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_GOING_AWAY;e=d("DGWStream").StreamError.GOING_AWAY;break;case d("DGWConstants").WebsocketCloseCodes.UNAUTHORIZED:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_UNAUTHORIZED;e=d("DGWStream").StreamError.UNAUTHORIZED;break;case d("DGWConstants").WebsocketCloseCodes.REJECTED:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_REJECTED;e=d("DGWStream").StreamError.REJECTED;break;case d("DGWConstants").WebsocketCloseCodes.BAD_REQUEST:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_BAD_REQUEST;e=d("DGWStream").StreamError.BAD_REQUEST;break;case d("DGWConstants").WebsocketCloseCodes.DGW_SERVER_ERROR:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_SERVER_INTERNAL_ERROR;e=d("DGWStream").StreamError.DGW_SERVER_ERROR;c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_DGW_SERVER_ERROR;break;default:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_UNKNOWN_ERROR;e=d("DGWStream").StreamError.UNKNOWN_ERROR;break}a.$13.streamGroupCallbacks.onStreamGroupError(c);a.$5.forEach(function(a){a.__transportCloseHook(e)});a.$6.forEach(function(a){a.abortStream(e)})}else a.$12.transportClosed(!0,""),a.$13.streamGroupCallbacks.onStreamGroupTransportClose(),a.$5.forEach(function(a){a.__transportCloseHook()}),a.$6.forEach(function(a){a.abortStream(d("DGWStream").StreamError.TRANSPORT_CLOSED_BEFORE_STREAM_INIT)});a.$5.clear();a.$6.clear()}};e.$19=function(){var a=this.$2.encodePing();if(a==null)throw c("err")("Failed to encode Ping Frame");this.send(a)};e.isClosedLocally=function(){return this.$3||this.$8||this.$4};e.streamEndCallback=function(a){this.$5["delete"](a),this.$6["delete"](a),this.$16.putBackStreamId(a)};e.canCreateGroupedStream=function(){return this.$16.streamIdAvailable()};e.createEstablishStreamFrame=function(b,d){d=this.$2.encodeEstablishStream(b,new Uint8Array(this.$10.encode(JSON.stringify(a.__prefixAppHeaders(d.groupedStreamHeaders)))));if(d==null){this.$16.putBackStreamId(b);throw c("err")("Failed to encode EstablishStreamFrame")}return d};e.getStreamId=function(){try{return this.$16.getNextStreamId()}catch(a){this.$12.ranOutOfStreamIds("inFlightGroupedStreamSize: "+this.$6.size+" groupedStreamSize: "+this.$5.size);throw a}};e.__createGroupedStream=function(a,b,c,e){var f=this;return new(d("GroupedStream").GroupedStream)(a,b,c,this,e,this.$2,function(){f.streamEndCallback(a)})};e.__getStreamIdGenerator=function(){return new(d("StreamIdGenerator").StreamIdGeneratorImpl)()};return a}();g.StreamGroupWebSocketTransport=a}),98);
__d("StreamGroup",["DGWConstants","DGWLoggingContext","DGWUtils","StreamGroupWebSocketTransport","justknobx","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h={maxRetries:c("justknobx")._("2595"),baseRetryInterval:1e3,backoffFactor:Math.sqrt(2)};a=function(){function a(a,b,c,e,f,g,h,i,j){this.$2=j;this.$1=j.getNewStreamGroupId();j=(j=h.overrideUrl)!=null?j:f;this.$5=null;this.$3={appId:a,appVersion:b,authType:c,deviceId:h.deviceId,dgwVersion:e,headers:h.streamGroupAppHeaders,tier:(f=h.serviceTier)!=null?f:d("DGWConstants").DEFAULT_SERVICE_TIER,connectEndpoint:j,fbId:g,loggingId:h.loggingId,serviceId:h.serviceId,streamGroupCallbacks:i,keepAliveMs:h.keepAliveMs,regionHint:h.regionHint,enableFirstStreamOnWsHandshake:!1};this.$4=h;this.streamGroupLoggingContext=new(d("DGWLoggingContext").DGWLoggingContext)(this.$3.dgwVersion,null,this.$3.serviceId,this.$3.fbId,this.$4.loggingId,!1,(a=h.verboseLoggingEnabled)!=null?a:!1);this.$6=d("DGWUtils").DGWUtils.constructConnectUrl({appId:this.$3.appId,appVersion:this.$3.appVersion,authType:this.$3.authType,deviceId:(b=this.$3.deviceId)!=null?b:void 0,dgwVersion:this.$3.dgwVersion,fbId:this.$3.fbId,headers:babelHelpers["extends"]({},this.$3.headers),loggingId:(c=this.$3.loggingId)!=null?c:void 0,tier:this.$3.tier,serviceId:this.$3.serviceId,endpoint:this.$3.connectEndpoint,regionHint:(e=this.$3.regionHint)!=null?e:void 0})}var c=a.prototype;c.initTransport=function(){var c=this,a,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:a={maxRetries:0,baseRetryInterval:1e3,backoffFactor:Math.sqrt(2)};this.$5=this.$5||d("StreamGroupWebSocketTransport").StreamGroupWebSocketTransport.getTransport_DEPRECATED(this.$6,this.$3,this.streamGroupLoggingContext,function(){c.$2.removeStreamGroupAndTransport(c.$1)},a);f.prev=2;f.next=5;return b("regeneratorRuntime").awrap(this.$5);case 5:e=f.sent;this.$5=null;f.next=13;break;case 9:f.prev=9;f.t0=f["catch"](2);this.$5=null;throw f.t0;case 13:this.$2.containsStreamGroup(this.$1)||this.$2.setStreamGroupAndTransport(this.$1,e);return f.abrupt("return",e);case 15:case"end":return f.stop()}},null,this,[[2,9]])};c.establishStream=function(a,c){var e=this,f,g;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:if(!(this.$2.containsStreamGroup(this.$1)===!1)){i.next=23;break}this.streamGroupLoggingContext.logEvent(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"createTransportWhenEstablishStream");if(this.$3.enableFirstStreamOnWsHandshake){i.next=18;break}this.$5=this.$5||d("StreamGroupWebSocketTransport").StreamGroupWebSocketTransport.getTransport_DEPRECATED(this.$6,this.$3,this.streamGroupLoggingContext,function(){e.$2.removeStreamGroupAndTransport(e.$1)},h);i.prev=4;i.next=7;return b("regeneratorRuntime").awrap(this.$5);case 7:f=i.sent;this.$5=null;i.next=15;break;case 11:i.prev=11;i.t0=i["catch"](4);this.$5=null;throw i.t0;case 15:this.$2.containsStreamGroup(this.$1)||this.$2.setStreamGroupAndTransport(this.$1,f);i.next=23;break;case 18:i.next=20;return b("regeneratorRuntime").awrap(d("StreamGroupWebSocketTransport").StreamGroupWebSocketTransport.getTransportWithInitialStream(a,c,this.$3,this.streamGroupLoggingContext,function(){e.$2.removeStreamGroupAndTransport(e.$1)},h));case 20:g=i.sent;this.$2.setStreamGroupAndTransport(this.$1,g.transport);return i.abrupt("return",g.streamPromise);case 23:return i.abrupt("return",this.establishStreamWithTransport(a,c));case 24:case"end":return i.stop()}},null,this,[[4,11]])};c.establishStreamWithTransport=function(a,c){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:f=a.loggingId;this.streamGroupLoggingContext.logEvent(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"Establishing Grouped Stream",null,!0,f);h.next=4;return b("regeneratorRuntime").awrap(this.$2.getStreamGroupTransport(this.$1).establishGroupedStream(c,a,new(d("DGWLoggingContext").DGWLoggingContext)(this.$3.dgwVersion,f,this.$3.serviceId,this.$3.fbId,this.$3.loggingId,a.disableFalcoLogging,(e=a.verboseLoggingEnabled)!=null?e:!1)));case 4:g=h.sent;return h.abrupt("return",g);case 6:case"end":return h.stop()}},null,this)};c.canCreateGroupedStream=function(){var a=!0;if(this.$2.containsStreamGroup(this.$1)!==!1){var b=this.$2.getStreamGroupTransport(this.$1);a=b.canCreateGroupedStream()}d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,a?"can_create":"cannot_create");return a};c.close=function(){var a=this.$2.getStreamGroupTransport(this.$1);a.close()};return a}();g.StreamGroup=a}),98);
__d("StreamGroupRegistry",["Random","err"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$1=new Map(),this.$2=new Set()}var b=a.prototype;b.setStreamGroupAndTransport=function(a,b){this.$1.set(a,b)};b.containsStreamGroup=function(a){return this.$1.has(a)};b.removeStreamGroupAndTransport=function(a){this.$1["delete"](a)};b.getStreamGroupTransport=function(a){a=this.$1.get(a);if(a==null)throw c("err")("No stream group transport");return a};b.getNewStreamGroupId=function(){var a=d("Random").uint32();while(this.$2.has(a))a=d("Random").uint32();this.$2.add(a);return a};return a}();g.StreamGroupRegistry=a}),98);
__d("RawDGWClient",["CurrentUser","DGWLoggingContext","DGWStream","StreamGroup","StreamGroupRegistry","isFastRefreshEnabledForCurrentDomain","justknobx"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){var b=a.appId,c=a.appVersion,e=a.authType,f=a.dgwVersion,g=a.endpoint;a=a.fbId;this.$1=b;this.$2=c;this.$3=e;this.$4=f;this.$5=g;this.$6=a;this.$7=new(d("StreamGroupRegistry").StreamGroupRegistry)()}var b=a.prototype;b.createStreamGroup=function(a,b){c("justknobx")._("1023")&&this.handleUserChecks();return new(d("StreamGroup").StreamGroup)(this.$1,this.$2,this.$3,this.$4,this.$5,this.$6,b,a,this.$7)};b.handleUserChecks=function(){if(!c("CurrentUser").isLoggedInNow()&&!c("isFastRefreshEnabledForCurrentDomain")()){d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.RAW_CLIENT,"unauthenticated");throw d("DGWStream").StreamError.UNAUTHENTICATED}};return a}();g.RawDGWClient=a}),98);
__d("DGWClient",["DGWAuth","DGWEnvUtil","DGWWebConfig","RawDGWClient","err"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("RawDGWClient").RawDGWClient)({appId:c("DGWWebConfig").appId,appVersion:c("DGWWebConfig").appVersion,authType:d("DGWAuth").fromStringToDGWAuth(c("DGWEnvUtil").getDGWAuthType()),dgwVersion:c("DGWEnvUtil").getDGWVersion(),endpoint:c("DGWEnvUtil").getDGWEndpoint(),fbId:c("DGWWebConfig").fbId});function a(){if(c("DGWEnvUtil").isDGWEnvCompatible())return h;else throw c("err")("unsupported_environment_retry_with_mqtt")}g["default"]=a}),98);
__d("DGWRequestStreamUtils",["Base64","WebDriverConfig","cr:3024","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,d,e,f){var g={};a=Object.entries(a);for(var h=0;h<a.length;h++){var i=a[h],j=i[0];i=i[1];typeof i=="string"?g["XRSS-"+j]=i:typeof i=="number"?g["XRSN-"+j]=i.toString():typeof i=="boolean"?g["XRSB-"+j]=i.toString():typeof i=="object"&&i!=null&&(g["XRSO-"+j]=c("Base64").encode(JSON.stringify(i)))}d&&(g["xrs-body"]="true");e!=null&&e.length>0&&(g["xrs-instrumentation"]=c("Base64").encode(e));g["XRS-Accept-Ack"]="RSAck";f!=null&&f.ackTimeoutSec!=null&&(g["XRS-SRAck-Timeout"]=f.ackTimeoutSec.toString());g["XRSS-http_referer"]=window.location.href;if(c("WebDriverConfig").isTestRunning&&c("gkx")("20919")){j=b("cr:3024")==null?void 0:b("cr:3024").get();j!=null&&(g["XRSB-is_test"]="true",g["XRSS-original_request_id"]=j)}return g}function h(a){return Object.keys(a).reduce(function(b,c){(typeof a[c]==="string"||typeof a[c]==="boolean"||typeof a[c]==="number"||typeof a[c]==="object")&&(b[c]=a[c]);return b},{})}function d(a){if(a.response&&a.response.instrumentation_data!=null&&a.response.instrumentation_data.length>0)try{a=JSON.parse(new TextDecoder("utf-8").decode(a.response.instrumentation_data));return{auxId:a.auxId,dfTraceId:(a=a.dataFlowTracingData)==null?void 0:a.traceId}}catch(a){}return null}function e(a,b){var c=a.headers;a=a.body;b.kill_body===!0&&(a=null);b.new_body!=null&&(a=b.new_body);if(b.new_headers!=null)try{c=h(JSON.parse(b.new_headers))}catch(a){}if(b.patch_headers!=null)try{c=babelHelpers["extends"]({},c,h(JSON.parse(b.patch_headers)))}catch(a){}return{headers:c,body:a}}g.convertHeaders=a;g.cleanHeaders=h;g.getInstrumentationDataFieldsFromPayload=d;g.transformContextWithRewriteDelta=e}),98);
__d("DGWStreamHandler",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b,c,d,e){this.$2=a,this.$3=b,this.$4=c,this.$5=d,this.$6=e,this.$1=!0}var b=a.prototype;b.onClose=function(a){if(!this.$1)return;this.$2(a)};b.onDataReceived=function(a){if(!this.$1)return;this.$3(a)};b.onError=function(a){if(!this.$1)return;this.$4(a)};b.onStreamMustDrain=function(a,b){if(!this.$1)return;this.$5(a,b)};b.onServerHasFinishedSendingData=function(a){if(!this.$1)return;this.$6(a)};b.stop=function(){this.$1=!1};b.isStopped=function(){return!this.$1};return a}();f["default"]=a}),66);
__d("InflightAmends",["Deferred","err"],(function(a,b,c,d,e,f,g){"use strict";var h="inflight_amends_timeout",i="inflight_amends_duplicate_id";a=function(){function a(a,b,c){this.$1=a,this.$3=b,this.$4=c,this.$2=new Map()}var b=a.prototype;b.add=function(a){var b=this;if(this.$2.has(a))throw c("err")(i);var d=new(c("Deferred"))(),e=Date.now(),f=setTimeout(function(){b.$2.has(a)&&b.reject(a,c("err")(h))},this.$1);this.$2.set(a,{id:a,deferred:d,createdTimestampMs:e,timeoutId:f});return d.getPromise()};b.getPromise=function(a){return(a=this.$5(a))==null?void 0:a.deferred.getPromise()};b.resolve=function(a,b){a=this.$5(a);a&&(a.deferred.resolve==null?void 0:a.deferred.resolve(b),this.$3(a.id,Date.now()-a.createdTimestampMs),this.$6(a))};b.reject=function(a,b){a=this.$5(a);a&&(a.deferred.reject==null?void 0:a.deferred.reject(b),this.$4(a.id,b),this.$6(a))};b.rejectAll=function(a){for(var b=this.$2.entries(),c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{d=b.next();if(d.done)break;e=d.value}e=e;var f=e[0];e[1];this.reject(f,a)}};b.getSize=function(){return this.$2.size};b.getAllPromises=function(){var a=[];for(var b=this.$2.values(),c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{d=b.next();if(d.done)break;e=d.value}e=e;a.push(e.deferred.getPromise())}return a};b.$6=function(a){clearTimeout(a.timeoutId),this.$2["delete"](a.id)};b.$5=function(a){return this.$2.get(a)};return a}();g["default"]=a}),98);
__d("RequestStreamCloseReason",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["UserIntention","StartStreamFailure","StreamError","RemoteTermination","ServerDataEnd","ServerDrain","ReestablishError","ClientError"]);f.RequestStreamCloseReason=a}),66);
__d("RequestStreamCommonRequestStreamCommonSerializers",["RequestStreamCommonRequestStreamCommonTypes","ThriftTypes","jsbi"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return{}}function b(){return{expected_existing_headers:"",patch_headers_if_match:""}}function e(){return{bytes:Uint8Array.of()}}function f(){return{message:""}}function i(){return{reason:d("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.cast(0)}}function j(){return{}}function k(){return{stream_id:"0",last_sequencer:0,amendment_count:0,last_status:d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(0)}}function l(){return{caller_timestamp_ms:"0"}}function m(){return{original_ping_timestamp_ms:"0"}}function n(){return{}}function o(a,b){b.writeStructBegin("ResponseRewriteRequest"),a.new_headers!=null&&(b.writeFieldBegin({fname:"new_headers",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:1}),b.writeString(a.new_headers),b.writeFieldEnd()),a.new_body!=null&&(b.writeFieldBegin({fname:"new_body",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:2}),b.writeBinary(a.new_body),b.writeFieldEnd()),a.patch_headers!=null&&(b.writeFieldBegin({fname:"patch_headers",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:3}),b.writeString(a.patch_headers),b.writeFieldEnd()),a.kill_body!=null&&(b.writeFieldBegin({fname:"kill_body",ftype:(h||(h=c("ThriftTypes"))).BOOL,fid:4}),b.writeBool(a.kill_body),b.writeFieldEnd()),a.temporary!=null&&(b.writeFieldBegin({fname:"temporary",ftype:(h||(h=c("ThriftTypes"))).BOOL,fid:5}),b.writeBool(a.temporary),b.writeFieldEnd()),a.conditional_patch_headers!=null&&(b.writeFieldBegin({fname:"conditional_patch_headers",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:6}),p(a.conditional_patch_headers,b),b.writeFieldEnd()),b.writeFieldStop(),b.writeStructEnd()}function p(a,b){b.writeStructBegin("ResponseRewriteConditionalPatchHeaders");b.writeFieldBegin({fname:"expected_existing_headers",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:1});if(a.expected_existing_headers!=null)b.writeString(a.expected_existing_headers);else{var d="";b.writeString(d)}b.writeFieldEnd();b.writeFieldBegin({fname:"patch_headers_if_match",ftype:h.STRING,fid:2});if(a.patch_headers_if_match!=null)b.writeString(a.patch_headers_if_match);else{d="";b.writeString(d)}b.writeFieldEnd();a.patch_headers_otherwise!=null&&(b.writeFieldBegin({fname:"patch_headers_otherwise",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:3}),b.writeString(a.patch_headers_otherwise),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function q(a,b){b.writeStructBegin("ResponseData");b.writeFieldBegin({fname:"bytes",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:1});if(a.bytes!=null)b.writeBinary(a.bytes);else{var d=Uint8Array.of();b.writeBinary(d)}b.writeFieldEnd();a.metadata!=null&&(b.writeFieldBegin({fname:"metadata",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:2}),b.writeString(a.metadata),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function r(a,b){b.writeStructBegin("LogMessage");b.writeFieldBegin({fname:"message",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:1});if(a.message!=null)b.writeString(a.message);else{a="";b.writeString(a)}b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd()}function s(a,b){b.writeStructBegin("Termination");b.writeFieldBegin({fname:"reason",ftype:(h||(h=c("ThriftTypes"))).I32,fid:1});if(a.reason!=null){var e;b.writeI32((e=a.reason)!=null?e:0)}else{e=d("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.cast(0);b.writeI32((e=e)!=null?e:0)}b.writeFieldEnd();a.message!=null&&(b.writeFieldBegin({fname:"message",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:2}),b.writeString(a.message),b.writeFieldEnd());a.retry_delay_ms!=null&&(b.writeFieldBegin({fname:"retry_delay_ms",ftype:(h||(h=c("ThriftTypes"))).I64,fid:3}),b.writeI64(c("jsbi").BigInt(a.retry_delay_ms)),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function t(a,b){b.writeStructBegin("AmendStreamAck"),a.amendment_id!=null&&(b.writeFieldBegin({fname:"amendment_id",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1}),b.writeI64(c("jsbi").BigInt(a.amendment_id)),b.writeFieldEnd()),a.accepted!=null&&(b.writeFieldBegin({fname:"accepted",ftype:(h||(h=c("ThriftTypes"))).BOOL,fid:2}),b.writeBool(a.accepted),b.writeFieldEnd()),a.result!=null&&(b.writeFieldBegin({fname:"result",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:3}),b.writeBinary(a.result),b.writeFieldEnd()),b.writeFieldStop(),b.writeStructEnd()}function u(a,b){b.writeStructBegin("StreamCheck");b.writeFieldBegin({fname:"stream_id",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1});if(a.stream_id!=null)b.writeI64(c("jsbi").BigInt(a.stream_id));else{var e="0";b.writeI64(c("jsbi").BigInt(e))}b.writeFieldEnd();b.writeFieldBegin({fname:"last_sequencer",ftype:h.I32,fid:2});if(a.last_sequencer!=null)b.writeI32(a.last_sequencer);else{e=0;b.writeI32(e)}b.writeFieldEnd();b.writeFieldBegin({fname:"amendment_count",ftype:h.I32,fid:4});if(a.amendment_count!=null)b.writeI32(a.amendment_count);else{e=0;b.writeI32(e)}b.writeFieldEnd();b.writeFieldBegin({fname:"last_status",ftype:h.I32,fid:3});if(a.last_status!=null){b.writeI32((e=a.last_status)!=null?e:0)}else{a=d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(0);b.writeI32((e=a)!=null?e:0)}b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd()}function v(a,b){b.writeStructBegin("Ping");b.writeFieldBegin({fname:"caller_timestamp_ms",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1});if(a.caller_timestamp_ms!=null)b.writeI64(c("jsbi").BigInt(a.caller_timestamp_ms));else{var d="0";b.writeI64(c("jsbi").BigInt(d))}b.writeFieldEnd();if(a.streams_to_check!=null){b.writeFieldBegin({fname:"streams_to_check",ftype:(h||(h=c("ThriftTypes"))).LIST,fid:2});b.writeListBegin({etype:h.STRUCT,size:a.streams_to_check.length});for(var d=a.streams_to_check,a=Array.isArray(d),e=0,d=a?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(a){if(e>=d.length)break;f=d[e++]}else{e=d.next();if(e.done)break;f=e.value}f=f;u(f,b)}b.writeListEnd();b.writeFieldEnd()}b.writeFieldStop();b.writeStructEnd()}function w(a,b){b.writeStructBegin("Pong");b.writeFieldBegin({fname:"original_ping_timestamp_ms",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1});if(a.original_ping_timestamp_ms!=null)b.writeI64(c("jsbi").BigInt(a.original_ping_timestamp_ms));else{var d="0";b.writeI64(c("jsbi").BigInt(d))}b.writeFieldEnd();if(a.stream_ids_missing!=null){b.writeFieldBegin({fname:"stream_ids_missing",ftype:(h||(h=c("ThriftTypes"))).LIST,fid:2});b.writeListBegin({etype:h.I64,size:a.stream_ids_missing.length});for(var d=a.stream_ids_missing,e=Array.isArray(d),f=0,d=e?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{f=d.next();if(f.done)break;g=f.value}g=g;b.writeI64(c("jsbi").BigInt(g))}b.writeListEnd();b.writeFieldEnd()}if(a.stream_ids_behind!=null){b.writeFieldBegin({fname:"stream_ids_behind",ftype:(h||(h=c("ThriftTypes"))).LIST,fid:3});b.writeListBegin({etype:h.I64,size:a.stream_ids_behind.length});for(g=a.stream_ids_behind,f=Array.isArray(g),e=0,g=f?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(f){if(e>=g.length)break;d=g[e++]}else{e=g.next();if(e.done)break;d=e.value}d=d;b.writeI64(c("jsbi").BigInt(d))}b.writeListEnd();b.writeFieldEnd()}if(a.stream_ids_with_lost_amendments!=null){b.writeFieldBegin({fname:"stream_ids_with_lost_amendments",ftype:(h||(h=c("ThriftTypes"))).LIST,fid:4});b.writeListBegin({etype:h.I64,size:a.stream_ids_with_lost_amendments.length});for(d=a.stream_ids_with_lost_amendments,e=Array.isArray(d),f=0,d=e?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(e){if(f>=d.length)break;g=d[f++]}else{f=d.next();if(f.done)break;g=f.value}g=g;b.writeI64(c("jsbi").BigInt(g))}b.writeListEnd();b.writeFieldEnd()}if(a.stream_ids_with_wrong_status!=null){b.writeFieldBegin({fname:"stream_ids_with_wrong_status",ftype:(h||(h=c("ThriftTypes"))).LIST,fid:5});b.writeListBegin({etype:h.I64,size:a.stream_ids_with_wrong_status.length});for(g=a.stream_ids_with_wrong_status,f=Array.isArray(g),e=0,g=f?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(f){if(e>=g.length)break;d=g[e++]}else{e=g.next();if(e.done)break;d=e.value}a=d;b.writeI64(c("jsbi").BigInt(a))}b.writeListEnd();b.writeFieldEnd()}b.writeFieldStop();b.writeStructEnd()}function x(a,b){b.writeStructBegin("StreamResponseDelta");if(a.flow_status!=null){var d;b.writeFieldBegin({fname:"flow_status",ftype:(h||(h=c("ThriftTypes"))).I32,fid:1});b.writeI32((d=a.flow_status)!=null?d:0);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.log!=null){b.writeFieldBegin({fname:"log",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:2});r(a.log,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.rewrite!=null){b.writeFieldBegin({fname:"rewrite",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:3});o(a.rewrite,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.data!=null){b.writeFieldBegin({fname:"data",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:4});q(a.data,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.termination!=null){b.writeFieldBegin({fname:"termination",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:5});s(a.termination,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.amend_ack!=null){b.writeFieldBegin({fname:"amend_ack",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:6});t(a.amend_ack,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}b.writeFieldStop();b.writeStructEnd()}function y(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).STRING?b.new_headers=a.readString():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).STRING?b.new_body=a.readBinary():a.skip(e);break;case 3:e===(h||(h=c("ThriftTypes"))).STRING?b.patch_headers=a.readString():a.skip(e);break;case 4:e===(h||(h=c("ThriftTypes"))).BOOL?b.kill_body=a.readBool():a.skip(e);break;case 5:e===(h||(h=c("ThriftTypes"))).BOOL?b.temporary=a.readBool():a.skip(e);break;case 6:e===(h||(h=c("ThriftTypes"))).STRUCT?b.conditional_patch_headers=z(a):a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();return b}function z(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).STRING?b.expected_existing_headers=a.readString():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).STRING?b.patch_headers_if_match=a.readString():a.skip(e);break;case 3:e===(h||(h=c("ThriftTypes"))).STRING?b.patch_headers_otherwise=a.readString():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.expected_existing_headers===void 0&&(b.expected_existing_headers="");b.patch_headers_if_match===void 0&&(b.patch_headers_if_match="");return b}function A(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).STRING?b.bytes=a.readBinary():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).STRING?b.metadata=a.readString():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.bytes===void 0&&(b.bytes=Uint8Array.of());return b}function B(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).STRING?b.message=a.readString():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.message===void 0&&(b.message="");return b}function C(a){var b={};a.readStructBegin();while(!0){var e=a.readFieldBegin(),f=e.ftype;e=e.fid;if(f===(h||(h=c("ThriftTypes"))).STOP)break;switch(e){case 1:f===(h||(h=c("ThriftTypes"))).I32?b.reason=d("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.cast(a.readI32()):a.skip(f);break;case 2:f===(h||(h=c("ThriftTypes"))).STRING?b.message=a.readString():a.skip(f);break;case 3:f===(h||(h=c("ThriftTypes"))).I64?b.retry_delay_ms=a.readI64().toString():a.skip(f);break;default:a.skip(f)}a.readFieldEnd()}a.readStructEnd();b.reason===void 0&&(b.reason=d("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.cast(0));return b}function D(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).I64?b.amendment_id=a.readI64().toString():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).BOOL?b.accepted=a.readBool():a.skip(e);break;case 3:e===(h||(h=c("ThriftTypes"))).STRING?b.result=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();return b}function E(a){var b={};a.readStructBegin();while(!0){var e=a.readFieldBegin(),f=e.ftype;e=e.fid;if(f===(h||(h=c("ThriftTypes"))).STOP)break;switch(e){case 1:f===(h||(h=c("ThriftTypes"))).I64?b.stream_id=a.readI64().toString():a.skip(f);break;case 2:f===(h||(h=c("ThriftTypes"))).I32?b.last_sequencer=a.readI32():a.skip(f);break;case 4:f===(h||(h=c("ThriftTypes"))).I32?b.amendment_count=a.readI32():a.skip(f);break;case 3:f===(h||(h=c("ThriftTypes"))).I32?b.last_status=d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(a.readI32()):a.skip(f);break;default:a.skip(f)}a.readFieldEnd()}a.readStructEnd();b.stream_id===void 0&&(b.stream_id="0");b.last_sequencer===void 0&&(b.last_sequencer=0);b.amendment_count===void 0&&(b.amendment_count=0);b.last_status===void 0&&(b.last_status=d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(0));return b}function F(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).I64?b.caller_timestamp_ms=a.readI64().toString():a.skip(e);break;case 2:if(e===(h||(h=c("ThriftTypes"))).LIST){b.streams_to_check=[];d=a.readListBegin();for(var f=0;f<d.size;f++){var g=E(a);b.streams_to_check.push(g)}}else a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.caller_timestamp_ms===void 0&&(b.caller_timestamp_ms="0");return b}function G(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).I64?b.original_ping_timestamp_ms=a.readI64().toString():a.skip(e);break;case 2:if(e===(h||(h=c("ThriftTypes"))).LIST){b.stream_ids_missing=[];d=a.readListBegin();for(var f=0;f<d.size;f++){var g=a.readI64().toString();b.stream_ids_missing.push(g)}}else a.skip(e);break;case 3:if(e===(h||(h=c("ThriftTypes"))).LIST){b.stream_ids_behind=[];g=a.readListBegin();for(f=0;f<g.size;f++){d=a.readI64().toString();b.stream_ids_behind.push(d)}}else a.skip(e);break;case 4:if(e===(h||(h=c("ThriftTypes"))).LIST){b.stream_ids_with_lost_amendments=[];d=a.readListBegin();for(f=0;f<d.size;f++){g=a.readI64().toString();b.stream_ids_with_lost_amendments.push(g)}}else a.skip(e);break;case 5:if(e===(h||(h=c("ThriftTypes"))).LIST){b.stream_ids_with_wrong_status=[];g=a.readListBegin();for(f=0;f<g.size;f++){d=a.readI64().toString();b.stream_ids_with_wrong_status.push(d)}}else a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.original_ping_timestamp_ms===void 0&&(b.original_ping_timestamp_ms="0");return b}function H(a){var b,e={};a.readStructBegin();while(!0){var f=a.readFieldBegin(),g=f.ftype;f=f.fid;if(g===(h||(h=c("ThriftTypes"))).STOP)break;switch(f){case 1:if(g===(h||(h=c("ThriftTypes"))).I32)if(b==null)e.flow_status=d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(a.readI32()),b="flow_status";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: flow_status, previous deserialized field: "+b);else a.skip(g);break;case 2:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.log=B(a),b="log";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: log, previous deserialized field: "+b);else a.skip(g);break;case 3:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.rewrite=y(a),b="rewrite";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: rewrite, previous deserialized field: "+b);else a.skip(g);break;case 4:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.data=A(a),b="data";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: data, previous deserialized field: "+b);else a.skip(g);break;case 5:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.termination=C(a),b="termination";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: termination, previous deserialized field: "+b);else a.skip(g);break;case 6:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.amend_ack=D(a),b="amend_ack";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: amend_ack, previous deserialized field: "+b);else a.skip(g);break;default:a.skip(g)}a.readFieldEnd()}a.readStructEnd();return e}g.ResponseRewriteRequest$DefaultConstructor=a;g.ResponseRewriteConditionalPatchHeaders$DefaultConstructor=b;g.ResponseData$DefaultConstructor=e;g.LogMessage$DefaultConstructor=f;g.Termination$DefaultConstructor=i;g.AmendStreamAck$DefaultConstructor=j;g.StreamCheck$DefaultConstructor=k;g.Ping$DefaultConstructor=l;g.Pong$DefaultConstructor=m;g.StreamResponseDelta$DefaultConstructor=n;g.serializeResponseRewriteRequest=o;g.serializeResponseRewriteConditionalPatchHeaders=p;g.serializeResponseData=q;g.serializeLogMessage=r;g.serializeTermination=s;g.serializeAmendStreamAck=t;g.serializeStreamCheck=u;g.serializePing=v;g.serializePong=w;g.serializeStreamResponseDelta=x;g.deserializeResponseRewriteRequest=y;g.deserializeResponseRewriteConditionalPatchHeaders=z;g.deserializeResponseData=A;g.deserializeLogMessage=B;g.deserializeTermination=C;g.deserializeAmendStreamAck=D;g.deserializeStreamCheck=E;g.deserializePing=F;g.deserializePong=G;g.deserializeStreamResponseDelta=H}),98);
__d("RequestStreamSingleChannelSingleChannelRequestStreamTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({Ignored:100,Success:200,Queued:250,UnknownStream:400,HandledUnknownResult:450,Failure:500});c=b("$InternalEnum")({Request_headers:"request_headers",Request_body:"request_body",Amend:"amend",Ack:"ack",Response:"response",Ping:"ping",Pong:"pong"});e.exports={Ack:a,Payload$Types:c}}),null);
__d("RequestStreamSingleChannelSingleChannelRequestStreamSerializers",["RequestStreamCommonRequestStreamCommonSerializers","RequestStreamCommonRequestStreamCommonTypes","RequestStreamSingleChannelSingleChannelRequestStreamTypes","ThriftTypes","jsbi"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return{}}function b(){return{body:Uint8Array.of()}}function e(){return{amendment:Uint8Array.of()}}function f(){return{ack:d("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.cast(0)}}function i(){return{delta:[]}}function j(){return{}}function k(a,b){b.writeStructBegin("RequestStreamHeaders"),a.headers!=null&&(b.writeFieldBegin({fname:"headers",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:1}),b.writeBinary(a.headers),b.writeFieldEnd()),a.instrumentation_data!=null&&(b.writeFieldBegin({fname:"instrumentation_data",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:2}),b.writeBinary(a.instrumentation_data),b.writeFieldEnd()),b.writeFieldStop(),b.writeStructEnd()}function l(a,b){b.writeStructBegin("RequestStreamBody");b.writeFieldBegin({fname:"body",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:1});if(a.body!=null)b.writeBinary(a.body);else{a=Uint8Array.of();b.writeBinary(a)}b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd()}function m(a,b){b.writeStructBegin("AmendStream");a.amendment_id!=null&&(b.writeFieldBegin({fname:"amendment_id",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1}),b.writeI64(c("jsbi").BigInt(a.amendment_id)),b.writeFieldEnd());b.writeFieldBegin({fname:"amendment",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:2});if(a.amendment!=null)b.writeBinary(a.amendment);else{var d=Uint8Array.of();b.writeBinary(d)}b.writeFieldEnd();a.is_query!=null&&(b.writeFieldBegin({fname:"is_query",ftype:(h||(h=c("ThriftTypes"))).BOOL,fid:3}),b.writeBool(a.is_query),b.writeFieldEnd());a.instrumentation_data!=null&&(b.writeFieldBegin({fname:"instrumentation_data",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:4}),b.writeBinary(a.instrumentation_data),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function n(a,b){b.writeStructBegin("StreamResponseAck");a.response_id!=null&&(b.writeFieldBegin({fname:"response_id",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1}),b.writeI64(c("jsbi").BigInt(a.response_id)),b.writeFieldEnd());b.writeFieldBegin({fname:"ack",ftype:(h||(h=c("ThriftTypes"))).I32,fid:2});if(a.ack!=null){var e;b.writeI32((e=a.ack)!=null?e:0)}else{e=d("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.cast(0);b.writeI32((e=e)!=null?e:0)}b.writeFieldEnd();a.query_result!=null&&(b.writeFieldBegin({fname:"query_result",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:3}),b.writeBinary(a.query_result),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function o(a,b){b.writeStructBegin("StreamResponse");a.response_id!=null&&(b.writeFieldBegin({fname:"response_id",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1}),b.writeI64(c("jsbi").BigInt(a.response_id)),b.writeFieldEnd());b.writeFieldBegin({fname:"delta",ftype:(h||(h=c("ThriftTypes"))).LIST,fid:2});if(a.delta!=null){b.writeListBegin({etype:(h||(h=c("ThriftTypes"))).STRUCT,size:a.delta.length});for(var e=a.delta,f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(f){if(g>=e.length)break;i=e[g++]}else{g=e.next();if(g.done)break;i=g.value}i=i;d("RequestStreamCommonRequestStreamCommonSerializers").serializeStreamResponseDelta(i,b)}b.writeListEnd()}else{i=[];b.writeListBegin({etype:(h||(h=c("ThriftTypes"))).STRUCT,size:i.length});for(g=0;g<i.length;g++){f=i[g];d("RequestStreamCommonRequestStreamCommonSerializers").serializeStreamResponseDelta(f,b)}b.writeListEnd()}b.writeFieldEnd();if(a.ack_level!=null){b.writeFieldBegin({fname:"ack_level",ftype:(h||(h=c("ThriftTypes"))).I32,fid:3});b.writeI32((e=a.ack_level)!=null?e:0);b.writeFieldEnd()}a.query_request!=null&&(b.writeFieldBegin({fname:"query_request",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:4}),b.writeBinary(a.query_request),b.writeFieldEnd());a.instrumentation_data!=null&&(b.writeFieldBegin({fname:"instrumentation_data",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:5}),b.writeBinary(a.instrumentation_data),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function p(a,b){b.writeStructBegin("Payload");if(a.request_headers!=null){b.writeFieldBegin({fname:"request_headers",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:1});k(a.request_headers,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.request_body!=null){b.writeFieldBegin({fname:"request_body",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:2});l(a.request_body,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.amend!=null){b.writeFieldBegin({fname:"amend",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:3});m(a.amend,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.ack!=null){b.writeFieldBegin({fname:"ack",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:4});n(a.ack,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.response!=null){b.writeFieldBegin({fname:"response",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:5});o(a.response,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.ping!=null){b.writeFieldBegin({fname:"ping",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:6});d("RequestStreamCommonRequestStreamCommonSerializers").serializePing(a.ping,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.pong!=null){b.writeFieldBegin({fname:"pong",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:7});d("RequestStreamCommonRequestStreamCommonSerializers").serializePong(a.pong,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}b.writeFieldStop();b.writeStructEnd()}function q(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).STRING?b.headers=a.readBinary():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).STRING?b.instrumentation_data=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();return b}function r(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).STRING?b.body=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.body===void 0&&(b.body=Uint8Array.of());return b}function s(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).I64?b.amendment_id=a.readI64().toString():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).STRING?b.amendment=a.readBinary():a.skip(e);break;case 3:e===(h||(h=c("ThriftTypes"))).BOOL?b.is_query=a.readBool():a.skip(e);break;case 4:e===(h||(h=c("ThriftTypes"))).STRING?b.instrumentation_data=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.amendment===void 0&&(b.amendment=Uint8Array.of());return b}function t(a){var b={};a.readStructBegin();while(!0){var e=a.readFieldBegin(),f=e.ftype;e=e.fid;if(f===(h||(h=c("ThriftTypes"))).STOP)break;switch(e){case 1:f===(h||(h=c("ThriftTypes"))).I64?b.response_id=a.readI64().toString():a.skip(f);break;case 2:f===(h||(h=c("ThriftTypes"))).I32?b.ack=d("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.cast(a.readI32()):a.skip(f);break;case 3:f===(h||(h=c("ThriftTypes"))).STRING?b.query_result=a.readBinary():a.skip(f);break;default:a.skip(f)}a.readFieldEnd()}a.readStructEnd();b.ack===void 0&&(b.ack=d("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.cast(0));return b}function u(a){var b={};a.readStructBegin();while(!0){var e=a.readFieldBegin(),f=e.ftype;e=e.fid;if(f===(h||(h=c("ThriftTypes"))).STOP)break;switch(e){case 1:f===(h||(h=c("ThriftTypes"))).I64?b.response_id=a.readI64().toString():a.skip(f);break;case 2:if(f===(h||(h=c("ThriftTypes"))).LIST){b.delta=[];e=a.readListBegin();for(var g=0;g<e.size;g++){var i=d("RequestStreamCommonRequestStreamCommonSerializers").deserializeStreamResponseDelta(a);b.delta.push(i)}}else a.skip(f);break;case 3:f===(h||(h=c("ThriftTypes"))).I32?b.ack_level=d("RequestStreamCommonRequestStreamCommonTypes").AckLevel.cast(a.readI32()):a.skip(f);break;case 4:f===(h||(h=c("ThriftTypes"))).STRING?b.query_request=a.readBinary():a.skip(f);break;case 5:f===(h||(h=c("ThriftTypes"))).STRING?b.instrumentation_data=a.readBinary():a.skip(f);break;default:a.skip(f)}a.readFieldEnd()}a.readStructEnd();b.delta===void 0&&(b.delta=[]);return b}function v(a){var b,e={};a.readStructBegin();while(!0){var f=a.readFieldBegin(),g=f.ftype;f=f.fid;if(g===(h||(h=c("ThriftTypes"))).STOP)break;switch(f){case 1:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.request_headers=q(a),b="request_headers";else throw new Error("more than one field have been deserialized in union type: Payload; current field: request_headers, previous deserialized field: "+b);else a.skip(g);break;case 2:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.request_body=r(a),b="request_body";else throw new Error("more than one field have been deserialized in union type: Payload; current field: request_body, previous deserialized field: "+b);else a.skip(g);break;case 3:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.amend=s(a),b="amend";else throw new Error("more than one field have been deserialized in union type: Payload; current field: amend, previous deserialized field: "+b);else a.skip(g);break;case 4:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.ack=t(a),b="ack";else throw new Error("more than one field have been deserialized in union type: Payload; current field: ack, previous deserialized field: "+b);else a.skip(g);break;case 5:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.response=u(a),b="response";else throw new Error("more than one field have been deserialized in union type: Payload; current field: response, previous deserialized field: "+b);else a.skip(g);break;case 6:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.ping=d("RequestStreamCommonRequestStreamCommonSerializers").deserializePing(a),b="ping";else throw new Error("more than one field have been deserialized in union type: Payload; current field: ping, previous deserialized field: "+b);else a.skip(g);break;case 7:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.pong=d("RequestStreamCommonRequestStreamCommonSerializers").deserializePong(a),b="pong";else throw new Error("more than one field have been deserialized in union type: Payload; current field: pong, previous deserialized field: "+b);else a.skip(g);break;default:a.skip(g)}a.readFieldEnd()}a.readStructEnd();return e}g.RequestStreamHeaders$DefaultConstructor=a;g.RequestStreamBody$DefaultConstructor=b;g.AmendStream$DefaultConstructor=e;g.StreamResponseAck$DefaultConstructor=f;g.StreamResponse$DefaultConstructor=i;g.Payload$DefaultConstructor=j;g.serializeRequestStreamHeaders=k;g.serializeRequestStreamBody=l;g.serializeAmendStream=m;g.serializeStreamResponseAck=n;g.serializeStreamResponse=o;g.serializePayload=p;g.deserializeRequestStreamHeaders=q;g.deserializeRequestStreamBody=r;g.deserializeAmendStream=s;g.deserializeStreamResponseAck=t;g.deserializeStreamResponse=u;g.deserializePayload=v}),98);
__d("RequestStreamState",["RequestStreamCommonRequestStreamCommonTypes"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(b){case d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Accepted:if(a.seenAccepted)return a;return a.flowStatus===d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Started?a:{flowStatus:d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Accepted,seenAccepted:!0};default:if(!a.seenAccepted||a.flowStatus===b)return a;else return{flowStatus:b,seenAccepted:!0}}}g.getNextState=a}),98);
__d("StreamRetryState",[],(function(a,b,c,d,e,f){"use strict";var g=1e3,h=2*60*1e3;a=function(){function a(){this.$1=0}var b=a.prototype;b.resetErrorAndRetryCount=function(){this.$1=0};b.onRetry=function(){this.$1+=1};b.getRetryCount=function(){return this.$1};b.getBackoffDelayMs=function(){if(this.$1<=1)return 0;if(this.$1===2)return g*Math.random();var a=g*Math.pow(2,this.$1-3),b=a*Math.random();a=a+b;return Math.min(a,h)};return a}();f["default"]=a}),66);
__d("DGWRequestStreamRef",["CompactSerializerPolyfill","DGWRequestStreamUtils","DGWStream","DGWStreamHandler","InflightAmends","Promise","RequestStreamCloseReason","RequestStreamCommonRequestStreamCommonTypes","RequestStreamE2EClientLoggerEvent","RequestStreamE2EClientLoggerMessageType","RequestStreamE2ELogger","RequestStreamE2ESampling","RequestStreamSingleChannelSingleChannelRequestStreamSerializers","RequestStreamSingleChannelSingleChannelRequestStreamTypes","RequestStreamState","RequestStreamTransport","RtiWebRequestStreamClient","StreamRetryState","err","gkx","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=4,j=0,k=1e3,l=2,m=c("gkx")("20915")?3e4:5e3,n="dgw_stream_send_ack_failure";function o(a){if(!a){a=c("err")(n);a.stack;throw a}}function p(a,b){if(a==null||a.length===0)return null;a=JSON.parse(a);a.auxId=b;return new TextEncoder().encode(JSON.stringify(a))}function q(a){var b={};a=a.delta;a.forEach(function(a){if(a.flow_status){b.type=d("RequestStreamCommonRequestStreamCommonTypes").StreamResponseDelta$Types.Flow_status;switch(a.flow_status){case d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Accepted:b.flow_status="Accepted";break;case d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Started:b.flow_status="Started";break;case d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Stopped:b.flow_status="Stopped";break}}else a.log?b.type=d("RequestStreamCommonRequestStreamCommonTypes").StreamResponseDelta$Types.Log:a.rewrite?b.type=d("RequestStreamCommonRequestStreamCommonTypes").StreamResponseDelta$Types.Rewrite:a.data?b.type=d("RequestStreamCommonRequestStreamCommonTypes").StreamResponseDelta$Types.Data:a.termination?b.type=d("RequestStreamCommonRequestStreamCommonTypes").StreamResponseDelta$Types.Termination:a.amend_ack&&(b.type=d("RequestStreamCommonRequestStreamCommonTypes").StreamResponseDelta$Types.Amend_ack)});return b}a=function(){function a(a,b,e,f,g,h){var j=this;this.$6=null;this.$7={};this.$10=!1;this.$15=new(c("StreamRetryState"))();this.$16=0;this.$17=0;this.$18=0;this.$21=0;var k=null;typeof b==="string"?k=new TextEncoder().encode(b):typeof b==="object"&&(k=b);this.$1={headers:a,body:k};this.$3=e;this.$4=f;this.$12=i;this.$9=!1;this.$14=!1;this.$20=h;k=f==null?void 0:f.serviceId;g!=null&&(this.$22()||(g.dgwStreamGroupLoggingId=this.$20.getStreamGroupLoggingId(k)),g.dgwCountPriorStreamsInGroup=this.$20.guessStreamGroupPriorStreamCount(k),g.transport="WEB_RS_STARGATE");this.$5=d("RequestStreamE2ESampling").validateInstrumentationData(a,g,f==null?void 0:f.requestLogContext,f==null?void 0:f.upsampleMultiplier);!this.$22()?this.$6=d("RequestStreamE2ELogger").createStreamLogger(a,this.$5,d("RequestStreamTransport").RequestStreamTransport.WEB_RS_STARGATE):this.$7.disableFalcoLogging=!0;(f==null?void 0:f.deviceId)!=null&&(this.$7.deviceId=f.deviceId);this.$6&&(this.$7.loggingId=this.$6.getRequestId());f&&f.overrideUrl!=null&&(this.$7.overrideUrl=f.overrideUrl);k!=null&&(this.$7.serviceId=k);this.$8={flowStatus:d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Stopped,seenAccepted:!1};this.$19=new(c("InflightAmends"))(m,function(a,b){var d;(d=j.$6)==null?void 0:d.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT_ACK,c("RequestStreamE2EClientLoggerEvent").RECEIVED,babelHelpers["extends"]({},j.$23(),{latency:b.toString()}),a)},function(a,b){if(b.message!==n){var d;(d=j.$6)==null?void 0:d.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT_ACK,c("RequestStreamE2EClientLoggerEvent").FAILURE,babelHelpers["extends"]({},j.$23(),{reason:b.message}),a)}});(e=this.$6)==null?void 0:e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").RECEIVED,{data_size:(g=b==null?void 0:(h=b.length)==null?void 0:h.toString())!=null?g:"0"},"0","0")}var e=a.prototype;e.getInstrumentationData=function(){return this.$5};e.getE2EClientLogger=function(){return this.$6};e.amendWithAck=function(a){a=this.$24(a,!0);return a==null?(h||(h=b("Promise"))).resolve(!1):this.$19.getPromise(a)||(h||(h=b("Promise"))).resolve(!1)};e.amendWithoutAck=function(a){this.$24(a,!1)};e.cancel=function(){var a;(a=this.$6)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").CANCEL,c("RequestStreamE2EClientLoggerEvent").RECEIVED);this.$9=!0;this.$25(d("RequestStreamCloseReason").RequestStreamCloseReason.UserIntention,"user cancel the stream",!0)};e.start=function(a){var e=this;a===void 0&&(a=!1);var f=String(this.$16++),g=Date.now();return this.$26(f).then(function(){var a;e.$14=!1;e.$21=0;var b=(Date.now()-g).toString();(a=e.$6)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").PUBACK,{latency:b},f,String(e.$18))})["catch"](function(g){g.stack;if(g.message===n&&e.$10)return;e.$14=!1;if(g!==d("DGWStream").StreamError.ESTABLISHMENT_ERROR){var i,j=g.message;g===d("DGWStream").StreamError.UNAUTHENTICATED?j="UNAUTHENTICATED":g===d("DGWStream").StreamError.UNAUTHORIZED&&(j="UNAUTHORIZED");(i=e.$6)==null?void 0:i.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:j},f,String(e.$18));e.$25(a?d("RequestStreamCloseReason").RequestStreamCloseReason.ReestablishError:d("RequestStreamCloseReason").RequestStreamCloseReason.StartStreamFailure,j,!0);if(g===d("DGWStream").StreamError.UNAUTHENTICATED||g===d("DGWStream").StreamError.UNAUTHORIZED)return;throw g}else{(i=e.$6)==null?void 0:i.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:(j=g.message)!=null?j:g},f,String(e.$18));e.$15.onRetry();var m=c("gkx")("20916")?e.$15.getBackoffDelayMs():k*Math.pow(l,e.$21);return new(h||(h=b("Promise")))(function(a){return window.setTimeout(a,m)}).then(function(){e.$21++;e.$18++;return e.start()})}})};e.getFlowStatus=function(){return this.$8.flowStatus};e.shouldTerminateOrRetry=function(a,e,f,g){var i=this;if(this.$14)return;var k=e;this.$12||(k="cannot retry for error: "+e+" because of hit max retry limitation");if(a!==d("RequestStreamCloseReason").RequestStreamCloseReason.ClientError){(e=this.$6)==null?void 0:e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:k},null,String(this.$18))}e=f&&(c("gkx")("20916")||this.$12);this.$25(a,k,!e);if(e){var l=c("gkx")("20916")?Math.max((f=g)!=null?f:0,this.$15.getBackoffDelayMs()):(a=g)!=null?a:j;this.$14=!0;return new(h||(h=b("Promise")))(function(a){return window.setTimeout(a,l)}).then(function(){return i.$27()})["catch"](function(a){})}};e.$28=function(){return this.$11!=null};e.$24=function(a,b){var e,f=this,g=typeof a==="string"?new TextEncoder().encode(a):a,h=String(this.$17++);(e=this.$6)==null?void 0:e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").RECEIVED,{},h);e=p(this.$5,h);g={amend:{amendment:g,instrumentation_data:e}};b&&g.amend&&(g.amend.amendment_id=h);e=d("CompactSerializerPolyfill").serialize(g,d("RequestStreamSingleChannelSingleChannelRequestStreamSerializers").serializePayload);var i=Date.now();if(this.$29()&&this.$11!=null){b&&this.$19.add(h);this.$11.send(e).then(function(a){var b;o(a);a=(Date.now()-i).toString();(b=f.$6)==null?void 0:b.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").PUBACK,{latency:a},h)})["catch"](function(a){var b;(b=f.$6)==null?void 0:b.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:a.message},h);f.$19.reject(h,a)});(g=this.$6)==null?void 0:g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").SENT,{data_size:(e=a==null?void 0:(b=a.length)==null?void 0:b.toString())!=null?e:"0"},h);return h}else{(g=this.$6)==null?void 0:g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"not_started"},h)}};e.$26=function(a){var e=this,f,g,h,j,k,l,m,n,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:if(this.$9){q.next=39;break}g=this.$2||this.$1;q.prev=2;h=this.$30();this.$13=h;j=g.headers.graphiql_sandbox;k=babelHelpers["extends"]({},g.headers,this.$31());j!=null&&(k=babelHelpers["extends"]({},k,{www_sandbox:j,distillery_sandbox:j+":8086"}));l=d("DGWRequestStreamUtils").convertHeaders(k,g.body!=null,this.$5);q.next=11;return b("regeneratorRuntime").awrap(this.$20.establishStream(l,h,this.$7));case 11:this.$11=q.sent;q.next=26;break;case 14:q.prev=14;q.t0=q["catch"](2);if(!(q.t0===d("DGWStream").StreamError.ESTABLISHMENT_ERROR)){q.next=18;break}throw q.t0;case 18:if(!(d("DGWStream").StreamError.isValid(q.t0)&&!d("DGWStream").isRetryableError(q.t0))){q.next=22;break}throw q.t0;case 22:if(!(d("DGWStream").StreamError.isValid(q.t0)&&d("DGWStream").isRetryableError(q.t0))){q.next=25;break}this.$32(q.t0);return q.abrupt("return");case 25:throw q.t0;case 26:if(!this.$9){q.next=29;break}this.$25(d("RequestStreamCloseReason").RequestStreamCloseReason.UserIntention,"user cancel the stream",!0);return q.abrupt("return");case 29:m=new Uint8Array([]);g.body!=null&&(n={request_body:{body:g.body}},m=d("CompactSerializerPolyfill").serialize(n,d("RequestStreamSingleChannelSingleChannelRequestStreamSerializers").serializePayload));if(this.$11){q.next=33;break}throw new Error("dgwstream_is_null");case 33:p=this.$11.send(m).then(function(a){o(a),e.$9&&e.$25(d("RequestStreamCloseReason").RequestStreamCloseReason.UserIntention,"user cancel the stream",!0)});(f=this.$6)==null?void 0:f.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").SENT,{},a,String(this.$18));this.$12=i;return q.abrupt("return",p);case 39:throw new Error("stream_already_canceled");case 40:case"end":return q.stop()}},null,this,[[2,14]])};e.$29=function(){return this.$8.flowStatus===d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Started||this.$8.flowStatus===d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Accepted};e.$25=function(a,b,c){var e;this.$11&&a!==d("RequestStreamCloseReason").RequestStreamCloseReason.StreamError&&a!==d("RequestStreamCloseReason").RequestStreamCloseReason.RemoteTermination&&this.$11.close();(e=this.$13)==null?void 0:e.stop();this.$11=null;this.$10=!0;this.$33(d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Stopped)&&this.$3.onFlowStatus(d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Stopped);c&&!this.$9&&this.$3.onTermination("terminate stream because "+a+" with msg : "+b)};e.$33=function(a){var b=this.$8;this.$8=d("RequestStreamState").getNextState(b,a);return b!==this.$8};e.$27=function(){this.$12--;this.$18++;this.$15.onRetry();return this.start(!0)};e.$34=function(a){var b=this;a=d("CompactSerializerPolyfill").deserialize(a,d("RequestStreamSingleChannelSingleChannelRequestStreamSerializers").deserializePayload);if(a.response){var e=d("DGWRequestStreamUtils").getInstrumentationDataFieldsFromPayload(a),f=e==null?void 0:e.auxId;e=e==null?void 0:e.dfTraceId;if(!this.$28()){var g;(g=this.$6)==null?void 0:g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"response_received_after_close"},f,String(this.$18),e);return}(g=this.$6)==null?void 0:g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").RECEIVED,q(a.response),f,String(this.$18),e);g=a.response.delta;g.forEach(function(a){if(a.data)b.$15.resetErrorAndRetryCount(),b.$8.flowStatus===d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Started&&b.$3.onData(new TextDecoder("utf-8").decode(a.data.bytes));else if(a.flow_status){var c=a.flow_status;c===d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Started&&b.$15.resetErrorAndRetryCount();b.$33(c)&&b.$3.onFlowStatus(c)}else if(a.termination){c=(c=a.termination.message)!=null?c:"unknown termination msg";b.$2=null;b.shouldTerminateOrRetry(d("RequestStreamCloseReason").RequestStreamCloseReason.RemoteTermination,c,a.termination.reason===d("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.TryAgain,a.termination.retry_delay_ms!=null?parseInt(a.termination.retry_delay_ms,10):null)}else if(a.log)b.$3.onLog(a.log.message);else if(a.amend_ack){c=a.amend_ack.amendment_id;if(c!=null){var e=a.amend_ack.accepted||!1;b.$19.resolve(c,e)}}else if(a.rewrite){c=d("DGWRequestStreamUtils").transformContextWithRewriteDelta(b.$1,a.rewrite);a.rewrite.temporary===!0?b.$2=c:b.$1=c}});(g=this.$6)==null?void 0:g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").SENT,q(a.response),f,String(this.$18),e);a.response.ack_level===d("RequestStreamCommonRequestStreamCommonTypes").AckLevel.Device&&a.response.response_id!=null&&this.$35(a.response.response_id,f)}else{(g=this.$6)==null?void 0:g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"unexpected_payload_type"},null,String(this.$18))}};e.$35=function(a,b){a={ack:{response_id:a,ack:d("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.Success}};a=d("CompactSerializerPolyfill").serialize(a,d("RequestStreamSingleChannelSingleChannelRequestStreamSerializers").serializePayload);if(this.$11!=null){this.$11.send(a);(a=this.$6)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE_ACK,c("RequestStreamE2EClientLoggerEvent").SENT,{},b,String(this.$18))}else{(a=this.$6)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE_ACK,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"not_started"},b,String(this.$18))}};e.$22=function(){return this.$1.headers.method==="Falco"};e.$30=function(){return new(c("DGWStreamHandler"))(this.$36.bind(this),this.$37.bind(this),this.$32.bind(this),this.$38.bind(this),this.$39.bind(this))};e.$39=function(a){(a=this.$6)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"OnClose: Server Has FinishedSendingData"},null,String(this.$18));this.$25(d("RequestStreamCloseReason").RequestStreamCloseReason.ServerDataEnd,"Client receive OnServerHasFinishedSendingData and Server will not send more data",!0)};e.$36=function(a){(a=this.$6)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"OnClose: Server Close Connection"},null,String(this.$18));this.$25(d("RequestStreamCloseReason").RequestStreamCloseReason.RemoteTermination,"Client receive OnClose and Server will not send more data",!0)};e.$37=function(a){try{this.$34(a)}catch(b){(a=this.$6)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:b.message},null,String(this.$18));this.shouldTerminateOrRetry(d("RequestStreamCloseReason").RequestStreamCloseReason.ClientError,b.message,!1)}};e.$32=function(a){var b="",c=d("DGWStream").isRetryableError(a);b="StreamError: Received "+a;this.shouldTerminateOrRetry(d("RequestStreamCloseReason").RequestStreamCloseReason.StreamError,b,c)};e.$38=function(a,b){this.shouldTerminateOrRetry(d("RequestStreamCloseReason").RequestStreamCloseReason.ServerDrain,b,!0)};e.$31=function(){return c("RtiWebRequestStreamClient").overrideHeaders};e.$23=function(){var a={};c("gkx")("20918")&&(a.pending_amendments_size=this.$19.getSize().toString());return a};return a}();g["default"]=a}),98);
__d("DGWStreamGroupHandler",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b,c){this.$1=a,this.$2=b,this.$3=c}var b=a.prototype;b.onStreamGroupError=function(a){this.$1(a)};b.onStreamGroupMustDrain=function(a){this.$2(a)};b.onStreamGroupTransportClose=function(){this.$3()};return a}();f["default"]=a}),66);
__d("DGWStreamFactory",["DGWClient","DGWStreamGroupHandler","Promise","gkx","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i="realtime",j=1e4,k=null;a=function(){function a(){this.$1={}}a.get=function(){k==null&&(k=new a());return k};var d=a.prototype;d.$2=function(a){var b;this.$1=(b={},b[a]={dgwStreamGroup:null,multiStreamGroupLoggingId:null,multiStreamGroupPriorStreamCountGuess:0},b)};d.getStreamGroupLoggingId=function(a){a===void 0&&(a=null);return(a=this.$1[(a=a)!=null?a:i])==null?void 0:a.multiStreamGroupLoggingId};d.guessStreamGroupPriorStreamCount=function(a){a===void 0&&(a=null);return((a=this.$1[(a=a)!=null?a:i])==null?void 0:a.multiStreamGroupPriorStreamCountGuess)||0};d.establishStream=function(a,d,e){var f,g=this,k=e.serviceId==null?i:e.serviceId;f=(f=this.$1[k])==null?void 0:f.dgwStreamGroup;if(f==null||!f.canCreateGroupedStream()){var l={deviceId:e.deviceId,serviceId:k,disableFalcoLogging:e.disableFalcoLogging,streamGroupAppHeaders:{"stream-group":"group1"}};e.overrideUrl!=null&&(l.overrideUrl=e.overrideUrl);l.keepAliveMs=j;c("gkx")("20920")&&(l.loggingId=c("uuidv4")());try{f=c("DGWClient")().createStreamGroup(new(c("DGWStreamGroupHandler"))(function(){g.$2(k)},function(){g.$2(k)},function(){g.$2(k)}),l),this.$1[k]={dgwStreamGroup:f,multiStreamGroupLoggingId:l.loggingId,multiStreamGroupPriorStreamCountGuess:0}}catch(a){return(h||(h=b("Promise"))).reject(a)}}this.$1[k].multiStreamGroupPriorStreamCountGuess++;return f.establishStream({loggingId:e.loggingId,disableFalcoLogging:e.disableFalcoLogging,groupedStreamHeaders:a},d)};return a}();g["default"]=a}),98);
__d("DGWRequestStreamClient",["DGWRequestStreamRef","DGWStreamFactory","Promise","cr:2046346"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(a){this.$1=a!=null?a:c("DGWStreamFactory").get()}var d=a.prototype;d.createStream=function(a,d,e,f,g){b("cr:2046346")!=null&&b("cr:2046346").startPulsarTest();return(h||(h=b("Promise"))).resolve(new(c("DGWRequestStreamRef"))(a,d,f,g,e,this.$1))};return a}();g["default"]=a}),98);/*FB_PKG_DELIM*/
__d("MEBEncryptionVersion",[],(function(a,b,c,d,e,f){a=Object.freeze({UNKNOWN:0,ENCRYPTION_KDF_WITH_VERSION:2,ENCRYPTION_KDF_WITH_NULL_SALT:3,ENCRYPTION_KDF_WITH_NULL_SALT_DF_CANARY:4,TEST_VERSION:99});f["default"]=a}),66);
__d("CryptoUtils",["Base64Utils","EncryptedBackupsSymmetricEncryptionUtils","HChaCha20","MEBEncryptionVersion","SymmetricEncryptionPaddingUtils","XPlatReactCrypto","XPlatReactTextDecoder","err"],(function(a,b,c,d,e,f,g){"use strict";var h=32,i=2147483647,j="message_key_in_epoch",k="_",l="cipher_version",m="thread";e="message_thread";function a(a,b,d,e){var f=d>=c("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_NULL_SALT?null:n(e);a=o(a,d,e);if(a==null)throw c("err")("Error in derive message symmetric key. info is null");return q(a,f,b,[h])}function n(a){try{return new TextEncoder().encode(a).buffer}catch(a){throw c("err")("Error in get blob from string with exception: ",a)}}function o(a,b,c){a=p(a,b,c);return n(a)}function p(a,b,e){if(b>=c("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_NULL_SALT_DF_CANARY||b>=c("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_NULL_SALT)return[j,new(d("XPlatReactTextDecoder").TextDecoder)().decode(a),l,b,m,e!=null?e:""].join(k);else if(b>=c("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_VERSION)return[j,new(d("XPlatReactTextDecoder").TextDecoder)().decode(a),l,b].join(k);else return[j,new(d("XPlatReactTextDecoder").TextDecoder)().decode(a)].join(k)}function q(a,b,e,f){if(f.length<1||f.some(function(a){return a>i}))throw c("err")("Invalid key lengths for derive keys");var g=f.reduce(function(a,b){return a+b},0)*8;return d("XPlatReactCrypto").subtleImportKey("raw",e,"HKDF",!1,["deriveBits"]).then(function(c){var e;return d("XPlatReactCrypto").subtleDeriveBits({hash:"SHA-256",info:a,name:"HKDF",salt:(e=b)!=null?e:new Uint8Array(10).buffer},c,g)}).then(function(a){a=new Uint8Array(a);var b=[],c=0;for(var d=0,e=f.length;d<e;++d){var g=c+f[d];b.push(a.slice(c,g).buffer);c=g}return b})["catch"](function(a){throw c("err")("Exception in create derived keys",a)})}function b(a,b,e){e=d("Base64Utils").toArrayBuffer(e);return r(a,b,e).then(function(a){return a}).then(function(a){if(a==null)throw c("err")("symmetric string decryption with null result");return new(d("XPlatReactTextDecoder").TextDecoder)().decode(a)})["catch"](function(a){throw c("err")("symmetric string decryption failed with error",a)})}function r(a,b,e){if(e.byteLength<d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes+d("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLengthInBytes)throw c("err")("cipher text is invalid");e=new Uint8Array(e);var f=e.slice(0,d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes),g=new(d("HChaCha20").HChaCha20)(),h=e.slice(d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes).buffer;e=g.hChaCha20Bytes(f.slice(0,d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer,a);return d("XPlatReactCrypto").subtleImportKey("raw",e,"AES-GCM",!1,["decrypt"]).then(function(a){return d("XPlatReactCrypto").subtleDecrypt({additionalData:b,iv:new Uint8Array(f.slice(d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer),name:"AES-GCM",tagLength:d("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLength},a,h)}).then(function(a){a=d("SymmetricEncryptionPaddingUtils").stripPadding(a);if(a==null)throw c("err")("Failed to strip padding for symmetric decryption");return a})["catch"](function(a){throw c("err")("symmetric data decryption failed with error",a)})}g.KEY_LEN=h;g.MAX_INT_32=i;g.STRING_JOIN_SEPARATOR=k;g.MESSAGE_ENCYPTION_AAD=e;g.deriveMessageSymmetricKey=a;g.createDerivedKeys=q;g.symmetricEncryptionCreateDecryptedString=b}),98);
__d("LSDeleteAndReenrollDeviceState",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure] Beginning execution."),function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure] No reenrollment trigger table. Doing nothing."),d[1]=c.createArray(),void 0!==void 0?d[8]=(d[1].push(void 0),d[1]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure","No reenrollment trigger table. Doing nothing.",d[1],c.i64.cast([0,3]))},function(a){return d[2]=c.i64.of_float(Date.now()),d[3]=c.i64.random(),d[5]="Finishing execution. Execution time: ",d[6]=c.i64.to_string(c.i64.sub(d[2],d[0])),d[7]=" ms",d[4]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure] ",d[4],d[5],d[4],d[6],d[4],d[7]].join("")),c.i64.eq(c.i64.mod_(d[3],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[8]=",",d[9]=c.createArray(),void 0!==void 0?d[10]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure",[d[5],d[8],d[6],d[8],d[7]].join(""),d[9],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDeleteAndReenrollDeviceStateStoredProcedure",["LSDeleteAndReenrollDeviceState","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDeleteAndReenrollDeviceState"),e.targetDeviceId,e.reenrollmentReason);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSMEBDeviceReenrollmentReason",[],(function(a,b,c,d,e,f){a=Object.freeze({UNIT_TEST:1,UPLOAD_FAILED_WITH_NO_DEVICE_FOUND:2,LOCAL_DEVICE_ID_NOT_IN_FETCH_BACKUPS_RESULT:3,RESTORE_FAILED_WITH_NO_DEVICE_FOUND:4,EPOCH_DOWNLOAD_UNRECOVERABLE_ERROR:5,OPT_OUT_DELTA_FROM_DEVICE_PRUNING:6,UPLOAD_FAILED_WITH_INCORRECT_FINGERPRINT_FROM_CORRUPT_EPOCH:7,INIT_SEV_REMEDIATION:8,INIT_SEV_REMEDIATION_V2:9,GRAPHQL_INIT_SEV_REMEDIATION:10,DELETE_DELTA_TRIGGER:11});f["default"]=a}),66);
__d("LSDecryptSupplementalKey",["LSArrayGetObjectAt","LSBase64Decode.nop","LSCreateDerivedKeys.nop","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateDecryptedData.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptSupplementalKey] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.nativeOperation(b("LSBase64Decode.nop"),a[0]).then(function(a){return a=a,d[2]=a[0],a})},function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[1],c.i64.cast([0,0])).then(function(a){return a=a,d[3]=a[0],d[4]=a[1],a})},function(a){return c.blobs.neq(d[2],void 0)?c.sequence([function(a){return d[13]=d[3].get("epoch_root_key"),d[14]=c.createArray(),d[21]=(d[14].push(c.i64.cast([0,32])),d[14]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5zdXBwbGVtZW50YWxfZW5jX2tleQ=="),void 0,d[13],d[14]).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[15]!==void 0?c.sequence([function(a){return d[21]=c.i64.of_int32(d[15].length),c.i64.ge(d[21],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[15],c.i64.cast([0,0])).then(function(a){return a=a,d[23]=a[0],d[24]=a[1],a})},function(a){return d[22]=d[23]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[23]=c.createArray(),void 0!==void 0?d[24]=(d[23].push(void 0),d[23]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[23],c.i64.cast([0,3]))},function(a){return d[22]=void 0}])},function(a){return d[16]=d[22]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[21]=c.createArray(),void 0!==void 0?d[22]=(d[21].push(void 0),d[21]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[21],c.i64.cast([0,3]))},function(a){return d[16]=void 0}])},function(a){return c.blobs.neq(d[16],void 0)?d[17]=!0:d[17]=!1,d[17]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedData.nop"),d[16],c.blob("c3VwcGxlbWVudGFsX2VuY19hYWQ="),d[2]).then(function(a){return a=a,d[18]=a[0],a})},function(a){return c.blobs.neq(d[18],void 0)?(a=[c.blobs.to_string(d[18]),void 0],d[19]=a[0],d[20]=a[1],a):(d[21]=new c.Map(),d[21].set("error_code",c.i64.cast([0,109])),d[21].set("stored_procedure","LSEncryptedBackupsDecryptSupplementalKeyStoredProcedure"),d[21].set("error_message",""),a=[void 0,d[21]],d[19]=a[0],d[20]=a[1],a),a=[d[19],d[20]],d[5]=a[0],d[6]=a[1],a}]):c.resolve((d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,109])),d[13].set("stored_procedure","LSEncryptedBackupsDecryptSupplementalKeyStoredProcedure"),d[13].set("error_message",""),a=[void 0,d[13]],d[5]=a[0],d[6]=a[1],a))},function(a){return d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptSupplementalKey] ",d[9],d[10],d[9],d[11],d[9],d[12]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[13]=",",d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptSupplementalKey",[d[10],d[13],d[11],d[13],d[12]].join(""),d[14],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[5],d[6]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDecryptSupplementalKeyStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDecryptMessageProtobufs",["LSArrayGetObjectAt","LSDecryptProtobuf","LSDecryptSupplementalKey","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptMessageProtobufs] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var g=e.done;e=e.value;return g?(d[11]=new c.Map(),d[11].set("error_code",c.i64.cast([0,1])),d[11].set("stored_procedure","LSEncryptedBackupsDecryptMessageProtobufsStoredProcedure"),d[11].set("error_message",""),g=[void 0,d[11]],d[2]=g[0],d[3]=g[1],g):(f=e.item,c.sequence([function(a){return d[19]=f.backupId,d[18]=f.backupTenancy,d[17]=f.encryptionVersion,d[11]=void 0,c.i64.neq(d[11],void 0)?c.resolve(d[12]=d[11]):c.sequence([function(a){return d[20]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[30]=(d[20].push(c.i64.cast([0,0])),d[20]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[22]?d[30]=(d[20].push(c.i64.cast([0,2])),d[20]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[23]?d[30]=(d[20].push(c.i64.cast([0,3])),d[20]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[30]=(d[20].push(c.i64.cast([0,4])),d[20]):0,d[25]=c.createArray(),d[26]=c.i64.of_int32(d[20].length),c.i64.gt(d[26],c.i64.cast([0,0]))?c.loopAsync(d[26],function(a){return d[30]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[20],d[30]).then(function(a){return a=a,d[31]=a[0],d[32]=a[1],a})},function(a){return d[33]=(d[25].push(d[31]),d[25])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[30]=c.createArray(),d[31]=c.i64.of_int32(d[25].length),c.i64.gt(d[31],c.i64.cast([0,0]))?c.loopAsync(d[31],function(a){return d[33]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[25],d[33]).then(function(a){return a=a,d[34]=a[0],d[35]=a[1],a})},function(a){return d[36]=(d[30].push(c.i64.to_string(d[34])),d[30])}])}):c.resolve()},function(a){return d[32]=d[30].join(","),d[27]=d[32]}])},function(a){return d[25].some(function(a){return c.i64.eq(d[17],a)})?d[28]=d[17]:d[28]=void 0,c.i64.neq(d[28],void 0)?d[29]=d[28]:d[29]=void 0,d[12]=d[29]}])},function(e){return c.i64.neq(d[12],void 0)?d[13]=d[12]:d[13]=c.i64.cast([0,0]),c.i64.neq(d[18],void 0)?d[14]=d[18]:d[14]=c.i64.cast([0,1]),c.i64.neq(f.deviceId,void 0)?c.sequence([function(e){return d[20]=c.createArray(),d[21]=c.createArray(),d[22]=new c.Map(),d[23]=c.i64.of_int32(a[0].length),c.i64.gt(d[23],c.i64.cast([0,0]))?c.loopAsync(d[23],function(e){return d[27]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[27]).then(function(a){return a=a,d[28]=a[0],d[29]=a[1],a})},function(a){return d[30]=d[28].get("encrypted_protobufs"),d[31]=d[30].get("toplevel_protobuf"),d[32]=d[31].get("epoch_id"),d[33]=d[31].get("epoch_anon_id"),d[34]=d[22].get(c.blobs.to_string(d[33])),d[34]!==void 0?c.resolve(d[35]=d[34]):c.sequence([function(a){return c.i64.neq(d[32],void 0)?c.sequence([function(a){return d[42]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch([[[d[32]]]]),function(a){return c.i64.eq(a.backupId,d[19])&&c.i64.eq(a.epochId,d[32])&&c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[43]=new c.Map(),d[43].set("epoch_root_key",a.epochRootKeyBlob),d[43].set("epoch_anon_id",a.epochAnonIdBlob),d[44]=(d[42].push(d[43]),d[42])})},function(a){return d[41]=d[42]}]):c.sequence([function(a){return d[42]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch([[[d[19]]],"fk_secure_encrypted_backups_client_state"]),function(a){return c.i64.eq(a.backupId,d[19])&&c.blobs.eq(a.epochAnonIdBlob,d[33])&&c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[43]=new c.Map(),d[43].set("epoch_root_key",a.epochRootKeyBlob),d[43].set("epoch_anon_id",a.epochAnonIdBlob),d[44]=(d[42].push(d[43]),d[42])})},function(a){return d[41]=d[42]}])},function(a){return d[35]=d[41]}])},function(e){return d[36]=d[31].get("epoch_anon_id"),d[22].set(c.blobs.to_string(d[36]),d[35]),d[37]=d[31].get("encrypted_protobuf"),d[38]=d[31].get("encryption_version"),c.storedProcedure(b("LSDecryptProtobuf"),d[37],d[38],a[1],d[35]).then(function(a){return a=a,d[39]=a[0],d[40]=a[1],a})},function(e){return c.blobs.neq(d[39],void 0)?c.sequence([function(e){return d[41]=d[28].get("encrypted_protobufs"),d[42]=d[41].get("supplemental_protobufs"),d[43]=new c.Map(),d[44]=d[42].keys(),d[45]=c.i64.of_int32(d[44].length),c.i64.gt(d[45],c.i64.cast([0,0]))?c.loopAsync(d[45],function(e){return d[51]=e,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[44],d[51]).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],a})},function(e){return d[54]=d[42].get(d[52]),d[54]!==void 0?c.sequence([function(a){return d[55]=d[54].get("epoch_id"),d[56]=d[54].get("epoch_anon_id"),d[57]=d[22].get(c.blobs.to_string(d[56])),d[57]!==void 0?c.resolve(d[58]=d[57]):c.sequence([function(a){return c.i64.neq(d[55],void 0)?c.sequence([function(a){return d[64]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch([[[d[55]]]]),function(a){return c.i64.eq(a.backupId,d[19])&&c.i64.eq(a.epochId,d[55])&&c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[65]=new c.Map(),d[65].set("epoch_root_key",a.epochRootKeyBlob),d[65].set("epoch_anon_id",a.epochAnonIdBlob),d[66]=(d[64].push(d[65]),d[64])})},function(a){return d[63]=d[64]}]):c.sequence([function(a){return d[64]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch([[[d[19]]],"fk_secure_encrypted_backups_client_state"]),function(a){return c.i64.eq(a.backupId,d[19])&&c.blobs.eq(a.epochAnonIdBlob,d[56])&&c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[65]=new c.Map(),d[65].set("epoch_root_key",a.epochRootKeyBlob),d[65].set("epoch_anon_id",a.epochAnonIdBlob),d[66]=(d[64].push(d[65]),d[64])})},function(a){return d[63]=d[64]}])},function(a){return d[58]=d[63]}])},function(a){return d[59]=d[54].get("epoch_anon_id"),d[22].set(c.blobs.to_string(d[59]),d[58]),d[60]=d[54].get("sk_ciphertext"),c.storedProcedure(b("LSDecryptSupplementalKey"),d[60]==null?"":d[60],d[58]).then(function(a){return a=a,d[61]=a[0],d[62]=a[1],a})},function(e){return d[61]!==void 0?c.sequence([function(e){return d[63]=d[54].get("encrypted_protobuf"),d[64]=d[54].get("encryption_version"),c.storedProcedure(b("LSDecryptProtobuf"),d[63],d[64],a[1],d[58]).then(function(a){return a=a,d[65]=a[0],d[66]=a[1],a})},function(a){return c.blobs.neq(d[65],void 0)?(d[67]=d[54].get("protobuf_timestamp_ms"),d[68]=new c.Map(),d[68].set("decrypted_protobuf",d[65]),d[68].set("protobuf_timestamp_ms",d[67]),d[43].set(d[61],d[68])):d[67]=(d[21].push(d[66]),d[21])}]):c.resolve((d[63]=new c.Map(),d[63].set("error_code",c.i64.cast([0,109])),d[63].set("stored_procedure","LSEncryptedBackupsDecryptMessageProtobufsStoredProcedure"),d[63].set("error_message",""),d[64]=(d[21].push(d[63]),d[21])))}]):c.resolve()}])}):c.resolve()},function(a){return d[46]=d[28].get("otid"),d[47]=d[31].get("protobuf_timestamp_ms"),d[48]=new c.Map(),d[48].set("decrypted_protobuf",d[39]),d[48].set("protobuf_timestamp_ms",d[47]),d[49]=d[28].get("message_tags"),d[50]=new c.Map(),d[50].set("otid",d[46]),d[50].set("toplevel_protobuf",d[48]),d[50].set("supplemental_protobufs",d[43]),d[50].set("message_tags",d[49]),d[51]=(d[20].push(d[50]),d[20])}]):c.resolve(d[41]=(d[21].push(d[40]),d[21]))}])}):c.resolve()},function(a){return d[24]=c.i64.of_int32(d[21].length),c.i64.gt(d[24],c.i64.cast([0,0]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[21],c.i64.cast([0,0])).then(function(a){return a=a,d[27]=a[0],d[28]=a[1],a})},function(a){return a=[void 0,d[27]],d[25]=a[0],d[26]=a[1],a}]):c.resolve((a=[d[20],void 0],d[25]=a[0],d[26]=a[1],a))},function(a){return a=[d[25],d[26]],d[15]=a[0],d[16]=a[1],a}]):c.resolve((d[20]=new c.Map(),d[20].set("error_code",c.i64.cast([0,24])),d[20].set("stored_procedure","LSEncryptedBackupsDecryptMessageProtobufsStoredProcedure"),d[20].set("error_message",""),e=[void 0,d[20]],d[15]=e[0],d[16]=e[1],e))},function(a){return a=[d[15],d[16]],d[2]=a[0],d[3]=a[1],a}]))})},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptMessageProtobufs] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptMessageProtobufs",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDecryptMessageProtobufsStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSDecryptMessageProtobufsStoredProcedure",["LSDecryptMessageProtobufs","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDecryptMessageProtobufs"),e.encryptedMessagesWithProtobufs,e.actThreadId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSSymmetricEncryptionCreateDecryptedString.nop",["Base64Utils","CryptoLogger","LSResult","LSSymmetricEncryptionCreateDecryptedData.nop","XPlatReactTextDecoder"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return c("LSResult")(a)}a=function(a,b,e,f,g){var i=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_decrypted_string");g=d("Base64Utils").toArrayBuffer(g);return c("LSSymmetricEncryptionCreateDecryptedData.nop")(a,b,e,f,g).then(function(a){a=a[0];return a}).then(function(a){return a==null?h():h(new(d("XPlatReactTextDecoder").TextDecoder)().decode(a))})["catch"](function(a){d("CryptoLogger").captureError(i,a).mustfix("symmetric string decryption failed");return h()})};g["default"]=a}),98);
__d("LSDecryptMessageV2",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSIsMobileClient","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateDecryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptMessageV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[8]=a[2]==null?c.i64.cast([0,0]):a[2],d[2]=c.i64.of_int32(a[3].length),c.i64.eq(d[2],c.i64.cast([0,1]))?c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[3],c.i64.cast([0,0])).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(e){return d[14]=d[12].get("epoch_anon_id"),d[15]=d[12].get("epoch_root_key"),d[16]=c.createArray(),d[26]=(d[16].push(c.i64.cast([0,32])),d[16]),c.i64.ge(d[8],c.i64.cast([0,3]))?c.resolve(d[17]=void 0):c.sequence([function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[1]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[17]=d[26]}])},function(e){return c.i64.ge(d[8],c.i64.cast([0,4]))?(d[26]="_",d[18]=["message_key_in_epoch",d[26],c.blobs.to_string(d[14]),d[26],"cipher_version",d[26],c.i64.to_string(d[8]),d[26],"thread",d[26],a[1]==null?"":a[1]].join("")):(c.i64.ge(d[8],c.i64.cast([0,3]))?(d[27]="_",d[26]=["message_key_in_epoch",d[27],c.blobs.to_string(d[14]),d[27],"cipher_version",d[27],c.i64.to_string(d[8]),d[27],"thread",d[27],a[1]==null?"":a[1]].join("")):(c.i64.ge(d[8],c.i64.cast([0,2]))?(d[28]="_",d[27]=["message_key_in_epoch",d[28],c.blobs.to_string(d[14]),d[28],"cipher_version",d[28],c.i64.to_string(d[8])].join("")):d[27]=["message_key_in_epoch","_",c.blobs.to_string(d[14])].join(""),d[26]=d[27]),d[18]=d[26]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[18]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[19],d[17],d[15],d[16]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[21]=!1:d[21]=!0,d[21]?c.resolve(d[22]=void 0):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[20],c.i64.cast([0,0])).then(function(a){return a=a,d[26]=a[0],d[27]=a[1],a})},function(a){return d[22]=d[26]}])},function(e){return c.blobs.neq(d[22],void 0)?c.sequence([function(e){return c.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),d[22],c.blobs.of_string(["message_thread","_",a[1]].join("")),a[0]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]!==void 0?c.resolve(d[27]=d[26]):c.sequence([function(a){return d[28]=["Failed to decrypt message. Epoch Anon ID: ",c.blobs.to_string(d[14]),", Encryption Version: ",c.i64.to_string(d[8])].join(""),function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDecryptMessageV2StoredProcedure] ","",d[28]].join("")),d[29]=c.createArray(),void 0!==void 0?d[30]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptMessageV2StoredProcedure",[d[28]].join(""),d[29],c.i64.cast([0,3]))},function(a){return d[27]=void 0}])},function(a){return d[23]=d[27]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptMessageV2StoredProcedure] Decryption message key is null"),void 0!==void 0?c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,85]),c.i64.cast([0,2]),"[EncryptedBackups][LSEncryptedBackupsDecryptMessageV2StoredProcedure] Decryption message key is null",void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[27]=a[0],a})},function(a){return d[27]?d[28]=!0:d[28]=!1,d[28]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[29]=c.createArray(),void 0!==void 0?d[30]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[29],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptMessageV2StoredProcedure","Decryption message key is null",d[26],c.i64.cast([0,3]))},function(a){return d[23]=void 0}])},function(a){return d[23]!==void 0?(a=[d[23],void 0],d[24]=a[0],d[25]=a[1],a):(d[26]=new c.Map(),d[26].set("error_code",c.i64.cast([0,101])),d[26].set("stored_procedure","LSEncryptedBackupsDecryptMessageV2StoredProcedure"),d[26].set("error_message",""),a=[void 0,d[26]],d[24]=a[0],d[25]=a[1],a),a=[d[24],d[25]],d[3]=a[0],d[4]=a[1],a}]):c.resolve((d[12]=c.i64.of_int32(a[3].length),c.i64.eq(d[12],c.i64.cast([0,0]))?(d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,102])),d[15].set("stored_procedure","LSEncryptedBackupsDecryptMessageV2StoredProcedure"),d[15].set("error_message",""),e=[void 0,d[15]],d[13]=e[0],d[14]=e[1],e):(d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,103])),d[15].set("stored_procedure","LSEncryptedBackupsDecryptMessageV2StoredProcedure"),d[15].set("error_message",""),e=[void 0,d[15]],d[13]=e[0],d[14]=e[1],e),e=[d[13],d[14]],d[3]=e[0],d[4]=e[1],e))},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[11]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptMessageV2] ",d[7],d[9],d[7],d[10],d[7],d[11]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptMessageV2",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[3],d[4]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDecryptMessageV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDecryptMessages",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSDecryptMessageV2","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptMessages] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var g=e.done;e=e.value;return g?(d[11]=new c.Map(),d[11].set("error_code",c.i64.cast([0,1])),d[11].set("stored_procedure","LSEncryptedBackupsDecryptMessagesStoredProcedure"),d[11].set("error_message",""),g=[void 0,d[11]],d[2]=g[0],d[3]=g[1],g):(f=e.item,c.sequence([function(a){return d[19]=f.backupId,d[20]=f.deviceId,d[18]=f.backupTenancy,d[17]=f.encryptionVersion,d[11]=void 0,c.i64.neq(d[11],void 0)?c.resolve(d[12]=d[11]):c.sequence([function(a){return d[21]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[22]?d[31]=(d[21].push(c.i64.cast([0,0])),d[21]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[23]?d[31]=(d[21].push(c.i64.cast([0,2])),d[21]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[31]=(d[21].push(c.i64.cast([0,3])),d[21]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[25]=a[0],a})},function(a){return d[25]?d[31]=(d[21].push(c.i64.cast([0,4])),d[21]):0,d[26]=c.createArray(),d[27]=c.i64.of_int32(d[21].length),c.i64.gt(d[27],c.i64.cast([0,0]))?c.loopAsync(d[27],function(a){return d[31]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[21],d[31]).then(function(a){return a=a,d[32]=a[0],d[33]=a[1],a})},function(a){return d[34]=(d[26].push(d[32]),d[26])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[31]=c.createArray(),d[32]=c.i64.of_int32(d[26].length),c.i64.gt(d[32],c.i64.cast([0,0]))?c.loopAsync(d[32],function(a){return d[34]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[26],d[34]).then(function(a){return a=a,d[35]=a[0],d[36]=a[1],a})},function(a){return d[37]=(d[31].push(c.i64.to_string(d[35])),d[31])}])}):c.resolve()},function(a){return d[33]=d[31].join(","),d[28]=d[33]}])},function(a){return d[26].some(function(a){return c.i64.eq(d[17],a)})?d[29]=d[17]:d[29]=void 0,c.i64.neq(d[29],void 0)?d[30]=d[29]:d[30]=void 0,d[12]=d[30]}])},function(e){return c.i64.neq(d[12],void 0)?d[13]=d[12]:d[13]=c.i64.cast([0,0]),c.i64.neq(d[18],void 0)?d[14]=d[18]:d[14]=c.i64.cast([0,1]),c.i64.neq(d[20],void 0)?c.sequence([function(e){return d[21]=c.createArray(),d[22]=c.createArray(),d[23]=new c.Map(),d[24]=c.i64.of_int32(a[0].length),c.i64.gt(d[24],c.i64.cast([0,0]))?c.loopAsync(d[24],function(e){return d[28]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[28]).then(function(a){return a=a,d[29]=a[0],d[30]=a[1],a})},function(a){return d[31]=d[29].get("epoch_anon_id"),d[32]=d[23].get(c.blobs.to_string(d[31])),d[32]!==void 0?c.resolve(d[33]=d[32]):c.sequence([function(a){return d[38]=d[29].get("epoch_anon_id"),d[39]=d[29].get("epoch_id"),c.i64.neq(d[39],void 0)?c.sequence([function(a){return d[42]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch([[[d[39]]]]),function(a){return c.i64.eq(a.backupId,d[19])&&c.i64.eq(a.epochId,d[39])&&c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[43]=new c.Map(),d[43].set("epoch_root_key",a.epochRootKeyBlob),d[43].set("epoch_anon_id",a.epochAnonIdBlob),d[44]=(d[42].push(d[43]),d[42])})},function(a){return d[40]=d[42]}]):c.sequence([function(a){return d[42]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch([[[d[19]]],"fk_secure_encrypted_backups_client_state"]),function(a){return c.i64.eq(a.backupId,d[19])&&c.blobs.eq(a.epochAnonIdBlob,d[38])&&c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[43]=new c.Map(),d[43].set("epoch_root_key",a.epochRootKeyBlob),d[43].set("epoch_anon_id",a.epochAnonIdBlob),d[44]=(d[42].push(d[43]),d[42])})},function(a){return d[40]=d[42]}])},function(a){return d[41]=c.i64.of_int32(d[40].length),c.i64.gt(d[41],c.i64.cast([0,0]))?(d[42]=d[29].get("epoch_anon_id"),d[23].set(c.blobs.to_string(d[42]),d[40])):0,d[33]=d[40]}])},function(e){return d[34]=d[29].get("value"),d[35]=d[29].get("encryption_version"),c.storedProcedure(b("LSDecryptMessageV2"),d[34],a[1],d[35],d[33]).then(function(a){return a=a,d[36]=a[0],d[37]=a[1],a})},function(a){return d[36]!==void 0?c.resolve((d[38]=d[29].get("otid"),d[39]=new c.Map(),d[39].set("value",d[36]),d[39].set("otid",d[38]),d[40]=(d[21].push(d[39]),d[21]))):c.sequence([function(a){return d[37]!==void 0?c.sequence([function(a){return d[38]=c.i64.of_int32(d[33].length),c.i64.gt(d[38],c.i64.cast([0,0]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[33],c.i64.cast([0,0])).then(function(a){return a=a,d[49]=a[0],d[50]=a[1],a})},function(a){return d[51]=d[49].get("epoch_root_key"),d[52]=c.createArray(),d[57]=(d[52].push(c.i64.cast([0,18])),d[52]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[51],d[52]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[53]!==void 0?c.sequence([function(a){return d[57]=c.i64.of_int32(d[53].length),c.i64.ge(d[57],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[53],c.i64.cast([0,0])).then(function(a){return a=a,d[59]=a[0],d[60]=a[1],a})},function(a){return d[58]=d[59]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[59]=c.createArray(),void 0!==void 0?d[60]=(d[59].push(void 0),d[59]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[59],c.i64.cast([0,3]))},function(a){return d[58]=void 0}])},function(a){return d[54]=d[58]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[57]=c.createArray(),void 0!==void 0?d[58]=(d[57].push(void 0),d[57]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[57],c.i64.cast([0,3]))},function(a){return d[54]=void 0}])},function(a){return c.blobs.neq(d[54],void 0)?d[55]=!0:d[55]=!1,d[55]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.blobs.neq(d[54],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[54]).then(function(a){return a=a,d[57]=a[0],a})},function(a){return d[56]=d[57]==null?"[encodingFailed]":d[57]}]):c.resolve(d[56]="[null]")},function(a){return d[39]=d[56]}]):c.resolve(d[39]="[noEpochs]")},function(a){return d[40]=d[29].get("otid"),d[41]=d[29].get("epoch_anon_id"),d[42]=d[29].get("encryption_version"),c.i64.neq(d[42],void 0)?d[43]=c.i64.to_string(d[42]):d[43]="null",d[44]=c.i64.of_int32(d[33].length),d[45]=d[29].get("epoch_fingerprint"),c.blobs.neq(d[45],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[45]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[46]=d[49]==null?"[encodingFailed]":d[49]}]):c.resolve(d[46]="[null]")},function(a){return d[47]=d[29].get("backup_id"),d[48]="",d[37].set("error_message",["Decryption failed for message with otid:",d[48],d[40],d[48]," epoch:",d[48],c.blobs.to_string(d[41]),d[48]," version:",d[48],d[43],d[48]," epoch_key_count:",d[48],c.i64.to_string(d[44]),d[48]," vsr_fingerprint:",d[48],d[46],d[48]," local_fingerprint:",d[48],d[39],d[48]," vsr_backup_id:",d[48],c.i64.to_string(d[47])==null?"[null]":c.i64.to_string(d[47]),d[48]," local_backup_id:",d[48],c.i64.to_string(d[19]),d[48]," local_device_id:",d[48],c.i64.to_string(d[20])].join(""))}]):c.resolve()},function(a){return d[38]=(d[22].push(d[37]),d[22])}])}])}):c.resolve()},function(a){return d[25]=c.i64.of_int32(d[22].length),c.i64.gt(d[25],c.i64.cast([0,0]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[22],c.i64.cast([0,0])).then(function(a){return a=a,d[28]=a[0],d[29]=a[1],a})},function(a){return a=[void 0,d[28]],d[26]=a[0],d[27]=a[1],a}]):c.resolve((a=[d[21],void 0],d[26]=a[0],d[27]=a[1],a))},function(a){return a=[d[26],d[27]],d[15]=a[0],d[16]=a[1],a}]):c.resolve((d[21]=new c.Map(),d[21].set("error_code",c.i64.cast([0,24])),d[21].set("stored_procedure","LSEncryptedBackupsDecryptMessagesStoredProcedure"),d[21].set("error_message",""),e=[void 0,d[21]],d[15]=e[0],d[16]=e[1],e))},function(a){return a=[d[15],d[16]],d[2]=a[0],d[3]=a[1],a}]))})},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptMessages] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptMessages",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDecryptMessagesStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSDecryptMessagesStoredProcedure",["LSDecryptMessages","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDecryptMessages"),e.encryptedMessages,e.actThreadId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSGetNextEpochAnonId.nop",["CryptoLogger","LSCryptoUtils","LSResult","Promise","XPlatReactTextDecoder"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f){a=d("LSCryptoUtils").strToBuf("0");if(f!=null){e=f;if(e.byteLength===0)f=a;else{var g=new(d("XPlatReactTextDecoder").TextDecoder)();g=g.decode(e);e=Number.parseInt(g,10);g=e+1;f=d("LSCryptoUtils").strToBuf(String(g))}}else f=a;return(h||(h=b("Promise"))).resolve(c("LSResult")(f))["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("get_next_epoch_anonid"),a).mustfix("Getting next epoch anon id failed");throw a})};g["default"]=a}),98);
__d("PublicKeyEncryptionUtils",["Promise","UInt8Array","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){}function c(a){if(a!=null)return a;else return new Uint8Array(0).buffer}function e(a,b,c,e,f){return d("UInt8Array").concatBytes([a,b,c,e,f]).buffer}function f(a,b,c,e){return d("XPlatReactCrypto").subtleImportKey("raw",a.buffer,"HKDF",!1,["deriveKey"]).then(function(a){return d("XPlatReactCrypto").subtleDeriveKey({hash:"SHA-256",info:c,name:"HKDF",salt:b},a,{length:256,name:"AES-GCM"},!1,[e])})}var i="key length is not "+32;function j(a,b){if(a.length!==32)return b(i)}function k(a){return new(h||(h=b("Promise")))(function(b,c){j(a,c);return b()})}var l=32;g.assertValidCurvePoint=a;g.getSalt=c;g.concatAad=e;g.getAesKey=f;g.testKeyLength=j;g.assertKeyLength=k;g.keyLength=l}),98);
__d("LSPublicEncryptionCreateDecryptedData.nop",["CryptoLogger","Promise","PublicKeyEncryptionUtils","RetUtil","XPlatReactCrypto","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("PublicKeyCrypto").__setRef("LSPublicEncryptionCreateDecryptedData.nop"),j=c("requireDeferred")("X25519").__setRef("LSPublicEncryptionCreateDecryptedData.nop");function k(a,b){var c=1+d("PublicKeyEncryptionUtils").keyLength+16;a=a.length;a<1+d("PublicKeyEncryptionUtils").keyLength+16&&b("CipherText length is "+a+", < "+c)}function l(a,b,c){b=b[0];if(b!==a)return c("Unexpected version "+b)}function m(a){return new(h||(h=b("Promise")))(function(b,c){l(1,a,c);k(a,c);return b()})}function n(a,c){return new(h||(h=b("Promise")))(function(b,e){d("PublicKeyEncryptionUtils").assertValidCurvePoint(a,e);d("PublicKeyEncryptionUtils").assertValidCurvePoint(c,e);return b()})}a=function(a,c,e,f,g,k,l,o){var p=new Uint8Array(l),q=new Uint8Array([1]),r=d("PublicKeyEncryptionUtils").getSalt(k),s=new Uint8Array(e),t=new Uint8Array(g),u=new Uint8Array(f),v=new Uint8Array(o);return(h||(h=b("Promise"))).all([d("PublicKeyEncryptionUtils").assertKeyLength(s),d("PublicKeyEncryptionUtils").assertKeyLength(u),d("PublicKeyEncryptionUtils").assertKeyLength(t)]).then(function(){return m(v)}).then(function(){return j.load()}).then(function(a){var c=v.slice(1,d("PublicKeyEncryptionUtils").keyLength+1),e=a.publicKeyFromBytes(c,a.KeyPurpose.Encryption);return n(e,t).then(function(){var f=d("PublicKeyEncryptionUtils").concatAad(q,t,s,c,p),g=function(c,d,f){c=a.publicKeyFromBytes(c,a.KeyPurpose.Encryption);d=a.publicKeyFromBytes(d,a.KeyPurpose.Encryption);f=a.secretKeyFromBytes(f,a.KeyPurpose.Encryption);return c==null||d==null||f==null||e==null?(h||(h=b("Promise"))).resolve():(h||(h=b("Promise"))).resolve([c,d,f,e])};return g(s,t,u).then(function(a){if(a==null)return;return{ephemeralPub:a[3],innerAad:f,receiverPriv:a[2],receiverPub:a[0],senderPub:a[1]}})})}).then(function(a){if(a==null)return;var b=a.ephemeralPub,c=a.receiverPriv,e=a.senderPub,f=a.innerAad;return i.load().then(function(a){return a.receiverDeriveSharedSecret(c,b,e)}).then(function(a){if(a==null)return null;else return d("PublicKeyEncryptionUtils").getAesKey(a,r,f,"decrypt")}).then(function(a){if(a==null)return;var b=new Uint8Array(12).buffer,c=v.slice(d("PublicKeyEncryptionUtils").keyLength+1).buffer;return d("XPlatReactCrypto").subtleDecrypt({additionalData:f,iv:new Uint8Array(b),name:"AES-GCM",tagLength:128},a,c)})}).then(function(a){return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(a))})["catch"](function(a){var c=d("CryptoLogger").CryptoLogger("public_encryption_create_decrypted_data");d("CryptoLogger").captureError(c,a).mustfix("Creation of decrypted data for public encryption failed");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(void 0))})};g["default"]=a}),98);
__d("LSDeriveAndStoreEpochs",["LSArrayGetObjectAt","LSBase64Decode.nop","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSGetNextEpochAnonId.nop","LSIsEncryptionVersionSecure","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSPublicEncryptionCreateDecryptedData.nop","LSSymmetricEncryptionCreateDecryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] Beginning execution."),d[1]=c.i64.of_int32(a[0].length),c.i64.gt(d[1],c.i64.cast([0,0]))?c.sequence([function(e){return d[8]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] Unable to load client state: 1"),d[21]=c.createArray(),void 0!==void 0?d[24]=(d[21].push(void 0),d[21]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure","Unable to load client state: 1",d[21],c.i64.cast([0,3]))},function(e){return d[22]=c.createArray(),d[23]=c.i64.of_int32(a[0].length),c.i64.gt(d[23],c.i64.cast([0,0]))?c.loopAsync(d[23],function(e){return d[24]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[24]).then(function(a){return a=a,d[25]=a[0],d[26]=a[1],a})},function(a){return d[27]=d[25].get("from_epoch"),d[28]=d[27].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[28]).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]!==void 0?d[30]=d[29]:d[30]="",d[31]=d[25].get("from_epoch"),d[32]=d[31].get("epoch_id"),d[33]=new c.Map(),d[33].set("anon_id",d[30]),d[33].set("epoch_id",d[32]),d[34]=d[25].get("to_epoch"),d[35]=d[34].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[35]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]!==void 0?d[37]=d[36]:d[37]="",d[38]=d[25].get("to_epoch"),d[39]=d[38].get("epoch_id"),d[40]=new c.Map(),d[40].set("anon_id",d[37]),d[40].set("epoch_id",d[39]),d[41]=d[25].get("forward_edge"),d[41]?d[42]=!1:d[42]=!0,d[42]?d[43]=!1:d[43]=!0,d[44]=d[25].get("backward_edge"),c.blobs.neq(d[44],void 0)?d[45]=!0:d[45]=!1,d[46]=new c.Map(),d[46].set("from",d[33]),d[46].set("to",d[40]),d[46].set("has_forward_edge",d[43]),d[46].set("has_backward_edge",d[45]),d[46].set("result_code",c.i64.cast([0,7])),d[46].set("error_message",void 0),d[47]=(d[22].push(d[46]),d[22])}])}):c.resolve()},function(b){return b=[void 0,void 0,void 0,a[2],c.i64.cast([0,0]),c.i64.cast([0,0]),d[22]],d[9]=b[0],d[10]=b[1],d[11]=b[2],d[12]=b[3],d[13]=b[4],d[14]=b[5],d[15]=b[6],b}]):(f=e.item,c.sequence([function(a){return d[35]=f.epochStoragePublicKeyBlob,d[34]=f.deviceId,d[33]=f.backupTenancy,d[32]=f.encryptionVersion,d[21]=void 0,c.i64.neq(d[21],void 0)?c.resolve(d[22]=d[21]):c.sequence([function(a){return d[36]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[37]?d[46]=(d[36].push(c.i64.cast([0,0])),d[36]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[38]?d[46]=(d[36].push(c.i64.cast([0,2])),d[36]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[39]=a[0],a})},function(a){return d[39]?d[46]=(d[36].push(c.i64.cast([0,3])),d[36]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[40]=a[0],a})},function(a){return d[40]?d[46]=(d[36].push(c.i64.cast([0,4])),d[36]):0,d[41]=c.createArray(),d[42]=c.i64.of_int32(d[36].length),c.i64.gt(d[42],c.i64.cast([0,0]))?c.loopAsync(d[42],function(a){return d[46]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[36],d[46]).then(function(a){return a=a,d[47]=a[0],d[48]=a[1],a})},function(a){return d[49]=(d[41].push(d[47]),d[41])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[46]=c.createArray(),d[47]=c.i64.of_int32(d[41].length),c.i64.gt(d[47],c.i64.cast([0,0]))?c.loopAsync(d[47],function(a){return d[49]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[41],d[49]).then(function(a){return a=a,d[50]=a[0],d[51]=a[1],a})},function(a){return d[52]=(d[46].push(c.i64.to_string(d[50])),d[46])}])}):c.resolve()},function(a){return d[48]=d[46].join(","),d[43]=d[48]}])},function(a){return d[41].some(function(a){return c.i64.eq(d[32],a)})?d[44]=d[32]:d[44]=void 0,c.i64.neq(d[44],void 0)?d[45]=d[44]:d[45]=void 0,d[22]=d[45]}])},function(e){return c.i64.neq(d[22],void 0)?d[23]=d[22]:d[23]=c.i64.cast([0,0]),c.i64.neq(d[33],void 0)?d[24]=d[33]:d[24]=c.i64.cast([0,1]),c.i64.neq(d[34],void 0)?c.sequence([function(b){return c.i64.neq(a[1],void 0)?c.sequence([function(b){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(e,f){var b=e.done;e=e.value;return b?d[44]=!1:(f=e.item,d[47]=f.deviceId,c.i64.neq(d[47],void 0)?d[46]=c.i64.neq(d[47],a[1]):d[46]=!1,d[44]=d[46])})},function(a){return d[36]=d[44]}]):c.resolve(d[36]=!1)},function(e){return d[36]?c.sequence([function(e){return d[44]=c.createArray(),d[45]=c.i64.of_int32(a[0].length),c.i64.gt(d[45],c.i64.cast([0,0]))?c.loopAsync(d[45],function(e){return d[46]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[46]).then(function(a){return a=a,d[47]=a[0],d[48]=a[1],a})},function(a){return d[49]=d[47].get("from_epoch"),d[50]=d[49].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[50]).then(function(a){return a=a,d[51]=a[0],a})},function(a){return d[51]!==void 0?d[52]=d[51]:d[52]="",d[53]=d[47].get("from_epoch"),d[54]=d[53].get("epoch_id"),d[55]=new c.Map(),d[55].set("anon_id",d[52]),d[55].set("epoch_id",d[54]),d[56]=d[47].get("to_epoch"),d[57]=d[56].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[57]).then(function(a){return a=a,d[58]=a[0],a})},function(a){return d[58]!==void 0?d[59]=d[58]:d[59]="",d[60]=d[47].get("to_epoch"),d[61]=d[60].get("epoch_id"),d[62]=new c.Map(),d[62].set("anon_id",d[59]),d[62].set("epoch_id",d[61]),d[63]=d[47].get("forward_edge"),d[63]?d[64]=!1:d[64]=!0,d[64]?d[65]=!1:d[65]=!0,d[66]=d[47].get("backward_edge"),c.blobs.neq(d[66],void 0)?d[67]=!0:d[67]=!1,d[68]=new c.Map(),d[68].set("from",d[55]),d[68].set("to",d[62]),d[68].set("has_forward_edge",d[65]),d[68].set("has_backward_edge",d[67]),d[68].set("result_code",c.i64.cast([0,8])),d[68].set("error_message",void 0),d[69]=(d[44].push(d[68]),d[44])}])}):c.resolve()},function(b){return b=[d[34],d[34],a[1],a[2],c.i64.cast([0,0]),c.i64.cast([0,0]),d[44]],d[37]=b[0],d[38]=b[1],d[39]=b[2],d[40]=b[3],d[41]=b[4],d[42]=b[5],d[43]=b[6],b}]):c.sequence([function(e){return d[44]=c.createArray(),d[45]=c.i64.of_int32(a[0].length),c.i64.gt(d[45],c.i64.cast([0,0]))?c.loopAsync(d[45],function(e){return d[46]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[46]).then(function(a){return a=a,d[47]=a[0],d[48]=a[1],a})},function(a){return d[49]=d[47].get("from_epoch"),d[50]=d[49].get("epoch_id"),c.count(c.db.table(169).fetch([[[d[50]]]])).then(function(a){return d[51]=a})},function(a){return c.i64.le(d[51],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch([[[d[50]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?(d[77]=new c.Map(),d[77].set("error_msg","Expected a nonempty query result"),d[77].set("code",c.i64.cast([0,3])),d[77].set("src_line","MEBEpochClientUtils.php:69 MEBEpochClientUtils::maybeEpoch()"),d[78]=c.createArray(),d[79]=(d[78].push(d[77]),d[78]),a=[void 0,d[78]],d[73]=a[0],d[74]=a[1],a):(e=b.item,d[77]=new c.Map(),d[77].set("epoch_id",e.epochId),d[77].set("backup_id",e.backupId),d[77].set("epoch_anon_id_blob",e.epochAnonIdBlob),d[77].set("epoch_root_key_blob",e.epochRootKeyBlob),d[77].set("epoch_status",e.epochStatus),d[77].set("authority_level",e.authorityLevel),a=[d[77],void 0],d[73]=a[0],d[74]=a[1],a)})},function(a){return d[76]=new c.Map(),d[76].set("value",d[73]),d[76].set("errors",d[74]),d[52]=d[76]}]):c.resolve((d[73]=new c.Map(),d[73].set("error_msg","Expected at most one result"),d[73].set("code",c.i64.cast([0,4])),d[73].set("src_line","MEBEpochClientUtils.php:69 MEBEpochClientUtils::maybeEpoch()"),d[74]=c.createArray(),d[76]=(d[74].push(d[73]),d[74]),d[75]=new c.Map(),d[75].set("value",void 0),d[75].set("errors",d[74]),d[52]=d[75]))},function(a){return d[53]=d[52].get("value"),d[53]!==void 0?(d[73]=d[53].get("epoch_id"),d[74]=d[53].get("backup_id"),d[75]=d[53].get("epoch_anon_id_blob"),d[76]=d[53].get("epoch_root_key_blob"),d[77]=d[53].get("epoch_status"),d[78]=d[53].get("authority_level"),d[54]=d[52]):(d[73]=d[52].get("errors"),d[74]=d[52].get("errors"),d[75]=new c.Map(),d[75].set("error_msg","EB_EPOCH_SRC_EPOCH_MISSING"),d[75].set("code",c.i64.cast([0,10003])),d[75].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:372 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge()"),d[77]=(d[73].push(d[75]),d[73]),d[76]=new c.Map(),d[76].set("value",void 0),d[76].set("errors",d[73]),d[54]=d[76]),d[55]=d[54].get("value"),d[55]!==void 0?(d[73]=d[55].get("epoch_id"),d[74]=d[55].get("backup_id"),d[75]=d[55].get("epoch_anon_id_blob"),d[76]=d[55].get("epoch_root_key_blob"),d[77]=d[55].get("epoch_status"),d[78]=d[55].get("authority_level"),d[79]=d[47].get("from_epoch"),d[80]=d[79].get("epoch_anon_id"),c.blobs.eq(d[80],d[75])?d[81]=d[54]:(d[82]=new c.Map(),d[82].set("error_msg","EB_EPOCH_DERIVATION_SRC_ANON_ID_MISMATCH"),d[82].set("code",c.i64.cast([0,10007])),d[82].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:377 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge#2()"),d[83]=c.createArray(),d[85]=(d[83].push(d[82]),d[83]),d[84]=new c.Map(),d[84].set("value",void 0),d[84].set("errors",d[83]),d[81]=d[84]),d[56]=d[81]):(d[73]=d[54].get("errors"),d[74]=d[54].get("errors"),d[75]=new c.Map(),d[75].set("value",void 0),d[75].set("errors",d[73]),d[56]=d[75]),d[57]=d[56].get("value"),d[57]!==void 0?c.sequence([function(a){return d[73]=d[57].get("epoch_id"),d[74]=d[57].get("backup_id"),d[75]=d[57].get("epoch_anon_id_blob"),d[76]=d[57].get("epoch_root_key_blob"),d[77]=d[57].get("epoch_status"),d[78]=d[57].get("authority_level"),d[79]=d[47].get("from_epoch_fingerprint"),d[80]=c.createArray(),d[85]=(d[80].push(c.i64.cast([0,18])),d[80]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[76],d[80]).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[81]!==void 0?c.sequence([function(a){return d[85]=c.i64.of_int32(d[81].length),c.i64.ge(d[85],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[81],c.i64.cast([0,0])).then(function(a){return a=a,d[87]=a[0],d[88]=a[1],a})},function(a){return d[86]=d[87]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[87]=c.createArray(),void 0!==void 0?d[88]=(d[87].push(void 0),d[87]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[87],c.i64.cast([0,3]))},function(a){return d[86]=void 0}])},function(a){return d[82]=d[86]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[85]=c.createArray(),void 0!==void 0?d[86]=(d[85].push(void 0),d[85]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[85],c.i64.cast([0,3]))},function(a){return d[82]=void 0}])},function(a){return c.blobs.neq(d[82],void 0)?d[83]=!0:d[83]=!1,d[83]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.blobs.eq(d[79],void 0)||c.blobs.eq(d[79],d[82])?d[84]=d[56]:(d[85]=new c.Map(),d[85].set("error_msg","EB_EPOCH_DERIVATION_SRC_FINGERPRINT_MISMATCH"),d[85].set("code",c.i64.cast([0,10002])),d[85].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:386 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge#4()"),d[86]=c.createArray(),d[88]=(d[86].push(d[85]),d[86]),d[87]=new c.Map(),d[87].set("value",void 0),d[87].set("errors",d[86]),d[84]=d[87]),d[58]=d[84]}]):c.resolve((d[73]=d[56].get("errors"),d[74]=d[56].get("errors"),d[75]=new c.Map(),d[75].set("value",void 0),d[75].set("errors",d[73]),d[58]=d[75]))},function(a){return d[59]=d[47].get("forward_edge"),d[59]!==void 0?c.sequence([function(a){return d[73]=d[58].get("value"),d[73]!==void 0?c.sequence([function(a){return d[87]=d[73].get("epoch_id"),d[88]=d[73].get("backup_id"),d[89]=d[73].get("epoch_anon_id_blob"),d[90]=d[73].get("epoch_root_key_blob"),d[91]=d[73].get("epoch_status"),d[92]=d[73].get("authority_level"),c.nativeOperation(b("LSGetNextEpochAnonId.nop"),d[89]).then(function(a){return a=a,d[93]=a[0],a})},function(a){return d[94]=d[47].get("to_epoch"),d[95]=d[94].get("epoch_anon_id"),c.blobs.eq(d[93],d[95])?d[96]=d[58]:(d[97]=new c.Map(),d[97].set("error_msg","EB_EPOCH_FORWARD_EDGE_NOT_CONSECUTIVE"),d[97].set("code",c.i64.cast([0,10009])),d[97].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:104 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge()"),d[98]=c.createArray(),d[100]=(d[98].push(d[97]),d[98]),d[99]=new c.Map(),d[99].set("value",void 0),d[99].set("errors",d[98]),d[96]=d[99]),d[74]=d[96]}]):c.resolve((d[87]=d[58].get("errors"),d[88]=d[58].get("errors"),d[89]=new c.Map(),d[89].set("value",void 0),d[89].set("errors",d[87]),d[74]=d[89]))},function(a){return d[75]=d[74].get("value"),d[75]!==void 0?c.sequence([function(a){return d[87]=d[75].get("epoch_id"),d[88]=d[75].get("backup_id"),d[89]=d[75].get("epoch_anon_id_blob"),d[90]=d[75].get("epoch_root_key_blob"),d[91]=d[75].get("epoch_status"),d[92]=d[75].get("authority_level"),d[93]=d[47].get("from_epoch"),d[94]=d[93].get("epoch_anon_id"),d[95]=d[47].get("from_epoch"),d[96]=d[95].get("epoch_id"),d[97]=c.createArray(),d[106]=(d[97].push(c.i64.cast([0,32])),d[97]),d[106]=(d[97].push(c.i64.cast([0,32])),d[97]),d[98]="_",c.nativeOperation(b("LSGetBlobFromString.nop"),["epoch_chaining",d[98],c.blobs.to_string(d[94]),d[98],c.i64.to_string(d[96])].join("")).then(function(a){return a=a,d[99]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[99],void 0,d[90],d[97]).then(function(a){return a=a,d[100]=a[0],a})},function(a){return d[100]?d[101]=!1:d[101]=!0,d[101]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Failed to generate epoch_chaining_key and epoch_distribution_pre_shared_key."),d[106]=c.createArray(),void 0!==void 0?d[109]=(d[106].push(void 0),d[106]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils","Failed to generate epoch_chaining_key and epoch_distribution_pre_shared_key.",d[106],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[107]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[108]=a[0],a})},function(a){return a=[d[107],d[108]],d[102]=a[0],d[103]=a[1],a}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[100],c.i64.cast([0,0])).then(function(a){return a=a,d[106]=a[0],d[107]=a[1],a})},function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[100],c.i64.cast([0,1])).then(function(a){return a=a,d[108]=a[0],d[109]=a[1],a})},function(a){return a=[d[106],d[108]],d[102]=a[0],d[103]=a[1],a}])},function(a){return d[104]=new c.Map(),d[104].set("epoch_chaining_key",d[102]),d[104].set("epoch_distribution_pre_shared_key",d[103]),d[105]=new c.Map(),d[105].set("value",d[104]),d[105].set("errors",void 0),d[76]=d[105]}]):c.resolve((d[87]=d[74].get("errors"),d[88]=d[74].get("errors"),d[89]=new c.Map(),d[89].set("value",void 0),d[89].set("errors",d[87]),d[76]=d[89]))},function(a){return d[77]=d[76].get("value"),d[77]!==void 0?c.sequence([function(a){return d[87]=d[77].get("epoch_chaining_key"),d[88]=d[77].get("epoch_distribution_pre_shared_key"),d[89]=d[59].get("psk_fingerprint"),d[90]=c.createArray(),d[95]=(d[90].push(c.i64.cast([0,18])),d[90]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkNyeXB0b1ByZVNoYXJlZEtleQ=="),void 0,d[88],d[90]).then(function(a){return a=a,d[91]=a[0],a})},function(a){return d[91]!==void 0?c.sequence([function(a){return d[95]=c.i64.of_int32(d[91].length),c.i64.ge(d[95],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[91],c.i64.cast([0,0])).then(function(a){return a=a,d[97]=a[0],d[98]=a[1],a})},function(a){return d[96]=d[97]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[97]=c.createArray(),void 0!==void 0?d[98]=(d[97].push(void 0),d[97]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[97],c.i64.cast([0,3]))},function(a){return d[96]=void 0}])},function(a){return d[92]=d[96]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[95]=c.createArray(),void 0!==void 0?d[96]=(d[95].push(void 0),d[95]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[95],c.i64.cast([0,3]))},function(a){return d[92]=void 0}])},function(a){return c.blobs.neq(d[92],void 0)?d[93]=!0:d[93]=!1,d[93]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.blobs.eq(d[89],void 0)||c.blobs.eq(d[89],d[92])?d[94]=d[76]:(d[95]=new c.Map(),d[95].set("error_msg","EB_EPOCH_DERIVATION_PSK_FINGERPRINT_MISMATCH"),d[95].set("code",c.i64.cast([0,10005])),d[95].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:130 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge#4()"),d[96]=c.createArray(),d[98]=(d[96].push(d[95]),d[96]),d[97]=new c.Map(),d[97].set("value",void 0),d[97].set("errors",d[96]),d[94]=d[97]),d[78]=d[94]}]):c.resolve((d[87]=d[76].get("errors"),d[88]=d[76].get("errors"),d[89]=new c.Map(),d[89].set("value",void 0),d[89].set("errors",d[87]),d[78]=d[89]))},function(a){return d[79]=d[78].get("value"),d[79]!==void 0?(d[87]=d[79].get("epoch_chaining_key"),d[88]=d[79].get("epoch_distribution_pre_shared_key"),d[89]=d[59].get("epoch_storage_public_key"),c.blobs.eq(d[89],void 0)||c.blobs.eq(d[89],d[35])?d[90]=d[78]:(d[91]=new c.Map(),d[91].set("error_msg","EB_EPOCH_DERIVATION_STORAGE_KEY_MISMATCH"),d[91].set("code",c.i64.cast([0,10006])),d[91].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:144 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge#7()"),d[92]=c.createArray(),d[94]=(d[92].push(d[91]),d[92]),d[93]=new c.Map(),d[93].set("value",void 0),d[93].set("errors",d[92]),d[90]=d[93]),d[80]=d[90]):(d[87]=d[78].get("errors"),d[88]=d[78].get("errors"),d[89]=new c.Map(),d[89].set("value",void 0),d[89].set("errors",d[87]),d[80]=d[89]),d[81]=d[80].get("value"),d[81]!==void 0?c.sequence([function(a){return d[87]=d[81].get("epoch_chaining_key"),d[88]=d[81].get("epoch_distribution_pre_shared_key"),d[89]=d[59].get("auth_public_key"),d[90]=d[47].get("to_epoch"),d[91]=d[90].get("epoch_anon_id"),d[92]=d[59].get("encrypted_entropy"),c.nativeOperation(b("LSPublicEncryptionCreateDecryptedData.nop"),d[35],f.epochStoragePrivateKeyBlob,d[89],d[88],c.blobs.of_string(["epoch_","_",c.blobs.to_string(d[91])].join("")),d[92]).then(function(a){return a=a,d[93]=a[0],a})},function(a){return c.blobs.neq(d[93],void 0)?c.resolve(d[94]=d[93]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Couldn't decrypt epoch key. Returning null entropy"),d[100]=c.createArray(),void 0!==void 0?d[101]=(d[100].push(void 0),d[100]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils","Couldn't decrypt epoch key. Returning null entropy",d[100],c.i64.cast([0,3]))},function(a){return d[94]=void 0}])},function(a){return c.blobs.neq(d[94],void 0)?(d[100]=new c.Map(),d[100].set("entropy",d[94]),d[101]=new c.Map(),d[101].set("value",d[100]),d[101].set("errors",void 0),d[102]=d[101].get("value"),d[103]=d[101].get("errors"),a=[d[102],d[103]],d[95]=a[0],d[96]=a[1],a):(d[100]=c.createArray(),c.blobs.eq(d[94],void 0)?d[107]=(d[100].push("entropy"),d[100]):0,d[101]=d[100].join(", "),d[102]=new c.Map(),d[102].set("error_msg",["The following required nullables are null: ","",d[101]].join("")),d[102].set("code",c.i64.cast([0,2])),d[102].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:169 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge#11()"),d[103]=c.createArray(),d[107]=(d[103].push(d[102]),d[103]),d[104]=new c.Map(),d[104].set("value",void 0),d[104].set("errors",d[103]),d[105]=d[104].get("value"),d[106]=d[104].get("errors"),a=[d[105],d[106]],d[95]=a[0],d[96]=a[1],a),d[97]=new c.Map(),d[97].set("value",d[95]),d[97].set("errors",d[96]),d[98]=d[97].get("value"),d[98]!==void 0?(d[100]=d[98].get("entropy"),d[99]=d[97]):(d[100]=d[97].get("errors"),d[101]=d[97].get("errors"),d[102]=new c.Map(),d[102].set("error_msg","EB_EPOCH_FORWARD_DECRYPTION_FAILED"),d[102].set("code",c.i64.cast([0,10004])),d[102].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:171 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge#10()"),d[104]=(d[100].push(d[102]),d[100]),d[103]=new c.Map(),d[103].set("value",void 0),d[103].set("errors",d[100]),d[99]=d[103]),d[82]=d[99]}]):c.resolve((d[87]=d[80].get("errors"),d[88]=d[80].get("errors"),d[89]=new c.Map(),d[89].set("value",void 0),d[89].set("errors",d[87]),d[82]=d[89]))},function(a){return d[83]=d[80].get("value"),d[83]!==void 0?c.sequence([function(a){return d[87]=d[83].get("epoch_chaining_key"),d[88]=d[83].get("epoch_distribution_pre_shared_key"),d[89]=d[82].get("value"),d[89]!==void 0?c.sequence([function(a){return d[91]=d[89].get("entropy"),d[92]=c.createArray(),d[99]=(d[92].push(c.i64.cast([0,32])),d[92]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key").then(function(a){return a=a,d[93]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[93],d[87],d[91],d[92]).then(function(a){return a=a,d[94]=a[0],a})},function(a){return d[94]?d[95]=!1:d[95]=!0,d[95]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Unable to generate epoch root key."),d[99]=c.createArray(),void 0!==void 0?d[101]=(d[99].push(void 0),d[99]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils","Unable to generate epoch root key.",d[99],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[100]=a[0],a})},function(a){return d[96]=d[100]}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[94],c.i64.cast([0,0])).then(function(a){return a=a,d[99]=a[0],d[100]=a[1],a})},function(a){return d[96]=d[99]}])},function(a){return d[97]=new c.Map(),d[97].set("root_key",d[96]),d[98]=new c.Map(),d[98].set("value",d[97]),d[98].set("errors",void 0),d[90]=d[98]}]):c.resolve((d[91]=d[82].get("errors"),d[92]=d[82].get("errors"),d[93]=new c.Map(),d[93].set("value",void 0),d[93].set("errors",d[91]),d[90]=d[93]))},function(a){return d[84]=d[90]}]):c.resolve((d[87]=d[80].get("errors"),d[88]=d[80].get("errors"),d[89]=new c.Map(),d[89].set("value",void 0),d[89].set("errors",d[87]),d[84]=d[89]))},function(a){return d[85]=d[84].get("value"),d[86]=d[84].get("errors"),a=[d[85],d[86]],d[60]=a[0],d[61]=a[1],a}]):c.sequence([function(a){return d[73]=d[47].get("backward_edge"),c.blobs.neq(d[73],void 0)?c.sequence([function(a){return d[79]=d[58].get("value"),d[79]!==void 0?c.sequence([function(a){return d[87]=d[79].get("epoch_id"),d[88]=d[79].get("backup_id"),d[89]=d[79].get("epoch_anon_id_blob"),d[90]=d[79].get("epoch_root_key_blob"),d[91]=d[79].get("epoch_status"),d[92]=d[79].get("authority_level"),d[93]=d[47].get("to_epoch"),d[94]=d[93].get("epoch_anon_id"),c.nativeOperation(b("LSGetNextEpochAnonId.nop"),d[94]).then(function(a){return a=a,d[95]=a[0],a})},function(a){return c.blobs.eq(d[95],d[89])?d[96]=d[58]:(d[97]=new c.Map(),d[97].set("error_msg","EB_EPOCH_BACKWARD_EDGE_NOT_CONSECUTIVE"),d[97].set("code",c.i64.cast([0,10010])),d[97].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:198 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processBackwardEdge()"),d[98]=c.createArray(),d[100]=(d[98].push(d[97]),d[98]),d[99]=new c.Map(),d[99].set("value",void 0),d[99].set("errors",d[98]),d[96]=d[99]),d[80]=d[96]}]):c.resolve((d[87]=d[58].get("errors"),d[88]=d[58].get("errors"),d[89]=new c.Map(),d[89].set("value",void 0),d[89].set("errors",d[87]),d[80]=d[89]))},function(a){return d[81]=d[80].get("value"),d[81]!==void 0?c.sequence([function(a){return d[87]=d[81].get("epoch_id"),d[88]=d[81].get("backup_id"),d[89]=d[81].get("epoch_anon_id_blob"),d[90]=d[81].get("epoch_root_key_blob"),d[91]=d[81].get("epoch_status"),d[92]=d[81].get("authority_level"),d[93]=c.createArray(),d[98]=(d[93].push(c.i64.cast([0,32])),d[93]),c.nativeOperation(b("LSBase64Encode.nop"),d[89]).then(function(a){return a=a,d[94]=a[0],a})},function(a){return d[94]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blobs.of_string(["epoch_data_storage","_",d[94]].join("")),void 0,d[90],d[93]).then(function(a){return a=a,d[98]=a[0],a})},function(a){return d[98]?d[99]=!1:d[99]=!0,d[99]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),d[101]=c.createArray(),void 0!==void 0?d[103]=(d[101].push(void 0),d[101]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils","THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",d[101],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[102]=a[0],a})},function(a){return d[100]=d[102]}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[98],c.i64.cast([0,0])).then(function(a){return a=a,d[101]=a[0],d[102]=a[1],a})},function(a){return d[100]=d[101]}])},function(a){return d[95]=d[100]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),d[98]=c.createArray(),void 0!==void 0?d[100]=(d[98].push(void 0),d[98]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils","THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",d[98],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[99]=a[0],a})},function(a){return d[95]=d[99]}])},function(a){return d[96]=new c.Map(),d[96].set("epoch_data_storage_key",d[95]),d[97]=new c.Map(),d[97].set("value",d[96]),d[97].set("errors",void 0),d[82]=d[97]}]):c.resolve((d[87]=d[80].get("errors"),d[88]=d[80].get("errors"),d[89]=new c.Map(),d[89].set("value",void 0),d[89].set("errors",d[87]),d[82]=d[89]))},function(a){return d[83]=d[82].get("value"),d[83]!==void 0?c.sequence([function(a){return d[87]=d[83].get("epoch_data_storage_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[73]).then(function(a){return a=a,d[88]=a[0],a})},function(a){return d[95]=d[88],d[95]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),d[87],c.blob("ZXBvY2hfZGF0YV9tZXRhZGF0YQ=="),d[95]).then(function(a){return a=a,d[96]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Decode.nop"),d[96]).then(function(a){return a=a,d[97]=a[0],a})},function(a){return d[89]=d[97]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Unable to base64 encode backward edge."),d[96]=c.createArray(),void 0!==void 0?d[97]=(d[96].push(void 0),d[96]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils","Unable to base64 encode backward edge.",d[96],c.i64.cast([0,3]))},function(a){return d[89]=void 0}])},function(a){return c.blobs.neq(d[89],void 0)?(d[96]=new c.Map(),d[96].set("root_key",d[89]),d[97]=new c.Map(),d[97].set("value",d[96]),d[97].set("errors",void 0),d[98]=d[97].get("value"),d[99]=d[97].get("errors"),a=[d[98],d[99]],d[90]=a[0],d[91]=a[1],a):(d[96]=c.createArray(),c.blobs.eq(d[89],void 0)?d[103]=(d[96].push("root_key"),d[96]):0,d[97]=d[96].join(", "),d[98]=new c.Map(),d[98].set("error_msg",["The following required nullables are null: ","",d[97]].join("")),d[98].set("code",c.i64.cast([0,2])),d[98].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:227 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processBackwardEdge#5()"),d[99]=c.createArray(),d[103]=(d[99].push(d[98]),d[99]),d[100]=new c.Map(),d[100].set("value",void 0),d[100].set("errors",d[99]),d[101]=d[100].get("value"),d[102]=d[100].get("errors"),a=[d[101],d[102]],d[90]=a[0],d[91]=a[1],a),d[92]=new c.Map(),d[92].set("value",d[90]),d[92].set("errors",d[91]),d[93]=d[92].get("value"),d[93]!==void 0?(d[96]=d[93].get("root_key"),d[94]=d[92]):(d[96]=d[92].get("errors"),d[97]=d[92].get("errors"),d[98]=new c.Map(),d[98].set("error_msg","EB_EPOCH_BACKWARD_DECRYPTION_FAILED"),d[98].set("code",c.i64.cast([0,10013])),d[98].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:229 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processBackwardEdge#4()"),d[100]=(d[96].push(d[98]),d[96]),d[99]=new c.Map(),d[99].set("value",void 0),d[99].set("errors",d[96]),d[94]=d[99]),d[84]=d[94]}]):c.resolve((d[87]=d[82].get("errors"),d[88]=d[82].get("errors"),d[89]=new c.Map(),d[89].set("value",void 0),d[89].set("errors",d[87]),d[84]=d[89]))},function(a){return d[85]=d[84].get("value"),d[86]=d[84].get("errors"),a=[d[85],d[86]],d[74]=a[0],d[75]=a[1],a}]):c.resolve((d[79]=new c.Map(),d[79].set("error_msg","EB_EPOCH_EDGE_NEITHER_FORWARD_NOR_BACKWARD"),d[79].set("code",c.i64.cast([0,10008])),d[79].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:411 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge#9()"),d[80]=c.createArray(),d[84]=(d[80].push(d[79]),d[80]),d[81]=new c.Map(),d[81].set("value",void 0),d[81].set("errors",d[80]),d[82]=d[81].get("value"),d[83]=d[81].get("errors"),a=[d[82],d[83]],d[74]=a[0],d[75]=a[1],a))},function(a){return d[76]=new c.Map(),d[76].set("value",d[74]),d[76].set("errors",d[75]),d[77]=d[76].get("value"),d[78]=d[76].get("errors"),a=[d[77],d[78]],d[60]=a[0],d[61]=a[1],a}])},function(a){return d[62]=new c.Map(),d[62].set("value",d[60]),d[62].set("errors",d[61]),d[63]=d[62].get("value"),d[63]!==void 0?c.sequence([function(a){return d[73]=d[63].get("root_key"),d[74]=d[47].get("to_epoch_fingerprint"),d[75]=c.createArray(),d[80]=(d[75].push(c.i64.cast([0,18])),d[75]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[73],d[75]).then(function(a){return a=a,d[76]=a[0],a})},function(a){return d[76]!==void 0?c.sequence([function(a){return d[80]=c.i64.of_int32(d[76].length),c.i64.ge(d[80],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[76],c.i64.cast([0,0])).then(function(a){return a=a,d[82]=a[0],d[83]=a[1],a})},function(a){return d[81]=d[82]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[82]=c.createArray(),void 0!==void 0?d[83]=(d[82].push(void 0),d[82]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[82],c.i64.cast([0,3]))},function(a){return d[81]=void 0}])},function(a){return d[77]=d[81]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[80]=c.createArray(),void 0!==void 0?d[81]=(d[80].push(void 0),d[80]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[80],c.i64.cast([0,3]))},function(a){return d[77]=void 0}])},function(a){return c.blobs.neq(d[77],void 0)?d[78]=!0:d[78]=!1,d[78]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.blobs.eq(d[74],void 0)||c.blobs.eq(d[74],d[77])?d[79]=d[62]:(d[80]=new c.Map(),d[80].set("error_msg","EB_EPOCH_DERIVATION_DEST_FINGERPRINT_MISMATCH"),d[80].set("code",c.i64.cast([0,10001])),d[80].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:415 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge#11()"),d[81]=c.createArray(),d[83]=(d[81].push(d[80]),d[81]),d[82]=new c.Map(),d[82].set("value",void 0),d[82].set("errors",d[81]),d[79]=d[82]),d[64]=d[79]}]):c.resolve((d[73]=d[62].get("errors"),d[74]=d[62].get("errors"),d[75]=new c.Map(),d[75].set("value",void 0),d[75].set("errors",d[73]),d[64]=d[75]))},function(a){return d[65]=d[64].get("value"),d[65]!==void 0?c.sequence([function(a){return d[73]=d[65].get("root_key"),d[74]=d[47].get("to_epoch"),d[75]=d[74].get("epoch_id"),d[76]=d[47].get("to_epoch"),d[77]=d[76].get("epoch_anon_id"),d[98]="Storing newly derived epoch ",d[99]=c.blobs.to_string(d[77]),d[100]=" authority_level:",d[101]="AUTHORITATIVE",d[102]=" status:",d[103]=c.i64.to_string(c.i64.cast([0,2])),d[78]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[78],d[98],d[78],d[99],d[78],d[100],d[78],d[101],d[78],d[102],d[78],d[103]].join("")),c.resolve()},function(a){return c.filter(c.db.table(169).fetch([[[d[75]]]]),function(a){return c.i64.eq(a.epochId,d[75])&&c.i64.gt(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(b){var a=b.done;b.value;return a?c.db.table(169).put({epochId:d[75],backupId:f.backupId,epochAnonIdBlob:d[77],epochRootKeyBlob:d[73],epochStatus:c.i64.cast([0,2]),authorityLevel:c.i64.cast([0,80])}):0})},function(a){return d[79]=d[47].get("from_epoch"),d[80]=d[79].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[80]).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[81]!==void 0?d[82]=d[81]:d[82]="",d[83]=d[47].get("from_epoch"),d[84]=d[83].get("epoch_id"),d[85]=new c.Map(),d[85].set("anon_id",d[82]),d[85].set("epoch_id",d[84]),d[86]=d[47].get("to_epoch"),d[87]=d[86].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[87]).then(function(a){return a=a,d[88]=a[0],a})},function(a){return d[88]!==void 0?d[89]=d[88]:d[89]="",d[90]=d[47].get("to_epoch"),d[91]=d[90].get("epoch_id"),d[92]=new c.Map(),d[92].set("anon_id",d[89]),d[92].set("epoch_id",d[91]),d[93]=d[47].get("forward_edge"),d[93]?d[94]=!1:d[94]=!0,d[94]?d[95]=!1:d[95]=!0,d[96]=d[47].get("backward_edge"),c.blobs.neq(d[96],void 0)?d[97]=!0:d[97]=!1,a=[d[85],d[92],d[95],d[97],void 0,c.i64.cast([0,0])],d[66]=a[0],d[67]=a[1],d[68]=a[2],d[69]=a[3],d[70]=a[4],d[71]=a[5],a}]):c.sequence([function(a){return d[73]=d[64].get("errors"),d[74]=d[64].get("errors"),d[75]=c.i64.of_int32(d[73].length),c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[73],c.i64.sub(d[75],c.i64.cast([0,1]))).then(function(a){return a=a,d[76]=a[0],d[77]=a[1],a})},function(a){return d[78]=d[76].get("code"),d[79]=d[76].get("src_line"),d[80]=d[76].get("error_msg"),c.i64.eq(d[78],c.i64.cast([0,10004]))?d[81]=c.i64.cast([0,3]):(c.i64.eq(d[78],c.i64.cast([0,10003]))?d[103]=c.i64.cast([0,13]):(c.i64.eq(d[78],c.i64.cast([0,10002]))?d[104]=c.i64.cast([0,9]):(c.i64.eq(d[78],c.i64.cast([0,10001]))?d[105]=c.i64.cast([0,10]):(c.i64.eq(d[78],c.i64.cast([0,10005]))?d[106]=c.i64.cast([0,12]):(c.i64.eq(d[78],c.i64.cast([0,10006]))?d[107]=c.i64.cast([0,11]):(c.i64.eq(d[78],c.i64.cast([0,10008]))?d[108]=c.i64.cast([0,2]):(c.i64.eq(d[78],c.i64.cast([0,10009]))?d[109]=c.i64.cast([0,14]):(c.i64.eq(d[78],c.i64.cast([0,10010]))?d[110]=c.i64.cast([0,15]):(c.i64.eq(d[78],c.i64.cast([0,10011]))?d[111]=c.i64.cast([0,16]):(c.i64.eq(d[78],c.i64.cast([0,10012]))?d[112]=c.i64.cast([0,17]):(c.i64.eq(d[78],c.i64.cast([0,10013]))?d[113]=c.i64.cast([0,6]):d[113]=c.i64.cast([0,1]),d[112]=d[113]),d[111]=d[112]),d[110]=d[111]),d[109]=d[110]),d[108]=d[109]),d[107]=d[108]),d[106]=d[107]),d[105]=d[106]),d[104]=d[105]),d[103]=d[104]),d[81]=d[103]),d[82]=d[47].get("from_epoch"),d[83]=d[82].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[83]).then(function(a){return a=a,d[84]=a[0],a})},function(a){return d[84]!==void 0?d[85]=d[84]:d[85]="",d[86]=d[47].get("from_epoch"),d[87]=d[86].get("epoch_id"),d[88]=new c.Map(),d[88].set("anon_id",d[85]),d[88].set("epoch_id",d[87]),d[89]=d[47].get("to_epoch"),d[90]=d[89].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[90]).then(function(a){return a=a,d[91]=a[0],a})},function(a){return d[91]!==void 0?d[92]=d[91]:d[92]="",d[93]=d[47].get("to_epoch"),d[94]=d[93].get("epoch_id"),d[95]=new c.Map(),d[95].set("anon_id",d[92]),d[95].set("epoch_id",d[94]),d[96]=d[47].get("forward_edge"),d[96]?d[97]=!1:d[97]=!0,d[97]?d[98]=!1:d[98]=!0,d[99]=d[47].get("backward_edge"),c.blobs.neq(d[99],void 0)?d[100]=!0:d[100]=!1,d[101]="",d[102]=c.i64.of_int32(d[73].length),c.i64.gt(d[102],c.i64.cast([0,0]))?c.loopAsync(d[102],function(a){return d[103]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[73],d[103]).then(function(a){return a=a,d[104]=a[0],d[105]=a[1],a})},function(a){return d[106]=d[104].get("code"),d[107]=d[104].get("src_line"),d[108]=d[104].get("error_msg"),d[109]=d[104].get("code"),d[110]=d[104].get("src_line"),d[111]=d[104].get("error_msg"),d[112]=d[104].get("code"),d[113]=d[104].get("src_line"),d[114]=d[104].get("error_msg"),d[101]=[d[101],["at ",d[107],": ","error code ",c.i64.to_string(d[109]),": ",d[114]].join(""),"\n"].join("")}])}):c.resolve()},function(a){return a=[d[88],d[95],d[98],d[100],d[101],d[81]],d[66]=a[0],d[67]=a[1],d[68]=a[2],d[69]=a[3],d[70]=a[4],d[71]=a[5],a}])},function(a){return d[72]=new c.Map(),d[72].set("from",d[66]),d[72].set("to",d[67]),d[72].set("has_forward_edge",d[68]),d[72].set("has_backward_edge",d[69]),d[72].set("error_message",d[70]),d[72].set("result_code",d[71]),d[73]=(d[44].push(d[72]),d[44])}])}):c.resolve()},function(b){return b=[d[34],d[34],a[1],a[2],c.i64.cast([0,0]),c.i64.cast([0,0]),d[44]],d[37]=b[0],d[38]=b[1],d[39]=b[2],d[40]=b[3],d[41]=b[4],d[42]=b[5],d[43]=b[6],b}])},function(a){return a=[d[37],d[38],d[39],d[40],d[41],d[42],d[43]],d[25]=a[0],d[26]=a[1],d[27]=a[2],d[28]=a[3],d[29]=a[4],d[30]=a[5],d[31]=a[6],a}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] Unable to load client state: 24"),d[36]=c.createArray(),void 0!==void 0?d[39]=(d[36].push(void 0),d[36]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure","Unable to load client state: 24",d[36],c.i64.cast([0,3]))},function(e){return d[37]=c.createArray(),d[38]=c.i64.of_int32(a[0].length),c.i64.gt(d[38],c.i64.cast([0,0]))?c.loopAsync(d[38],function(e){return d[39]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[39]).then(function(a){return a=a,d[40]=a[0],d[41]=a[1],a})},function(a){return d[42]=d[40].get("from_epoch"),d[43]=d[42].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[43]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[44]!==void 0?d[45]=d[44]:d[45]="",d[46]=d[40].get("from_epoch"),d[47]=d[46].get("epoch_id"),d[48]=new c.Map(),d[48].set("anon_id",d[45]),d[48].set("epoch_id",d[47]),d[49]=d[40].get("to_epoch"),d[50]=d[49].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[50]).then(function(a){return a=a,d[51]=a[0],a})},function(a){return d[51]!==void 0?d[52]=d[51]:d[52]="",d[53]=d[40].get("to_epoch"),d[54]=d[53].get("epoch_id"),d[55]=new c.Map(),d[55].set("anon_id",d[52]),d[55].set("epoch_id",d[54]),d[56]=d[40].get("forward_edge"),d[56]?d[57]=!1:d[57]=!0,d[57]?d[58]=!1:d[58]=!0,d[59]=d[40].get("backward_edge"),c.blobs.neq(d[59],void 0)?d[60]=!0:d[60]=!1,d[61]=new c.Map(),d[61].set("from",d[48]),d[61].set("to",d[55]),d[61].set("has_forward_edge",d[58]),d[61].set("has_backward_edge",d[60]),d[61].set("result_code",c.i64.cast([0,7])),d[61].set("error_message",void 0),d[62]=(d[37].push(d[61]),d[37])}])}):c.resolve()},function(b){return b=[void 0,void 0,void 0,a[2],c.i64.cast([0,0]),c.i64.cast([0,0]),d[37]],d[25]=b[0],d[26]=b[1],d[27]=b[2],d[28]=b[3],d[29]=b[4],d[30]=b[5],d[31]=b[6],b}])},function(a){return a=[d[25],d[26],d[27],d[28],d[29],d[30],d[31]],d[9]=a[0],d[10]=a[1],d[11]=a[2],d[12]=a[3],d[13]=a[4],d[14]=a[5],d[15]=a[6],a}]))})},function(a){return d[17]=c.i64.of_float(Date.now()),d[18]=new c.Map(),d[18].set("local_device_id",d[9]),d[18].set("decryption_device_id",d[10]),d[18].set("target_device_id",d[11]),d[18].set("epoch_sync_reason",d[12]),d[18].set("start_ms",d[8]),d[18].set("end_ms",d[17]),d[18].set("results",d[15]),d[19]=c.toJSON(d[18]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_record_epoch_sync",c.i64.cast([0,50039]),d[19],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[20]=a[0],a})}]):c.resolve()},function(a){return d[2]=c.i64.of_float(Date.now()),d[3]=c.i64.random(),d[5]="Finishing execution. Execution time: ",d[6]=c.i64.to_string(c.i64.sub(d[2],d[0])),d[7]=" ms",d[4]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] ",d[4],d[5],d[4],d[6],d[4],d[7]].join("")),c.i64.eq(c.i64.mod_(d[3],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[8]=",",d[9]=c.createArray(),void 0!==void 0?d[10]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure",[d[5],d[8],d[6],d[8],d[7]].join(""),d[9],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSDeriveAndStoreEpochsStoredProcedure",["LSDeriveAndStoreEpochs","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDeriveAndStoreEpochs"),e.epochEdges,e.targetDeviceId,e.epochSyncReason,e.traceId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MEBEpochSyncReason",[],(function(a,b,c,d,e,f){a=Object.freeze({EMPTY_RESTORE_PAYLOAD:-3,NONE_PROVIDED_BY_CLIENT:-2,NONE_PROVIDED_BY_SERVER:-1,SNAPSHOT_RESTORE:0,POINT_QUERY_RESTORE:1,RANGE_QUERY_RESTORE:2,MESSAGE_QUERY_RESTORE:3,SURROUNDING_RESTORE:4,DOWNLOAD_EPOCHS_V2:5,PREPARE_OPEN_EPOCH:6,HANDLE_OPEN_EPOCH_SUCCESS:7,HANDLE_INIT_GET_SECRETS:8,DERIVE_ONBOARDING_MATERIAL:9,DECRYPT_AND_WRITE_MESSAGES:10,RESTORE_WITH_SERIALIZER:11,FINISH_ADD_PEER_DEVICE:12});f["default"]=a}),66);
__d("createWorkerMutation",["WorkerRelayNetwork","asyncToGeneratorRuntime","err","executeGraphQLQuery","relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=d("relay-runtime").getRequest(a);if(e.params.operationKind!=="mutation")throw c("err")("createWorkerMutation: Expected mutation operation");var f=d("WorkerRelayNetwork").getWorkerNetworkExecute();e=function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=(yield f);return d("executeGraphQLQuery").executeGraphQLQuery(c,a,b).then(function(a){return a.toPromise()}).then(function(a){if(Array.isArray(a)){return(a=a[0])==null?void 0:a.data}else return null})});return function(a){return c.apply(this,arguments)}}();return[e]}g["default"]=a}),98);
__d("WorkerRelay",["WorkerRelayNetwork","createWorkerMutation","createWorkerQuery","executeGraphQLQuery","relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";f.exports={createWorkerMutation:c("createWorkerMutation"),createWorkerQuery:c("createWorkerQuery"),executeGraphQLQuery:d("executeGraphQLQuery").executeGraphQLQuery,getWorkerRelayEnvironment:d("WorkerRelayNetwork").getWorkerNetworkExecute,graphql:d("relay-runtime").graphql}}),34);
__d("handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"encryption_version",storageKey:null},b={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf_stanza",storageKey:null},e={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp_ms",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"sk_ciphertext",storageKey:null},g=[b,c];return{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMessage",kind:"LinkedField",name:"encrypted_messages",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEchoDocument",kind:"LinkedField",name:"echo_document",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"echo_document_string",storageKey:null},a,b,c,{alias:null,args:null,kind:"ScalarField",name:"epoch_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"otid",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanzas",kind:"LinkedField",name:"protobuf_stanzas",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"top_level_protobuf",plural:!1,selections:[d,a,b,c,e,f],storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs",plural:!0,selections:[d,a,b,c,e,f,{alias:null,args:null,kind:"ScalarField",name:"supplemental_key",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},{alias:null,args:null,concreteType:"XFBMessageRangeInfo",kind:"LinkedField",name:"message_range_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_more_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_more_after",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_after",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_delete_mailbox",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:g,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:g,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null}],storageKey:null}],storageKey:null}],type:"XFBEncryptedBackupMessages",abstractKey:null}}();e.exports=a}),null);
__d("handleRestoreMessagesGraphQLResponse",["EBAPIQPLPoints","I64","LSAuthorityLevel","LSDecryptMessageProtobufsStoredProcedure","LSDecryptMessagesStoredProcedure","LSDeleteAndReenrollDeviceStateStoredProcedure","LSDeriveAndStoreEpochsStoredProcedure","LSDict","LSFactory","LSIntEnum","LSMEBDeviceReenrollmentReason","LSMEBTaskCreationSource","LSShape","LSVec","MAWEBRestoreTrackingUtils","MAWEncryptedBackupUtils","MAWJobDefinitions","MEBEncryptionVersion","MEBEpochSyncReason","QPLUserFlow","ReQL","WAHashStringToNumber","WALogger","asyncToGeneratorRuntime","handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages.graphql","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Protobuf decryption failed in search range restore response"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message range info is not complete - cannot proceed with graphQL restore for thread ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] backup_id is null during graphQL restore for thread ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message range info is null - cannot proceed with graphQL restore"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] server side exception during graphql restore - ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web Client state is null - unable to proceed with GQL restore"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message with no echo document and no protobuf data, more details: encrypted_protobuf_content: ",", protobuf_epoch_anon_id: ",", protobuf_epoch_id: ",", protobuf_timestamp_ms: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] echo_document_string or echo_epoch_anon_id is null for a message in the GraphQL range restore response"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] otid is null for a message in the GraphQL range restore response"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message is null in the GraphQL range restore response"]);t=function(){return a};return a}var u=c("requireDeferred")("LSRestoreEchoBlobs.nop").__setRef("handleRestoreMessagesGraphQLResponse"),v=c("requireDeferred")("LSRestoreProtobufs.nop").__setRef("handleRestoreMessagesGraphQLResponse");function w(a){if(a==null)return c("MEBEncryptionVersion").UNKNOWN;switch(a){case"ENCRYPTION_KDF_WITH_NULL_SALT":return c("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_NULL_SALT;case"ENCRYPTION_KDF_WITH_VERSION":return c("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_VERSION;case"ENCRYPTION_KDF_WITH_NULL_SALT_DF_CANARY":return c("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_NULL_SALT_DF_CANARY;case"TEST_VERSION":return c("MEBEncryptionVersion").TEST_VERSION;default:return c("MEBEncryptionVersion").UNKNOWN}}function x(a,b){b=b;b==null&&(b="ENCRYPTION_VERSION_MISSING");var c=a.get(b);a.has(b)&&c!=null?a.set(b,c+1):a.set(b,1)}function y(a,b,e,f){if(b==null)return{encryptedLSEchoMessages:[],encryptedMessagesWithProtobufs:[],encryptedNonLSEchoMessages:[]};var g=new Map(),h=new Map(),k=new Map(),l=[],m=[];a=(a=a==null?void 0:a.map(function(a){var e,f,n,o,p,q,u;if(a==null){d("WALogger").ERROR(t());return}var v=a.otid;if(v==null){d("WALogger").ERROR(s());return}e=(e=a.echo_document)==null?void 0:e.echo_document_string;f=(f=a.echo_document)==null?void 0:f.epoch_anon_id;n=(n=a.echo_document)==null?void 0:n.epoch_fingerprint;var y=a.protobuf_stanzas;o=y==null?void 0:(o=y.top_level_protobuf)==null?void 0:o.encrypted_protobuf_stanza;p=y==null?void 0:(p=y.top_level_protobuf)==null?void 0:p.epoch_anon_id;q=y==null?void 0:(q=y.top_level_protobuf)==null?void 0:q.epoch_id;u=y==null?void 0:(u=y.top_level_protobuf)==null?void 0:u.protobuf_timestamp_ms;var z=y==null?void 0:y.supplemental_protobufs;if(e==null||f==null){d("WALogger").ERROR(r());return}if(o==null||p==null||q==null||u==null)if(e.length===0){A(o,p,q,u);return}else{var B,C;B=w((B=a.echo_document)==null?void 0:B.encryption_version);x(g,(C=a.echo_document)==null?void 0:C.encryption_version);l.push(d("LSShape").ofRecord({backup_id:Number(b),encryption_version:(i||(i=d("LSIntEnum"))).ofNumber(B),epoch_anon_id:new TextEncoder().encode(f).buffer,epoch_fingerprint:n!=null?new TextEncoder().encode(n).buffer:void 0,epoch_id:((C=a.echo_document)==null?void 0:C.epoch_id)!=null?(j||(j=d("I64"))).of_string(a.echo_document.epoch_id):void 0,otid:v,value:e}));m.push({backup_id:Number(b),encryption_version:B,epoch_anon_id:new TextEncoder().encode(f).buffer,epoch_fingerprint:n!=null?new TextEncoder().encode(n).buffer:void 0,epoch_id:((C=a.echo_document)==null?void 0:C.epoch_id)!=null?(j||(j=d("I64"))).of_string(a.echo_document.epoch_id):void 0,otid:v,value:e});return}if(y!=null){C=w((B=a.echo_document)==null?void 0:B.encryption_version);x(g,(B=a.echo_document)==null?void 0:B.encryption_version);a=d("LSShape").ofRecord({backup_id:Number(b),encryption_version:(i||(i=d("LSIntEnum"))).ofNumber(C),epoch_anon_id:new TextEncoder().encode(f).buffer,epoch_fingerprint:n!=null?new TextEncoder().encode(n).buffer:void 0,value:e});C=w(y==null?void 0:(B=y.top_level_protobuf)==null?void 0:B.encryption_version);x(h,y==null?void 0:(f=y.top_level_protobuf)==null?void 0:f.encryption_version);n=d("LSShape").ofRecord({encrypted_protobuf:o,encryption_version:i.ofNumber(C),epoch_anon_id:new TextEncoder().encode(p).buffer,epoch_id:(j||(j=d("I64"))).of_string(q),protobuf_timestamp_ms:j.of_string(u)});var D=new(c("LSDict"))();z==null?void 0:z.forEach(function(a){var b=a==null?void 0:a.supplemental_key,c=a==null?void 0:a.encrypted_protobuf_stanza,e=a.epoch_anon_id,f=a==null?void 0:a.epoch_id,g=a==null?void 0:a.protobuf_timestamp_ms;if(c==null||e==null||f==null||g==null||b==null)return;var h=w(a==null?void 0:a.encryption_version);x(k,a==null?void 0:a.encryption_version);D.set(b,d("LSShape").ofRecord({encrypted_protobuf:c,encryption_version:(i||(i=d("LSIntEnum"))).ofNumber(h),epoch_anon_id:new TextEncoder().encode(e).buffer,epoch_id:(j||(j=d("I64"))).of_string(f),protobuf_timestamp_ms:j.of_string(g),sk_ciphertext:a==null?void 0:a.sk_ciphertext}))});return d("LSShape").ofRecord({encrypted_echo_message:a,encrypted_protobufs:d("LSShape").ofRecord({supplemental_protobufs:D,toplevel_protobuf:n}),otid:v})}}).filter(Boolean))!=null?a:[];if(f!=null&&e!=null){c("QPLUserFlow").addPoint(e,"processing_encrypted_messages_complete",{instanceKey:f});for(var n of g.entries()){var o,p=n[0],q=n[1];p=p+"_echo";c("QPLUserFlow").addAnnotations(e,{"int":(o={},o[p]=q,o)},{instanceKey:f})}for(p of h.entries()){q=p[0];o=p[1];n=q+"_protobuf_top_level";c("QPLUserFlow").addAnnotations(e,{"int":(q={},q[n]=o,q)},{instanceKey:f})}for(n of k.entries()){o=n[0];q=n[1];p=o+"_protobuf_supplemental";c("QPLUserFlow").addAnnotations(e,{"int":(o={},o[p]=q,o)},{instanceKey:f})}}z(l,a,e,f);return{encryptedLSEchoMessages:l,encryptedMessagesWithProtobufs:a,encryptedNonLSEchoMessages:m}}function z(a,b,e,f){if(e!=null){if(a.length>0){var g=d("LSShape").toRecord(a[0]);a=d("LSShape").toRecord(a[a.length-1]);c("QPLUserFlow").addAnnotations(e,{string:{first_echo_otid:g.otid,last_echo_otid:a.otid}},{instanceKey:f})}if(b.length>0){a=(g=d("LSShape")).toRecord(b[0]);var h=g.toRecord(a.encrypted_protobufs);b=g.toRecord(b[b.length-1]);g=g.toRecord(b.encrypted_protobufs);c("QPLUserFlow").addAnnotations(e,{string:{first_protobuf_otid:a.otid,first_protobuf_ts:(j||(j=d("I64"))).to_string(d("LSShape").toRecord(h.toplevel_protobuf).protobuf_timestamp_ms),last_protobuf_otid:b.otid,last_protobuf_ts:j.to_string(d("LSShape").toRecord(g.toplevel_protobuf).protobuf_timestamp_ms)}},{instanceKey:f})}}}function A(a,b,c,e){d("WALogger").ERROR(q(),a==null?"null/empty":"not empty",b==null?"null/empty":"not empty",c==null?"null/empty":"not empty",e==null?"null/empty":"not empty")}function B(a){return C.apply(this,arguments)}function C(){C=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.backupId,e=a.encryptedMessages,g=a.isPointQuery,h=a.messageRangeInfo,k=a.sortOrderMs,l=a.source,m=a.storage,n=a.threadId,o=a.traceId;a=y(e,b);var p=a.encryptedLSEchoMessages,q=a.encryptedMessagesWithProtobufs;b=(e=h)!=null?e:{};var r=b.has_more_after,s=b.has_more_before,t=b.next_message_timestamp_ms_after,w=b.next_message_timestamp_ms_before;if(s==null||r==null||t==null||w==null)return;if(q.length===0){a=(yield m.runInTransaction(function(a){return c("LSDecryptMessagesStoredProcedure")(c("LSFactory")(a),{actThreadId:n,encryptedMessages:c("LSVec").ofArray(p)})},"readwrite",void 0,void 0,f.id+":543"));h=a[0];if(h!=null){var x=c("LSVec").toArray(h).map(function(a){return d("LSShape").toRecord(a).value});c("promiseDone")(u.load().then(function(a){return m.runInTransaction(function(b){return a(b,0,(j||(j=d("I64"))).zero,c("LSVec").ofArray(x),s,j.of_string(w),r,j.of_string(t),g,n,o,k!=null?k:void 0,(i||(i=d("LSIntEnum"))).ofNumber((b=l)!=null?b:c("LSMEBTaskCreationSource").UNKNOWN),void 0)},"readwrite",void 0,void 0,f.id+":559")}))}}else{var z=(yield m.runInTransaction(function(a){return c("LSDecryptMessageProtobufsStoredProcedure")(c("LSFactory")(a),{actThreadId:n,encryptedMessagesWithProtobufs:c("LSVec").ofArray(q)})},"readwrite",void 0,void 0,f.id+":582"));c("promiseDone")(v.load().then(function(a){return m.runInTransaction(function(b){return a(b,0,n,(b=z[0])!=null?b:c("LSVec").ofArray([]),s,(j||(j=d("I64"))).of_string(w),r,j.of_string(t),g,o,k!=null?k:void 0,void 0,c("LSVec").ofArray([]),(i||(i=d("LSIntEnum"))).ofNumber((b=l)!=null?b:c("LSMEBTaskCreationSource").UNKNOWN))},"readwrite",void 0,void 0,f.id+":592")}))}});return C.apply(this,arguments)}function a(a,b){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=b!=null?yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.secure_encrypted_backups_client_state)):yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state));b=b!=null?yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(b.secure_encrypted_backups_epochs)):yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_epochs));a=b.filter(function(a){return a.authorityLevel!==c("LSAuthorityLevel").AUTHORITATIVE}).map(function(a){return(j||(j=d("I64"))).to_string(a.epochId)});if(e==null){d("WALogger").ERROR(p());return}b=e.deviceId;var f=e.mailboxRootKeyBlob;e=e.ocmfClientStateBlob;return{device_id:b,locally_available_epochs:a,mailboxRootKey:f,ocmfClientStateBlob:e}});return D.apply(this,arguments)}function E(a,b,c,d,e){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,g,h){g!=null&&(h!=null&&h?d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotationsWorker({annotations:{bool:{has_epochs:a!=null&&a.epoch_edges.length>0}},pointName:"derive_and_store_epochs_worker",traceId:g}):d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotations({annotations:{bool:{has_epochs:a!=null&&a.epoch_edges.length>0}},pointName:"derive_and_store_epochs",traceId:g}));try{if(a!=null){var k=a.epoch_edges,l=[],m=new TextEncoder();k!=null&&(k.forEach(function(a){var b=a.from_epoch,c=a.to_epoch,e=a.forward_edge,f=e==null?void 0:e.auth_public_key,g=e==null?void 0:e.encrypted_entropy,h=e==null?void 0:e.entropy_fingerprint,i=e==null?void 0:e.epoch_storage_public_key;e=e==null?void 0:e.psk_fingerprint;var k;f!=null&&g!=null&&(k=d("LSShape").ofRecord({auth_public_key:m.encode(f).buffer,encrypted_entropy:m.encode(g).buffer,entropy_fingerprint:h!=null?m.encode(h).buffer:void 0,epoch_storage_public_key:i!=null?m.encode(i).buffer:void 0,psk_fingerprint:e!=null?m.encode(e).buffer:void 0}));f=b==null?void 0:b.epoch_anon_id;g=b==null?void 0:b.epoch_id;h=c==null?void 0:c.epoch_anon_id;i=c==null?void 0:c.epoch_id;f!=null&&g!=null&&h!=null&&i!=null&&l.push(d("LSShape").ofRecord({backward_edge:a.backward_edge!=null?m.encode(a.backward_edge).buffer:void 0,forward_edge:k,from_epoch:d("LSShape").ofRecord({epoch_anon_id:m.encode(f).buffer,epoch_id:(j||(j=d("I64"))).of_string(g)}),from_epoch_fingerprint:a.from_epoch_fingerprint!=null?m.encode(a.from_epoch_fingerprint).buffer:void 0,to_epoch:d("LSShape").ofRecord({epoch_anon_id:m.encode(h).buffer,epoch_id:j.of_string(i)}),to_epoch_fingerprint:a.to_epoch_fingerprint!=null?m.encode(a.to_epoch_fingerprint).buffer:void 0}))}),yield b.runInTransaction(function(a){return c("LSDeriveAndStoreEpochsStoredProcedure")(c("LSFactory")(a),{epochEdges:c("LSVec").ofArray(l),epochSyncReason:(i||(i=d("LSIntEnum"))).ofNumber(c("MEBEpochSyncReason").DECRYPT_AND_WRITE_MESSAGES),targetDeviceId:e,traceId:g})},"readwrite",void 0,void 0,f.id+":771"))}}catch(b){g!=null&&(h!=null&&h?d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotationsWorker({annotations:{bool:{has_epochs:a!=null&&a.epoch_edges.length>0},string:{exception:b.message}},pointName:"derive_and_store_epochs_worker_exception",traceId:g}):d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotations({annotations:{bool:{has_epochs:a!=null&&a.epoch_edges.length>0},string:{exception:b.message}},pointName:"derive_and_store_epochs_exception",traceId:g}))}});return F.apply(this,arguments)}function e(a,b,c,d,e,f,g,h){return G.apply(this,arguments)}function G(){G=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,g,h,j,k,p){var q=a;if(q==null){j!=null&&(d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"null_messages",traceId:j,type:"none"}),d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(j));return}var r=q.backup_id,s=q.encrypted_messages,t=q.epoch_derivation_set,u=q.exception_string,v=q.message_range_info;q=q.should_delete_mailbox;if(u!=null){d("WALogger").ERROR(o(),u);q===!0&&(j!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"delete_mailbox",traceId:j,type:"none"}),yield b.runInTransaction(function(a){return c("LSDeleteAndReenrollDeviceStateStoredProcedure")(c("LSFactory")(a),{reenrollmentReason:(i||(i=d("LSIntEnum"))).ofNumber(c("LSMEBDeviceReenrollmentReason").RESTORE_FAILED_WITH_NO_DEVICE_FOUND),targetDeviceId:g})},"readwrite",void 0,void 0,f.id+":873"));j!=null&&d("MAWEBRestoreTrackingUtils").markEBRestoreFail(j,!1,"server-side-exception",{string:{exception:u}});return}yield E(t,b,g,j);if(s.length===0){j!=null&&(d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"no_messages",traceId:j,type:"none"}),d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(j));return}if(v==null){j!=null&&(d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"message_range_info_null",traceId:j,type:"none"}),d("MAWEBRestoreTrackingUtils").markEBRestoreFail(j));d("WALogger").ERROR(n());return}r==null&&(d("WALogger").WARN(m(),e),j!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"backup_id_null",traceId:j,type:"none"}));q=v.has_more_after;u=v.has_more_before;t=v.next_message_timestamp_ms_after;var w=v.next_message_timestamp_ms_before;if(u==null||q==null||t==null||w==null){j!=null&&(d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:" message_range_info_incomplete",traceId:j,type:"none"}),d("MAWEBRestoreTrackingUtils").markEBRestoreFail(j));d("WALogger").ERROR(l(),e);return}yield B({backupId:r,encryptedMessages:s,isPointQuery:p,messageRangeInfo:v,sortOrderMs:h,source:k,storage:b,threadId:e,traceId:j});return a});return G.apply(this,arguments)}h!==void 0?h:h=b("handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages.graphql");function H(a){return I.apply(this,arguments)}function I(){I=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.backupId,e=a.encryptedMessages,g=a.messageRangeInfo,h=a.qplEvent,i=a.runningInWorker,l=a.sortOrderMs,m=a.source,n=a.storage,o=a.threadId;a=a.traceId;var p=a!=null?d("WAHashStringToNumber").hashStringToNumber(a):void 0;e=y(e,b);var q=e.encryptedLSEchoMessages,r=e.encryptedMessagesWithProtobufs;e=(b=g)!=null?b:{};g=e.has_more_after;b=e.has_more_before;var s=e.next_message_timestamp_ms_after;e=e.next_message_timestamp_ms_before;if(b==null||g==null||s==null||e==null)return;if(r.length===0){var t;(t=d("EBAPIQPLPoints")).ebAPIAddQPLPoint(i,h,t.EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_START,void 0,p);var u=(yield n.runInTransaction(function(a){return c("LSDecryptMessagesStoredProcedure")(c("LSFactory")(a),{actThreadId:o,encryptedMessages:c("LSVec").ofArray(q)})},"readwrite",void 0,void 0,f.id+":1082"));t.ebAPIAddQPLPoint(i,h,t.EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_END,void 0,p);u=u[0];if(u!=null){d("EBAPIQPLPoints").ebAPIAddQPLPoint(i,h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.ECHO_DECODE_START,void 0,p);u=c("LSVec").toArray(u).map(function(a){return d("LSShape").toRecord(a).value}).map(function(a){return d("MAWJobDefinitions").toEncodedEchoMessage(a)});u={echoMessages:u,hasMoreAfter:g,hasMoreBefore:b,isPointQuery:!1,mpsMessageQuery:void 0,nextMessageTimestampMsAfter:(j||(j=d("I64"))).of_string(s),nextMessageTimestampMsBefore:j.of_string(e),referenceTimestamp:l!=null?l:void 0,requestId:a,taskSource:m!=null?m:void 0};return u}}else{var t;(t=d("EBAPIQPLPoints")).ebAPIAddQPLPoint(i,h,t.EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_START,void 0,p);u=(yield n.runInTransaction(function(a){return c("LSDecryptMessageProtobufsStoredProcedure")(c("LSFactory")(a),{actThreadId:o,encryptedMessagesWithProtobufs:c("LSVec").ofArray(r)})},"readwrite",void 0,void 0,f.id+":1144"));t.ebAPIAddQPLPoint(i,h,t.EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_END,void 0,p);if(u[0]==null){d("WALogger").ERROR(k());d("EBAPIQPLPoints").ebAPIAddQPLPoint(i,h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.PROTOBUF_DECRYPTION_FAILURE,void 0,p);return}n=d("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(u[0]);t={hasMoreAfter:g,hasMoreBefore:b,isPointQuery:!1,mpsMessageQuery:void 0,nextMessageTimestampMsAfter:(j||(j=d("I64"))).of_string(s),nextMessageTimestampMsBefore:j.of_string(e),protobufMessages:n,referenceTimestamp:l!=null?l:void 0,requestId:a,taskSource:m!=null?m:void 0};return t}});return I.apply(this,arguments)}g.processMessageArray=y;g.getClientState=a;g.deriveAndStoreEpochs=E;g.handleGraphQLRestoreResponse=e;g.processEncryptedMessagesWithoutPersisting=H}),98);
__d("EBAPISharedUtils",["EBAPIQPLPoints","LSDeleteAndReenrollDeviceStateStoredProcedure","LSFactory","LSIntEnum","LSMEBDeviceReenrollmentReason","MAWBridgeSafeActionsWorkerAndUI","MWEBODSEntityName.enum","ODS","WALogger","asyncToGeneratorRuntime","handleRestoreMessagesGraphQLResponse"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Echo to protobuf conversion failed in search range restore response: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] backup_id is null during graphQL restore"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message range info is not complete - cannot proceed with graphQL restore"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message range info is null - cannot proceed with graphQL restore"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] server side exception during graphql restore - ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] GQL worker range restore query returned null for message response"]);o=function(){return a};return a}function a(a){(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,a)}function e(a,b,c,d,e,f,g,h,i,j,k){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,g,h,p,q,r,s,t,u){var v;d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_END,void 0,h);if(a==null||(a==null?void 0:(v=a.viewer)==null?void 0:(v=v.encrypted_backup)==null?void 0:v.mailbox)==null){d("EBAPIQPLPoints").ebAPIEndFailure(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,h);return{response:"invalid-graphql-response",success:!1}}a=a==null?void 0:(v=a.viewer)==null?void 0:(a=v.encrypted_backup)==null?void 0:(v=a.mailbox)==null?void 0:v.messages;if(a==null){d("WALogger").ERROR(o());d("EBAPIQPLPoints").ebAPIEndFailure(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,h);return{response:"invalid-graphql-response",success:!1}}v=a;if((v==null?void 0:v.encrypted_messages)==null){d("EBAPIQPLPoints").ebAPIEndFailure(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NULL_MESSAGES,h);return{response:"invalid-graphql-response",success:!1}}a=v.backup_id;var w=v.encrypted_messages,x=v.epoch_derivation_set,y=v.exception_string,z=v.message_range_info;v=v.should_delete_mailbox;if(y!=null){d("WALogger").ERROR(n(),y);v===!0&&(d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DELETE_MAILBOX,void 0,h),yield g.runInTransaction(function(a){return c("LSDeleteAndReenrollDeviceStateStoredProcedure")(c("LSFactory")(a),{reenrollmentReason:(i||(i=d("LSIntEnum"))).ofNumber(c("LSMEBDeviceReenrollmentReason").RESTORE_FAILED_WITH_NO_DEVICE_FOUND),targetDeviceId:p})},"readwrite",void 0,void 0,f.id+":133"));d("EBAPIQPLPoints").ebAPIEndFailure(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,h,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,exception:y}});return{response:"server-side-exception",success:!1}}d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_START,void 0,h);yield d("handleRestoreMessagesGraphQLResponse").deriveAndStoreEpochs(x,g,p,t,b);d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_END,void 0,h);if(z==null){d("WALogger").ERROR(m());d("EBAPIQPLPoints").ebAPIEndFailure(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,h);return{response:"missing-message-range-info",success:!1}}if(z!=null){v=z.has_more_after;y=z.has_more_before;x=z.next_message_timestamp_ms_after;var A=z.next_message_timestamp_ms_before;if(y==null||v==null||x==null||A==null){d("WALogger").ERROR(l());d("EBAPIQPLPoints").ebAPIEndFailure(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,h);return{response:"missing-message-range-info",success:!1}}}a==null&&(d("WALogger").WARN(k()),d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.BACKUP_ID_NULL,void 0,h));d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.PROCESS_AND_DECRYPT_MESSAGES_START,void 0,h);y=(yield d("handleRestoreMessagesGraphQLResponse").processEncryptedMessagesWithoutPersisting({backupId:a,encryptedMessages:w,messageRangeInfo:z,qplEvent:e,runningInWorker:b,sortOrderMs:u,source:s,storage:g,threadId:q,traceId:t}));d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.PROCESS_AND_DECRYPT_MESSAGES_END,void 0,h);if(y==null){d("EBAPIQPLPoints").ebAPIEndFailure(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.EMPTY_DECRYPTION_RESPONSE,h);return{response:"empty-decryption-response",success:!1}}if(y.echoMessages!=null){v=y;x=v.echoMessages;d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.ECHO_TO_PROTOBUF_CONVERSION_START,void 0,h);try{A=(yield d("MAWBridgeSafeActionsWorkerAndUI").sendAndReceiveBackendWorkerAndUIShared("convertEchoMessagesToEBProtobufs",{chatJid:r,encodedEchoMessages:x}));d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.ECHO_TO_PROTOBUF_CONVERSION_END,void 0,h);y=babelHelpers["extends"]({},y,{echoMessages:void 0,protobufMessages:(y.protobufMessages||[]).concat(A)})}catch(a){d("WALogger").ERROR(j(),a.message);d("EBAPIQPLPoints").ebAPIEndFailure(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.ECHO_TO_PROTOBUF_CONVERSION_FAILURE,h);return{response:"echo-to-protobuf-conversion-error",success:!1}}}d("EBAPIQPLPoints").ebAPIEndSuccess(b,e,h,{bool:{isEcho:((a=y)==null?void 0:a.echoMessages)?((w=y)==null?void 0:w.echoMessages.length)>0:!1,isProtobuf:((z=y)==null?void 0:z.protobufMessages)?((u=y)==null?void 0:u.protobufMessages.length)>0:!1}});return{response:y,success:!0}});return p.apply(this,arguments)}g.bumpOdsRestoreKey=a;g.constructEBRestoreResponse=e}),98);
__d("EBGenerateMessageTags",["EncryptedBackupsUploadEntity","MSGDataclassTypes.flow"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.IMAGE:return d("MSGDataclassTypes.flow").MpsMessageTag.Photo;case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.VIDEO:return d("MSGDataclassTypes.flow").MpsMessageTag.Video;case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.GIF:return d("MSGDataclassTypes.flow").MpsMessageTag.Gif;case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.PTT:return d("MSGDataclassTypes.flow").MpsMessageTag.Audio;case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.DOCUMENT:return d("MSGDataclassTypes.flow").MpsMessageTag.File;default:return null}}g.generateEBMessageTags=a}),98);
__d("EBIsEbEnabled",["FBLogger","MAWEBSwitch","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(){try{return d("WAResultOrError").makeResult(c("MAWEBSwitch").isEnabled())}catch(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("Failed to check EB enabled");return d("WAResultOrError").makeResult(!1)}}g.isEbEnabled=a}),98);
__d("EBMessagePointQueryWithPersistenceQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9085258601531441"}),null);
__d("EBMessagePointQueryWithPersistenceQuery.graphql",["EBMessagePointQueryWithPersistenceQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"app_id"},c={defaultValue:null,kind:"LocalArgument",name:"restore_payload_string"},d={defaultValue:null,kind:"LocalArgument",name:"restore_type"},e=[{kind:"Variable",name:"app_id",variableName:"app_id"},{kind:"Variable",name:"restore_payload_string",variableName:"restore_payload_string"},{kind:"Variable",name:"restore_type",variableName:"restore_type"}],f={alias:null,args:null,kind:"ScalarField",name:"encryption_version",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf_stanza",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp_ms",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"sk_ciphertext",storageKey:null},l=[g,h];return{fragment:{argumentDefinitions:[a,c,d],kind:"Fragment",metadata:null,name:"EBMessagePointQueryWithPersistenceQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:e,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages_point_restore",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages"}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[c,d,a],kind:"Operation",name:"EBMessagePointQueryWithPersistenceQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:e,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages_point_restore",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMessage",kind:"LinkedField",name:"encrypted_messages",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEchoDocument",kind:"LinkedField",name:"echo_document",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"echo_document_string",storageKey:null},f,g,h,{alias:null,args:null,kind:"ScalarField",name:"epoch_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"otid",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanzas",kind:"LinkedField",name:"protobuf_stanzas",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"top_level_protobuf",plural:!1,selections:[i,f,g,h,j,k],storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs",plural:!0,selections:[i,f,g,h,j,k,{alias:null,args:null,kind:"ScalarField",name:"supplemental_key",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},{alias:null,args:null,concreteType:"XFBMessageRangeInfo",kind:"LinkedField",name:"message_range_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_more_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_more_after",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_after",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_delete_mailbox",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:l,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:b("EBMessagePointQueryWithPersistenceQuery_facebookRelayOperation"),metadata:{},name:"EBMessagePointQueryWithPersistenceQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("XFBLSRestoreOperationType.facebook",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["DELTA_GENERIC_MESSAGE_SYNC","INITIAL_RESTORE","MESSAGE_QUERY_RESTORE","POINT_QUERY_RESTORE","RANGE_QUERY_RESTORE","SNAPSHOT_RESTORE","SURROUNDING_RESTORE","UNKNOWN"]);c=a;f["default"]=c}),66);
__d("EBMessagePointQueryWithPersistence",["EBAPIQPLPoints","EBAPISharedUtils","EBAPIWorkerCheck","EBMessagePointQueryWithPersistenceQuery.graphql","I64","LSDecryptMessageProtobufsStoredProcedure","LSDecryptMessagesStoredProcedure","LSDeleteAndReenrollDeviceStateStoredProcedure","LSEncryptedBackupsBackupTenancy","LSFactory","LSIntEnum","LSMEBDeviceReenrollmentReason","LSMEBTaskCreationSource","LSShape","LSVec","MAWBridge","MAWCurrentUser","MAWEBRestoreTrackingUtils","MAWEncryptedBackupUtils","MAWJobDefinitions","MAWMainTraceUtils","QPLUserFlow","WABase64","WAHashStringToNumber","WALogger","WAResultOrError","WorkerRelay","WorkerRelayNetwork","asyncToGeneratorRuntime","cr:7713","handleRestoreMessagesGraphQLResponse","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] graphQL point restore error ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message range info is not complete - cannot proceed with graphQL restore"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] backup_id is null during graphQL restore"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message range info is null - cannot proceed with graphQL restore"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] server side exception during graphql restore - ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] GQL worker point restore query returned null for message response"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mandatory params of client state are null"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No client state found - unable to restore"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling EBLS without EBLS being available for message point query"]);s=function(){return a};return a}var t=h!==void 0?h:h=b("EBMessagePointQueryWithPersistenceQuery.graphql");function a(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.jid,f=a.messageId,g=a.sortOrderMs,h=a.source,u=a.threadId;a=a.traceId;if(!d("EBAPIWorkerCheck").runningInWorker())return d("WAResultOrError").makeError("unsupported-context");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql");a=a!=null?a:d("MAWMainTraceUtils").createTraceId();var v=d("WAHashStringToNumber").hashStringToNumber(a),w=c("qpl")._(521474469,"2612");try{var x,y;c("QPLUserFlow").start(w,{annotations:{bool:{mainThreadRestore:!1,workerThreadRestore:!0},"int":{source:(x=h)!=null?x:c("LSMEBTaskCreationSource").UNKNOWN}},instanceKey:v});d("MAWEBRestoreTrackingUtils").markEBRestorePoint(h,a,"GQL_WORKER",!0);if(b("cr:7713")==null){d("WALogger").ERROR(s());c("QPLUserFlow").endFailure(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.EBLS_NOT_INITIALIZED,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.EBLS_NOT_INITIALIZED}},instanceKey:v});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a,!0,"ebls_not_initialized");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("ebls-not-intialized")}yield b("cr:7713").init();x=(yield b("cr:7713").getLSStorage());var z=(yield d("MAWEncryptedBackupUtils").getBackupTenancy(x.tables));if(z==null||!(i||(i=d("I64"))).equal(z,(j||(j=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION))){c("QPLUserFlow").addPoint(w,"eb_not_enabled",{instanceKey:v});c("QPLUserFlow").endSuccess(w,{instanceKey:v});d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"eb_not_enabled",traceId:a});d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(a,!0);d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.success");return d("WAResultOrError").makeResult()}d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"lsdb_singleton_retrieved",traceId:a});c("QPLUserFlow").addPoint(w,"lsdb_singleton_retrieved",{instanceKey:v});z=(yield d("handleRestoreMessagesGraphQLResponse").getClientState(x));d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotationsWorker({annotations:{string:{device_id:(i||(i=d("I64"))).to_string((y=z==null?void 0:z.device_id)!=null?y:(i||(i=d("I64"))).zero)}},pointName:"client_state_retrieved",traceId:a});c("QPLUserFlow").addPoint(w,"client_state_retrieved",{data:{string:{device_id:i.to_string((y=z==null?void 0:z.device_id)!=null?y:(i||(i=d("I64"))).zero)}},instanceKey:v});if(z==null){d("WALogger").ERROR(r());c("QPLUserFlow").endFailure(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE}},instanceKey:v});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a,!0,"no_client_state");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("no-client-state")}var A=z.device_id;y=z.locally_available_epochs;var B=z.mailboxRootKey;z=z.ocmfClientStateBlob;if(A==null||B==null||z==null){d("WALogger").ERROR(q());c("QPLUserFlow").endFailure(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE}},instanceKey:v});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a,!0,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE);d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("invalid-client-state")}var C=d("MAWCurrentUser").getAppID();d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"app_id_retrieved",traceId:a});c("QPLUserFlow").addPoint(w,"app_id_retrieved",{instanceKey:v});y={restore_context:{act_thread_id:d("MAWJobDefinitions").toThreadJidPrimaryId(u),site:"www",tam_thread_subtype:0},success:babelHelpers["extends"]({device_context:{device_id:i.to_string(A),locally_available_epochs:y,raw_tokens:{mailbox_root_key:d("WABase64").encodeB64(B),ocmf_client_state_blob:d("WABase64").encodeB64(z)}},message_id:f},g!=null?{reference_timestamp:g}:{})};d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"graphql_query_start",traceId:a});c("QPLUserFlow").addPoint(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_START,{instanceKey:v});yield d("WorkerRelayNetwork").createWorkerNetworkExecute();z=(yield d("WorkerRelay").createWorkerQuery(t,{app_id:String((B=C)!=null?B:"0"),restore_payload_string:JSON.stringify(y),restore_type:"POINT_QUERY_RESTORE"}));d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"graphql_query_end",traceId:a});c("QPLUserFlow").addPoint(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_END,{instanceKey:v});if(z==null||(z==null?void 0:(f=z.viewer)==null?void 0:(C=f.encrypted_backup)==null?void 0:C.mailbox)==null){c("QPLUserFlow").endFailure(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}},instanceKey:v});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a,!0,"gql_point_restore_exception");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}C=z==null?void 0:(B=z.viewer)==null?void 0:(y=B.encrypted_backup)==null?void 0:(f=y.mailbox)==null?void 0:f.messages_point_restore;if(C==null){d("WALogger").ERROR(p());c("QPLUserFlow").endFailure(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}},instanceKey:v});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a,!0,"gql_point_restore_exception");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}z=C;if((z==null?void 0:z.encrypted_messages)==null){c("QPLUserFlow").endFailure(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NULL_MESSAGES,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NULL_MESSAGES}},instanceKey:v});d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"null_messages",traceId:a});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a,!0,"null_messages");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}B=z.backup_id;y=z.encrypted_messages;f=z.epoch_derivation_set;C=z.exception_string;var D=z.message_range_info;z=z.should_delete_mailbox;if(C!=null){d("WALogger").ERROR(o(),C);z===!0&&(c("QPLUserFlow").addPoint(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DELETE_MAILBOX,{instanceKey:v}),yield x.runInTransaction(function(a){return c("LSDeleteAndReenrollDeviceStateStoredProcedure")(c("LSFactory")(a),{reenrollmentReason:(j||(j=d("LSIntEnum"))).ofNumber(c("LSMEBDeviceReenrollmentReason").RESTORE_FAILED_WITH_NO_DEVICE_FOUND),targetDeviceId:A})},"readwrite"),d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"delete_mailbox",traceId:a}));c("QPLUserFlow").endFailure(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,exception:C}},instanceKey:v});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a,!0,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,exception:C}});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("server-side-exception")}d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"derive_and_store_epochs_start",traceId:a});c("QPLUserFlow").addPoint(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_START,{instanceKey:v});c("QPLUserFlow").addAnnotations(w,{bool:{hasEpochs:f!=null&&f.epoch_edges.length>0}},{instanceKey:v});yield d("handleRestoreMessagesGraphQLResponse").deriveAndStoreEpochs(f,x,A,a,!0);d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"derive_and_store_epochs_end",traceId:a});c("QPLUserFlow").addPoint(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_END,{instanceKey:v});y.length===0&&(c("QPLUserFlow").addPoint(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_MESSAGES_TO_RESTORE,{instanceKey:v}),d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"no_messages",traceId:a}));if(D==null){d("WALogger").ERROR(n());c("QPLUserFlow").endFailure(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO}},instanceKey:v});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a,!0,"missing_message_range_info");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("missing-message-range-info")}B==null&&(d("WALogger").WARN(m()),c("QPLUserFlow").addPoint(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.BACKUP_ID_NULL,{instanceKey:v}),d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"backup_id_null",traceId:a}));z=D.has_more_after;C=D.has_more_before;f=D.next_message_timestamp_ms_after;D=D.next_message_timestamp_ms_before;if(C==null||z==null||f==null||D==null){d("WALogger").ERROR(l());c("QPLUserFlow").endFailure(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO}},instanceKey:v});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a,!0,"message_range_info_null");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("missing-message-range-info")}y=d("handleRestoreMessagesGraphQLResponse").processMessageArray(y,B,w,v);var E=y.encryptedLSEchoMessages,F=y.encryptedMessagesWithProtobufs;if(F.length===0){d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"decrypt_messages_echo_start",traceId:a});c("QPLUserFlow").addPoint(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_START,{instanceKey:v});B=(yield x.runInTransaction(function(a){return c("LSDecryptMessagesStoredProcedure")(c("LSFactory")(a),{actThreadId:u,encryptedMessages:c("LSVec").ofArray(E)})},"readwrite"));d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"decrypt_messages_echo_end",traceId:a});c("QPLUserFlow").addPoint(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_END,{instanceKey:v});y=B[0];if(y!=null){B=c("LSVec").toArray(y).map(function(a){return d("LSShape").toRecord(a).value});c("promiseDone")(d("MAWBridge").getBridge().sendAndReceive("event","uiUpdate",{events:[{tag:"RestoreNativeOp",value:{chatJid:e,echoMessages:c("LSVec").ofArray(B),hasMoreAfter:z,hasMoreBefore:C,isPointQuery:!0,nextMessageTimestampMsAfter:(i||(i=d("I64"))).of_string(f),nextMessageTimestampMsBefore:i.of_string(D),referenceTimestamp:g!=null?(i||(i=d("I64"))).to_string(g):void 0,requestId:a,taskSource:(j||(j=d("LSIntEnum"))).ofNumber((y=h)!=null?y:c("LSMEBTaskCreationSource").UNKNOWN),threadId:u}}]}))}}else{d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"decrypt_messages_protobuf_start",traceId:a});c("QPLUserFlow").addPoint(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_START,{instanceKey:v});B=(yield x.runInTransaction(function(a){return c("LSDecryptMessageProtobufsStoredProcedure")(c("LSFactory")(a),{actThreadId:u,encryptedMessagesWithProtobufs:c("LSVec").ofArray(F)})},"readwrite"));d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"decrypt_messages_protobuf_end",traceId:a});c("QPLUserFlow").addPoint(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_END,{instanceKey:v});if(B[0]!=null){y=d("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(B[0]);c("promiseDone")(d("MAWBridge").getBridge().sendAndReceive("event","uiUpdate",{events:[{tag:"RestoreNativeOp",value:{chatJid:e,decryptedMessagesProtobufs:y,hasMoreAfter:z,hasMoreBefore:C,isPointQuery:!0,nextMessageTimestampMsAfter:(i||(i=d("I64"))).of_string(f),nextMessageTimestampMsBefore:i.of_string(D),referenceTimestamp:g!=null?(i||(i=d("I64"))).to_string(g):void 0,requestId:a,taskSource:(j||(j=d("LSIntEnum"))).ofNumber((x=h)!=null?x:c("LSMEBTaskCreationSource").UNKNOWN),threadId:u}}]}))}else{c("QPLUserFlow").endFailure(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPTED_PROTOBUFS_NULL,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPTED_PROTOBUFS_NULL}},instanceKey:v});d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"decrypted_protobufs_null",traceId:a});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a,!0,"decrypted_protobufs_null");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}}c("QPLUserFlow").endSuccess(w,{annotations:{bool:{isEcho:F.length===0,isProtobuf:F.length>0}},instanceKey:v});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.success");return d("WAResultOrError").makeResult()}catch(b){d("WALogger").ERROR(k(),b);c("QPLUserFlow").endFailure(w,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,errorStackTrace:(B=b.stack)!=null?B:""}},error:b,instanceKey:v});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a,!0,"gql_point_restore_exception");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("runtime-error",b)}});return u.apply(this,arguments)}g.pointRestoreQuery=t;g.messagePointQueryWithPersistence=a}),98);
__d("EBgenerateMPSMessageQuery",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return{__typename:"MPSMessageQuery",ctx:{__typename:"MPSQueryContext",caller:"HISTORY_RESTORE"},query:{__typename:"MPSMessagePointQuery",include_deleted:!1,otids:b,thread_id:a}}}f.generateMPSMessageQuery=a}),66);
__d("EBMessageBulkPointQuery",["EBAPIQPLPoints","EBAPISharedUtils","EBAPIWorkerCheck","EBMessagePointQueryWithPersistence","EBgenerateMPSMessageQuery","I64","LSEncryptedBackupsBackupTenancy","LSIntEnum","LSMEBTaskCreationSource","LSVec","MAWCurrentUser","MAWEncryptedBackupUtils","QPLUserFlow","WABase64","WAHashStringToNumber","WALogger","WAPushSafeTypes","WAResultOrError","WorkerRelay","asyncToGeneratorRuntime","cr:9437","handleRestoreMessagesGraphQLResponse","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] graphQL bulk point restore error ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mandatory params of client state are null"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No client state found - unable to restore"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling EBLS without EBLS being available for message bulk point query"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] GQL bulk point query called from non-worker context"]);n=function(){return a};return a}function a(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!d("EBAPIWorkerCheck").runningInWorker()){d("WALogger").ERROR(n());return d("WAResultOrError").makeError("called-from-main-thread")}d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.bulkpoint.search.gql");a=d("WAPushSafeTypes").unsafeNotNullable(a);var e=a.chatJid,f=a.messageIds,g=a.sortOrderMsList,o=a.source,p=a.threadId;a=a.traceId;var q=a!=null?d("WAHashStringToNumber").hashStringToNumber(a):void 0,r=c("qpl")._(521482281,"2703");try{var s;c("QPLUserFlow").start(r,{annotations:{bool:{bulkPointQuery:!0,mainThreadRestore:!1,workerThreadRestore:!0},"int":{source:(s=o)!=null?s:c("LSMEBTaskCreationSource").UNKNOWN}},instanceKey:q});if(b("cr:9437")==null){d("WALogger").ERROR(m());c("QPLUserFlow").endFailure(r,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.EBLS_NOT_INITIALIZED,{instanceKey:q});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.bulkpoint.search.gql.error");return d("WAResultOrError").makeError("ebls-not-intialized")}yield b("cr:9437").init();s=(yield b("cr:9437").getLSStorage());var t=(yield d("MAWEncryptedBackupUtils").getBackupTenancy(s.tables));if(t==null||!(h||(h=d("I64"))).equal(t,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION))){c("QPLUserFlow").addPoint(r,"eb_not_enabled",{instanceKey:q});c("QPLUserFlow").endSuccess(r,{instanceKey:q});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.bulkpoint.search.gql.error");return d("WAResultOrError").makeError("eb-not-enabled")}t=(yield d("handleRestoreMessagesGraphQLResponse").getClientState(s));if(t==null){d("WALogger").ERROR(l());c("QPLUserFlow").endFailure(r,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE,{instanceKey:q});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.bulkpoint.search.gql.error");return d("WAResultOrError").makeError("no-client-state")}var u=t.device_id,v=t.locally_available_epochs,w=t.mailboxRootKey;t=t.ocmfClientStateBlob;if(u==null||w==null||t==null){d("WALogger").ERROR(k());c("QPLUserFlow").endFailure(r,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE,{instanceKey:q});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.bulkpoint.search.gql.error");return d("WAResultOrError").makeError("invalid-client-state")}var x=d("MAWCurrentUser").getAppID();v={restore_context:{act_thread_id:p,site:"www",tam_thread_subtype:0},success:{device_context:{device_id:(h||(h=d("I64"))).to_string(u),locally_available_epochs:v,raw_tokens:{mailbox_root_key:d("WABase64").encodeB64(w),ocmf_client_state_blob:d("WABase64").encodeB64(t)}},mps_message_query:JSON.stringify(d("EBgenerateMPSMessageQuery").generateMPSMessageQuery(p,f))}};if(g!=null){w=c("LSVec").ofArray(g.map(function(a){return(h||(h=d("I64"))).of_string(""+a)}));v=babelHelpers["extends"]({},v,{sort_order_ms_list:w})}c("QPLUserFlow").addPoint(r,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_START,{instanceKey:q});f=(yield d("WorkerRelay").createWorkerQuery(d("EBMessagePointQueryWithPersistence").pointRestoreQuery,{app_id:String((t=x)!=null?t:"0"),restore_payload_string:JSON.stringify(v),restore_type:"MESSAGE_QUERY_RESTORE"}));g=(yield d("EBAPISharedUtils").constructEBRestoreResponse(f,!0,r,s,q,u,p,e,o,a,void 0));if(g.success){d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.bulkpoint.search.gql.success");return d("WAResultOrError").makeResult(g.response)}else{d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.bulkpoint.search.gql.error");return d("WAResultOrError").makeError(g.response)}}catch(a){d("WALogger").ERROR(j(),a);c("QPLUserFlow").endFailure(r,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,{error:a,instanceKey:q});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.bulkpoint.search.gql.error");return d("WAResultOrError").makeError("runtime-error",a)}});return o.apply(this,arguments)}g.messageBulkPointQuery=a}),98);
__d("EBMessageRangeQueryWithPersistenceQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="8765464933531736"}),null);
__d("EBMessageRangeQueryWithPersistenceQuery.graphql",["EBMessageRangeQueryWithPersistenceQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"app_id"},c={defaultValue:null,kind:"LocalArgument",name:"restore_payload_string"},d={defaultValue:null,kind:"LocalArgument",name:"restore_type"},e=[{kind:"Variable",name:"app_id",variableName:"app_id"},{kind:"Variable",name:"restore_payload_string",variableName:"restore_payload_string"},{kind:"Variable",name:"restore_type",variableName:"restore_type"}],f={alias:null,args:null,kind:"ScalarField",name:"encryption_version",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf_stanza",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp_ms",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"sk_ciphertext",storageKey:null},l=[g,h];return{fragment:{argumentDefinitions:[a,c,d],kind:"Fragment",metadata:null,name:"EBMessageRangeQueryWithPersistenceQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:e,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages"}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[c,d,a],kind:"Operation",name:"EBMessageRangeQueryWithPersistenceQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:e,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMessage",kind:"LinkedField",name:"encrypted_messages",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEchoDocument",kind:"LinkedField",name:"echo_document",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"echo_document_string",storageKey:null},f,g,h,{alias:null,args:null,kind:"ScalarField",name:"epoch_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"otid",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanzas",kind:"LinkedField",name:"protobuf_stanzas",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"top_level_protobuf",plural:!1,selections:[i,f,g,h,j,k],storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs",plural:!0,selections:[i,f,g,h,j,k,{alias:null,args:null,kind:"ScalarField",name:"supplemental_key",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},{alias:null,args:null,concreteType:"XFBMessageRangeInfo",kind:"LinkedField",name:"message_range_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_more_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_more_after",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_after",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_delete_mailbox",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:l,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:b("EBMessageRangeQueryWithPersistenceQuery_facebookRelayOperation"),metadata:{},name:"EBMessageRangeQueryWithPersistenceQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("EchoMessageDecryptor",["CryptoUtils","I64","LSAuthorityLevel","LSIntEnum","MEBEncryptionVersion","Promise","ReQL","WACryptoUtils","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No backup id provided"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to derive symmetric key for message"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No epoch keys found for message"]);m=function(){return a};return a}a=function(){function a(){}var e=a.prototype;e.decrypt=function(a,e,f){var g=this;f=f.map(function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var f=(yield g.getEpochKeysByID(a,b));if(f.length===0){d("WALogger").ERROR(m());return{otid:b.otid,value:null}}f=(yield d("CryptoUtils").deriveMessageSymmetricKey(f[0].epochAnonIdBlob,f[0].epochRootKeyBlob,(f=b.encryption_version)!=null?f:c("MEBEncryptionVersion").UNKNOWN,e));if(f==null||f.length===0){d("WALogger").ERROR(l());return{otid:b.otid,value:null}}f=(yield d("CryptoUtils").symmetricEncryptionCreateDecryptedString(f[0],new TextEncoder().encode([d("CryptoUtils").MESSAGE_ENCYPTION_AAD,e].join(d("CryptoUtils").STRING_JOIN_SEPARATOR)).buffer,b.value));return{otid:b.otid,value:f}});return function(a){return f.apply(this,arguments)}}());return(j||(j=b("Promise"))).all(f)};e.getEpochs=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(b==null){d("WALogger").ERROR(k());return[]}a=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_epochs)));return a.filter(function(a){return(h||(h=d("LSIntEnum"))).toNumber(a.authorityLevel)===c("LSAuthorityLevel").AUTHORITATIVE&&(i||(i=d("I64"))).equal(a.backupId,(i||(i=d("I64"))).of_float(b))&&e.equals(a[e.key])})});function e(b,c,d){return a.apply(this,arguments)}return e}();e.getEpochKeysByID=function(a,b){var c=b.epoch_id;return c!=null?this.getEpochs(a,b.backup_id,{equals:function(a){return a instanceof ArrayBuffer?!1:(i||(i=d("I64"))).equal(c,a)},key:"epochId",value:c}):this.getEpochs(a,b.backup_id,{equals:function(a){return a instanceof ArrayBuffer?d("WACryptoUtils").arrayBuffersEqual(b.epoch_anon_id,a):!1},key:"epochAnonIdBlob",value:b.epoch_anon_id})};return a}();g.EchoMessageDecryptor=a}),98);
__d("LSEncryptedBackupsMessagesRangeQueryDirection",[],(function(a,b,c,d,e,f){a=Object.freeze({BEFORE:1,AFTER:2});f["default"]=a}),66);
__d("EBMessageRangeQueryWithPersistence",["EBAPIQPLPoints","EBAPISharedUtils","EBAPIWorkerCheck","EBMessageRangeQueryWithPersistenceQuery.graphql","EchoMessageDecryptor","I64","LSDatabaseSingleton","LSDecryptMessageProtobufsStoredProcedure","LSDecryptMessagesStoredProcedure","LSDeleteAndReenrollDeviceStateStoredProcedure","LSEncryptedBackupsMessagesRangeQueryDirection","LSFactory","LSIntEnum","LSMEBDeviceReenrollmentReason","LSMEBTaskCreationSource","LSShape","LSVec","MAWCurrentUser","MAWEBRestoreTrackingUtils","MAWJobDefinitions","MAWMiActGetThreadLifecycleState","MAWMiActThreadLifecycleState","QPLUserFlow","WABase64","WAHashStringToNumber","WAJids","WAResultOrError","WATagsLogger","WorkerRelay","WorkerRelayNetwork","asyncToGeneratorRuntime","gkx","handleRestoreMessagesGraphQLResponse","justknobx","promiseDone","qpl","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["graphQL range restore error ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["message range info is not complete - cannot proceed with graphQL restore"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["backup_id is null during graphQL restore"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["message range info is null - cannot proceed with graphQL restore"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["server side exception during graphql restore - ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["GQL worker range restore query returned null for message response"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["mandatory params of client state are null"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["No client state found - unable to restore"]);s=function(){return a};return a}var t=c("requireDeferred")("LSEBUnifiedRestoreUtils").__setRef("EBMessageRangeQueryWithPersistence"),u=c("requireDeferred")("LSRestoreEchoBlobs.nop").__setRef("EBMessageRangeQueryWithPersistence"),v=c("requireDeferred")("LSRestoreProtobufs.nop").__setRef("EBMessageRangeQueryWithPersistence"),w=d("WATagsLogger").TAGS(["labyrinth_web","EBMessageRangeQueryWithPersistence"]),x=c("justknobx")._("3177"),y=h!==void 0?h:h=b("EBMessageRangeQueryWithPersistenceQuery.graphql");function a(a){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.chatJid,g=a.direction,h=a.includeOffset;h=h===void 0?!1:h;var z=a.sortOrderMs,B=a.source,C=a.traceId;if(d("EBAPIWorkerCheck").runningInWorker())return d("WAResultOrError").makeError("unsupported-context");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql");var D=d("WAHashStringToNumber").hashStringToNumber(C),E=c("qpl")._(521471755,"2586");try{var F,G;c("QPLUserFlow").start(E,{annotations:{bool:{mainThreadRestore:!0,workerThreadRestore:!1},"int":{source:(F=B)!=null?F:c("LSMEBTaskCreationSource").UNKNOWN},string:{request_args:JSON.stringify(a)}},instanceKey:D,timeoutInMs:c("justknobx")._("2950")});d("MAWEBRestoreTrackingUtils").markEBRestorePaginated(B,C,"GQL_MAIN_THREAD");var H=(yield (i||(i=d("LSDatabaseSingleton"))).getLSDatabaseSingletonPromiseOrValue());d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"lsdb_singleton_retrieved",traceId:C,type:"none"});c("QPLUserFlow").addPoint(E,"lsdb_singleton_retrieved",{instanceKey:D});var I;yield H.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;I=(yield d("handleRestoreMessagesGraphQLResponse").getClientState(H,a));d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotations({annotations:{string:{device_id:(j||(j=d("I64"))).to_string((b=(b=I)==null?void 0:b.device_id)!=null?b:(j||(j=d("I64"))).zero)}},pointName:"client_state_retrieved",traceId:C});c("QPLUserFlow").addPoint(E,"client_state_retrieved",{data:{string:{device_id:j.to_string((b=(b=I)==null?void 0:b.device_id)!=null?b:(j||(j=d("I64"))).zero)}},instanceKey:D});b=(yield d("MAWMiActGetThreadLifecycleState").getThreadLifecycleStateByJid(a,j.of_string(d("WAJids").threadIdForChatJid(e)),"GQL_range_restore_eb_api_call"));if(b.type===d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MAPPING_ROW||b.type===d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MI_THREAD){d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotations({annotations:{string:{thread_state_by_jid:b.type}},pointName:"chat_jid_not_found_in_act_mapping_table",traceId:C});c("QPLUserFlow").addPoint(E,"chat_jid_not_found_in_act_mapping_table",{instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(C,!1);c("QPLUserFlow").endSuccess(E,{instanceKey:D});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.thread.missing.error");return d("WAResultOrError").makeError("thread-not-found-in-mi-act-mapping-table")}else d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotations({annotations:{string:{thread_state_by_jid:b.type}},pointName:"chat_jid_exists_in_act_mapping_table",traceId:C}),c("QPLUserFlow").addPoint(E,"chat_jid_exists_in_act_mapping_table",{instanceKey:D})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":188");if(I==null){w.ERROR(s());c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!1,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE);d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("no-client-state")}F=I;var J=F.device_id;a=F.locally_available_epochs;var K=F.mailboxRootKey;F=F.ocmfClientStateBlob;if(J==null||K==null||F==null){w.ERROR(r());c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!1,"client_state_null");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("invalid-client-state")}var L=d("MAWCurrentUser").getAppID();d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"app_id_retrieved",traceId:C,type:"none"});c("QPLUserFlow").addPoint(E,"app_id_retrieved",{instanceKey:D});var M=d("WAJids").threadIdForChatJid(e);d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"converted_chatjid_to_threadid",traceId:C,type:"none"});c("QPLUserFlow").addPoint(E,"converted_chatjid_to_threadid",{instanceKey:D});g=g==="before"?c("LSEncryptedBackupsMessagesRangeQueryDirection").BEFORE:c("LSEncryptedBackupsMessagesRangeQueryDirection").AFTER;a={restore_context:{act_thread_id:d("MAWJobDefinitions").toThreadJidPrimaryId(M),site:"www",tam_thread_subtype:0},success:babelHelpers["extends"]({device_context:{device_id:(j||(j=d("I64"))).to_string(J),locally_available_epochs:a,raw_tokens:{mailbox_root_key:d("WABase64").encodeB64(K),ocmf_client_state_blob:d("WABase64").encodeB64(F)}},direction:g,include_offset:h,server_thread_key:M},z!=null?{reference_timestamp:z}:{})};c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_START,{instanceKey:D});d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"graphql_query_start",traceId:C,type:"none"});var N;try{yield d("WorkerRelayNetwork").createWorkerNetworkExecute();N=(yield d("WorkerRelay").createWorkerQuery(y,{app_id:String((K=L)!=null?K:"0"),restore_payload_string:JSON.stringify(a),restore_type:"RANGE_QUERY_RESTORE"}));c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_END,{instanceKey:D});d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"graphql_query_end",traceId:C,type:"none"})}catch(a){c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_EXCEPTION,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_EXCEPTION,errorStackTrace:(F=a.stack)!=null?F:""}},instanceKey:D});return d("WAResultOrError").makeError("invalid-graphql-response")}if(N==null||((g=N)==null?void 0:(h=g.viewer)==null?void 0:(L=h.encrypted_backup)==null?void 0:L.mailbox)==null){c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!1,"gql_range_restore_exception");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}h=(K=N)==null?void 0:(a=K.viewer)==null?void 0:(F=a.encrypted_backup)==null?void 0:(g=F.mailbox)==null?void 0:g.messages;if(h==null){w.ERROR(q());c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!1,"gql_range_restore_exception");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}L=h;if((L==null?void 0:L.encrypted_messages)==null){c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NULL_MESSAGES,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NULL_MESSAGES}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!1,"null_messages");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}K=L.backup_id;a=L.encrypted_messages;F=L.epoch_derivation_set;g=L.exception_string;h=L.message_range_info;L=L.should_delete_mailbox;c("QPLUserFlow").addAnnotations(E,{bool:{should_delete_mailbox:(G=L)!=null?G:!1},"int":{response_messages:a.length},string:{message_range_info:JSON.stringify(h)}},{instanceKey:D});if(g!=null){w.ERROR(p(),g);L===!0&&(c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DELETE_MAILBOX,{instanceKey:D}),yield H.runInTransaction(function(a){return c("LSDeleteAndReenrollDeviceStateStoredProcedure")(c("LSFactory")(a),{reenrollmentReason:(k||(k=d("LSIntEnum"))).ofNumber(c("LSMEBDeviceReenrollmentReason").RESTORE_FAILED_WITH_NO_DEVICE_FOUND),targetDeviceId:J})},"readwrite",void 0,void 0,f.id+":532"),d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"delete_mailbox",traceId:C,type:"none"}));c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,exception:g}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!1,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,{string:{exception:g}});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("server-side-exception")}c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_START,{instanceKey:D});yield d("handleRestoreMessagesGraphQLResponse").deriveAndStoreEpochs(F,H,J,C);c("QPLUserFlow").addAnnotations(E,{bool:{hasEpochs:F!=null&&F.epoch_edges.length>0}},{instanceKey:D});c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_END,{instanceKey:D});a.length===0&&(c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_MESSAGES_TO_RESTORE,{instanceKey:D}),d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"no_messages",traceId:C,type:"none"}));if(h==null){w.ERROR(o());c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!1,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO);d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("missing-message-range-info")}K==null&&(w.WARN(n()),c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.BACKUP_ID_NULL,{instanceKey:D}),d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"backup_id_null",traceId:C,type:"none"}));var O=h.has_more_after,P=h.has_more_before,Q=h.next_message_timestamp_ms_after,R=h.next_message_timestamp_ms_before;if(P==null||O==null||Q==null||R==null){w.ERROR(m());c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!1,"message_range_info_null");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("missing-message-range-info")}G=d("handleRestoreMessagesGraphQLResponse").processMessageArray(a,K,E,D);var S=G.encryptedLSEchoMessages,T=G.encryptedMessagesWithProtobufs;L=G.encryptedNonLSEchoMessages;g="none";if(S.length>0&&T.length>0&&S.length+T.length===x){g="mixed";c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RESTORING_MIXED_ECHO_PROTOBUF_PAYLOAD,{instanceKey:D});c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_AND_PROTOBUF_START,{instanceKey:D});F=(yield H.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield c("LSDecryptMessagesStoredProcedure")(c("LSFactory")(a),{actThreadId:M,encryptedMessages:c("LSVec").ofArray(S)}));a=(yield c("LSDecryptMessageProtobufsStoredProcedure")(c("LSFactory")(a),{actThreadId:M,encryptedMessagesWithProtobufs:c("LSVec").ofArray(T)}));return{decryptedEchoMsgs:b,decryptedProtobufMsgs:a}});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":743"));h=F.decryptedEchoMsgs;var U=F.decryptedProtobufMsgs;c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_AND_PROTOBUF_END,{instanceKey:D});var V;h[0]!=null&&(V=c("LSVec").toArray(h[0]).map(function(a){return d("LSShape").toRecord(a).value}));if(c("gkx")("9385")){yield A((a=V)!=null?a:[],L,M,H,C,D)}c("promiseDone")(t.load().then(function(a){return a.echoProtobufConsolidatedRestoreHelper(M,(a=U[0])!=null?a:c("LSVec").ofArray([]),P,(j||(j=d("I64"))).of_string(R),O,j.of_string(Q),!1,C,z,void 0,c("LSVec").ofArray(V),(k||(k=d("LSIntEnum"))).ofNumber((a=B)!=null?a:c("LSMEBTaskCreationSource").UNKNOWN),e,!0)}))}else if(T.length===0){g="echo";c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_START,{instanceKey:D});K=(yield H.runInTransaction(function(a){return c("LSDecryptMessagesStoredProcedure")(c("LSFactory")(a),{actThreadId:M,encryptedMessages:c("LSVec").ofArray(S)})},"readwrite",void 0,void 0,f.id+":827"));c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_END,{instanceKey:D});G=K[0];if(G!=null){var W=c("LSVec").toArray(G).map(function(a){return d("LSShape").toRecord(a).value});if(c("gkx")("9385")){yield A((F=W)!=null?F:[],L,M,H,C,D)}c("promiseDone")(u.load().then(function(a){return H.runInTransaction(function(b){return a(b,0,(j||(j=d("I64"))).zero,c("LSVec").ofArray(W),P,j.of_string(R),O,j.of_string(Q),!1,M,C,z,(k||(k=d("LSIntEnum"))).ofNumber((b=B)!=null?b:c("LSMEBTaskCreationSource").UNKNOWN),e)},"readwrite",void 0,void 0,f.id+":865")}))}}else{g="protobuf";c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_START,{instanceKey:D});var X=(yield H.runInTransaction(function(a){return c("LSDecryptMessageProtobufsStoredProcedure")(c("LSFactory")(a),{actThreadId:M,encryptedMessagesWithProtobufs:c("LSVec").ofArray(T)})},"readwrite",void 0,void 0,f.id+":897"));c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_END,{instanceKey:D});c("promiseDone")(v.load().then(function(a){return H.runInTransaction(function(b){return a(b,0,M,(b=X[0])!=null?b:c("LSVec").ofArray([]),P,(j||(j=d("I64"))).of_string(R),O,j.of_string(Q),!1,C,z,void 0,c("LSVec").ofArray([]),(k||(k=d("LSIntEnum"))).ofNumber((b=B)!=null?b:c("LSMEBTaskCreationSource").UNKNOWN),e)},"readwrite",void 0,void 0,f.id+":916")}))}c("QPLUserFlow").endSuccess(E,{annotations:{string:{restoreType:g}},instanceKey:D});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.success");return d("WAResultOrError").makeResult()}catch(a){w.ERROR(l(),a);c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,errorStackTrace:(h=a.stack)!=null?h:""}},error:a,instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!1,"gql_range_restore_exception");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("runtime-error",a)}});return z.apply(this,arguments)}function A(a,b,c,d,e,f){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h){var i=c("qpl")._(521471755,"2586");f=(yield new(d("EchoMessageDecryptor").EchoMessageDecryptor)().decrypt(f,e,b));e=C(f,a);d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotations({annotations:{bool:{isMatch:e}},pointName:"ls_and_non_ls_echo_msg_decryption_response_comparison",traceId:g});c("QPLUserFlow").addAnnotations(i,{bool:{does_ls_and_non_ls_echo_msg_decryption_match:e}},{instanceKey:h})});return B.apply(this,arguments)}function C(a,b){if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(a[c].value!==b[c])return!1;return!0}g.query=y;g.messageRangeQueryWithPersistence=a}),98);
__d("EBMessageRangeQueryForIndexing",["EBAPIQPLPoints","EBAPISharedUtils","EBAPIWorkerCheck","EBMessageRangeQueryWithPersistence","I64","LSEncryptedBackupsBackupTenancy","LSEncryptedBackupsMessagesRangeQueryDirection","LSIntEnum","LSMEBTaskCreationSource","MAWCurrentUser","MAWEncryptedBackupUtils","MAWJobDefinitions","QPLUserFlow","WABase64","WAHashStringToNumber","WAJids","WAPushSafeTypes","WAResultOrError","WATagsLogger","WorkerRelay","asyncToGeneratorRuntime","cr:9437","gkx","handleRestoreMessagesGraphQLResponse","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["graphQL range restore error ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["mandatory params of client state are null"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["No client state found - unable to restore"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Calling EBLS without EBLS being available for message range query"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["GQL point query called from non-worker context"]);n=function(){return a};return a}var o=d("WATagsLogger").TAGS(["labyrinth_web","EBMessageRangeQueryForIndexing"]);function a(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!d("EBAPIWorkerCheck").runningInWorker()){o.ERROR(n());return d("WAResultOrError").makeError("called-from-main-thread")}d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.range.search.gql");a=d("WAPushSafeTypes").unsafeNotNullable(a);var e=a.chatJid,f=a.direction,g=a.sortOrderMs,p=a.source;a=a.traceId;var q=a!=null?d("WAHashStringToNumber").hashStringToNumber(a):void 0,r=c("qpl")._(521476367,"2704");try{var s,t;c("QPLUserFlow").start(r,{annotations:{bool:{mainThreadRestore:!1,rangeQueryForIndexing:!0,workerThreadRestore:!0},"int":{source:(s=p)!=null?s:c("LSMEBTaskCreationSource").UNKNOWN}},instanceKey:q});if(b("cr:9437")==null){o.ERROR(m());c("QPLUserFlow").endFailure(r,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.EBLS_NOT_INITIALIZED,{instanceKey:q});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.range.search.gql.error");return d("WAResultOrError").makeError("ebls-not-intialized")}yield b("cr:9437").init();s=(yield b("cr:9437").getLSStorage());var u=(yield d("MAWEncryptedBackupUtils").getBackupTenancy(s.tables));if(u==null||!(h||(h=d("I64"))).equal(u,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION))){c("QPLUserFlow").addPoint(r,"eb_not_enabled",{instanceKey:q});c("QPLUserFlow").endSuccess(r,{instanceKey:q});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.range.search.gql.error");return d("WAResultOrError").makeError("eb-not-enabled")}u=(yield d("handleRestoreMessagesGraphQLResponse").getClientState(s));c("QPLUserFlow").addPoint(r,"client_state_retrieved",{data:{string:{device_id:(h||(h=d("I64"))).to_string((t=u==null?void 0:u.device_id)!=null?t:(h||(h=d("I64"))).zero)}},instanceKey:q});if(u==null){o.ERROR(l());c("QPLUserFlow").endFailure(r,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE,{instanceKey:q});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.range.search.gql.error");return d("WAResultOrError").makeError("no-client-state")}t=u.device_id;var v=u.locally_available_epochs,w=u.mailboxRootKey;u=u.ocmfClientStateBlob;if(t==null||w==null||u==null){o.ERROR(k());c("QPLUserFlow").endFailure(r,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE,{instanceKey:q});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.range.search.gql.error");return d("WAResultOrError").makeError("invalid-client-state")}var x=d("MAWCurrentUser").getAppID(),y=d("WAJids").threadIdForChatJid(e);f=f==="before"?c("LSEncryptedBackupsMessagesRangeQueryDirection").BEFORE:c("LSEncryptedBackupsMessagesRangeQueryDirection").AFTER;v={restore_context:{act_thread_id:d("MAWJobDefinitions").toThreadJidPrimaryId(y),site:"www",tam_thread_subtype:0},success:{device_context:{device_id:h.to_string(t),locally_available_epochs:v,raw_tokens:{mailbox_root_key:d("WABase64").encodeB64(w),ocmf_client_state_blob:d("WABase64").encodeB64(u)}},direction:f,include_offset:c("gkx")("5340"),server_thread_key:y}};if(g!=null){w=v.success;v.success=babelHelpers["extends"]({},w,{reference_timestamp:g});v=babelHelpers["extends"]({},v,{success:v.success})}if(p!=null){u=v.success;v.success=babelHelpers["extends"]({},u,{source:p});v=babelHelpers["extends"]({},v,{success:v.success})}c("QPLUserFlow").addPoint(r,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_START,{instanceKey:q});w=(yield d("WorkerRelay").createWorkerQuery(d("EBMessageRangeQueryWithPersistence").query,{app_id:String((f=x)!=null?f:"0"),restore_payload_string:JSON.stringify(v),restore_type:"RANGE_QUERY_RESTORE"}));u=(yield d("EBAPISharedUtils").constructEBRestoreResponse(w,!0,r,s,q,t,y,e,p,a,g));if(u.success){d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.range.search.gql.success");return d("WAResultOrError").makeResult(u.response)}else{d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.range.search.gql.error");return d("WAResultOrError").makeError(u.response)}}catch(a){o.ERROR(j(),a);c("QPLUserFlow").endFailure(r,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,{error:a,instanceKey:q});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.range.search.gql.error");return d("WAResultOrError").makeError("runtime-error",a)}});return p.apply(this,arguments)}g.messageRangeQueryForIndexing=a}),98);
__d("EBUploadDeletedMessage",["EncryptedBackupsUploadQueue","I64","MAWUserJidWrapper","WAAsMessageApplication","WAJids","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.instanceKey,c=a.msgId,e=a.sender,f=a.serverTs;a=a.sortOrderMs;try{yield d("EncryptedBackupsUploadQueue").putMsgsToEbUpload([{backupDirective:{actionType:3,originalMsgProtocolId:c},instanceKey:b,messageApplication:d("WAAsMessageApplication").castToMessageApplicationBytes(new Uint8Array(0)),msgId:c,originalMsgProtocolId:c,reportingMeta:null,senderId:(h||(h=d("I64"))).of_string(d("WAJids").authorToUserId(e,d("WAJids").extractUserId(d("MAWUserJidWrapper").getMyUserJid()))),serverTs:f,sortOrderMs:a,triggerSource:"upload-deleted-message"}])}catch(a){return d("WAResultOrError").makeError("runtime-error",a)}return d("WAResultOrError").makeResult()});return i.apply(this,arguments)}g.uploadDeletedMessage=a}),98);
__d("EncryptedBackupsConvertToLegacyAttachmentContext",["MAWCastToMsgrServerMediaType","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["invalid "," media type for legacy attachment upload"]);h=function(){return a};return a}function a(a){var b=[];for(var c=0;c<a.length;c++){var e=a[c],f=d("MAWCastToMsgrServerMediaType").castMediaAttachmentTypeToServerMediaType(e.mediaType);f==null?d("WALogger").ERROR(h(),e.mediaType):b.push({mediaObjectId:e.mediaObjectId,mediaType:f})}return b}g["default"]=a}),98);
__d("EncryptedBackupsCastToAttachmentContextMediaType",["EncryptedBackupsUploadEntity","MAWDbMedia","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid AttachmentContextMediaType: ",""]);h=function(){return a};return a}function a(a){switch(a){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:return d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.IMAGE;case d("MAWDbMedia").MEDIA_TYPE.VIDEO:return d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.VIDEO;case d("MAWDbMedia").MEDIA_TYPE.PTT:return d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.PTT;case d("MAWDbMedia").MEDIA_TYPE.GIF:return d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.GIF;case d("MAWDbMedia").MEDIA_TYPE.STICKER:return d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.STICKER;case d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.DOCUMENT;default:a;d("WALogger").ERROR(h(),a);return d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.INVALID}}g["default"]=a}),98);
__d("EncryptedBackupsGetAttachmentContextForReceivedMsg",["EncryptedBackupsCastToAttachmentContextMediaType","EncryptedBackupsUploadEntity","WAMediaUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,e=new Map();if(((b=a.decodedMsg)==null?void 0:b.unstoredDbMedia)!=null){b=(b=a.decodedMsg)==null?void 0:b.unstoredDbMedia;var f=b.mediaType;b=d("WAMediaUtils").decodeMediaEntryData(b.mediaEntry);var g=b.downloadableThumbnail;b=b.objectId;g=g==null?void 0:g.objectId;f=c("EncryptedBackupsCastToAttachmentContextMediaType")(f);b!=null&&f!=null&&e.set(d("WAMediaUtils").stringToDeliveryObjectId(b),f);g!=null&&g!==b&&e.set(d("WAMediaUtils").stringToDeliveryObjectId(g),d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.MESSENGER_PREVIEW)}if(((f=a.decodedMsg)==null?void 0:f.unstoredXMA)!=null){g=(b=a.decodedMsg)==null?void 0:b.unstoredXMA;if(g.unstoredFavicon!=null){f=d("WAMediaUtils").decodeMediaEntryData(g.unstoredFavicon.mediaEntry);a=f.objectId;a!=null&&e.set(d("WAMediaUtils").stringToDeliveryObjectId(a),d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA)}if(g.unstoredHeaderMedia!=null){b=d("WAMediaUtils").decodeMediaEntryData(g.unstoredHeaderMedia.mediaEntry);f=b.objectId;f!=null&&e.set(d("WAMediaUtils").stringToDeliveryObjectId(f),d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA)}if(g.unstoredAssociatedMedia!=null){a=d("WAMediaUtils").decodeMediaEntryData(g.unstoredAssociatedMedia.mediaEntry);b=a.objectId;b!=null&&e.set(d("WAMediaUtils").stringToDeliveryObjectId(b),d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA)}g.unstoredPreviews!=null&&g.unstoredPreviews.length>0&&g.unstoredPreviews.forEach(function(a){a=a.mediaEntry;a=d("WAMediaUtils").decodeMediaEntryData(a);a=a.objectId;a!=null&&e.set(d("WAMediaUtils").stringToDeliveryObjectId(a),d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA)})}return Array.from(e.entries()).map(function(a){var b=a[0];a=a[1];return{mediaObjectId:b,mediaType:a}})}g["default"]=a}),98);
__d("MessageBackupDirectiveGenerator",["FBLogger","I64","MAWJids","MAWMsgType","MessageBackupSupplementalKeyGenerator","WAGlobals","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){a=d("MessageBackupSupplementalKeyGenerator").createReactionSupplementalKey(a);if(a!=null)return a;throw c("FBLogger")("labyrinth_web").mustfixThrow("Failed to create reaction supplemental key")}function j(a,b){a=d("MessageBackupSupplementalKeyGenerator").createEditSupplementalKey(a,b);if(a!=null)return a;throw c("FBLogger")("labyrinth_web").mustfixThrow("Failed to create edit supplemental key")}function k(a,b){b=d("MAWJids").toUserJid((h||(h=d("I64"))).to_string(b).toString());return{actionType:2,originalMsgProtocolId:a,supplementalKey:i(b)}}function l(a,b,c){b=d("MAWJids").toUserJid((h||(h=d("I64"))).to_string(b).toString());return{actionType:2,originalMsgProtocolId:a,supplementalKey:j(b,c)}}function m(a){if(d("WAJids").isAuthorSystem(a.author))return null;if(a.reactToExternalId!=null)return{author:a.reactToAuthor===d("WAGlobals").getMyUserJid()?"@me":a.reactToAuthor,chat:a.threadJid,externalId:a.reactToExternalId};else if(a.originalMsgExternalId!=null)return{author:a.author,chat:a.threadJid,externalId:a.originalMsgExternalId};else if(a.revokedExternalId!=null)return{author:a.author,chat:a.threadJid,externalId:a.revokedExternalId};return a.externalId==null?null:{author:a.author,chat:a.threadJid,externalId:a.externalId}}function a(a){var b=(h||(h=d("I64"))).of_string(d("WAJids").authorToUserId(a.author,d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()))),e=m(a);if(e==null)return null;if(a.originalMsgExternalId!=null){if(a.editTs==null){c("FBLogger")("labyrinth_web").mustfix("editTs is null for edit message during createMessageBackupDirectiveFromDbMsg");return null}return l(e,b,d("WATimeUtils").castUnixTimeToMillisTime(a.editTs))}return a.reactToExternalId!=null?k(e,b):n(e,b,a.type,null)}function n(a,b,e,f){switch(e){case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return{actionType:1,originalMsgProtocolId:a};case d("MAWMsgType").MSG_TYPE.REACTION:return k(a,b);case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:if(f==null)throw c("FBLogger")("labyrinth_web").mustfixThrow("editTs is null for edit message during createMessageBackupDirective");return l(a,b,f);case d("MAWMsgType").MSG_TYPE.REVOKED:return{actionType:4,originalMsgProtocolId:a};case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:return{actionType:3,originalMsgProtocolId:a};default:c("FBLogger")("labyrinth_web").mustfix("Unsupported message type %s",e);return{actionType:0,originalMsgProtocolId:a}}}g.createMessageBackupDirectiveFromDbMsg=a;g.createMessageBackupDirective=n}),98);
__d("EncryptedBackupsCreateUploadMessage",["EBAPIQPLPoints","EBGenerateMessageTags","EncryptedBackupsConvertToLegacyAttachmentContext","EncryptedBackupsGetAttachmentContextForReceivedMsg","I64","LSRequestId","MAWEBSwitch","MAWMessageSortOrderUtils","MAWMsgType","MessageBackupDirectiveGenerator","QPLUserFlow","WAAsMessageApplication","WAByteArray","WAConsumerApplication.pb","WAGlobals","WAJids","WALogger","WAMsgApplication.pb","WATimeUtils","decodeProtobuf","encodeProtobuf","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] no result or failed for incoming stanza ",""]);i=function(){return a};return a}function j(a){if(a==null)return null;var b;if(a.unstoredDbReaction!=null)return d("MAWMsgType").MSG_TYPE.REACTION;else if(a.unstoredDbEditActionMsg!=null)return d("MAWMsgType").MSG_TYPE.EDIT_ACTION;else if(a.unstoredDbMedia!=null){var c;b=a.unstoredDbMedia.mediaType;c=(c=a.unstoredDbMsg)==null?void 0:c.ephemeralSetting}else if(a.unstoredXMA!=null){var e;b=d("MAWMsgType").MSG_TYPE.XMA;c=(e=(e=a.unstoredDbMsg)==null?void 0:e.ephemeralSetting)!=null?e:(e=a.unstoredXMA.unstoredAssociatedMsg)==null?void 0:e.ephemeralSetting}else if(a.unstoredDbMsg!=null)b=a.unstoredDbMsg.type,c=a.unstoredDbMsg.ephemeralSetting;else return null;return d("MAWMsgType").isEBSupportedMsgType(b)&&!(c!=null&&c.ephemeralExpirationInSec>0)?b:null}function k(a){var b,c=a.stanza.message.decrypted.id;if(((b=a.decodedMsg)==null?void 0:b.unstoredDbReaction)!=null)return{author:a.decodedMsg.unstoredDbReaction.reactToAuthor,chat:c.chat,externalId:a.decodedMsg.unstoredDbReaction.reactToExternalId};else if(((b=a.decodedMsg)==null?void 0:b.unstoredDbEditActionMsg)!=null)return{author:c.author,chat:c.chat,externalId:a.decodedMsg.unstoredDbEditActionMsg.originalMsgExternalId};return c}function l(a){var b;return d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,{metadata:a.metadata,payload:{subProtocol:(b={},b[a.subprotocolType]={payload:d("WAByteArray").uint8ArrayToBuffer(a.subprotocol),version:1},b)}}).readByteArray())}function m(a){if(a.subprotocolType!=="consumerMessage")return null;a=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAConsumerApplication.pb").ConsumerApplicationSpec,a.subprotocol);if(a==null)return null;a=(a=a.payload)==null?void 0:a.content;if(a==null)return null;a=a.editMessage;return a==null||a.timestampMs==null?null:d("WATimeUtils").castLongIntToMillisTime(a.timestampMs)}function n(a){var b=a.stanza.message.decrypted.id,e=a.stanza.message.details.ts;a=c("EncryptedBackupsGetAttachmentContextForReceivedMsg")(a);var f=c("EncryptedBackupsConvertToLegacyAttachmentContext")(a),g=[];f.length>0&&f.forEach(function(a){var f=a.mediaObjectId;a=a.mediaType;g.push({deliveryObjectId:f,mediaType:a,messageId:b.externalId,productType:"msgr",threadId:d("WAJids").threadIdForChatJid(b.chat),threadJid:b.chat,traceId:c("LSRequestId").generate(),ts:e})});return{attachmentContext:a,legacyUploadAttachmentArray:g}}function a(a,b,e,f){var g=j(a.decodedMsg);if(g==null){d("WALogger").WARN(i(),a.stanza.message.decrypted.id);c("QPLUserFlow").addPoint(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UNKNOWN_MESSAGE_TYPE,{instanceKey:f});return null}var o=a.stanza.message.decrypted.id,p=o.author,q=o.externalId,r=k(a),s=a.stanza.message.decrypted.msg;if((s==null?void 0:s.version)!=="v3"||s.type!=="subprotocol"){c("QPLUserFlow").addPoint(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UKNOWN_MESSAGE_VERSION_OR_PROTOCOL,{instanceKey:f});return null}var t=l(s);p=(h||(h=d("I64"))).of_string(d("WAJids").authorToUserId(p,d("WAJids").extractUserId(d("WAGlobals").getMyUserJid())));var u=a.stanza.message.details.reportingMeta,v=a.stanza.message.details.ts;a=n(a);var w=a.attachmentContext;a=a.legacyUploadAttachmentArray;var x=w.map(function(a){return d("EBGenerateMessageTags").generateEBMessageTags(a.mediaType)}).filter(Boolean);w.length>0&&c("QPLUserFlow").addPoint(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.ADDED_ATTACHMENT_CONTEXT,{data:{"int":{attachmentCount:w.length}},instanceKey:f});a.length>0&&c("QPLUserFlow").addPoint(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.ADDED_ATTACHMENT_CONTEXT_LEGACY,{data:{"int":{legacyAttachmentCount:a.length}},instanceKey:f});var y=!c("MAWEBSwitch").isEnabled();s=d("MessageBackupDirectiveGenerator").createMessageBackupDirective(r,p,g,g===d("MAWMsgType").MSG_TYPE.EDIT_ACTION?m(s):null);c("QPLUserFlow").addAnnotations(c("qpl")._(521477113,"2698"),{bool:{isRetroactiveUpload:y},"int":{attachmentCount:w.length,backupDirectiveType:s.actionType,legacyAttachmentCount:a.length}},{instanceKey:f});return{attachmentContext:w,backupDirective:s,dbMsgType:g,instanceKey:f,isRetroactiveUpload:y,legacyAttachmentContext:a,messageApplication:t,msgId:o,originalMsgProtocolId:r,reportingMeta:u,senderId:p,serverTs:v,sortOrderMs:(w=e)!=null?w:d("WATimeUtils").castToMillisTime(d("MAWMessageSortOrderUtils").generateAuthoritativeMessageSortOrder({externalId:q,serverTs:v,ts:v})),tags:x,triggerSource:(s=b)!=null?s:"unknown"}}g["default"]=a}),98);
__d("EBUploadReceivedMessages",["EBAPIQPLPoints","EncryptedBackupsCreateUploadMessage","EncryptedBackupsUploadQueue","MWEBODSEntityName.enum","MWEBODSUtils","QPLUserFlow","WAHashStringToNumber","WALogger","WAResultOrError","asyncToGeneratorRuntime","justknobx","qpl","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] error generating backup directive for received message, ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] no result or failed for incoming stanza ",""]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.incomingMessages,e=a.msgResults;try{if(b.length===0)return d("WAResultOrError").makeResult();d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.api.receive.process",b.length);a=b.map(function(a){var b=d("WAHashStringToNumber").hashStringToNumber(c("uuidv4")());c("QPLUserFlow").start(c("qpl")._(521477113,"2698"),{annotations:{bool:{received:!0}},instanceKey:b,timeoutInMs:c("justknobx")._("308")});try{var f=a.stanza.message.decrypted.id;f=e.get(f);if(f==null||!f.success){d("WALogger").EXPECTED_ERROR(i(),a.stanza.message.decrypted.id);c("QPLUserFlow").endFailure(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.MESSAGE_RESULT_FAILURE_OR_NULL,{instanceKey:b});return null}f=c("EncryptedBackupsCreateUploadMessage")(a,"upload-received-messages",void 0,b);f==null?c("QPLUserFlow").endFailure(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UPLOAD_PAYLOAD_CREATION_FAILURE,{instanceKey:b}):c("QPLUserFlow").addPoint(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UPLOAD_PAYLOAD_CREATED,{instanceKey:b});return f}catch(a){d("WALogger").ERROR(h(),a);c("QPLUserFlow").endFailure(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.RUNTIME_ERROR,{annotations:{string:{error:a.toString()}},instanceKey:b});return null}}).filter(Boolean);if(a.length===0)return d("WAResultOrError").makeResult();d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.api.receive.enqueue",a.length);yield d("EncryptedBackupsUploadQueue").putMsgsToEbUpload(a);return d("WAResultOrError").makeResult()}catch(a){return d("WAResultOrError").makeError("runtime-exception",a)}});return j.apply(this,arguments)}g.uploadReceivedMessages=a}),98);
__d("EBUploadReceivedMessagesProtobufOnly",["EBAPIQPLPoints","EncryptedBackupsCreateUploadMessage","EncryptedBackupsUploadQueue","MAWGetMsgForProtocolMsgIdTxn","MAWMessageSortOrderUtils","Promise","QPLUserFlow","WAHashStringToNumber","WALogger","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","gkx","justknobx","qpl","requireDeferred","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] EBUploadReceivedMessages not uploading placeholder message - Original message not found for revoked message ",""]);i=function(){return a};return a}var j=c("requireDeferred")("EBAPI").__setRef("EBUploadReceivedMessagesProtobufOnly");function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.uploadArray;try{if(a.length===0)return d("WAResultOrError").makeResult();a=a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAHashStringToNumber").hashStringToNumber(c("uuidv4")());c("QPLUserFlow").start(c("qpl")._(521477113,"2698"),{annotations:{bool:{protobufOnly:!0,received:!0}},instanceKey:b,timeoutInMs:c("justknobx")._("308")});try{var e,f=null;if(((e=a.decodedMsg)==null?void 0:(e=e.unstoredDbMsg)==null?void 0:e.type)==="Revoked"){var g=a.stanza.message.decrypted.id,h=(yield d("MAWGetMsgForProtocolMsgIdTxn").getMsgForProtocolMsgIdTxn({author:g.author,chat:g.chat,externalId:a.decodedMsg.unstoredDbMsg.revokedExternalId}));if(!h.success){d("WALogger").WARN(i(),g.externalId);c("QPLUserFlow").endFailure(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.MESSAGE_RESULT_FAILURE_OR_NULL,{instanceKey:b});return null}var k=d("WATimeUtils").castToMillisTime((e=h.value.sortOrderMs)!=null?e:d("MAWMessageSortOrderUtils").generateAuthoritativeMessageSortOrder({externalId:h.value.externalId,serverTs:h.value.serverTs,ts:h.value.ts}));c("gkx")("6929")&&(yield j.load().then(function(a){return a.uploadDeletedMessage({instanceKey:b,msgId:{author:g.author,chat:g.chat,externalId:h.value.externalId},sender:g.author,serverTs:(a=h.value.serverTs)!=null?a:h.value.ts,sortOrderMs:k})}));f=c("EncryptedBackupsCreateUploadMessage")(a,"upload-received-messages",k,b)}else f=c("EncryptedBackupsCreateUploadMessage")(a,"upload-received-messages",void 0,b);f==null?c("QPLUserFlow").endFailure(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UPLOAD_PAYLOAD_CREATION_FAILURE,{instanceKey:b}):c("QPLUserFlow").addPoint(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UPLOAD_PAYLOAD_CREATED,{instanceKey:b});return f}catch(a){c("QPLUserFlow").endFailure(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UPLOAD_PAYLOAD_CREATION_FAILURE,{annotations:{string:{error:a.message}},instanceKey:b});return null}});return function(b){return a.apply(this,arguments)}}());a=(yield (h||(h=b("Promise"))).all(a));a=a.filter(Boolean);if(a.length===0)return d("WAResultOrError").makeResult();yield d("EncryptedBackupsUploadQueue").putMsgsToEbUpload(a);return d("WAResultOrError").makeResult()}catch(a){return d("WAResultOrError").makeError("runtime-exception",a)}});return k.apply(this,arguments)}g.uploadReceivedMessagesProtobufOnly=a}),98);
__d("MAWGetAllMediaIdsForXMAMsgApi",["MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({xma:d("MAWTransactionMode").READONLY},"getAllMediaIdsForXMAMsg",function(a){return function(b){var c=new Map();b=b.map(function(b){return d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,b).then(function(a){var d,e=(d=c.get(b))!=null?d:new Set();a!=null&&(a.faviconMediaId!=null&&e.add(a.faviconMediaId),a.headerMediaId!=null&&e.add(a.headerMediaId),a.previewMediaIds!=null&&a.previewMediaIds.forEach(function(a){return e.add(a)}));c.set(b,e)})});return d("MAWDexieTable").dexieAll(b).then(function(a){return c})}});g.getAllMediaIdsForXMAMsg=a}),98);
__d("EncryptedBackupsGetAttachmentContextForSentMsgXMA",["EncryptedBackupsUploadEntity","MAWDbMediaTxns","MAWGetAllMediaIdsForXMAMsgApi","MAWIndexedDb","MAWTransactionMode","WAMediaUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY},"bulkGetRetroactiveMedia",function(a){return function(){for(var b=arguments.length,c=new Array(b),e=0;e<b;e++)c[e]=arguments[e];return d("MAWDbMediaTxns").bulkGetMedias.apply(void 0,[a].concat(c))}});function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield d("MAWGetAllMediaIdsForXMAMsgApi").getAllMediaIdsForXMAMsg([a]).then(function(b){b=b.get(a);return b!=null?h(Array.from(b)):[]}));return c.filter(Boolean).flatMap(function(a){var c=b.msgId!=null?a==null?void 0:a.mediaEntries.get(b.msgId):null;c=c!=null?d("WAMediaUtils").decodeMediaEntryData(c):null;var e=[];(c==null?void 0:c.objectId)!=null&&a.mediaType!=null&&e.push({mediaObjectId:c.objectId,mediaType:d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA});c=c==null?void 0:(a=c.downloadableThumbnail)==null?void 0:a.objectId;c!=null&&e.push({isPreview:!0,mediaObjectId:d("WAMediaUtils").stringToDeliveryObjectId(c),mediaType:d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.MESSENGER_PREVIEW});return e})});return i.apply(this,arguments)}g["default"]=a}),98);
__d("EncryptedBackupsGetAttachmentContextForSentMsg",["EncryptedBackupsCastToAttachmentContextMediaType","EncryptedBackupsGetAttachmentContextForSentMsgXMA","EncryptedBackupsUploadEntity","WAMediaUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.dbMsg,e=a.isXMAMsg,f=a.media;a=a.protocolMsgIdFromArgs;if(e===!0){e=(yield c("EncryptedBackupsGetAttachmentContextForSentMsgXMA")(a,b));return e.filter(Boolean)}a=[];e=b.msgId!=null?f==null?void 0:f.mediaEntries.get(b.msgId):null;b=e!=null?d("WAMediaUtils").decodeMediaEntryData(e):null;if(f==null||b==null)return[];if(b.objectId!=null&&f.mediaType!=null){a.push({mediaObjectId:b.objectId,mediaType:c("EncryptedBackupsCastToAttachmentContextMediaType")(f.mediaType)});f=(e=b.downloadableThumbnail)==null?void 0:e.objectId;f!=null&&a.push({mediaObjectId:d("WAMediaUtils").stringToDeliveryObjectId(f),mediaType:d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.MESSENGER_PREVIEW})}return a});return h.apply(this,arguments)}g["default"]=a}),98);
__d("EncryptedBackupsGetAttachmentContextForSentMsgV2",["EncryptedBackupsCastToAttachmentContextMediaType","EncryptedBackupsUploadEntity","WAMediaUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){var f=new Map(),g=[],h=a.msgId;if(b!=null){a=h!=null?b.mediaEntries.get(h):null;a=a!=null?d("WAMediaUtils").decodeMediaEntryData(a):null;b=c("EncryptedBackupsCastToAttachmentContextMediaType")(b.mediaType);if((a==null?void 0:a.objectId)!=null&&b!=null){var i=a.objectId;f.set(i,b)}b=a==null?void 0:(i=a.downloadableThumbnail)==null?void 0:i.objectId;b!=null&&f.set(b,d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.MESSENGER_PREVIEW)}if(e!=null){if(e.favicon!=null){a=e.favicon.objectId;a!=null&&f.set(a,d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA)}if(e.header!=null){i=e.header.objectId;i!=null&&f.set(i,d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA)}e.previews!=null&&e.previews.length>0&&e.previews.forEach(function(a){a=a.mediaEntries;a=h!=null?a.get(h):null;a=a!=null?d("WAMediaUtils").decodeMediaEntryData(a):null;if((a==null?void 0:a.objectId)!=null){a=a.objectId;f.set(a,d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA)}})}f.forEach(function(a,b){g.push({mediaObjectId:b,mediaType:a})});return g}g["default"]=a}),98);
__d("EBUploadSentMessage",["EBAPIQPLPoints","EBEnableUnifiedAttachment","EBGenerateMessageTags","EBUnifyLegacyMediaUpload","EncryptedBackupsConvertToLegacyAttachmentContext","EncryptedBackupsGetAttachmentContextForSentMsg","EncryptedBackupsGetAttachmentContextForSentMsgV2","EncryptedBackupsUploadQueue","I64","LSRequestId","MAWEBSwitch","MAWMessageSortOrderUtils","MAWMsgType","MWEBODSEntityName.enum","MWEBODSUtils","MessageBackupDirectiveGenerator","QPLUserFlow","WAFrankingTypes","WAGenReportingMeta","WAGlobals","WAHashStringToNumber","WAJids","WALogger","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","gkx","justknobx","qpl","requireDeferred","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg adding message "," attachments to EB upload queue"]);i=function(){return a};return a}var j=c("requireDeferred")("EBAPI").__setRef("EBUploadSentMessage");function k(a){if(a.reactToExternalId!=null)return d("MAWMsgType").MSG_TYPE.REACTION;else if(a.editMsgHistoryId!=null)return d("MAWMsgType").MSG_TYPE.EDIT_ACTION;else if(a.type==null)return null;else return d("MAWMsgType").isEBSupportedMsgType(a.type)&&!(a.ephemeralSetting!=null&&a.ephemeralSetting.ephemeralExpirationInSec>0)?a.type:null}function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.dbMsg,e=a.isXMAMsg;e=e===void 0?!1:e;var f=a.media,g=a.messageApplication,l=a.messageApplicationBytes,m=a.protocolMsgId,n=a.serverTs,o=a.triggerSource;o=o===void 0?"upload-sent-message":o;a=a.xmaPayload;var p=d("WAHashStringToNumber").hashStringToNumber(c("uuidv4")()),q=c("qpl")._(521477113,"2698");d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.api.sent.process",1);try{if(d("WAJids").isAuthorSystem(b.author))return d("WAResultOrError").makeResult();c("QPLUserFlow").start(q,{annotations:{bool:{received:!1}},instanceKey:p,timeoutInMs:c("justknobx")._("308")});var r=k(b);if(r==null){c("QPLUserFlow").endFailure(q,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UNSUPPORTED_MESSAGE_TYPE,{instanceKey:p});return d("WAResultOrError").makeError("Unsupported EB upload message type")}var s=d("MessageBackupDirectiveGenerator").createMessageBackupDirectiveFromDbMsg(b);if(s==null){c("QPLUserFlow").endFailure(q,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UNABLE_TO_CREATE_BACKUP_DIRECTIVE,{instanceKey:p});return d("WAResultOrError").makeError("Unable to create backup directive")}g=g==null?void 0:g.metadata;var t=[];d("EBUnifyLegacyMediaUpload").getEnableUnifyLegacyMediaUpload()||d("EBEnableUnifiedAttachment").getEbEnableUnifiedAttachment()?t=c("EncryptedBackupsGetAttachmentContextForSentMsgV2")(b,f,a):t=(yield c("EncryptedBackupsGetAttachmentContextForSentMsg")({dbMsg:b,isXMAMsg:e,media:f,protocolMsgIdFromArgs:m}));d("WALogger").LOG(i(),(a=t)==null?void 0:a.length);e=(yield d("WAGenReportingMeta").genReportingMeta(l,(g==null?void 0:g.frankingKey)?d("WAFrankingTypes").castToFrankingKey(new Uint8Array(g==null?void 0:g.frankingKey)):null,g==null?void 0:g.frankingVersion));f=c("EncryptedBackupsConvertToLegacyAttachmentContext")(t);var u=[];a=t.map(function(a){return d("EBGenerateMessageTags").generateEBMessageTags(a.mediaType)}).filter(Boolean);f.length>0&&f.forEach(function(a){var e=a.mediaObjectId;a=a.mediaType;u.push({deliveryObjectId:e,mediaType:a,messageId:m.externalId,productType:"msgr",threadId:d("WAJids").threadIdForChatJid(m.chat),threadJid:b.threadJid,traceId:c("LSRequestId").generate(),ts:n})});t.length>0&&c("QPLUserFlow").addPoint(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.ADDED_ATTACHMENT_CONTEXT);u.length>0&&c("QPLUserFlow").addPoint(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.ADDED_ATTACHMENT_CONTEXT_LEGACY);g=!c("MAWEBSwitch").isEnabled();var v=d("WATimeUtils").castToMillisTime((f=b.sortOrderMs)!=null?f:d("MAWMessageSortOrderUtils").generateAuthoritativeMessageSortOrder({externalId:m.externalId,originalTs:b.originalTs,revokedExternalId:b.revokedExternalId,serverTs:n,ts:n}));c("QPLUserFlow").addAnnotations(c("qpl")._(521477113,"2698"),{bool:{isRetroactiveUpload:g},"int":{attachmentCount:t.length,backupDirectiveType:s.actionType,legacyAttachmentCount:u.length}},{instanceKey:p});d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.api.sent.enqueue",1);yield d("EncryptedBackupsUploadQueue").putMsgsToEbUpload([{attachmentContext:t,backupDirective:s,dbMsgType:r,instanceKey:p,isRetroactiveUpload:g,legacyAttachmentContext:u,messageApplication:l,msgId:m,originalMsgProtocolId:s.originalMsgProtocolId.externalId!==m.externalId?s.originalMsgProtocolId:m,reportingMeta:e,senderId:(h||(h=d("I64"))).of_string(d("WAJids").authorToUserId(m.author,d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()))),serverTs:n,sortOrderMs:v,tags:a,triggerSource:o}]);c("gkx")("6929")&&b.type===d("MAWMsgType").MSG_TYPE.REVOKED&&b.originalMsgExternalId==null&&b.reactToExternalId==null&&(c("QPLUserFlow").addPoint(q,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UPLOAD_DELETED_MESSAGE,{instanceKey:p}),yield j.load().then(function(a){return a.uploadDeletedMessage({instanceKey:p,msgId:{author:m.author,chat:b.threadJid,externalId:b.revokedExternalId},sender:b.author,serverTs:(a=(a=b.originalTs)!=null?a:b.serverTs)!=null?a:b.ts,sortOrderMs:v})}));return d("WAResultOrError").makeResult()}catch(a){c("QPLUserFlow").endFailure(q,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.RUNTIME_ERROR,{instanceKey:p});return d("WAResultOrError").makeError("runtime-error",a)}});return l.apply(this,arguments)}g.uploadSentMessage=a}),98);
__d("EchoSerializationFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5722");b=d("FalcoLoggerInternal").create("echo_serialization_failure",a);e=b;g["default"]=e}),98);
__d("EchoSerializationSuccessFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5723");b=d("FalcoLoggerInternal").create("echo_serialization_success",a);e=b;g["default"]=e}),98);
__d("EncryptedBackupsDYIHandleMessageRestore",["EncryptedBackupsDYISingleton","I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Issuing next range query for thread with thread key ",", server generated next reference timestamp: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["nextTimestampMs was not supplied for thread with thread key ","."]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handling message range query for thread with thread key ",", hasMoreBefore: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot find thread key for thread id: ",""]);l=function(){return a};return a}function a(a,b,c,e,f,g,n){var o=d("EncryptedBackupsDYISingleton").getSingleton(),p=o.getLogger();o=o.getThreadKeyForThreadId(b);if(o==null){p.WARN(l(),b);return}void p.LOG(k(),b,e);c.length>0&&g(o,b,c);if(!e||f==null){e&&f==null&&void p.ERROR(j(),b);m(o);return}g=(h||(h=d("I64"))).to_string(f);void p.LOG(i(),b,g);void n(a,g,b)}function m(a){var b=d("EncryptedBackupsDYISingleton").getSingleton();b.deleteThreadKeyFromThreadsRestoreInProgress(a)}g.handleMessageRangeQueryRestore=a}),98);
__d("EncryptedBackupsDYIMediaDownloadHandlers",["EncryptedBackupsDYIFileUtils","EncryptedBackupsDYISingleton","FBLogger","Promise","WAResultOrError","asyncToGeneratorRuntime","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){f=(yield d("EncryptedBackupsDYIFileUtils").getMediaFolderHandle());b=b.split("/")[1];b=c("uuidv4")()+"."+b;yield d("EncryptedBackupsDYIFileUtils").writeFile(f,b,e);f=d("EncryptedBackupsDYISingleton").getSingleton();f.setMediaUrlByPlainTextHash(a,d("EncryptedBackupsDYIFileUtils").DyiMediaFolder+"/"+b);f.deletePlaintextHashFromAttachmentDownloadsInProgress(a);return d("WAResultOrError").makeResult()});return function(b,c,d,e){return a.apply(this,arguments)}}();e=function(){c("FBLogger")("labyrinth_web").debug("[DYIMediaPreviewHandler] Skipping previews for DYI");return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult())};g.DYIMediaDownloadHandler=a;g.DYIMediaPreviewHandler=e}),98);
__d("EncryptedBackupsDYIMessageProcessingUtils",["EncryptedBackupsDYIMediaDownloadHandlers","EncryptedBackupsDYISingleton","MebWAMediaDownloader","Promise","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] Failed to resign CDN URL: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] Media CDN URL has expired and should be renewed"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] Successfully downloaded media"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] Failed to download media"]);l=function(){return a};return a}function a(a,b){return{isUnsent:!1,media:new Set(),reactions:[],senderName:m(a),text:"",timestamp:(a=b)!=null?a:0,type:""}}function m(a){var b=d("EncryptedBackupsDYISingleton").getSingleton(),c="Unknown User";if(a!=null){b=b.getContactNameForContactId(a);b!=null&&(c=b)}return c}function c(a,c,e,f,g,m,n,o,p,q,r){var s=d("EncryptedBackupsDYISingleton").getSingleton(),t=s.getLogger(),u={author:d("WAJids").toMsgrUserJid(n),chat:d("WAJids").toMsgrUserJid(g),externalId:o},v={hash:p,isUrlRenewed:!1,mediaEntry:f,protocolMsgId:u,sortOrderMs:q};n={onDownloadError:function(){void t.ERROR(l(),v.hash);s.deletePlaintextHashFromAttachmentDownloadsInProgress(v.hash);return(h||(h=b("Promise"))).resolve()},onDownloadSuccess:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){void t.LOG(k(),v.hash);var b=a.mimeType;a=a.plaintext;yield d("EncryptedBackupsDYIMediaDownloadHandlers").DYIMediaDownloadHandler(v.hash,b,a,u)});function c(b){return a.apply(this,arguments)}return c}(),onUrlExpired:function(){void t.LOG(j(),v.hash);return(h||(h=b("Promise"))).resolve()}};var w=new(d("MebWAMediaDownloader").MebWAMediaDownloader)(v,n,a),x=f.serverMediaType;f=f.objectId;if(x!=null&&f!=null&&typeof q==="number"){c={backupEntFbid:c,deliveryObjectId:f,hash:p,mediaType:x,messageId:o,productType:e,sortOrder:q,threadId:g,threadKey:m};f={onResignCdnUrlFailure:function(a){void t.ERROR(i(),v.hash,a.message);s.deletePlaintextHashFromAttachmentDownloadsInProgress(v.hash);return(h||(h=b("Promise"))).resolve()},onResignCdnUrlSuccess:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){});function c(){return a.apply(this,arguments)}return c}()};p=r(c,f);w.setNextHandler(p);p.setNextHandler(new(d("MebWAMediaDownloader").MebWAMediaDownloader)(v,n,a))}void w.handle()}g.buildBaseDyiMessage=a;g.getSenderName=m;g.startMediaDownloadChain=c}),98);
__d("LSCreateDataTrace",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return c[0]=b.i64.of_float(Date.now()),b.db.table(153).add({traceId:a[0],initTimestampMs:c[0],traceType:a[4],shouldFlush:!1,contextOne:a[1],contextTwo:a[2],contextThree:a[3]})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSDataTraceCreateDataTraceStoredProcedure";a.__tables__=["data_trace_meta"];e.exports=a}),null);
__d("LSCreateDataTraceID.nop",["LSRequestId","LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,d){return(h||(h=b("Promise"))).resolve(c("LSResult")(c("LSRequestId").generate()))};g["default"]=a}),98);
__d("LSLoadThreadPkFromThreadId",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadThreadPkFromThreadId] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(173).fetch(),function(b){return c.i64.to_string(b.jid)===a[0]}).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,100])),d[13].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[13].set("error_message",""),e=[void 0,d[13]],d[2]=e[0],d[3]=e[1],e):(b=a.item,e=[b.clientThreadPk,void 0],d[2]=e[0],d[3]=e[1],e)})},function(a){return c.i64.neq(d[2],void 0)?(a=[d[2],d[3]],d[5]=a[0],d[6]=a[1],a):(d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,7])),d[13].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[13].set("error_message",""),c.i64.neq(void 0,void 0)?(a=[void 0,d[13]],d[14]=a[0],d[15]=a[1],a):(d[16]=new c.Map(),d[16].set("error_code",c.i64.cast([0,100])),d[16].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[16].set("error_message",""),a=[void 0,d[16]],d[14]=a[0],d[15]=a[1],a),a=[d[14],d[15]],d[5]=a[0],d[6]=a[1],a),d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadThreadPkFromThreadId] ",d[9],d[10],d[9],d[11],d[9],d[12]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[13]=",",d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadThreadPkFromThreadId",[d[10],d[13],d[11],d[13],d[12]].join(""),d[14],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[5],d[6]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure";a.__tables__=["mi_act_mapping_table"];e.exports=a}),null);
__d("LSIssueMessageRangeQueryTask",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSFlushDataTrace.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLoadThreadPkFromThreadId","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] Beginning execution."),d[6]=c.i64.gt(a[1],c.i64.cast([0,0]))&&c.i64.gt(a[5],c.i64.cast([0,0])),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(e){return d[6]?(d[12]=new c.Map(),d[12].set("error_code",c.i64.cast([0,1])),d[12].set("error_message",""),d[12].set("stored_procedure","issueMessageRangeQueryTask"),d[13]=new c.Map(),d[13].set("act_thread_id",a[0]),d[14]=new c.Map(),d[14].set("restore_context",d[13]),d[14].set("failure",d[12]),d[15]=d[14].get("restore_context"),d[16]=d[15].get("act_thread_id"),d[17]=c.toJSON(d[14]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),["encrypted_backups_restore",":",d[16]].join(""),c.i64.cast([0,50031]),d[17],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[18]=a[0],a})):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var a=e.done;e=e.value;return a?d[12]=void 0:(f=e.item,c.sequence([function(a){return d[28]=f.deviceId,d[27]=f.backupTenancy,d[26]=f.encryptionVersion,d[21]=void 0,c.i64.neq(d[21],void 0)?c.resolve(d[22]=d[21]):c.sequence([function(a){return d[29]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[39]=(d[29].push(c.i64.cast([0,0])),d[29]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[31]=a[0],a})},function(a){return d[31]?d[39]=(d[29].push(c.i64.cast([0,2])),d[29]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]?d[39]=(d[29].push(c.i64.cast([0,3])),d[29]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[33]?d[39]=(d[29].push(c.i64.cast([0,4])),d[29]):0,d[34]=c.createArray(),d[35]=c.i64.of_int32(d[29].length),c.i64.gt(d[35],c.i64.cast([0,0]))?c.loopAsync(d[35],function(a){return d[39]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[29],d[39]).then(function(a){return a=a,d[40]=a[0],d[41]=a[1],a})},function(a){return d[42]=(d[34].push(d[40]),d[34])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[39]=c.createArray(),d[40]=c.i64.of_int32(d[34].length),c.i64.gt(d[40],c.i64.cast([0,0]))?c.loopAsync(d[40],function(a){return d[42]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[34],d[42]).then(function(a){return a=a,d[43]=a[0],d[44]=a[1],a})},function(a){return d[45]=(d[39].push(c.i64.to_string(d[43])),d[39])}])}):c.resolve()},function(a){return d[41]=d[39].join(","),d[36]=d[41]}])},function(a){return d[34].some(function(a){return c.i64.eq(d[26],a)})?d[37]=d[26]:d[37]=void 0,c.i64.neq(d[37],void 0)?d[38]=d[37]:d[38]=void 0,d[22]=d[38]}])},function(a){return c.i64.neq(d[22],void 0)?d[23]=d[22]:d[23]=c.i64.cast([0,0]),c.i64.neq(d[27],void 0)?d[24]=d[27]:d[24]=c.i64.cast([0,1]),c.i64.neq(d[28],void 0)?d[25]=d[28]:d[25]=void 0,d[12]=d[25]}]))})},function(e){return d[14]=new c.Map(),d[14].set("error_code",c.i64.cast([0,1])),d[14].set("error_message",void 0==null?"":void 0),d[14].set("stored_procedure","issueMessageRangeQueryTask"),d[15]=new c.Map(),d[15].set("act_thread_id",a[0]),d[15].set("source",a[6]),d[15].set("restore_operation_type",c.i64.cast([0,2])),d[15].set("request_id",a[4]),d[15].set("device_id",d[12]),d[16]=new c.Map(),d[16].set("restore_context",d[15]),d[16].set("failure",d[14]),d[17]=d[16].get("queue_name"),d[17]!==void 0?d[18]=d[17]:(d[21]=d[16].get("restore_context"),d[22]=d[21].get("act_thread_id"),d[18]=["encrypted_backups_restore",":",d[22]].join("")),d[19]=c.toJSON(d[16]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),d[18],c.i64.cast([0,50030]),d[19],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[20]=a[0],a})}])},function(e){return d[11]="backup not found",d[11]!==void 0?c.sequence([function(e){return d[13]=["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",d[11]].join(""),function(a){c.logger(a).mustfix(a)}(d[13]),d[12]=c.createArray(),a[4]!==void 0?d[14]=(d[12].push(a[4]),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",d[11],d[12],c.i64.cast([0,3]))},function(e){return c.sequence([function(e){return a[4]!==void 0?c.sequence([function(e){return a[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),d[13],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]?d[17]=!0:d[17]=!1,d[17]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[18]=c.createArray(),void 0!==void 0?d[19]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[18],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[14]=a[0],a})},function(a){return d[14]?d[15]=!0:d[15]=!1,d[15]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[16],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(e){return a[4]!==void 0?c.sequence([function(d){return a[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[14]=a[0],a})},function(a){return d[14]?d[15]=!0:d[15]=!1,d[15]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[16],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[12]=a[0],a})},function(a){return d[12]?d[13]=!0:d[13]=!1,d[13]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[14],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[6]?d[10]=c.i64.cast([0,5]):d[10]=c.i64.cast([0,2]),d[1]=!1}]):(f=e.item,c.sequence([function(a){return d[19]=f.mailboxRootKeyBlob,d[18]=f.ocmfClientStateBlob,d[17]=f.deviceId,d[16]=f.backupTenancy,d[15]=f.encryptionVersion,d[10]=void 0,c.i64.neq(d[10],void 0)?c.resolve(d[11]=d[10]):c.sequence([function(a){return d[20]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[30]=(d[20].push(c.i64.cast([0,0])),d[20]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[22]?d[30]=(d[20].push(c.i64.cast([0,2])),d[20]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[23]?d[30]=(d[20].push(c.i64.cast([0,3])),d[20]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[30]=(d[20].push(c.i64.cast([0,4])),d[20]):0,d[25]=c.createArray(),d[26]=c.i64.of_int32(d[20].length),c.i64.gt(d[26],c.i64.cast([0,0]))?c.loopAsync(d[26],function(a){return d[30]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[20],d[30]).then(function(a){return a=a,d[31]=a[0],d[32]=a[1],a})},function(a){return d[33]=(d[25].push(d[31]),d[25])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[30]=c.createArray(),d[31]=c.i64.of_int32(d[25].length),c.i64.gt(d[31],c.i64.cast([0,0]))?c.loopAsync(d[31],function(a){return d[33]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[25],d[33]).then(function(a){return a=a,d[34]=a[0],d[35]=a[1],a})},function(a){return d[36]=(d[30].push(c.i64.to_string(d[34])),d[30])}])}):c.resolve()},function(a){return d[32]=d[30].join(","),d[27]=d[32]}])},function(a){return d[25].some(function(a){return c.i64.eq(d[15],a)})?d[28]=d[15]:d[28]=void 0,c.i64.neq(d[28],void 0)?d[29]=d[28]:d[29]=void 0,d[11]=d[29]}])},function(e){return c.i64.neq(d[11],void 0)?d[12]=d[11]:d[12]=c.i64.cast([0,0]),c.i64.neq(d[16],void 0)?d[13]=d[16]:d[13]=c.i64.cast([0,1]),c.i64.neq(d[17],void 0)?c.sequence([function(e){return c.storedProcedure(b("LSLoadThreadPkFromThreadId"),a[0]).then(function(a){return a=a,d[20]=a[0],d[21]=a[1],a})},function(e){return c.i64.neq(d[20],void 0)?d[6]?c.sequence([function(e){return c.i64.eq(d[13],c.i64.cast([0,3]))?d[22]=c.i64.cast([0,4]):d[22]=c.i64.cast([0,0]),d[23]=new c.Map(),d[23].set("act_thread_id",a[0]),d[23].set("tam_thread_subtype",d[22]),d[23].set("source",a[6]),c.nativeOperation(b("LSBase64Encode.nop"),d[18]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[19]).then(function(a){return a=a,d[25]=a[0],a})},function(a){return d[26]=new c.Map(),d[26].set("ocmf_client_state_blob",d[24]==null?"":d[24]),d[26].set("mailbox_root_key",d[25]==null?"":d[25]),d[27]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[39]=(d[27].push(a.epochId),d[27])})},function(a){return d[37]="Queried locally available epochs. Count: ",d[28]=c.i64.of_int32(d[27].length),d[38]=c.i64.to_string(d[28]),d[29]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[29],d[37],d[29],d[38]].join("")),c.resolve()},function(e){return d[30]=new c.Map(),d[30].set("device_id",d[17]),d[30].set("raw_tokens",d[26]),d[30].set("locally_available_epochs",d[27]),d[31]=new c.Map(),d[31].set("reference_timestamp",a[2]),d[31].set("server_thread_key",void 0),d[31].set("device_context",d[30]),d[31].set("source",a[6]),d[32]=new c.Map(),d[32].set("restore_context",d[23]),d[32].set("success",d[31]),d[33]=d[32].get("restore_context"),d[34]=d[33].get("act_thread_id"),d[35]=c.toJSON(d[32]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),["encrypted_backups_restore",":",d[34]].join(""),c.i64.cast([0,50031]),d[35],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[36]=a[0],a})}]):c.i64.gt(a[1],c.i64.cast([0,0]))?c.sequence([function(e){return c.i64.eq(d[13],c.i64.cast([0,3]))?d[22]=c.i64.cast([0,4]):d[22]=c.i64.cast([0,0]),a[7]===!0?d[23]=!0:d[23]=!1,d[24]=new c.Map(),d[24].set("act_thread_id",a[0]),d[24].set("request_id",a[4]),d[24].set("tam_thread_subtype",d[22]),d[24].set("source",a[6]),c.nativeOperation(b("LSBase64Encode.nop"),d[18]).then(function(a){return a=a,d[25]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[19]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[27]=new c.Map(),d[27].set("ocmf_client_state_blob",d[25]==null?"":d[25]),d[27].set("mailbox_root_key",d[26]==null?"":d[26]),d[28]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[40]=(d[28].push(a.epochId),d[28])})},function(a){return d[38]="Queried locally available epochs. Count: ",d[29]=c.i64.of_int32(d[28].length),d[39]=c.i64.to_string(d[29]),d[30]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[30],d[38],d[30],d[39]].join("")),c.resolve()},function(e){return d[31]=new c.Map(),d[31].set("device_id",d[17]),d[31].set("raw_tokens",d[27]),d[31].set("locally_available_epochs",d[28]),d[32]=new c.Map(),d[32].set("reference_timestamp",a[2]),d[32].set("direction",c.i64.cast([0,1])),d[32].set("server_thread_key",void 0),d[32].set("device_context",d[31]),d[32].set("source",a[6]),d[32].set("include_offset",d[23]),d[33]=new c.Map(),d[33].set("restore_context",d[24]),d[33].set("success",d[32]),d[33].set("queue_name",void 0),d[34]=d[33].get("queue_name"),d[34]!==void 0?d[35]=d[34]:(d[40]=d[33].get("restore_context"),d[41]=d[40].get("act_thread_id"),d[35]=["encrypted_backups_restore",":",d[41]].join("")),d[36]=c.toJSON(d[33]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),d[35],c.i64.cast([0,50030]),d[36],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[37]=a[0],a})}]):c.sequence([function(e){return c.i64.eq(d[13],c.i64.cast([0,3]))?d[22]=c.i64.cast([0,4]):d[22]=c.i64.cast([0,0]),a[7]===!0?d[23]=!0:d[23]=!1,d[24]=new c.Map(),d[24].set("act_thread_id",a[0]),d[24].set("request_id",a[4]),d[24].set("tam_thread_subtype",d[22]),d[24].set("source",a[6]),c.nativeOperation(b("LSBase64Encode.nop"),d[18]).then(function(a){return a=a,d[25]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[19]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[27]=new c.Map(),d[27].set("ocmf_client_state_blob",d[25]==null?"":d[25]),d[27].set("mailbox_root_key",d[26]==null?"":d[26]),d[28]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[40]=(d[28].push(a.epochId),d[28])})},function(a){return d[38]="Queried locally available epochs. Count: ",d[29]=c.i64.of_int32(d[28].length),d[39]=c.i64.to_string(d[29]),d[30]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[30],d[38],d[30],d[39]].join("")),c.resolve()},function(e){return d[31]=new c.Map(),d[31].set("device_id",d[17]),d[31].set("raw_tokens",d[27]),d[31].set("locally_available_epochs",d[28]),d[32]=new c.Map(),d[32].set("reference_timestamp",a[2]),d[32].set("direction",c.i64.cast([0,2])),d[32].set("server_thread_key",void 0),d[32].set("device_context",d[31]),d[32].set("source",a[6]),d[32].set("include_offset",d[23]),d[33]=new c.Map(),d[33].set("restore_context",d[24]),d[33].set("success",d[32]),d[33].set("queue_name",void 0),d[34]=d[33].get("queue_name"),d[34]!==void 0?d[35]=d[34]:(d[40]=d[33].get("restore_context"),d[41]=d[40].get("act_thread_id"),d[35]=["encrypted_backups_restore",":",d[41]].join("")),d[36]=c.toJSON(d[33]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),d[35],c.i64.cast([0,50030]),d[36],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[37]=a[0],a})}]):c.sequence([function(e){return d[6]?(d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,100])),d[24].set("error_message",""),d[24].set("stored_procedure","issueMessageRangeQueryTask"),d[25]=new c.Map(),d[25].set("act_thread_id",a[0]),d[26]=new c.Map(),d[26].set("restore_context",d[25]),d[26].set("failure",d[24]),d[27]=d[26].get("restore_context"),d[28]=d[27].get("act_thread_id"),d[29]=c.toJSON(d[26]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),["encrypted_backups_restore",":",d[28]].join(""),c.i64.cast([0,50031]),d[29],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[30]=a[0],a})):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var a=e.done;e=e.value;return a?d[24]=void 0:(f=e.item,c.sequence([function(a){return d[40]=f.deviceId,d[39]=f.backupTenancy,d[38]=f.encryptionVersion,d[33]=void 0,c.i64.neq(d[33],void 0)?c.resolve(d[34]=d[33]):c.sequence([function(a){return d[41]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[42]?d[51]=(d[41].push(c.i64.cast([0,0])),d[41]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[43]?d[51]=(d[41].push(c.i64.cast([0,2])),d[41]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[44]?d[51]=(d[41].push(c.i64.cast([0,3])),d[41]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[45]?d[51]=(d[41].push(c.i64.cast([0,4])),d[41]):0,d[46]=c.createArray(),d[47]=c.i64.of_int32(d[41].length),c.i64.gt(d[47],c.i64.cast([0,0]))?c.loopAsync(d[47],function(a){return d[51]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[41],d[51]).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],a})},function(a){return d[54]=(d[46].push(d[52]),d[46])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[51]=c.createArray(),d[52]=c.i64.of_int32(d[46].length),c.i64.gt(d[52],c.i64.cast([0,0]))?c.loopAsync(d[52],function(a){return d[54]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[46],d[54]).then(function(a){return a=a,d[55]=a[0],d[56]=a[1],a})},function(a){return d[57]=(d[51].push(c.i64.to_string(d[55])),d[51])}])}):c.resolve()},function(a){return d[53]=d[51].join(","),d[48]=d[53]}])},function(a){return d[46].some(function(a){return c.i64.eq(d[38],a)})?d[49]=d[38]:d[49]=void 0,c.i64.neq(d[49],void 0)?d[50]=d[49]:d[50]=void 0,d[34]=d[50]}])},function(a){return c.i64.neq(d[34],void 0)?d[35]=d[34]:d[35]=c.i64.cast([0,0]),c.i64.neq(d[39],void 0)?d[36]=d[39]:d[36]=c.i64.cast([0,1]),c.i64.neq(d[40],void 0)?d[37]=d[40]:d[37]=void 0,d[24]=d[37]}]))})},function(e){return d[26]=new c.Map(),d[26].set("error_code",c.i64.cast([0,100])),d[26].set("error_message",void 0==null?"":void 0),d[26].set("stored_procedure","issueMessageRangeQueryTask"),d[27]=new c.Map(),d[27].set("act_thread_id",a[0]),d[27].set("source",a[6]),d[27].set("restore_operation_type",c.i64.cast([0,2])),d[27].set("request_id",a[4]),d[27].set("device_id",d[24]),d[28]=new c.Map(),d[28].set("restore_context",d[27]),d[28].set("failure",d[26]),d[29]=d[28].get("queue_name"),d[29]!==void 0?d[30]=d[29]:(d[33]=d[28].get("restore_context"),d[34]=d[33].get("act_thread_id"),d[30]=["encrypted_backups_restore",":",d[34]].join("")),d[31]=c.toJSON(d[28]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),d[30],c.i64.cast([0,50030]),d[31],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[32]=a[0],a})}])},function(e){return d[23]="threak pk not found for jid",d[23]!==void 0?c.sequence([function(e){return d[25]=["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",d[23]].join(""),function(a){c.logger(a).mustfix(a)}(d[25]),d[24]=c.createArray(),a[4]!==void 0?d[26]=(d[24].push(a[4]),d[24]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",d[23],d[24],c.i64.cast([0,3]))},function(e){return c.sequence([function(e){return a[4]!==void 0?c.sequence([function(e){return a[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),d[25],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[29]=!0:d[29]=!1,d[29]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[30]=c.createArray(),void 0!==void 0?d[31]=(d[30].push(void 0),d[30]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[30],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]?d[27]=!0:d[27]=!1,d[27]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[28]=c.createArray(),void 0!==void 0?d[29]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[28],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(e){return a[4]!==void 0?c.sequence([function(d){return a[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]?d[27]=!0:d[27]=!1,d[27]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[28]=c.createArray(),void 0!==void 0?d[29]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[28],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[25]=!0:d[25]=!1,d[25]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[26],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[6]?d[22]=c.i64.cast([0,5]):d[22]=c.i64.cast([0,2])}])},function(a){return d[14]=!0}]):c.sequence([function(e){return d[6]?(d[22]=new c.Map(),d[22].set("error_code",c.i64.cast([0,1])),d[22].set("error_message",""),d[22].set("stored_procedure","issueMessageRangeQueryTask"),d[23]=new c.Map(),d[23].set("act_thread_id",a[0]),d[24]=new c.Map(),d[24].set("restore_context",d[23]),d[24].set("failure",d[22]),d[25]=d[24].get("restore_context"),d[26]=d[25].get("act_thread_id"),d[27]=c.toJSON(d[24]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),["encrypted_backups_restore",":",d[26]].join(""),c.i64.cast([0,50031]),d[27],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[28]=a[0],a})):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var a=e.done;e=e.value;return a?d[22]=void 0:(f=e.item,c.sequence([function(a){return d[38]=f.deviceId,d[37]=f.backupTenancy,d[36]=f.encryptionVersion,d[31]=void 0,c.i64.neq(d[31],void 0)?c.resolve(d[32]=d[31]):c.sequence([function(a){return d[39]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[40]=a[0],a})},function(a){return d[40]?d[49]=(d[39].push(c.i64.cast([0,0])),d[39]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[41]=a[0],a})},function(a){return d[41]?d[49]=(d[39].push(c.i64.cast([0,2])),d[39]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[42]?d[49]=(d[39].push(c.i64.cast([0,3])),d[39]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[43]?d[49]=(d[39].push(c.i64.cast([0,4])),d[39]):0,d[44]=c.createArray(),d[45]=c.i64.of_int32(d[39].length),c.i64.gt(d[45],c.i64.cast([0,0]))?c.loopAsync(d[45],function(a){return d[49]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[39],d[49]).then(function(a){return a=a,d[50]=a[0],d[51]=a[1],a})},function(a){return d[52]=(d[44].push(d[50]),d[44])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[49]=c.createArray(),d[50]=c.i64.of_int32(d[44].length),c.i64.gt(d[50],c.i64.cast([0,0]))?c.loopAsync(d[50],function(a){return d[52]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[44],d[52]).then(function(a){return a=a,d[53]=a[0],d[54]=a[1],a})},function(a){return d[55]=(d[49].push(c.i64.to_string(d[53])),d[49])}])}):c.resolve()},function(a){return d[51]=d[49].join(","),d[46]=d[51]}])},function(a){return d[44].some(function(a){return c.i64.eq(d[36],a)})?d[47]=d[36]:d[47]=void 0,c.i64.neq(d[47],void 0)?d[48]=d[47]:d[48]=void 0,d[32]=d[48]}])},function(a){return c.i64.neq(d[32],void 0)?d[33]=d[32]:d[33]=c.i64.cast([0,0]),c.i64.neq(d[37],void 0)?d[34]=d[37]:d[34]=c.i64.cast([0,1]),c.i64.neq(d[38],void 0)?d[35]=d[38]:d[35]=void 0,d[22]=d[35]}]))})},function(e){return d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,1])),d[24].set("error_message",void 0==null?"":void 0),d[24].set("stored_procedure","issueMessageRangeQueryTask"),d[25]=new c.Map(),d[25].set("act_thread_id",a[0]),d[25].set("source",a[6]),d[25].set("restore_operation_type",c.i64.cast([0,2])),d[25].set("request_id",a[4]),d[25].set("device_id",d[22]),d[26]=new c.Map(),d[26].set("restore_context",d[25]),d[26].set("failure",d[24]),d[27]=d[26].get("queue_name"),d[27]!==void 0?d[28]=d[27]:(d[31]=d[26].get("restore_context"),d[32]=d[31].get("act_thread_id"),d[28]=["encrypted_backups_restore",":",d[32]].join("")),d[29]=c.toJSON(d[26]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),d[28],c.i64.cast([0,50030]),d[29],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[30]=a[0],a})}])},function(e){return d[21]="backup not found",d[21]!==void 0?c.sequence([function(e){return d[23]=["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",d[21]].join(""),function(a){c.logger(a).mustfix(a)}(d[23]),d[22]=c.createArray(),a[4]!==void 0?d[24]=(d[22].push(a[4]),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",d[21],d[22],c.i64.cast([0,3]))},function(e){return c.sequence([function(e){return a[4]!==void 0?c.sequence([function(e){return a[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),d[23],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]?d[27]=!0:d[27]=!1,d[27]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[28]=c.createArray(),void 0!==void 0?d[29]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[28],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[25]=!0:d[25]=!1,d[25]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[26],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(e){return a[4]!==void 0?c.sequence([function(d){return a[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[25]=!0:d[25]=!1,d[25]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[26],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[22]?d[23]=!0:d[23]=!1,d[23]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[24]=c.createArray(),void 0!==void 0?d[25]=(d[24].push(void 0),d[24]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[24],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[6]?d[20]=c.i64.cast([0,5]):d[20]=c.i64.cast([0,2]),d[14]=!1}])},function(a){return d[1]=d[14]}]))})},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[9]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ",d[5],d[7],d[5],d[8],d[5],d[9]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSIssueMessageRangeQueryTaskStoredProcedure",["LSIssueMessageRangeQueryTask","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSIssueMessageRangeQueryTask"),e.threadId,e.numMessages,e.startSortKey,e.isPointQuery,e.traceId,e.newerNumMessages,e.source,e.includeOffset);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSIssueAttachmentRestoreTask",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSBinaryToHex.nop","LSCreateDataTrace","LSCreateDataTraceID.nop","LSCreateDerivedKeys.nop","LSFindBackup","LSFlushDataTrace.nop","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSTruncateSortKey.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] Beginning execution."),a[7]!==void 0?c.resolve(d[1]=a[7]):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))&&c.i64.eq(a.backupTenancy,c.i64.cast([0,2]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){b=a.done;a=a.value;return b?d[27]=!1:(a.item,d[27]=!0)})},function(a){return d[27]?d[29]=c.i64.or_(c.i64.cast([0,82]),c.i64.cast([0,128])):d[29]=c.i64.cast([0,82]),c.sequence([function(a){return c.nativeOperation(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,d[31]=a[0],a})},function(a){return c.sequence([function(a){return d[35]="EncryptedBackups MCD Trace ID",d[36]=c.i64.to_string(d[29]),d[34]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",d[34],d[35],d[34],d[36]].join("")),c.resolve()},function(a){return c.storedProcedure(b("LSCreateDataTrace"),d[31],void 0,void 0,"media_restore",d[29])}])},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]?d[33]=!0:d[33]=!1,d[33]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[34]=c.createArray(),void 0!==void 0?d[35]=(d[34].push(void 0),d[34]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[34],c.i64.cast([0,3]))):c.resolve()},function(a){return d[30]=d[31]}])},function(a){return d[1]=d[30]}])},function(a){return c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,1829]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[27]=a[0],a})},function(a){return d[27]?d[28]=!0:d[28]=!1,d[28]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[29]=c.createArray(),void 0!==void 0?d[30]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[29],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?(f=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,20]),void 0],d[2]=f[0],d[3]=f[1],d[4]=f[2],d[5]=f[3],d[6]=f[4],d[7]=f[5],d[8]=f[6],d[9]=f[7],d[10]=f[8],d[11]=f[9],d[12]=f[10],d[13]=f[11],d[14]=f[12],d[15]=f[13],d[16]=f[14],d[17]=f[15],d[18]=f[16],f):(e=a.item,c.sequence([function(a){return d[32]=e.backupTenancy,d[31]=e.encryptionVersion,d[27]=void 0,c.i64.neq(d[27],void 0)?c.resolve(d[28]=d[27]):c.sequence([function(a){return d[33]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[34]?d[43]=(d[33].push(c.i64.cast([0,0])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[35]?d[43]=(d[33].push(c.i64.cast([0,2])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[43]=(d[33].push(c.i64.cast([0,3])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[37]?d[43]=(d[33].push(c.i64.cast([0,4])),d[33]):0,d[38]=c.createArray(),d[39]=c.i64.of_int32(d[33].length),c.i64.gt(d[39],c.i64.cast([0,0]))?c.loopAsync(d[39],function(a){return d[43]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[33],d[43]).then(function(a){return a=a,d[44]=a[0],d[45]=a[1],a})},function(a){return d[46]=(d[38].push(d[44]),d[38])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[43]=c.createArray(),d[44]=c.i64.of_int32(d[38].length),c.i64.gt(d[44],c.i64.cast([0,0]))?c.loopAsync(d[44],function(a){return d[46]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[38],d[46]).then(function(a){return a=a,d[47]=a[0],d[48]=a[1],a})},function(a){return d[49]=(d[43].push(c.i64.to_string(d[47])),d[43])}])}):c.resolve()},function(a){return d[45]=d[43].join(","),d[40]=d[45]}])},function(a){return d[38].some(function(a){return c.i64.eq(d[31],a)})?d[41]=d[31]:d[41]=void 0,c.i64.neq(d[41],void 0)?d[42]=d[41]:d[42]=void 0,d[28]=d[42]}])},function(a){return c.i64.neq(d[28],void 0)?d[29]=d[28]:d[29]=c.i64.cast([0,0]),c.i64.neq(d[32],void 0)?d[30]=d[32]:d[30]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,void 0,void 0,d[29],d[30],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel,void 0],d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],d[6]=a[4],d[7]=a[5],d[8]=a[6],d[9]=a[7],d[10]=a[8],d[11]=a[9],d[12]=a[10],d[13]=a[11],d[14]=a[12],d[15]=a[13],d[16]=a[14],d[17]=a[15],d[18]=a[16],a}]))})},function(a){return c.storedProcedure(b("LSFindBackup")).then(function(a){return a=a,d[20]=a[0],a})},function(e){return c.blobs.neq(d[5],void 0)?c.i64.neq(d[3],void 0)?d[20]!==void 0?c.blobs.neq(d[4],void 0)?c.sequence([function(e){return d[27]=c.createArray(),d[34]=(d[27].push(d[20]),d[27]),d[34]=(d[27].push(a[1]),d[27]),d[28]=c.toJSON(d[27]),d[29]=c.createArray(),d[34]=(d[29].push(c.i64.cast([0,32])),d[29]),c.nativeOperation(b("LSGetBlobFromString.nop"),["thread_ope_key","_",a[5]].join("")).then(function(a){return a=a,d[30]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[30],void 0,d[4],d[29]).then(function(a){return a=a,d[31]=a[0],a})},function(a){return d[31]?d[32]=!1:d[32]=!0,d[32]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),d[34]=c.createArray(),void 0!==void 0?d[35]=(d[34].push(void 0),d[34]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Got null keys while deriving message list OPE key. Returning null blobish",d[34],c.i64.cast([0,3]))},function(a){return d[33]=void 0}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[31],c.i64.cast([0,0])).then(function(a){return a=a,d[34]=a[0],d[35]=a[1],a})},function(a){return d[33]=d[34]}])},function(e){return c.blobs.neq(d[33],void 0)?c.sequence([function(e){return c.i64.neq(a[9],void 0)?d[34]=a[9]:d[34]=c.i64.cast([-1,4294967295]),c.nativeOperation(b("LSGetBlobFromInt64BE.nop"),a[6]).then(function(a){return a=a,d[35]=a[0],a})},function(a){return c.nativeOperation(b("LSTruncateSortKey.nop"),d[35]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return c.nativeOperation(b("LSOpeEncrypt.nop"),d[33],d[36],c.i64.cast([0,16])).then(function(a){return a=a,d[37]=a[0],a})},function(a){return c.nativeOperation(b("LSBinaryToHex.nop"),d[37]).then(function(a){return a=a,d[38]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),d[28]).then(function(a){return a=a,d[39]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2NvcGU="),d[39]).then(function(a){return a=a,d[40]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[40]).then(function(a){return a=a,d[41]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[41]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),d[20]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[43]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[44]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[45]).then(function(a){return a=a,d[46]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[4]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWVzc2FnZV9pZF9zY29wZQ=="),d[47]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[48]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[49]).then(function(a){return a=a,d[50]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[4]).then(function(a){return a=a,d[51]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[51]).then(function(a){return a=a,d[52]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[52]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[53]).then(function(a){return a=a,d[54]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[5]).then(function(a){return a=a,d[55]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[55]).then(function(a){return a=a,d[56]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[56]).then(function(a){return a=a,d[57]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[57]).then(function(a){return a=a,d[58]=a[0],a})},function(e){return d[59]=new c.Map(),d[59].set("attachment_index_key",d[42]==null?"":d[42]),d[59].set("backup_ent_fbid",a[0]),d[59].set("delivery_object_id",a[1]),d[59].set("device_id",d[3]),d[59].set("mailbox_partial_id",d[46]==null?"":d[46]),d[59].set("media_type",a[3]),d[59].set("message_partial_id",d[50]==null?"":d[50]),d[59].set("product_type",a[2]),d[59].set("salt_partial_id",d[54]==null?"":d[54]),d[59].set("sort_key",d[38]==null?"":d[38]),d[59].set("thread_partial_id",d[58]==null?"":d[58]),d[59].set("trace_id",d[1]),d[59].set("source",d[34]),d[60]=new c.Map(),d[60].set("otid",a[4]),d[60].set("server_thread_key",a[8]),d[60].set("timestamp",c.i64.to_string(a[6])),c.nativeOperation(b("LSBase64Encode.nop"),d[5]).then(function(a){return a=a,d[61]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[4]).then(function(a){return a=a,d[62]=a[0],a})},function(e){return d[63]=new c.Map(),d[63].set("ocmf_client_state_blob",d[61]==null?"":d[61]),d[63].set("mailbox_root_key",d[62]==null?"":d[62]),d[64]=c.createArray(),d[76]=(d[64].push(a[4]),d[64]),d[76]=(d[64].push(a[1]),d[64]),d[65]=c.toJSON(d[64]),d[59].set("raw_identifiers",d[60]),d[59].set("backup_id",d[20]),d[59].set("thread_id",a[5]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[65]).then(function(a){return a=a,d[66]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[66]).then(function(a){return a=a,d[67]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[67]).then(function(a){return a=a,d[68]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[68]).then(function(a){return a=a,d[69]=a[0],a})},function(a){return d[59].set("salt_partial_access_token",d[69]==null?"":d[69]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[28]).then(function(a){return a=a,d[70]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2FsdF9zY29wZQ=="),d[70]).then(function(a){return a=a,d[71]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[71]).then(function(a){return a=a,d[72]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[72]).then(function(a){return a=a,d[73]=a[0],a})},function(a){return d[59].set("salt_partial_attachment_index_key",d[73]==null?"":d[73]),d[59].set("raw_tokens",d[63]),d[74]=c.toJSON(d[59]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_attachment_restore",c.i64.cast([0,50020]),d[74],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),d[1],c.i64.cast([0,0])).then(function(a){return a=a,d[75]=a[0],a})}]):(d[34]="OPE key is null for IssueAttachmentRestoreTask",d[34]!==void 0?c.sequence([function(a){return d[36]=["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",d[34]].join(""),function(a){c.logger(a).mustfix(a)}(d[36]),d[35]=c.createArray(),d[1]!==void 0?d[37]=(d[35].push(d[1]),d[35]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",d[34],d[35],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),d[36],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[39]=a[0],a})},function(a){return d[39]?d[40]=!0:d[40]=!1,d[40]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[41]=c.createArray(),void 0!==void 0?d[42]=(d[41].push(void 0),d[41]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[41],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[37]?d[38]=!0:d[38]=!1,d[38]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[39]=c.createArray(),void 0!==void 0?d[40]=(d[39].push(void 0),d[39]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[39],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[37]?d[38]=!0:d[38]=!1,d[38]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[39]=c.createArray(),void 0!==void 0?d[40]=(d[39].push(void 0),d[39]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[39],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[35]?d[36]=!0:d[36]=!1,d[36]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[37]=c.createArray(),void 0!==void 0?d[38]=(d[37].push(void 0),d[37]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[37],c.i64.cast([0,3]))):c.resolve()}]))}]):(d[27]="Missing mailbox_root_key for IssueAttachmentRestoreTask",d[27]!==void 0?c.sequence([function(a){return d[29]=["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",d[27]].join(""),function(a){c.logger(a).mustfix(a)}(d[29]),d[28]=c.createArray(),d[1]!==void 0?d[30]=(d[28].push(d[1]),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",d[27],d[28],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),d[29],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]?d[33]=!0:d[33]=!1,d[33]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[34]=c.createArray(),void 0!==void 0?d[35]=(d[34].push(void 0),d[34]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[34],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[31]=!0:d[31]=!1,d[31]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[32]=c.createArray(),void 0!==void 0?d[33]=(d[32].push(void 0),d[32]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[32],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[31]=!0:d[31]=!1,d[31]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[32]=c.createArray(),void 0!==void 0?d[33]=(d[32].push(void 0),d[32]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[32],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[29]=!0:d[29]=!1,d[29]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[30]=c.createArray(),void 0!==void 0?d[31]=(d[30].push(void 0),d[30]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[30],c.i64.cast([0,3]))):c.resolve()}])):(d[27]="Missing backup_id for IssueAttachmentRestoreTask",d[27]!==void 0?c.sequence([function(a){return d[29]=["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",d[27]].join(""),function(a){c.logger(a).mustfix(a)}(d[29]),d[28]=c.createArray(),d[1]!==void 0?d[30]=(d[28].push(d[1]),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",d[27],d[28],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),d[29],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]?d[33]=!0:d[33]=!1,d[33]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[34]=c.createArray(),void 0!==void 0?d[35]=(d[34].push(void 0),d[34]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[34],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[31]=!0:d[31]=!1,d[31]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[32]=c.createArray(),void 0!==void 0?d[33]=(d[32].push(void 0),d[32]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[32],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[31]=!0:d[31]=!1,d[31]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[32]=c.createArray(),void 0!==void 0?d[33]=(d[32].push(void 0),d[32]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[32],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[29]=!0:d[29]=!1,d[29]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[30]=c.createArray(),void 0!==void 0?d[31]=(d[30].push(void 0),d[30]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[30],c.i64.cast([0,3]))):c.resolve()}])):(d[27]="Missing device_id for IssueAttachmentRestoreTask",d[27]!==void 0?c.sequence([function(a){return d[29]=["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",d[27]].join(""),function(a){c.logger(a).mustfix(a)}(d[29]),d[28]=c.createArray(),d[1]!==void 0?d[30]=(d[28].push(d[1]),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",d[27],d[28],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),d[29],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]?d[33]=!0:d[33]=!1,d[33]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[34]=c.createArray(),void 0!==void 0?d[35]=(d[34].push(void 0),d[34]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[34],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[31]=!0:d[31]=!1,d[31]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[32]=c.createArray(),void 0!==void 0?d[33]=(d[32].push(void 0),d[32]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[32],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[31]=!0:d[31]=!1,d[31]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[32]=c.createArray(),void 0!==void 0?d[33]=(d[32].push(void 0),d[32]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[32],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[29]=!0:d[29]=!1,d[29]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[30]=c.createArray(),void 0!==void 0?d[31]=(d[30].push(void 0),d[30]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[30],c.i64.cast([0,3]))):c.resolve()}])):(d[27]="Missing ocmf_client_state_blob for IssueAttachmentRestoreTask",d[27]!==void 0?c.sequence([function(a){return d[29]=["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",d[27]].join(""),function(a){c.logger(a).mustfix(a)}(d[29]),d[28]=c.createArray(),d[1]!==void 0?d[30]=(d[28].push(d[1]),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",d[27],d[28],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),d[29],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]?d[33]=!0:d[33]=!1,d[33]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[34]=c.createArray(),void 0!==void 0?d[35]=(d[34].push(void 0),d[34]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[34],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[31]=!0:d[31]=!1,d[31]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[32]=c.createArray(),void 0!==void 0?d[33]=(d[32].push(void 0),d[32]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[32],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[31]=!0:d[31]=!1,d[31]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[32]=c.createArray(),void 0!==void 0?d[33]=(d[32].push(void 0),d[32]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[32],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[29]=!0:d[29]=!1,d[29]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[30]=c.createArray(),void 0!==void 0?d[31]=(d[30].push(void 0),d[30]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[30],c.i64.cast([0,3]))):c.resolve()}]))},function(a){return d[21]=c.i64.of_float(Date.now()),d[22]=c.i64.random(),d[24]="Finishing execution. Execution time: ",d[25]=c.i64.to_string(c.i64.sub(d[21],d[0])),d[26]=" ms",d[23]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ",d[23],d[24],d[23],d[25],d[23],d[26]].join("")),c.i64.eq(c.i64.mod_(d[22],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[27]=",",d[28]=c.createArray(),void 0!==void 0?d[29]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",[d[24],d[27],d[25],d[27],d[26]].join(""),d[28],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSIssueAttachmentRestoreTaskStoredProcedure",["LSIssueAttachmentRestoreTask","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSIssueAttachmentRestoreTask"),e.backupEntFbid,e.deliveryObjectId,e.productType,e.mediaType,e.messageId,e.threadId,e.sortOrder,e.traceId,e.serverThreadKey,e.source);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MAWMIMediaDownloader",["FBLogger","I64","LSDatabaseSingleton","LSFactory","LSIntEnum","LSIssueAttachmentRestoreTaskStoredProcedure","LSMEBTaskCreationSource","MAWCastToMsgrServerMediaType","MAWLoggerUtils","MAWThreadKeyUtils","MebMIMediaDownloader","MediaDownloadMediator","Promise","WALogger","WAMediaUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);l=function(){return a};return a}a=function(a){babelHelpers.inheritsLoose(e,a);function e(){return a.apply(this,arguments)||this}var g=e.prototype;g.handle=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this,e=(yield (k||(k=d("LSDatabaseSingleton"))).LSDatabaseSingleton);d("MediaDownloadMediator").mapDeliveryObjectIdToMediaDownloader(d("WAMediaUtils").stringToDeliveryObjectId(this.mediaDownloadMetadata.deliveryObjectId),this);var g=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(this.mediaDownloadMetadata.mediaType);if(g==null)throw c("FBLogger")("labyrinth_web").mustfixThrow("Unsupported media type");var m=d("MAWThreadKeyUtils").stringThreadKeyToString(this.mediaDownloadMetadata.threadKey),n=new(h||(h=b("Promise")))(function(a,b){window.setTimeout(function(){b(c("err")("[labyrinth_web][MIMediaDownloader] MI Media download timed out"))},2*60*1e3)}),o=d("MAWLoggerUtils").getInstanceKey();return h.race([e.runInTransaction(function(b){return c("LSIssueAttachmentRestoreTaskStoredProcedure")(c("LSFactory")(b),{backupEntFbid:(i||(i=d("I64"))).of_string(a.mediaDownloadMetadata.backupEntFbid),deliveryObjectId:a.mediaDownloadMetadata.deliveryObjectId,mediaType:g,messageId:a.mediaDownloadMetadata.messageId,productType:a.mediaDownloadMetadata.productType,serverThreadKey:m,sortOrder:i.of_float(a.mediaDownloadMetadata.sortOrder),source:(j||(j=d("LSIntEnum"))).ofNumber(c("LSMEBTaskCreationSource").MSGR_DYI),threadId:a.mediaDownloadMetadata.threadId,traceId:o.toString()})},"readwrite",void 0,void 0,f.id+":68"),n])["catch"](function(b){d("WALogger").ERROR(l(),b.message);return a.handleError(b)})});function e(){return a.apply(this,arguments)}return e}();return e}(c("MebMIMediaDownloader"));g.MAWMIMediaDownloader=a}),98);
__d("MAWEncryptedBackupsDYIProcessProtobufMessages",["CurrentUser","EncryptedBackupsDYIMessageProcessingUtils","EncryptedBackupsDYISingleton","MAWFrontendMediaUtils","MAWHandleEchoMediaMsgsRestoreV2","MAWHandleEchoProtobufsRestoreApi","MAWJids","MAWMIMediaDownloader","MAWMsgType","MebWAMediaDownloader","WAHashUtils","WAMediaUtils","WAStanzaUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Protobuf] Media message is missing encrypted hash"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Protobuf] Media message is missing media key"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Protobuf] Starting DYI media download for attachemnt with hash ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Protobuf] Media message is missing media data"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Explicitly dropping "," message type"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bump message is not supported in DYI"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Protobuf] XMA message doesn't have xmaData"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Documents are not supported in DYI"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error processing protobuf: ts or messageId or senderId is null"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error processing protobuf: metadata or message type is null"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error processing protobuf. Dropping the message: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error converting protobuf to DYI format. Dropping the message"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error converting protobuf to DYI format. Dropping the message"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["Decoded protobuf is empty"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing "," protobuf messages for thread ",""]);v=function(){return a};return a}function a(a,b,e){var f=d("EncryptedBackupsDYISingleton").getSingleton(),g=f.getLogger();void g.LOG(v(),e.length,b);var h=d("MAWJids").toUserJid(c("CurrentUser").getAccountID());e.forEach(function(c){try{c=d("MAWHandleEchoProtobufsRestoreApi").decodeDecryptedMessageProtobuf(c,h,void 0,new Set(),new Set(),new Map(),new Map(),new Map(),!0);if(c==null){void g.WARN(u());return}if(c!=null&&c.metadata!=null&&c.metadata.messageId!=null){var e=d("WAStanzaUtils").toStanzaId(c.metadata.messageId);c=w(a,b,c);if(c==null){void g.WARN(t());return}f.setMessagesByThreadKey(a,e,c)}else{void g.WARN(s());return}}catch(a){void g.ERROR(r(),a);return}})}function w(a,b,c){var e=d("EncryptedBackupsDYISingleton").getSingleton(),f=e.getLogger(),g=c.metadata,h=c.msgType,i=c.sortOrderMs;if(g==null||h==null){void f.WARN(q());return}h=g.messageId;var j=g.senderId;g=g.timestampMs;if(g==null||typeof g!=="number"||h==null||j==null){void f.WARN(p());return}h=d("WATimeUtils").castMilliSecondsToUnixTime(g);g=d("EncryptedBackupsDYIMessageProcessingUtils").buildBaseDyiMessage(j,i);j=(j=c.decodedPayload)==null?void 0:j.text;if(c.editMsgData.length>0){var k=h;c.editMsgData.forEach(function(a){var b;if(a.ts>k&&((b=a.editMsgContent.message)==null?void 0:b.text)!=null){k=a.ts;j=(b=a.editMsgContent.message)==null?void 0:b.text}})}c.reactionData.length>0&&(g.reactions=c.reactionData.map(function(a){var b=a.reaction;a=a.senderId;return{actor:(a=e.getContactNameForContactId(a))!=null?a:"unknown",reaction:(a=b.text)!=null?a:"unknown"}}));switch(c.msgType){case d("MAWMsgType").MSG_TYPE.TEXT:g.type="text";g.text=j||"";break;case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.PTT:g.type="media";g.text=j||"";g=y(a,b,c,i,g);break;case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:void f.WARN(o());return;case d("MAWMsgType").MSG_TYPE.XMA:g.type="link";if(c.xmaData==null){void f.WARN(n());return}g.text=((h=c.xmaData)==null?void 0:h.ctas.map(function(a){return a.nativeUrl}).filter(Boolean).join("\n"))||"";break;case d("MAWMsgType").MSG_TYPE.REVOKED:g.type="placeholder";g.isUnsent=!0;g.text="User unsent a message";break;case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:g.type="poll";g.text=x(c);break;case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:void f.WARN(m());return;default:void f.LOG(l(),c.msgType);return}return g}function x(a){a=a.groupPollInfo;return a==null?"":"Question: "+a.name+"\nOptions:\n"+a.options.map(function(a){return"- "+a.optionName}).join("\n")}function y(a,b,c,e,f){var g,l=d("EncryptedBackupsDYISingleton").getSingleton(),m=l.getLogger();if(c.mediaMetadata==null){void m.WARN(k());return f}var n=c.mediaMetadata,o=n.attachmentObjectId,p=n.backupEntFbid,q=n.directPath,r=n.encryptedHash,s=n.filename,t=n.mediaContentType,u=n.mediaKey,v=n.mediaKeyTimestamp,w=n.plaintextHash;n=n.size;g=(g=(g=c.metadata)==null?void 0:g.senderId)!=null?g:"0";c=d("WAStanzaUtils").toStanzaId(c.externalId);w=d("WAHashUtils").stringToPlaintextHash(w);t=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(t||"");t=t.serverMediaType;f.media.add(w);if(!l.isAttachmentDownloadInProgressForPlaintextHash(w)&&!l.isAttachmentDownloadCompleteForPlaintextHash(w)){void m.LOG(j(),d("WAHashUtils").sanitisePlaintextHash(w));l.addPlaintextHashToAttachmentDownloadsInProgress(w);if(u==null){m.ERROR(i());return f}if(r==null){m.ERROR(h());return f}l=d("MAWHandleEchoMediaMsgsRestoreV2").constructMediaEntry(w,r,u,q,v,t,s,p,o,null,n);m=d("WAMediaUtils").decodeMediaEntryData(l);void d("EncryptedBackupsDYIMessageProcessingUtils").startMediaDownloadChain(d("MebWAMediaDownloader").MebWADownloadMediaThroughTheBridge,"-8","msgr",m,b,a,g,c,w,e,function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return babelHelpers.construct(d("MAWMIMediaDownloader").MAWMIMediaDownloader,b)})}return f}g.processEBProtobufMessagesForDYI=a}),98);
__d("MAWEncryptedBackupsDYIHandleMessageRestore",["EncryptedBackupsDYIHandleMessageRestore","I64","LSDatabaseSingleton","LSFactory","LSIntEnum","LSIssueMessageRangeQueryTaskStoredProcedure","LSMEBTaskCreationSource","MAWEBRestoreTrackingUtils","MAWEncryptedBackupsDYIProcessProtobufMessages","asyncToGeneratorRuntime","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=(h||d("LSIntEnum")).ofNumber(c("LSMEBTaskCreationSource").MSGR_DYI),l=c("justknobx")._("467"),m=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){d("MAWEBRestoreTrackingUtils").markEBRestoreDYI(c("LSMEBTaskCreationSource").MSGR_DYI),yield a.runInTransaction(function(a){return c("LSIssueMessageRangeQueryTaskStoredProcedure")(c("LSFactory")(a),{isPointQuery:!1,newerNumMessages:(i||(i=d("I64"))).zero,numMessages:i.of_int32(l),source:k,startSortKey:b,threadId:e})},"readwrite",void 0,void 0,f.id+":39")});return function(b,c,d){return a.apply(this,arguments)}}();function a(a,b,c,d){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=(yield (j||(j=d("LSDatabaseSingleton"))).LSDatabaseSingleton);void d("EncryptedBackupsDYIHandleMessageRestore").handleMessageRangeQueryRestore(f,a,b,c,e,d("MAWEncryptedBackupsDYIProcessProtobufMessages").processEBProtobufMessagesForDYI,m)});return n.apply(this,arguments)}g.taskCreationSource=k;g.MESSENGER_DYI_BATCH_SIZE=l;g.handleMAWProtobufMessageRangeQueryRestore=a}),98);
__d("MAWRestoreProtobufsFromEncryptedBackupsDeferred",["ExecutionEnvironment","I64","LSDatabaseSingleton","WAJobOrchestratorTypes","asyncToGeneratorRuntime","cr:10036","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("requireDeferred")("MAWRestoreProtobufsFromEncryptedBackupsNOP").__setRef("MAWRestoreProtobufsFromEncryptedBackupsDeferred");function a(a,e,f,g,l,m,n,o,p,q,r,s,t,u,v){u===void 0&&(u=d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION);return k.load().then(function(){var k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(k){var w;(j||(j=c("ExecutionEnvironment"))).isInWorker&&b("cr:10036")!=null?(yield b("cr:10036").init(),w=(yield b("cr:10036").getLSStorage())):w=(yield (h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton);return w.runInTransaction(function(b){return k.call(b,a,e,f,g,l!=null?(i||(i=d("I64"))).to_float(l):0,m,n!=null?(i||(i=d("I64"))).to_float(n):(i||(i=d("I64"))).to_float((i||(i=d("I64"))).max_int),o,p,q,r,s,t,u,v)},"readwrite")});return function(a){return k.apply(this,arguments)}}())}g.call=a}),98);
__d("LSProtobufRestoreHandler",["CurrentUser","LSIntEnum","LSMEBTaskCreationSource","LSVec","MAWAsyncEBPendingQueryPromise","MAWEBRestoreTrackingUtils","MAWEBUnstoredDbMsgUtils","MAWEncryptedBackupUtils","MAWEncryptedBackupsDYIHandleMessageRestore","MAWJids","MAWJobDefinitions","MAWRestoreProtobufsFromEncryptedBackupsDeferred","Promise","WATagsLogger","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreProtobufs nativeop - Failed to restore protobufs, with error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Restoring Messenger DYI batch"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreProtobufs nativeop - no messages but hasMoreBefore is true"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreProtobufs nativeop - Failed to decode protobufs, with error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreProtobufs nativeop - no decoded messages but hasMoreBefore is true, messages count after decryption: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Protobuf restore native op called with invalid/null protobuf payload"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreProtobufs nativeop - ",""]);p=function(){return a};return a}function a(a,e,f,g,r,s,t,u,v,w,x,y,z,A){var B=null;y!=null&&(B=q(y));d("WATagsLogger").TAGS(["labyrinth_web","protobuf_restore",(y=v)!=null?y:"no_request_id"]).LOG(p(),(y=v)!=null?y:"no_request_id");d("MAWEBRestoreTrackingUtils").markEBRestoreProtobuf(z);if(f!=null)y=f;else if(e!=null)y=d("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(e);else{d("WATagsLogger").TAGS(["labyrinth_web","protobuf_restore",(f=v)!=null?f:"no_request_id"]).ERROR(o());d("MAWEBRestoreTrackingUtils").markEBRestoreFail(v,!1,"invalid_protobuf_payload");return(i||(i=b("Promise"))).resolve()}d("MAWEncryptedBackupUtils").logIfDuplicateMessagesFoundInRestore(y,"protobuf_restore");if(v!=null)try{d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"native_op_start",traceId:v,type:"protobuf"});f=d("MAWJids").toUserJid(c("CurrentUser").getAccountID());f=d("MAWEBUnstoredDbMsgUtils").getUnstoredDbMsgFromProtobuf(y,a,void 0,f);if(g===!0&&f.length===0){var C;d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"hasMoreBefore_decodedMessages_inconsistency",traceId:v,type:"protobuf"});e=e!=null?c("LSVec").toArray(e).length:0;d("WATagsLogger").TAGS(["labyrinth_web","protobuf_restore",(C=v)!=null?C:"no_request_id"]).ERROR(n(),e)}d("MAWAsyncEBPendingQueryPromise").resolvePendingQueryIfPresent(v,{echoMessages:B,hasMoreAfter:s,hasMoreBefore:g,isPointQuery:u,messages:f,nextMessageTimestampMsBefore:r,protobufMessages:y,referenceTimestamp:w,requestId:v,restoreType:"protobuf",threadId:a})}catch(a){d("WATagsLogger").TAGS(["labyrinth_web","protobuf_restore",(C=v)!=null?C:"no_request_id"]).ERROR(m(),a.message)}if(g===!0&&y.length===0){v!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"hasMoreBefore_messages_inconsistency",traceId:v,type:"protobuf"});d("WATagsLogger").TAGS(["labyrinth_web","protobuf_restore",(e=v)!=null?e:"no_request_id"]).ERROR(l())}f=z!=null&&(h||(h=d("LSIntEnum"))).unwrapIntEnum(z)===c("LSMEBTaskCreationSource").FTS_INDEX_EB_MESSAGES_WEB;if(f){v!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"search_restore_end",traceId:v,type:"protobuf"});d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(v);return(i||(i=b("Promise"))).resolve()}C=z!=null&&(h||(h=d("LSIntEnum"))).unwrapIntEnum(z)===c("LSMEBTaskCreationSource").MSGR_DYI;if(C){d("WATagsLogger").TAGS(["labyrinth_web","protobuf_restore",(e=v)!=null?e:"no_request_id"]).LOG(k());void d("MAWEncryptedBackupsDYIHandleMessageRestore").handleMAWProtobufMessageRangeQueryRestore(a,y,g,r);v!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"dyi_restore_end",traceId:v,type:"protobuf"});d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(v);return(i||(i=b("Promise"))).resolve()}c("promiseDone")(d("MAWRestoreProtobufsFromEncryptedBackupsDeferred").call("AdvancedCrypto",d("MAWJobDefinitions").toThreadJidPrimaryId(a),y,g,r,s,t,u,v,w,x,B,z,void 0,(f=A)!=null?f:void 0),function(){v!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"native_op_end",traceId:v,type:"protobuf"})},function(a){var b;d("WATagsLogger").TAGS(["labyrinth_web","protobuf_restore",(b=v)!=null?b:"no_request_id"]).ERROR(j(),a.message);b={string:{error:a.message}};v!=null&&d("MAWEBRestoreTrackingUtils").markEBRestoreFail(v,!1,"native_op_reject",b)});return(i||(i=b("Promise"))).resolve()}function q(a){return c("LSVec").toArray(a).map(function(a){return d("MAWJobDefinitions").toEncodedEchoMessage(a)})}g.handleProtobufRestoreHelper=a;g.convertLSEchoMessageVecToArray=q}),98);
__d("LSEBUnifiedRestoreUtils",["CurrentUser","LSIntEnum","LSMEBTaskCreationSource","LSProtobufRestoreHandler","LSVec","MAWAsyncEBPendingQueryPromise","MAWBridgeSafeActionsWorkerAndUI","MAWEBRestoreTrackingUtils","MAWEBUnstoredDbMsgUtils","MAWEncryptedBackupUtils","MAWEncryptedBackupsDYIHandleMessageRestore","MAWJids","MAWJobDefinitions","MAWRestoreProtobufsFromEncryptedBackupsDeferred","Promise","WATagsLogger","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["eb restore nativeop - Failed to restore protobufs, with error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Restoring Messenger DYI batch"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["eb restore nativeop - no messages but hasMoreBefore is true"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["eb restore native op - Failed to decode protobufs, with error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["eb restore nativeop - no decoded messages but hasMoreBefore is true, messages count after decryption: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Restore called with null payload for both echo messages and protobufs"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["starting eb restore - ",""]);p=function(){return a};return a}function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,q,r,s,t,u,v,w,x,y,z){var A;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(A=t)!=null?A:"no_request_id"]).LOG(p(),(A=t)!=null?A:"no_request_id");if(e==null&&w==null){d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(A=t)!=null?A:"no_request_id"]).ERROR(o());d("MAWEBRestoreTrackingUtils").markEBRestoreFail(t,!1,"invalid_restore_payload");return(i||(i=b("Promise"))).resolve()}var B=e!=null?z!=null?"mixed":"protobuf":"echo";A=[];e!=null&&A.push.apply(A,d("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(e));if(z||e===null){z=null;w!=null&&(z=d("LSProtobufRestoreHandler").convertLSEchoMessageVecToArray(w));if(z!=null){w=(yield d("MAWBridgeSafeActionsWorkerAndUI").sendAndReceiveBackendWorkerAndUIShared("convertEchoMessagesToEBProtobufs",{chatJid:y,encodedEchoMessages:z}));A.push.apply(A,w)}}d("MAWEncryptedBackupUtils").logIfDuplicateMessagesFoundInRestore(A,"protobuf_restore");if(t!=null)try{d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"native_op_start_unified",traceId:t,type:B});z=d("MAWJids").toUserJid(c("CurrentUser").getAccountID());w=d("MAWEBUnstoredDbMsgUtils").getUnstoredDbMsgFromProtobuf(A,a,void 0,z);if(f===!0&&w.length===0){d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"hasMoreBefore_decodedMessages_inconsistency",traceId:t,type:B});z=e!=null?c("LSVec").toArray(e).length:0;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(e=t)!=null?e:"no_request_id"]).ERROR(n(),z)}d("MAWAsyncEBPendingQueryPromise").resolvePendingQueryIfPresent(t,{echoMessages:void 0,hasMoreAfter:q,hasMoreBefore:f,isPointQuery:s,messages:w,nextMessageTimestampMsBefore:g,protobufMessages:A,referenceTimestamp:u,requestId:t,restoreType:"protobuf",threadId:a})}catch(a){d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(e=t)!=null?e:"no_request_id"]).ERROR(m(),a.message)}if(f===!0&&A.length===0){t!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"hasMoreBefore_messages_inconsistency",traceId:t,type:B});d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(z=t)!=null?z:"no_request_id"]).ERROR(l())}w=x!=null&&(h||(h=d("LSIntEnum"))).unwrapIntEnum(x)===c("LSMEBTaskCreationSource").FTS_INDEX_EB_MESSAGES_WEB;if(w){t!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"search_restore_end",traceId:t,type:B});d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(t);return(i||(i=b("Promise"))).resolve()}e=x!=null&&(h||(h=d("LSIntEnum"))).unwrapIntEnum(x)===c("LSMEBTaskCreationSource").MSGR_DYI;if(e){d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(z=t)!=null?z:"no_request_id"]).LOG(k());void d("MAWEncryptedBackupsDYIHandleMessageRestore").handleMAWProtobufMessageRangeQueryRestore(a,A,f,g);t!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"dyi_restore_end",traceId:t,type:B});d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(t);return(i||(i=b("Promise"))).resolve()}c("promiseDone")(d("MAWRestoreProtobufsFromEncryptedBackupsDeferred").call("AdvancedCrypto",d("MAWJobDefinitions").toThreadJidPrimaryId(a),A,f,g,q,r,s,t,u,v,void 0,x,void 0,y),function(){t!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"native_op_end_unified",traceId:t,type:B})},function(a){var b;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(b=t)!=null?b:"no_request_id"]).ERROR(j(),a.message);b={string:{error:a.message}};t!=null&&d("MAWEBRestoreTrackingUtils").markEBRestoreFail(t,!1,"native_op_reject_unified",b)});return(i||(i=b("Promise"))).resolve()});return q.apply(this,arguments)}g.echoProtobufConsolidatedRestoreHelper=a}),98);
__d("LSProcessBackupIds",["LSAppendDataTraceAddon","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsProcessBackupIdsStoredProcedure] Beginning execution."),c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1487]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[11],c.i64.cast([0,3]))):c.resolve()}])},function(e){return c.db.table(172).fetch([[[c.i64.cast([0,1])]]]).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1488]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[11],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[1]=c.i64.cast([0,0])}]):(f=e.item,c.sequence([function(e){return d[11]=f.backupId,d[10]=f.authorityLevel,c.i64.eq(d[10],c.i64.cast([0,20]))?c.resolve(d[9]=c.i64.cast([0,1])):c.sequence([function(e){return c.i64.eq(d[10],c.i64.cast([0,80]))?c.sequence([function(e){return c.i64.eq(d[11],void 0)?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1492]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[14]=a[0],a})},function(a){return d[14]?d[15]=!0:d[15]=!1,d[15]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[16],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[13]=c.i64.cast([0,2])}]):c.sequence([function(e){return c.i64.eq(d[11],c.i64.cast([-1,4294967295]))?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1489]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[15]?d[16]=!0:d[16]=!1,d[16]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[17]=c.createArray(),void 0!==void 0?d[18]=(d[17].push(void 0),d[17]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[17],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[14]=c.i64.cast([-1,4294967295])}]):c.sequence([function(e){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.backupId,d[11])&&c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(e,f){f=e.done;e=e.value;return f?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1490]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[18]=!0:d[18]=!1,d[18]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]=c.createArray(),void 0!==void 0?d[20]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[19],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[15]=c.i64.cast([0,4])}]):(e.item,c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1491]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[18]=!0:d[18]=!1,d[18]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]=c.createArray(),void 0!==void 0?d[20]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[19],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[15]=c.i64.cast([0,3])}]))})},function(a){return d[14]=d[15]}])},function(a){return d[13]=d[14]}])},function(a){return d[12]=d[13]}]):c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1489]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[13]?d[14]=!0:d[14]=!1,d[14]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[15]=c.createArray(),void 0!==void 0?d[16]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[15],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[12]=c.i64.cast([-1,4294967295])}])},function(a){return d[9]=d[12]}])},function(a){return d[1]=d[9]}]))})},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[6]="Finishing execution. Execution time: ",d[7]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsProcessBackupIdsStoredProcedure] ",d[5],d[6],d[5],d[7],d[5],d[8]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[9]=",",d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsProcessBackupIdsStoredProcedure",[d[6],d[9],d[7],d[9],d[8]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[1]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsProcessBackupIdsStoredProcedure";a.__tables__=["encrypted_backups","secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSProcessBackupIdsStoredProcedure",["LSProcessBackupIds","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e===void 0&&(e={});a=a.storedProcedure(c("LSProcessBackupIds"),e.traceId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MAWThreadIdToChatJidMapping",["I64","MAWAsyncEBPendingQueryPromise","MAWJidUtils","ReQL","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot generate ChatJid from threadKey, called from ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot find thread with serverThreadKey ",", called from ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot find MI ACT mapping table entry for threadId ",", called from ",""]);k=function(){return a};return a}var l=new Map();function a(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(l.has(b))return l.get(b);var e=d("MAWAsyncEBPendingQueryPromise").getJidFromThreadId(b);if(e!=null){l.set(b,e);return e}e=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table.index("jid")).getKeyRange((h||(h=d("I64"))).of_string(b))));if(e==null){d("WALogger").ERROR(k(),b,c);return null}var f=e.serverThreadKey;e=e.jid;a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(f)));if(a==null){d("WALogger").ERROR(j(),(h||(h=d("I64"))).to_string(f),c);return null}f=d("MAWJidUtils").LSJidtoChatJid(e,a.threadType);if(f!=null){l.set(b,f);return f}else{d("WALogger").ERROR(i(),c);return null}});return m.apply(this,arguments)}g.genChatJidFromThreadId=a}),98);
__d("LSRestoreProtobufs.nop",["LSProtobufRestoreHandler","MAWThreadIdToChatJidMapping","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h,i,j,k,l,m,n,o,p){b=null;p!=null&&(b=d("WAJids").validateChatJid(p));b==null&&(b=(yield d("MAWThreadIdToChatJidMapping").genChatJidFromThreadId(a,c,"LSRestoreProtobufs.nop")));return d("LSProtobufRestoreHandler").handleProtobufRestoreHelper(c,e,void 0,f,g,h,i,j,k,l,m,n,o,b)});function c(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){return a.apply(this,arguments)}return c}();g["default"]=a}),98);
__d("LSRestoreEchoBlobsHandler",["LSRestoreProtobufs.nop","LSVec","MAWBridgeSafeActionsWorkerAndUI","MAWEBRestoreTrackingUtils","MAWEncryptedBackupUtils","MAWJobDefinitions","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,d,e,f,g,h,j,k,l,m,n){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,i,j,k,l,m,n,o,p,q){var r=c("LSVec").toArray(f).map(d("MAWJobDefinitions").toEncodedEchoMessage);n!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"echo_to_protobuf_conversion_start",traceId:n,type:"echo"});r=(yield d("MAWBridgeSafeActionsWorkerAndUI").sendAndReceiveBackendWorkerAndUIShared("convertEchoMessagesToEBProtobufs",{chatJid:q,encodedEchoMessages:r}));n!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"echo_to_protobuf_conversion_success",traceId:n,type:"echo"});yield c("LSRestoreProtobufs.nop")(a,e,m,d("MAWEncryptedBackupUtils").convertJSTypesToLSTypesForRestoreJob(r),g,i,j,k,l,n,o,"",f,p,q);return(h||(h=b("Promise"))).resolve([!0,c("LSVec").ofArray([]),c("LSVec").ofArray([])])});return i.apply(this,arguments)}g.handleEchoBlobsRestore=a}),98);
__d("LSRestoreEchoBlobs.nop",["LSRestoreEchoBlobsHandler","LSVec","MAWAsyncEBPendingQueryPromise","MAWEBRestoreTrackingUtils","MAWThreadIdToChatJidMapping","Promise","WAJids","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,i,j,k,l,m,n,o,p,q,r){var s;r!=null&&(s=d("WAJids").validateChatJid(r));s==null&&(s=(yield d("MAWThreadIdToChatJidMapping").genChatJidFromThreadId(a,n,"LSRestoreEchoBlobs.nop")));if(s==null){o!=null&&d("MAWAsyncEBPendingQueryPromise").rejectPendingQueryIfPresent(o,c("err")("Cannot generate ChatJid from threadKey: "+n));d("MAWEBRestoreTrackingUtils").markEBRestoreFail(o,!1,"no_chat_jid");return(h||(h=b("Promise"))).resolve([!0,c("LSVec").ofArray([]),c("LSVec").ofArray([])])}return d("LSRestoreEchoBlobsHandler").handleEchoBlobsRestore(a,e,g,i,j,k,l,m,n,o,p,q,s)});function e(b,c,d,e,f,g,h,i,j,k,l,m,n,o){return a.apply(this,arguments)}return e}();g["default"]=a}),98);
__d("MAWBridgeTraceRecordCheckpointHandler",["I64","LSAppendDataTraceAddonStoredProcedure","LSFactory","LSFlushDataTrace.nop"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var e=b.checkPointId,f=b.dataTraceId,g=b.errorMessage,i=b.tags;return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:e,dataTraceId:f,errorMessage:g,syncChannel:(h||(h=d("I64"))).neg_one,tags:i}).then(function(){if(b.shouldFlush)return c("LSFlushDataTrace.nop")(a,0,f)})}g.call=a}),98);
__d("MAWRestoreProtobufsFromEncryptedBackupsNOP",["ExecutionEnvironment","I64","LSDataTraceCheckPoint","LSIntEnum","LSMEBTaskCreationSource","MAWBridgeTraceRecordCheckpointHandler","MAWChatJid","MAWJobDefinitions","MAWJobManager","MAWMediaGalleryM2Utils","Promise","Random","ReQL","WAJobOrchestratorTypes","WALoggerDeferred","asyncToGeneratorRuntime","cr:9466","err","ifRequireable","justknobx","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to get thread key for "," when calling restoreProtobufsFromEncryptedBackups"]);l=function(){return a};return a}function m(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){try{c=(yield d("MAWChatJid").toThreadKeyMaybeForChatJidInteger(a,(k||(k=d("I64"))).of_string(c)));if(c!=null){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.messages_ranges_v2__generated).getKeyRange(c)));if(a!=null)return a.minMessageId}}catch(a){return(i||(i=b("Promise"))).reject(a)}return});return n.apply(this,arguments)}function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,p,q){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,h,n,o,q,r,s,t,u,v,w,x,y){x===void 0&&(x=d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION);try{var z=(yield m(a,f));n=(yield d("MAWChatJid").toThreadKeyMaybeForChatJidInteger(a,(k||(k=d("I64"))).of_string(f)));n==null&&void d("WALoggerDeferred").ERROR(l(),f);q=t!=null?Number(t):void 0;u=b("cr:9466")!=null?c("justknobx")._("2620"):0;n=d("Random").coinflip(u);u=b("cr:9466")!=null&&n?b("cr:9466").getMessageMetadataFromDeanonAPI(f,g.length,q):(i||(i=b("Promise"))).resolve();return u.then(function(a){return p(e,f,v,g,z,h,o,r,s,t,w==null?void 0:w,a,x,y)})}catch(e){if(s!=null)return d("MAWBridgeTraceRecordCheckpointHandler").call(a,{checkPointId:(j||(j=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE),dataTraceId:s,errorMessage:e,shouldFlush:!0,syncChannel:-1,tags:void 0}).then(function(){return(i||(i=b("Promise"))).reject(e)})}return(i||(i=b("Promise"))).resolve()});return o.apply(this,arguments)}function p(a,e,f,g,l,m,n,o,p,q,r,s,t,u){t===void 0&&(t=d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION);var v;if((h||(h=c("ExecutionEnvironment"))).isInWorker)v=d("MAWJobManager").getJobManager();else{var w;c("ifRequireable")("MAWTimedJob",function(a){a=a.TimedUIJobStarters;w=a},function(){throw c("err")("MAWTimedJob is not requireable in MAWRestoreProtobufsFromEncryptedBackupsNOP")});v=c("nullthrows")(w,"ifRequireable is not sync")}if(p!=null&&r!=null&&(j||(j=d("LSIntEnum"))).unwrapIntEnum(r)===c("LSMEBTaskCreationSource").MESSENGER_MESSAGE_LIST_PAGINATION&&!(h||(h=c("ExecutionEnvironment"))).isInWorker){var x;return v.waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreProtobufsFromEncryptedBackups(f,a,e,g,m,n,o,(x=l)!=null?x:void 0,(x=p)!=null?x:void 0,(x=q)!=null?x:void 0,void 0,{priority:t},r,s,void 0,(x=u)!=null?x:void 0))}if((j||(j=d("LSIntEnum"))).unwrapIntEnum(r||(k||(k=d("I64"))).zero)===c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE&&d("MAWMediaGalleryM2Utils").shouldSkipSyncToLSDB()&&!(h||(h=c("ExecutionEnvironment"))).isInWorker){return v.waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreProtobufsFromEncryptedBackups(f,a,e,g,m,n,o,(t=l)!=null?t:void 0,(x=p)!=null?x:void 0,(t=q)!=null?t:void 0,void 0,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},r,s,void 0,(x=u)!=null?x:void 0))}return(i||(i=b("Promise"))).resolve(v.fireAndForget(d("MAWJobDefinitions").jobSerializers.restoreProtobufsFromEncryptedBackups(f,a,e,g,m,n,o,(t=l)!=null?t:void 0,(x=p)!=null?x:void 0,(v=q)!=null?v:void 0,void 0,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},r,s,void 0,(f=u)!=null?f:void 0)))}g.call=a}),98);
__d("MWChatEncryptedBackupsLogging",["MWEBODSCategory","MWEBODSEntityKey.enum","ODS","QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){var b=a.cancelEndPoint,d=a.event,e=a.instanceKey;a=a.source;a!=null&&c("QPLUserFlow").addAnnotations(d,{string:{source:a}},{instanceKey:e});c("QPLUserFlow").addPoint(d,"cancel",{instanceKey:e});c("QPLUserFlow").addAnnotations(d,{string:{cancel_end_point:b}},{instanceKey:e});c("QPLUserFlow").endCancel(d,{instanceKey:e})}function a(a){var b=a.event,d=a.instanceKey,e=a.onClose;a=a.source;a!=null&&c("QPLUserFlow").addAnnotations(b,{string:{source:a}},{instanceKey:d});i({cancelEndPoint:"dialog_x_button",event:b,instanceKey:d});e()}function b(a){var b=a.annotations,e=a.event,f=a.instanceKey;a=a.odsEntityName;c("QPLUserFlow").addPoint(e,"success",{instanceKey:f});c("QPLUserFlow").endSuccess(e,{annotations:b,instanceKey:f});a&&(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),a,c("MWEBODSEntityKey.enum").SUCCESS)}function e(a){var b=a.annotations,e=a.errorName,f=a.event,g=a.instanceKey,i=a.odsEntityKey;a=a.odsEntityName;c("QPLUserFlow").addPoint(f,"failure",{instanceKey:g});c("QPLUserFlow").endFailure(f,e,{annotations:b,instanceKey:g});a&&(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),a,(f=i)!=null?f:c("MWEBODSEntityKey.enum").FAIL)}g.cancelFlow=i;g.closeDialogCancelFlow=a;g.endSuccess=b;g.endFailure=e}),98);
__d("MWChatEncryptedBackupsQPLEvents",["qpl"],(function(a,b,c,d,e,f,g){"use strict";b=(a=c("qpl"))._(521476140,"378");d=a._(521472542,"295");e=a._(521482085,"409");f=a._(521485406,"272");c=a._(521482763,"296");var h=a._(521484295,"1460"),i=a._(521482969,"1519"),j=a._(521479124,"1939"),k=a._(521474385,"263"),l=a._(521476098,"504"),m=a._(521482858,"1290"),n=a._(521473194,"1331");a=a._(521471024,"2275");g.pinCodeChangeQplEvent=b;g.optOutQplEvent=d;g.backupSetupQplEvent=e;g.mobileOnboardingQplEvent=f;g.restoreQplEvent=c;g.restoreDeviceAuthQplEvent=h;g.messageRestoreQplEvent=i;g.restoreWithAutoRestoreConsentQplEvent=j;g.hsmFleetMigrationQplEvent=k;g.virtualDeviceRevocationQplEvent=l;g.onboardingAuthQplEvent=m;g.processBackupIdsQPLEvent=n;g.fetchBackupIdsQPLEvent=a}),98);
__d("MWEncryptedBackupsProcessBackupIdsDEPRECATED",["FBLogger","LSFactory","LSIntEnum","LSProcessBackupIdsStoredProcedure","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","Promise","QPLEvent","QPLUserFlow","ReQL","WebSession","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("gkx")("23914");function l(a){if(k){var e=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").getActiveFlowIDs().includes((i||(i=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent))||c("QPLUserFlow").start(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:e,processBackupIdsVersion:"msys",sessionTabId:d("WebSession").getId()}}});return a.runInTransaction(function(a){return c("LSProcessBackupIdsStoredProcedure")(c("LSFactory")(a))},"readwrite",void 0,void 0,f.id+":53").then(function(a){a=(j||(j=d("LSIntEnum"))).unwrapIntEnum(a[0]);c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent,"EB_STATE_"+a+".");d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent});return a})}else return(h||(h=b("Promise"))).resolve(0)}function a(a,b){return a.tables.encrypted_backups.subscribe(function(){c("promiseDone")(d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.encrypted_backups)),function(d){if(d!=null){c("promiseDone")(l(a),b,function(a){c("FBLogger")("labyrinth_web").catching(a).info("Error in db transaction")});return}})})}g.processBackupIdsStoredProcedure=l;g.subscribeToEncryptedBackupsRow=a}),98);
__d("X25519",["$InternalEnum","Promise","WACryptoCurve25519Dependencies","WASignalKeys","WASignalOther","WASignalSignatures"],(function(a,b,c,d,e,f,g){"use strict";var h,i=b("$InternalEnum").Mirrored(["Encryption","Signing"]),j=b("$InternalEnum")({PublicKey:0,PrivateKey:1,Signature:2});function k(a,b){if(b===i.Encryption)return[];b=1;switch(a){case j.PublicKey:b=1;break;case j.PrivateKey:b=2;break;case j.Signature:b=3;break}return[255,b]}function l(a,b,c){b=k(b,c);c=b.length;if(c<=0)return a;var d=new Uint8Array(c+a.byteLength);d.set(Array.from(b));d.set(a,c);return d}function m(a,b,c){b=k(b,c).length;return a.slice(b)}function n(a,b){return{privateKey:l(a.privateKey,j.PrivateKey,b),publicKey:l(a.publicKey,j.PublicKey,b)}}function a(a){a=n(d("WASignalKeys").makeKeyPair(),a);return{pk:a.publicKey,sk:a.privateKey}}function o(a,b){if(b===i.Encryption)return 32;switch(a){case j.PublicKey:case j.PrivateKey:return 32;case j.Signature:return 64}}function p(a,b,c){var d=k(b,c),e=d.length;b=o(b,c);c=b!=null?e+b:0;if(a.length!==c)return!1;var f=a.subarray(0,e);b=new Uint8Array(d);return b.length===f.length&&b.every(function(a,b){return a===f[b]})}function q(a,b){if(p(a,j.PublicKey,b))return a;return}function r(a,b){if(p(a,j.PrivateKey,b))return a;return}function c(a,b){var c=q(a.pkBytes,b);a=r(a.skBytes,b);if(c!=null&&a!=null)return{pk:c,sk:a}}function e(a,c){a=m(a,j.PrivateKey,i.Signing);return d("WASignalSignatures").signMsg(d("WASignalKeys").makeKeyPairFrom(d("WASignalOther").ensureSize(a,32)),c).then(function(a){a=l(a,j.Signature,i.Signing);return(h||(h=b("Promise"))).resolve(a)})}function f(a){if(p(a,j.Signature,i.Signing))return a}function s(a,b,c){b=m(b,j.PublicKey,i.Signing);return d("WASignalSignatures").verifyMsgSignalVariant(d("WASignalKeys").serializeIdentity(b),c,d("WASignalOther").ensureSize(m(a,j.Signature,i.Signing),64))}function t(a,c){c=c;a=a;return!p(a,j.PublicKey,i.Encryption)||!p(c,j.PrivateKey,i.Encryption)?(h||(h=b("Promise"))).resolve():d("WACryptoCurve25519Dependencies").calculateAgreement(a,c).then(function(a){return(h||(h=b("Promise"))).resolve(new Uint8Array(a))})}g.KeyPurpose=i;g.generateKeys=a;g.publicKeyFromBytes=q;g.secretKeyFromBytes=r;g.keysFromBytes=c;g.sign=e;g.signatureFromBytes=f;g.verify=s;g.exchangeKeys=t}),98);
__d("PublicKeyCrypto",["Promise","UInt8Array","X25519"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,c){return(h||(h=b("Promise"))).all([a,c]).then(function(a){return(h||(h=b("Promise"))).resolve(a[0]!=null&&a[1]!=null?d("UInt8Array").concatBytes([a[0],a[1]]):void 0)})}function a(a,b,c){return i(d("X25519").exchangeKeys(c,a),d("X25519").exchangeKeys(c,b))}function c(a,b,c){return i(d("X25519").exchangeKeys(c,a),d("X25519").exchangeKeys(b,a))}g.senderDeriveSharedSecret=a;g.receiverDeriveSharedSecret=c}),98);/*FB_PKG_DELIM*/
__d("EARInitType",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["EB_INIT","LS_INIT","MAW_INIT","MAW_RP_INIT","MAW_IN_UI_INIT"]);c=a;f["default"]=c}),66);
__d("EBEnableUnifiedAttachment",[],(function(a,b,c,d,e,f){"use strict";var g=!1;function a(a){g=a}function b(){return g}f.setEbEnableUnifiedAttachment=a;f.getEbEnableUnifiedAttachment=b}),66);
__d("EBUnifyLegacyMediaUpload",[],(function(a,b,c,d,e,f){"use strict";var g=!1;function a(a){g=a}function b(){return g}f.setEnableUnifyLegacyMediaUpload=a;f.getEnableUnifyLegacyMediaUpload=b}),66);
__d("LSDataTraceTag",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;c=2;d=3;e=4;var g=5,h=6,i=7,j=20,k=21,l=22,m=23,n=24,o=25,p=26,q=27,r=28,s=29,t=30,u=31,v=32,w=33,x=34,y=35,z=36,A=37,B=38,C=39,D=40,E=41,F=42;f.none=a;f.sticker=b;f.image=c;f.animatedImage=d;f.video=e;f.audio=g;f.file=h;f.xma=i;f.messageTypeNone=j;f.messageTypeText=k;f.messageTypeFutureproof=l;f.messageTypeCiphertext=m;f.messageTypeUnavailable=n;f.messageTypeImage=o;f.messageTypeVideo=p;f.messageTypePtt=q;f.messageTypeAdmin=r;f.messageTypeRevoked=s;f.messageTypeGif=t;f.messageTypeSticker=u;f.messageTypeExpiredEphemeral=v;f.messageTypeEphemeralSettingAdmin=w;f.messageTypeEphemeralSyncResponse=x;f.messageTypeEphemeralScreenshotAction=y;f.messageTypeDeleteForMe=z;f.messageTypeEphemeralSettingChangeFromCurrentDevice=A;f.messageTypeAlertICDC=B;f.messageTypeGroupInvite=C;f.messageTypeXMA=D;f.messageTypeReaction=E;f.messageTypeSenderKeyDistribution=F}),66);
__d("LSHotEmojiSize",[],(function(a,b,c,d,e,f){a=Object.freeze({NONE:0,SMALL:1,MEDIUM:2,LARGE:3});f["default"]=a}),66);
__d("LSMEBTaskCreationSource",[],(function(a,b,c,d,e,f){a=Object.freeze({UNKNOWN:-1,TEST_ONLY:0,TAM:1,MEM:2,RETROACTIVE_BACKUP:3,TAM_WEB:4,ACT_MESSAGE_DELETE:5,ACT_THREAD_DELETE:6,ACT_UPDATE_ATTACHMENT:7,TAM_PERSISTENCE_TASK:8,TAM_XMA_TOMBSTONE:9,MEM_RECEIVE:10,MEM_SEND:11,MEM_PEER_SYNC:12,MEM_RECEIVE_PROTOBUF:13,MEM_SEND_PROTOBUF:14,MEM_PEER_SYNC_PROTOBUF:15,EB_ADD_DEVICE:21,OPTIMISTIC_THREAD_CREATE_VIA_SHIM:22,ACT_THREAD_INSERT_VIA_SHIM:23,MI_THREAD_INSERT_VIA_SHIM:24,POINT_QUERY_FROM_EB:25,MESSENGER_SEARCH:26,ACT_MESSAGE_RANGE_TASK_HANDLER:27,POINT_QUERY_ON_FULLY_LOADED_THREAD:28,THREAD_CUTOVER:29,HYBRID_THREAD_VERIFY_OR_CREATE_VIA_SHIM:30,BURNER_INTERNAL_LOAD_TESTING_FRAMEWORK:31,THREAD_GALLERY_RESTORE:32,ACT_SURROUNDING_QUERY:33,EB_SNAPSHOT_RESTORE:34,PROTOBUF_RESTORE:39,FTS_INDEX_EB_MESSAGES:40,INSTAMADILLO_DYI:41,MESSENGER_MESSAGE_LIST_PAGINATION:45,DELTA_GENERIC_MESSAGE_SYNC:55,MEDIA_GALLERY_RESTORE:57,EB_PROTOBUF_RESTORE_NO_OP:58,NEW_MEMBER_EXPORT:59,EB_RESTORE_REPLIED_MESSAGES_AFTER_RANGE_RESTORE:35,REPL_TESTING:36,EB_POINT_QUERY_IN_ACT:37,EB_POINT_QUERY_RETRY_DECRYPTION_FAILURES:38,EB_POINT_QUERY_PINNED_MESSAGES:53,EB_POINT_QUERY_RESTORE_PROTOBUF:54,EB_POINT_QUERY_IN_ACT_REACTIONS:56,IGD_DYI:42,FTS_INDEX_EB_MESSAGES_WEB:43,BULK_QUERY_FOR_SEARCH_RESULT:44,MSGR_DYI:46,EB_RESTORE_ON_REGISTRATION:47,EB_RESTORE_ON_OFFLINE_QUEUE_COUNT_LIMIT:48,EB_POINT_QUERY_RESTORE_ON_ACK_DROP:49,EB_POINT_QUERY_RESTORE_ON_DECRYPTION_FAILURE:50,EB_POINT_QUERY_RESTORE_ON_UNAVAILABLE_DEVICE:51,EB_RANGE_QUERY_RESTORE_ON_THREAD_SESSION_ACTIVATE:52});f["default"]=a}),66);
__d("MAWAckLevel",["LSIntEnum","LSMessageSendStatus"],(function(a,b,c,d,e,f,g){"use strict";var h,i={clock:0,contentGone:-3,contentTooBig:-4,contentUnuploadable:-5,expired:-2,failed:-1,failedRetryable:-9,inactiveReceived:-6,partialOptimistic:-8,played:4,read:3,received:2,senderBackFillSent:-7,sent:1};function a(a){return a>0}function b(a){switch(a){case i.partialOptimistic:return(h||(h=d("LSIntEnum"))).ofNumber(0);case i.clock:return(h||(h=d("LSIntEnum"))).ofNumber(1);case i.sent:case i.received:case i.read:case i.played:return(h||(h=d("LSIntEnum"))).ofNumber(2);case i.failedRetryable:return(h||(h=d("LSIntEnum"))).ofNumber(5);default:return(h||(h=d("LSIntEnum"))).ofNumber(4)}}function e(a){switch(a){case i.partialOptimistic:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessageSendStatus").NONE);case i.clock:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessageSendStatus").SENDING_TO_SERVER);case i.sent:case i.received:case i.read:case i.played:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessageSendStatus").SERVER_RECEIVED);case i.failedRetryable:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessageSendStatus").RETRIABLE_ERROR);default:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessageSendStatus").NON_RETRIABLE_ERROR)}}g.ACK=i;g.isMsgAuthoritative=a;g.levelToMessagingSendStatusV2=b;g.levelToMessagingSendStatus=e}),98);
__d("MAWAdminMsgType",[],(function(a,b,c,d,e,f){"use strict";a="currentUserAddedDevice";b="participantAddedDevice";c="currentUserRemovedDevice";d="participantRemovedDevice";e="currentUserUpdatedDevice";var g="participantUpdatedDevice",h="participantAddedYou",i="participantAddedYouAndOneUser",j="participantAddedYouAndMoreThanOneUsers",k="unknowUserAddedYou",l="unknowUserAddedYouAndOneUser",m="unknowUserAddedYouAndMoreThanOneUser",n="unknownUserAddedOneUser",o="unknownUserAddedTwoUser",p="unknownUserAddedMoreThanTwoUser",q="participantAddedOneUser",r="participantAddedTwoUser",s="participantAddedMoreThanTwoUser",t="currentUserRemovedOneParticipant",u="currentUserRemovedTwoParticipant",v="currentUserRemovedMoreThanTwoParticipant",w="currentUserAddedOneParticipant",x="currentUserAddedTwoParticipant",y="currentUserAddedMoreThanTwoParticipant",z="participantRemovedYou",A="participantRemovedYouAndOneUser",B="participantRemovedYouAndMoreThanOneUsers",C="unknowUserRemovedYou",D="unknowUserRemovedYouAndOneUser",E="unknowUserRemovedYouAndMoreThanOneUser",F="unknownUserRemovedOneUser",G="unknownUserRemovedTwoUser",H="unknownUserRemovedMoreThanTwoUser",I="participantRemovedOneUser",J="participantRemovedTwoUser",K="participantRemovedMoreThanTwoUser",L="participantLeftGroup",M="currentUserLeftGroup",N="participantCustomizeParticipantNickname",O="participantClearParticipantNickname",P="participantCustomizeCurrentUserNickname",Q="currentUserSetOwnNickname",aa="currentUserClearOwnNickname",ba="currentUserClearParticipantNickname",ca="participantSetOwnNickname",da="participantClearOwnNickname",ea="participantClearCurrentUserNickname",fa="currentUserCustomizeNickname",ga="currentUserNamedGroup",ha="unkonwnUserNamedGroup",ia="participantNamedGroup",ja="currentUserCustomizeHotlike",ka="participantCustomizeHotlike",la="currentUserCustomizeTheme",ma="currentUserCustomizePhoto",na="participantCustomizeTheme",oa="participantCustomizePhoto",pa="currentUserSetAddModeAdminOnly",qa="currentUserSetAddModeAllMembers",ra="participantSetAddModeAdminOnly",sa="participantSetAddModeAllMembers",ta="serverSetAddModeAdminOnly",ua="serverSetAddModeAllMembers",R="currentUserPinnedMessage",S="currentUserUnpinnedMessage",T="participantPinnedMessage",U="participantUnpinnedMessage",V="cutoverThreadAdminMessage",W="cutoverIGDThreadAdminMessage",X="cutoverRollbackAdminMessage",Y="dualThreadCutoverAdminMessage",Z="e2eeThreadDescription",$="e2eeThreadUKOSAAdminMessage",va="debugMsg",wa="reachabilityError",xa="twoUsersConnected",ya="twoUsersConnectedOneMSplit";y={CURRENT_USER_ADDED_DEVICE:a,CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:y,CURRENT_USER_ADDED_ONE_PARTICIPANT:w,CURRENT_USER_ADDED_TWO_PARTICIPANTS:x,CURRENT_USER_CLEAR_OWN_NICKNAME:aa,CURRENT_USER_CLEAR_PARTICIPANT_NICKNAME:ba,CURRENT_USER_CUSTOMIZE_HOTLIKE:ja,CURRENT_USER_CUSTOMIZE_NICKNAME:fa,CURRENT_USER_CUSTOMIZE_PHOTO:ma,CURRENT_USER_CUSTOMIZE_THEME:la,CURRENT_USER_LEFT_GROUP:M,CURRENT_USER_NAMED_GROUP:ga,CURRENT_USER_PINNED_MESSAGE:R,CURRENT_USER_REMOVED_DEVICE:c,CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:v,CURRENT_USER_REMOVED_ONE_PARTICIPANT:t,CURRENT_USER_REMOVED_TWO_PARTICIPANTS:u,CURRENT_USER_SET_ADD_MODE_ADMIN_ONLY:pa,CURRENT_USER_SET_ADD_MODE_ALL_MEMBERS:qa,CURRENT_USER_SET_OWN_NICKNAME:Q,CURRENT_USER_UNPINNED_MESSAGE:S,CURRENT_USER_UPDATED_DEVICE:e,CUTOVER_IGD_THREAD_ADMIN_MESSAGE:W,CUTOVER_ROLLBACK_ADMIN_MESSAGE:X,CUTOVER_THREAD_ADMIN_MESSAGE:V,DEBUG_MSG:va,DUAL_THREAD_CUTOVER_ADMIN_MESSAGE:Y,E2EE_THREAD_DESCRIPTION:Z,E2EE_THREAD_UK_OSA_ADMIN_MESSAGE:$,PARTICIPANT_ADDED_DEVICE:b,PARTICIPANT_ADDED_MORE_THAN_TWO_USER:s,PARTICIPANT_ADDED_ONE_USER:q,PARTICIPANT_ADDED_TWO_USER:r,PARTICIPANT_ADDED_YOU:h,PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:j,PARTICIPANT_ADDED_YOU_AND_ONE_USER:i,PARTICIPANT_CLEAR_CURRENT_USER_NICKNAME:ea,PARTICIPANT_CLEAR_OWN_NICKNAME:da,PARTICIPANT_CLEAR_PARTICIPANT_NICKNAME:O,PARTICIPANT_CUSTOMIZE_CURRENT_USER_NICKNAME:P,PARTICIPANT_CUSTOMIZE_HOTLIKE:ka,PARTICIPANT_CUSTOMIZE_PARTICIPANT_NICKNAME:N,PARTICIPANT_CUSTOMIZE_PHOTO:oa,PARTICIPANT_CUSTOMIZE_THEME:na,PARTICIPANT_LEFT_GROUP:L,PARTICIPANT_NAMED_GROUP:ia,PARTICIPANT_PINNED_MESSAGE:T,PARTICIPANT_REMOVED_DEVICE:d,PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:K,PARTICIPANT_REMOVED_ONE_USER:I,PARTICIPANT_REMOVED_TWO_USER:J,PARTICIPANT_REMOVED_YOU:z,PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:B,PARTICIPANT_REMOVED_YOU_AND_ONE_USER:A,PARTICIPANT_SET_ADD_MODE_ADMIN_ONLY:ra,PARTICIPANT_SET_ADD_MODE_ALL_MEMBERS:sa,PARTICIPANT_SET_OWN_NICKNAME:ca,PARTICIPANT_UNPINNED_MESSAGE:U,PARTICIPANT_UPDATED_DEVICE:g,REACHABILITY_ERROR:wa,SERVER_SET_ADD_MODE_ADMIN_ONLY:ta,SERVER_SET_ADD_MODE_ALL_MEMBERS:ua,TWO_USERS_CONNECTED:xa,TWO_USERS_CONNECTED_ONE_MSPLIT:ya,UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER:p,UNKNOWN_USER_ADDED_ONE_USER:n,UNKNOWN_USER_ADDED_TWO_USER:o,UNKNOWN_USER_ADDED_YOU:k,UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER:m,UNKNOWN_USER_ADDED_YOU_AND_ONE_USER:l,UNKNOWN_USER_NAMED_GROUP:ha,UNKNOWN_USER_REMOVED_MORE_THAN_TWO_USER:H,UNKNOWN_USER_REMOVED_ONE_USER:F,UNKNOWN_USER_REMOVED_TWO_USER:G,UNKNOWN_USER_REMOVED_YOU:C,UNKNOWN_USER_REMOVED_YOU_AND_MORE_THAN_ONE_USER:E,UNKNOWN_USER_REMOVED_YOU_AND_ONE_USER:D};f.CURRENT_USER_ADDED_DEVICE=a;f.CURRENT_USER_PINNED_MESSAGE=R;f.CURRENT_USER_UNPINNED_MESSAGE=S;f.PARTICIPANT_PINNED_MESSAGE=T;f.PARTICIPANT_UNPINNED_MESSAGE=U;f.CUTOVER_THREAD_ADMIN_MESSAGE=V;f.CUTOVER_IGD_THREAD_ADMIN_MESSAGE=W;f.CUTOVER_ROLLBACK_ADMIN_MESSAGE=X;f.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE=Y;f.E2EE_THREAD_DESCRIPTION=Z;f.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE=$;f.ADMIN_MSG_TYPE=y}),66);
__d("MAWLocalizationType",["MAWAdminMsgType"],(function(a,b,c,d,e,f,g){"use strict";a="emptySnippet";b="currentUserCreatedGroup";c="participantCreatedGroup";e="unknownUserCreatedGroup";f="currentUserGotPromoted";var h="currentUserGotDemoted",i="participantGotPromoted",j="participantGotDemoted",k="participantPromotedYou",l="participantDemotedYou",m="currentUserPromotedParticipant",n="currentUserDemotedParticipant",o="participantDemotedParticipant",p="participantPromotedParticipant",q="participantSelfDemoted",r="currentUserSelfDemoted",s="currentUserSendText",t="currentUserSendImage",u="currentUserSendVideo",v="currentUserSendAudio",w="currentUserSendGif",x="currentUserSendSticker",y="participantSendText",z="participantSendTextInGroup",A="participantSendImage",B="participantSendVideo",C="participantSendAudio",D="participantSendGif",E="participantSendSticker",F="unavailableSnippet",G="unknownUserEphemeralSettingTurnedOnSeconds",H="unknownUserEphemeralSettingTurnedOnMinutes",I="unknownUserEphemeralSettingTurnedOnHours",J="unknownUserEphemeralSettingTurnedOnDays",K="youEphemeralSettingTurnedOnSeconds",L="youEphemeralSettingTurnedOnMinutes",M="youEphemeralSettingTurnedOnHours",N="youEphemeralSettingTurnedOnDays",O="participantEphemeralSettingTurnedOnSeconds",P="participantEphemeralSettingTurnedOnMinutes",Q="participantEphemeralSettingTurnedOnHours",R="participantEphemeralSettingTurnedOnDays",S="unknownUserEphemeralSettingChangeSeconds",T="unknownUserEphemeralSettingChangeMinutes",U="unknownUserEphemeralSettingChangeHours",V="unknownUserEphemeralSettingChangeDays",W="youEphemeralSettingChangeSeconds",X="youEphemeralSettingChangeMinutes",Y="youEphemeralSettingChangeHours",aa="youEphemeralSettingChangeDays",ba="participantEphemeralSettingChangeSeconds",ca="participantEphemeralSettingChangeMinutes",da="participantEphemeralSettingChangeHours",ea="participantEphemeralSettingChangeDays",fa="unknownUserEphemeralSettingTurnedOff",ga="youEphemeralSettingTurnedOff",ha="participantEphemeralSettingTurnedOff",ia="ephemeralSettingsAutoReset",ja="currentUserUnsentMessage",ka="participantUnsentMessage",la="participantReactMessage",ma="participantReactMessageInGroup",Z="unknownUserEphemeralTakeScreenshot",na="unknownUserEphemeralRecordScreen",oa="youEphemeralTakeScreenshot",pa="youEphemeralRecordScreen",qa="participantEphemeralTakeScreenshot",ra="participantEphemeralRecordScreen",sa="icdcAlertAdminMessage",ta="yourDeviceICDCAlertAdminMessage",$="currentUserSendAttachment",ua="participantSendAttachment",va="currentUserSentPost",wa="currentUserSentReel",xa="currentUserSentStory",ya="currentUserSentEvent",za="currentUserMentionedStoryIG",Aa="currentUserReceivedStoryMentionIG",Ba="participantSentPost",Ca="participantSentReel",Da="participantSentStory",Ea="participantSentEvent",Fa="currentUserSentStoryHighlight",Ga="participantSentStoryHighlight",Ha="currentUserMissedAudioCall",Ia="participantMissedAudioCall",Ja="currentUserMissedVideoCall",Ka="participantMissedVideoCall",La="currentUserAudioCalled",Ma="participantAudioCalled",Na="currentUserVideoCalled",Oa="participantVideoCalled",Pa="currentUserStartedGroupAudioCall",Qa="participantStartedGroupAudioCall",Ra="currentUserStartedGroupVideoCall",Sa="participantStartedGroupVideoCall",Ta="currentUserBumpedOwnMessage",Ua="currentUserBumpedMessage",Va="participantBumpedOwnMessage",Wa="participantBumpedParticipantMessage",Xa="participantBumpedCurrentUserMessage",Ya="userSendUnavailableMessage",Za="userSendEncryptedMessage",$a="currentUserSendUnrenderableMessage",ab="participantSendUnrenderableMessage",bb="currentUserSendLocationFallback",cb="participantSendLocation",db="currentUserSendLiveLocationFallback",eb="participantSendLiveLocation",fb="currentUserSendLocation",gb="participantSendLocation",hb="currentUserSendPollCreationFallback",ib="participantSendPollCreation",jb="currentUserSendContactShareFallback",kb="currentUserSendContactShare",lb="participantSendContactShareFallback",mb="participantSendContactShare",nb="currentUserSendStoryMentionFallback",ob="currentUserSendStoryMention",pb="participantSendStoryMention",qb="participantSendStoryMentionFallback",rb="currentUserSendPostMentionFallback",sb="participantSendPostMentionFallback",tb="currentUserSendPostMention",ub="participantSendPostMention",vb="currentUserSendNoteMentionFallback",wb="participantSendNoteMentionFallback",xb="messengerMemoryEncryptedMessageFallback",yb="metaAISendMessageFallback",zb="currentUserSendBumpMessageFallback",Ab="participantSendBumpMessageFallback",Bb="participantSendBumpMessageOriginalUnavailable",Cb="currentUserSendStickerReceiverFetchMessageFallback",Db="participantSendStickerReceiverFetchMessageFallback",Eb="viewOncePhotoMessageFallback",Fb="viewOnceVideoMessageFallback",Gb="unavailableStory";d=babelHelpers["extends"]({},d("MAWAdminMsgType").ADMIN_MSG_TYPE,{CURRENT_USER_AUDIO_CALLED:La,CURRENT_USER_BUMPED_MESSAGE:Ua,CURRENT_USER_BUMPED_OWN_MESSAGE:Ta,CURRENT_USER_CREATED_GROUP:b,CURRENT_USER_DEMOTED_PARTICIPANT:n,CURRENT_USER_GOT_DEMOTED:h,CURRENT_USER_GOT_PROMOTED:f,CURRENT_USER_MENTIONED_STORY_IG:za,CURRENT_USER_MISSED_AUDIO_CALL:Ha,CURRENT_USER_MISSED_VIDEO_CALL:Ja,CURRENT_USER_PROMOTED_PARTICIPANT:m,CURRENT_USER_RECEIVED_STORY_MENTION_IG:Aa,CURRENT_USER_SELF_DEMOTED:r,CURRENT_USER_SEND_ATTACHMENT:$,CURRENT_USER_SEND_AUDIO:v,CURRENT_USER_SEND_BUMP_MESSAGE_FALLBACK:zb,CURRENT_USER_SEND_CONTACT_SHARE:kb,CURRENT_USER_SEND_CONTACT_SHARE_FALLBACK:jb,CURRENT_USER_SEND_GIF:w,CURRENT_USER_SEND_IMAGE:t,CURRENT_USER_SEND_LIVE_LOCATION_FALLBACK:db,CURRENT_USER_SEND_LOCATION:fb,CURRENT_USER_SEND_LOCATION_FALLBACK:bb,CURRENT_USER_SEND_NOTE_MENTION_FALLBACK:vb,CURRENT_USER_SEND_POLL_CREATION_FALLBACK:hb,CURRENT_USER_SEND_POST_MENTION:tb,CURRENT_USER_SEND_POST_MENTION_FALLBACK:rb,CURRENT_USER_SEND_STICKER:x,CURRENT_USER_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK:Cb,CURRENT_USER_SEND_STORY_MENTION:ob,CURRENT_USER_SEND_STORY_MENTION_FALLBACK:nb,CURRENT_USER_SEND_TEXT:s,CURRENT_USER_SEND_UNRENDERABLE_MESSAGE_FALLBACK:$a,CURRENT_USER_SEND_VIDEO:u,CURRENT_USER_SENT_EVENT:ya,CURRENT_USER_SENT_POST:va,CURRENT_USER_SENT_REEL:wa,CURRENT_USER_SENT_STORY:xa,CURRENT_USER_SENT_STORY_HIGHLIGHT:Fa,CURRENT_USER_STARTED_GROUP_AUDIO_CALL:Pa,CURRENT_USER_STARTED_GROUP_VIDEO_CALL:Ra,CURRENT_USER_UNSENT_MESSAGE:ja,CURRENT_USER_VIDEO_CALLED:Na,EMPTY_SNIPPET:a,EPHEMERAL_SETTINGS_AUTO_RESET:ia,ICDC_ALERT_ADMIN_MESSAGE:sa,MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK:xb,META_AI_SEND_MESSAGE_FALLBACK:yb,PARTICIPANT_AUDIO_CALLED:Ma,PARTICIPANT_BUMPED_CURRENT_USER_MESSAGE:Xa,PARTICIPANT_BUMPED_OWN_MESSAGE:Va,PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE:Wa,PARTICIPANT_CREATED_GROUP:c,PARTICIPANT_DEMOTED_PARTICIPANT:o,PARTICIPANT_DEMOTED_YOU:l,PARTICIPANT_EPHEMERAL_RECORD_SCREEN:ra,PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS:ea,PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS:da,PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES:ca,PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS:ba,PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF:ha,PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS:R,PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS:Q,PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES:P,PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS:O,PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT:qa,PARTICIPANT_GOT_DEMOTED:j,PARTICIPANT_GOT_PROMOTED:i,PARTICIPANT_MISSED_AUDIO_CALL:Ia,PARTICIPANT_MISSED_VIDEO_CALL:Ka,PARTICIPANT_PROMOTED_PARTICIPANT:p,PARTICIPANT_PROMOTED_YOU:k,PARTICIPANT_REACT_MESSAGE:la,PARTICIPANT_REACT_MESSAGE_IN_GROUP:ma,PARTICIPANT_SELF_DEMOTED:q,PARTICIPANT_SEND_ATTACHMENT:ua,PARTICIPANT_SEND_AUDIO:C,PARTICIPANT_SEND_BUMP_MESSAGE:Ab,PARTICIPANT_SEND_BUMP_MESSAGE_ORIGINAL_UNAVAILABLE_FALLBACK:Bb,PARTICIPANT_SEND_CONTACT_SHARE:mb,PARTICIPANT_SEND_CONTACT_SHARE_FALLBACK:lb,PARTICIPANT_SEND_GIF:D,PARTICIPANT_SEND_IMAGE:A,PARTICIPANT_SEND_LIVE_LOCATION_FALLBACK:eb,PARTICIPANT_SEND_LOCATION:gb,PARTICIPANT_SEND_LOCATION_FALLBACK:cb,PARTICIPANT_SEND_NOTE_MENTION_FALLBACK:wb,PARTICIPANT_SEND_POLL_CREATION_FALLBACK:ib,PARTICIPANT_SEND_POST_MENTION:ub,PARTICIPANT_SEND_POST_MENTION_FALLBACK:sb,PARTICIPANT_SEND_STICKER:E,PARTICIPANT_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK:Db,PARTICIPANT_SEND_STORY_MENTION:pb,PARTICIPANT_SEND_STORY_MENTION_FALLBACK:qb,PARTICIPANT_SEND_TEXT:y,PARTICIPANT_SEND_TEXT_IN_GROUP:z,PARTICIPANT_SEND_UNRENDERABLE_MESSAGE_FALLBACK:ab,PARTICIPANT_SEND_VIDEO:B,PARTICIPANT_SENT_EVENT:Ea,PARTICIPANT_SENT_POST:Ba,PARTICIPANT_SENT_REEL:Ca,PARTICIPANT_SENT_STORY:Da,PARTICIPANT_SENT_STORY_HIGHLIGHT:Ga,PARTICIPANT_STARTED_GROUP_AUDIO_CALL:Qa,PARTICIPANT_STARTED_GROUP_VIDEO_CALL:Sa,PARTICIPANT_UNSENT_MESSAGE:ka,PARTICIPANT_VIDEO_CALLED:Oa,UNAVAILABLE_SNIPPET:F,UNAVAILABLE_STORY:Gb,UNKNOWN_USER_CREATED_GROUP:e,UNKNOWN_USER_EPHEMERAL_RECORD_SCREEN:na,UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_DAYS:V,UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_HOURS:U,UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_MINUTES:T,UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_SECONDS:S,UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_OFF:fa,UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_DAYS:J,UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_HOURS:I,UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_MINUTES:H,UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS:G,UNKNOWN_USER_EPHEMERAL_TAKE_SCREENSHOT:Z,USER_SEND_ENCRYPTED_MESSAGE_FALLBACK:Za,USER_SEND_UNAVAILABLE_MESSAGE_FALLBACK:Ya,VIEW_ONCE_PHOTO_MESSAGE:Eb,VIEW_ONCE_VIDEO_MESSAGE:Fb,YOU_EPHEMERAL_RECORD_SCREEN:pa,YOU_EPHEMERAL_SETTING_CHANGE_DAYS:aa,YOU_EPHEMERAL_SETTING_CHANGE_HOURS:Y,YOU_EPHEMERAL_SETTING_CHANGE_MINUTES:X,YOU_EPHEMERAL_SETTING_CHANGE_SECONDS:W,YOU_EPHEMERAL_SETTING_TURNED_OFF:ga,YOU_EPHEMERAL_SETTING_TURNED_ON_DAYS:N,YOU_EPHEMERAL_SETTING_TURNED_ON_HOURS:M,YOU_EPHEMERAL_SETTING_TURNED_ON_MINUTES:L,YOU_EPHEMERAL_SETTING_TURNED_ON_SECONDS:K,YOU_EPHEMERAL_TAKE_SCREENSHOT:oa,YOUR_DEVICE_ICDC_ALERT_ADMIN_MESSAGE:ta});g.CURRENT_USER_CREATED_GROUP=b;g.CURRENT_USER_SEND_TEXT=s;g.CURRENT_USER_SEND_IMAGE=t;g.CURRENT_USER_SEND_VIDEO=u;g.CURRENT_USER_SEND_AUDIO=v;g.CURRENT_USER_SEND_GIF=w;g.CURRENT_USER_SEND_STICKER=x;g.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS=G;g.UNKNOWN_USER_EPHEMERAL_TAKE_SCREENSHOT=Z;g.CURRENT_USER_SEND_ATTACHMENT=$;g.LOCALIZATION_TYPE=d}),98);
__d("MAWAdminMsgNormalized",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PHOTO:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNPINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_PROMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SELF_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CLEAR_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_CURRENT_USER_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ALL_MEMBERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_CURRENT_USER_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_OWN_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE:return{contactIds:b,contents:[]};case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_HOTLIKE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_CURRENT_USER_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS:a=b[0];var c=b[1];return{contactIds:[a],contents:[c]};case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_PARTICIPANT_NICKNAME:a=b[0];c=b[1];var e=b[2];return{contactIds:[a,c],contents:[e]};case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_THEME:a=b[0];c=b[1];e=b[2];return{contactIds:[a],contents:[c,e]};case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_HOTLIKE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_OWN_NICKNAME:default:return{contactIds:[],contents:b}}}g.deconstructContactIdsFromAdminContent=a}),98);
__d("MAWDbChatId__UNSAFE_DO_NOT_USE",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return(h||(h=d("I64"))).of_float(a)}function b(a,b){return a+"_"+b}g.convertToChatId64__DEPRECATED=a;g.craftAltIndex__DEPRECATED=b}),98);
__d("MAWHexUtils",["err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.toString(16);return(a.length-1).toString(16)+a}function b(a){for(var b=1;b<a.length;b++){var d=a.substring(0,b),e=a.substring(b);if(e.length-1===parseInt(d,16))return parseInt(e,16)}throw c("err")("Cannot convert the order-preserving-hex back to number")}g.orderPreservingHex=a;g.reverseOrderPreservingHex=b}),98);
__d("WAMsgType",[],(function(a,b,c,d,e,f){"use strict";a="Text";b="Futureproof";c="Ciphertext";d="Unavailable";e="Image";var g="Video",h="Ptt",i="Admin",j="Revoked",k="Gif",l="Sticker",m="DocumentFile",n="ExpiredEphemeral",o="EphemeralSettingAdmin",p="EphemeralSyncResponse",q="DeleteForMe",r="EphemeralSettingChangeFromCurrentDevice",s="AlertICDC",t="GroupInvite",u="NoteReply",v="Reaction",w="SenderKeyDistribution",x="EditAction",y="ReceiverFetch",z="Raven",A="GroupPollCreate",B="GroupPollUpdate",C={ADMIN:i,CIPHERTEXT:c,DELETE_FOR_ME:q,DOCUMENT_FILE:m,EDIT_ACTION:x,EPHEMERAL_SETTING_ADMIN:o,EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:r,EPHEMERAL_SYNC_RESPONSE:p,EXPIRED_EPHEMERAL:n,FUTUREPROOF:b,GIF:k,GROUP_INVITE:t,ICDC_ALERT:s,IMAGE:e,PTT:h,REACTION:v,REVOKED:j,SK_DISTRIBUTION:w,STICKER:l,TEXT:a,UNAVAILABLE:d,VIDEO:g,RECEIVER_FETCH:y,RAVEN:z,GROUP_POLL_CREATE:A,GROUP_POLL_UPDATE:B};f.TEXT=a;f.FUTUREPROOF=b;f.CIPHERTEXT=c;f.UNAVAILABLE=d;f.IMAGE=e;f.VIDEO=g;f.PTT=h;f.ADMIN=i;f.REVOKED=j;f.GIF=k;f.STICKER=l;f.DOCUMENT_FILE=m;f.EXPIRED_EPHEMERAL=n;f.EPHEMERAL_SETTING_ADMIN=o;f.EPHEMERAL_SYNC_RESPONSE=p;f.DELETE_FOR_ME=q;f.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE=r;f.ICDC_ALERT=s;f.GROUP_INVITE=t;f.NOTE_REPLY=u;f.REACTION=v;f.SK_DISTRIBUTION=w;f.EDIT_ACTION=x;f.RECEIVER_FETCH=y;f.RAVEN=z;f.GROUP_POLL_CREATE=A;f.GROUP_POLL_UPDATE=B;f.MSG_TYPE=C}),66);
__d("MAWMsgType",["WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return j.has(a)};b=function(a){return k.has(a)||j.has(a)};c="EphemeralScreenshotAction";e="Raven";f="RavenAction";var h="XMA",i="BumpExistingMessage";d=babelHelpers["extends"]({},d("WAMsgType").MSG_TYPE,{BUMP_EXISTING_MESSAGE:i,EPHEMERAL_SCREENSHOT_ACTION:c,RAVEN:e,RAVEN_ACTION:f,XMA:h});var j=new Set([d.IMAGE,d.VIDEO,d.PTT,d.GIF,d.STICKER,d.XMA,d.RAVEN,d.DOCUMENT_FILE,d.RECEIVER_FETCH]),k=new Set([d.TEXT,d.REVOKED,d.XMA,d.BUMP_EXISTING_MESSAGE]),l=new Set([d.TEXT,d.IMAGE,d.VIDEO,d.PTT,d.GIF,d.STICKER,d.DOCUMENT_FILE,d.UNAVAILABLE,d.EXPIRED_EPHEMERAL,d.REVOKED,d.XMA,d.RAVEN,d.RECEIVER_FETCH]);i=function(a){return l.has(a)};g.isMAWSupportedMediaType=a;g.isEBSupportedMsgType=b;g.EPHEMERAL_SCREENSHOT_ACTION=c;g.MSG_TYPE=d;g.mawSupportedMediaTypes=j;g.isQuotedMsgType=i}),98);
__d("WAMsg",["WAAssertUnreachable","WAJids","WAMsgType","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.author,c=a.chat;a=a.externalId;return c+"_"+a+"_"+b}function h(a){switch(a.type){case d("WAMsgType").MSG_TYPE.TEXT:case d("WAMsgType").MSG_TYPE.IMAGE:case d("WAMsgType").MSG_TYPE.VIDEO:case d("WAMsgType").MSG_TYPE.PTT:case d("WAMsgType").MSG_TYPE.GIF:case d("WAMsgType").MSG_TYPE.STICKER:case d("WAMsgType").MSG_TYPE.RECEIVER_FETCH:return{author:a.id.author,deleteTs:a.deleteTs,ephemeralSetting:a.ephemeralSetting,expirationTs:a.expirationTs,externalId:a.id.externalId,sentTs:a.sentTs,serverTs:a.serverTs,ts:a.ts};case d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("WAMsgType").MSG_TYPE.UNAVAILABLE:return{author:a.id.author,externalId:a.id.externalId,sentTs:a.sentTs,ts:a.ts};default:a.type;return null}}function b(a){var b=h(a);if(b==null)return null;switch(a.type){case d("WAMsgType").MSG_TYPE.TEXT:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.TEXT});case d("WAMsgType").MSG_TYPE.IMAGE:return babelHelpers["extends"]({},b,{mediaId:a.mediaId,type:d("WAMsgType").MSG_TYPE.IMAGE});case d("WAMsgType").MSG_TYPE.VIDEO:return babelHelpers["extends"]({},b,{mediaId:a.mediaId,type:d("WAMsgType").MSG_TYPE.VIDEO});case d("WAMsgType").MSG_TYPE.PTT:return babelHelpers["extends"]({},b,{mediaId:a.mediaId,type:d("WAMsgType").MSG_TYPE.PTT});case d("WAMsgType").MSG_TYPE.STICKER:return babelHelpers["extends"]({},b,{mediaId:a.mediaId,type:d("WAMsgType").MSG_TYPE.STICKER});case d("WAMsgType").MSG_TYPE.RECEIVER_FETCH:return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.RECEIVER_FETCH});case d("WAMsgType").MSG_TYPE.GIF:return babelHelpers["extends"]({},b,{mediaId:a.mediaId,type:d("WAMsgType").MSG_TYPE.PTT});case d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL});case d("WAMsgType").MSG_TYPE.UNAVAILABLE:return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.UNAVAILABLE});case d("WAMsgType").MSG_TYPE.REVOKED:case d("WAMsgType").MSG_TYPE.REACTION:case d("WAMsgType").MSG_TYPE.ICDC_ALERT:case d("WAMsgType").MSG_TYPE.ADMIN:case d("WAMsgType").MSG_TYPE.FUTUREPROOF:case d("WAMsgType").MSG_TYPE.CIPHERTEXT:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case d("WAMsgType").MSG_TYPE.GROUP_INVITE:case d("WAMsgType").MSG_TYPE.DELETE_FOR_ME:case d("WAMsgType").MSG_TYPE.DOCUMENT_FILE:case d("WAMsgType").MSG_TYPE.EDIT_ACTION:return null;default:return c("WAAssertUnreachable")(a.type)}}function e(a){if(d("WAJids").isAuthorSystem(a.author))throw c("err")("Cannot send @system messages");else return{author:a.author,chat:a.chat,externalId:a.externalId}}g.craftWAMsgIdString=a;g.asQuotedMsg=b;g.asProtocolMsgId=e}),98);
__d("MAWDbMsg",["FBLogger","I64","MAWDbChatId__UNSAFE_DO_NOT_USE","MAWHexUtils","MAWMsgType","WAMsg","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;i=[(i=d("MAWMsgType")).MSG_TYPE.REVOKED,i.MSG_TYPE.EPHEMERAL_SYNC_RESPONSE,i.MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE,i.MSG_TYPE.GROUP_INVITE,i.MSG_TYPE.SK_DISTRIBUTION,i.MSG_TYPE.RAVEN_ACTION];var j=0,k=Number.MAX_SAFE_INTEGER;function a(a){return v(a)?a:null}function b(a){return a}function e(a){return a}var l="futureproof",m="futureproof_spam",n="spam",o="toBeRead",p="e2ee_admin_msg",q="cutover_admin_msg";function r(a,b){return d("MAWHexUtils").orderPreservingHex(a)+"_"+d("MAWHexUtils").orderPreservingHex(b)+"_m"}function f(a,b,e){a=d("MAWHexUtils").orderPreservingHex(a)+"_"+d("MAWHexUtils").orderPreservingHex(b)+"_m";return!c("justknobx")._("621")?a:a+"_"+e.externalId}function s(a,b){return!c("justknobx")._("1903")?r(a,b):d("MAWHexUtils").orderPreservingHex(a)+"_"+d("MAWHexUtils").orderPreservingHex(b)+"_um"}function t(a,b){return!c("justknobx")._("1903")?r(a,b):d("MAWHexUtils").orderPreservingHex(a)+"_"+d("MAWHexUtils").orderPreservingHex(b)+"_r"}function u(a,b){return d("MAWHexUtils").orderPreservingHex(a)+"_"+d("MAWHexUtils").orderPreservingHex(b)+"_DEBUG_"+d("MAWHexUtils").orderPreservingHex(Math.floor(Math.random()*1e4))}function v(a){a=a.split("_");return a.length>=3&&a[0]!==""&&a[1]!==""&&a[2]==="m"}function w(a){return d("MAWDbChatId__UNSAFE_DO_NOT_USE").craftAltIndex__DEPRECATED(a,o)}function x(a){return d("MAWDbChatId__UNSAFE_DO_NOT_USE").craftAltIndex__DEPRECATED(a,p)}function y(a){return d("MAWDbChatId__UNSAFE_DO_NOT_USE").craftAltIndex__DEPRECATED(a,q)}function z(a){a=a.split("_");a[0];a=a[1];return d("MAWHexUtils").reverseOrderPreservingHex(a)}function A(a){return d("MAWHexUtils").orderPreservingHex(a)+"_"}function B(a){return d("MAWHexUtils").orderPreservingHex(a)+"_z"}function C(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.XMA:return!0;case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return!1}throw c("FBLogger")("maw_db").mustfixThrow('Invalid msg type for isXMAMsg check: "%s"',a.type)}function D(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.RAVEN:return!0;case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return!1}throw c("FBLogger")("maw_db").mustfixThrow('Invalid msg type for isMediaMsg check: "%s"',a.type)}function E(a){return a.type===d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH}function F(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:return!0;case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return!1;default:c("FBLogger")("maw_db").mustfix('Invalid msg type for isPhotoOrVideoMediaMsg check: "%s"',a.type);return!1}}function G(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return!0;case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return!1;default:c("FBLogger")("maw_db").mustfix('Invalid msg type for isDocumentFileMediaMsg check: "%s"',a.type);return!1}}function H(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return!0;case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:case d("MAWMsgType").MSG_TYPE.RAVEN_ACTION:case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:return!1}throw c("FBLogger")("maw_db").mustfixThrow('Invalid msg type for isContentMsg check: "%s"',a.type)}function I(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return!0;case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:case d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:return!1}throw c("FBLogger")("maw_db").mustfixThrow('Invalid msg type for isMsgEligibleForTriggeringEphemeralSyncResponse check: "%s"',a.type)}function J(a){return L(a.type)}function K(a){return a.type===d("MAWMsgType").MSG_TYPE.ADMIN}function L(a){return a==="EphemeralSyncResponse"||a==="EphemeralSettingChangeFromCurrentDevice"||a==="GroupInvite"||a==="SenderKeyDistribution"||a==="RavenAction"||a==="EditAction"}function M(a){return a==="RavenAction"}function N(a){return a.originalTs!=null?a.originalTs:O(a)}function O(a){return a.serverTs!=null?a.serverTs:a.ts}function P(a){if(a.sortOrderMs!=null)return a.sortOrderMs;else return O(a)*1e3}function Q(a,b){if(a.serverTs!=null)return Math.max(b+1,a.serverTs*1e3);else return b+1}function R(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.TEXT:return a.msgContent;case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:return a.editMsgContent;case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return}throw c("FBLogger")("maw_db").mustfixThrow('Invalid msg type for getMsgContent check: "%s"',a.type)}function S(a){return d("WAMsg").craftWAMsgIdString({author:a.author,chat:a.threadJid,externalId:a.externalId})}function T(a){return(h||(h=d("I64"))).to_float(a)}g.NO_CONTENT_MESSAGE_TYPES_ALLOWLIST=i;g.MIN_MSG_SORT_ORDER=j;g.MAX_MSG_SORT_ORDER=k;g.toMsgId=a;g.stanzaIdToMsgId=b;g.instamadilloMsgIdToMsgId=e;g.FUTUREPROOF_ALT_INDEX=l;g.FUTUREPROOF_SPAM_ALT_INDEX=m;g.SPAM_ALT_INDEX=n;g.craftMsgId__DEPRECATED=r;g.craftMsgIdV2=f;g.craftUnrenderedMsgId=s;g.craftReactionId=t;g.craftDebugMsgId=u;g.isValidMsgId=v;g.craftToBeReadAltIndex=w;g.craftE2eeAdminMsgAltIndex=x;g.craftCutoverAdminMsgAltIndex=y;g.getInChatMsgIdFromMsgId=z;g.msgIdsInChatLowerBound=A;g.msgIdsInChatUpperBound=B;g.isXMAMsg=C;g.isMediaMsg=D;g.isReceiverFetchStickerMsg=E;g.isPhotoOrVideoMediaMsg=F;g.isDocumentFileMediaMsg=G;g.isContentMsg=H;g.isMsgEligibleForTriggeringEphemeralSyncResponse=I;g.isUnrenderedMsg=J;g.isAdminMsg=K;g.isUnrenderedMsgType=L;g.isRavenActionMsgType=M;g.getOriginalTsFromMsg=N;g.getCanonicalTsFromMsg=O;g.getSortOrderWithFallback=P;g.getSortOrderFromPrevious=Q;g.getMsgContent=R;g.getWAMsgId=S;g.convertMsgRowId64=T}),98);
__d("WABlobToArrayBuffer",["Promise","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return"arrayBuffer"in a&&typeof a.arrayBuffer==="function"?a.arrayBuffer():new(h||(h=b("Promise")))(function(b,d){var e=new FileReader();e.onload=function(){var a=e.result;a instanceof ArrayBuffer?b(a):d(c("err")("blobToArrayBuffer got error because result is not ArrayBuffer: "+typeof a))};e.onerror=function(){var a;d((a=e.error)!=null?a:c("err")("blobToArrayBuffer got unknown error"))};e.readAsArrayBuffer(a)})}g.blobToArrayBuffer=a}),98);
__d("WACalculateBoundOutputSize",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return b!=null?g(a.width,a.height,b.width,b.height):{outputWidth:a.width,outputHeight:a.height}}function g(a,b,c,d){var e=a,f=b;a>b?a>c&&(f*=c/e,e=c):f>d&&(e*=d/f,f=d);return{outputWidth:Math.round(Math.max(e,1)),outputHeight:Math.round(Math.max(f,1))}}f.calculateBoundOutputSize=a}),66);
__d("MAWImageUtils",["Promise","WABlobToArrayBuffer","WACalculateBoundOutputSize","cr:8676","err","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i="image/jpeg",j=100,k=c("justknobx")._("2338")*1024,l=c("justknobx")._("2340"),m=c("justknobx")._("2545");function n(a,d){d===void 0&&(d=!0);var e;return new(h||(h=b("Promise")))(function(b,f){e=new Image();var g=/^(?:data|blob):/.test(a);d&&!g&&e.setAttribute("crossOrigin","anonymous");e.onload=b;e.onabort=function(){f(function(){throw c("err")("Error loading image from provided URL")})};e.onerror=function(){f(function(){throw c("err")("Wrong blob type")})};e.src=a}).then(function(){return e})}function o(a,c,d,e){d===void 0&&(d=!1);if(a.toBlob)return new(h||(h=b("Promise")))(function(b){var d=e==null?void 0:e/100;a.toBlob(b,c,d)}).then(function(e){var f=k,g=l/100;return d&&e.size>=f?new(h||(h=b("Promise")))(function(b){a.toBlob(b,c,g)}):e});else{var f,g=(f=b("cr:8676")==null?void 0:b("cr:8676").dataURLtoBlob)!=null?f:window.dataURLtoBlob;return(h||(h=b("Promise"))).resolve(g(a.toDataURL(c))).then(function(e){var f=k,i=l/100;return d&&e.size>=f?(h||(h=b("Promise"))).resolve(g(a.toDataURL(c,i))):e})}}function a(a,e,f,g,i){return n(a).then(function(a){var b=a.naturalWidth,c=a.naturalHeight,h=d("WACalculateBoundOutputSize").calculateBoundOutputSize({height:c,width:b},i),j=h.outputHeight,k=h.outputWidth;h=document.createElement("canvas");h.width=k;h.height=j;var l=h.getContext("2d");g!==!0&&q(h);l.drawImage(a,0,0,b,c,0,0,k,j);return o(h,e,!1,f).then(function(a){return{blob:a,height:j,width:k}})})["catch"](function(a){return(h||(h=b("Promise"))).reject((a=a)!=null?a:c("err")("Error loading image from URL"))})}function e(a,b){return n(a).then(function(a){var c=document.createElement("canvas"),e=a.naturalWidth,f=a.naturalHeight,g=c.getContext("2d");f=r(f,e,b);c.width=f.width;c.height=f.height;var h=c.width,j=c.height;p(c);g.drawImage(a,0,0,h,j);return o(c,i,!0).then(function(a){return d("WABlobToArrayBuffer").blobToArrayBuffer(a).then(function(a){return{height:j,jpegThumbnail:a,width:h}})})})}function f(a,b){return n(a).then(function(a){a=r(a.naturalHeight,a.naturalWidth,b);return{height:a.height,width:a.width}})}function p(a){var b=a.getContext("2d");b.fillStyle="rgb(247,247,247)";b.fillRect(0,0,a.width,a.height)}function q(a){var b=a.getContext("2d");b.fillStyle="rgb(255,255,255)";b.fillRect(0,0,a.width,a.height)}function r(a,b,c){b=b!=null?b:c;a=a!=null?a:c;b>a?b>c&&(a*=c/b,b=c):a>c&&(b*=c/a,a=c);return{height:Math.round(Math.max(a,1)),width:Math.round(Math.max(b,1))}}function s(a){return n(a).then(function(a){return{height:a.naturalHeight,width:a.naturalWidth}})}g.TYPE_JPEG=i;g.IMG_THUMB_MAX_EDGE=j;g.STICKER_THUMBNAIL_MAX_SIZE=m;g.canvasToBlob=o;g.urlToFile=a;g.urlToThumbnail=e;g.urlToThumbnailSpec=f;g.boundHeightWidth=r;g.urlToImageSpec=s}),98);
__d("MAWMediaGalleryM2Utils",["gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){return c("gkx")("4219")}function a(){return c("justknobx")._("3060")&&h()}function b(){return c("gkx")("4219")}g.isMediaGalleryM2Enabled=h;g.shouldSkipSyncToLSDB=a;g.isFilesEBRestoreEnabled=b}),98);
__d("WAArrayBufferUtils",["Promise","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=new ArrayBuffer(a.length);b=new Uint8Array(b);var c,d;for(c=0,d=a.length;c<d;c++)b[c]=a.charCodeAt(c);return b.buffer}function d(a,c){c===void 0&&(c=5e5);return new(h||(h=b("Promise")))(function(b,d){var e=a.length,f=new ArrayBuffer(e),g=new Uint8Array(f),h=0;setTimeout(i,0);function i(){var d=Math.min(h+c,e);while(h<d)g[h]=a.charCodeAt(h),h++;if(h===e){b(f);return}setTimeout(i,16)}})}function e(a){return String.fromCharCode.apply(null,new Uint8Array(a))}var i=8388607;function f(a,b){a=new Uint8Array(a);if(b>i)throw c("err")("Divisor is too big");var d=0;for(var e=0;e<a.length;++e)d=((d<<8)+a[e])%b;return d}function j(a){a=a.map(function(a){return new Uint8Array(a)});var b=a.reduce(function(a,b){return a+b.byteLength},0),c=new Uint8Array(b);a.reduce(function(a,b){c.set(b,a);return a+b.byteLength},0);return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}function k(a,b){a=new Uint8Array(a);b=new Uint8Array(b);return l(a,b)}function l(a,b){if(a.byteLength!==b.byteLength)return!1;for(var c=0;c!==a.byteLength;c++)if(a[c]!==b[c])return!1;return!0}g.stringToArrayBuffer=a;g.largeStringToArrayBuffer=d;g.arrayBufferToString=e;g.arrayBufferMod=f;g.concatBuffers=j;g.arrayBuffersEqualUNSAFE=k;g.uint8ArraysEqualUNSAFE=l}),98);
__d("MAWVaultMaterials",["FBLogger","WAArrayBufferUtils","randomInt","tweetnacl"],(function(a,b,c,d,e,f,g){"use strict";var h=null,i=null,j=null;function k(a){i=a}function l(){return h}function m(a){h=a}function a(){h=null,i=null}function n(){return p()!=null&&l()!=null}function b(){return j}function o(){var a=1e9,b=9999999999;return c("randomInt")(a,b)+"##"+c("randomInt")(a,b)}function p(){return i}function q(){if(!n())throw c("FBLogger")("maw_ear").mustfixThrow("Vault materials are null");return{encryptionKey:h,prefixAndSuffix:i}}function e(a,b){var d=n();c("FBLogger")("maw_ear").debug("Setting vault materials -- vaultMaterials=%s, previouslySetup=%s",Boolean(a).toString(),d);if(!d){s((d=a)!=null?d:r());j=(d=b)!=null?d:a!=null?"existing":"newly-generated"}return q()}function r(){return{encryptionKey:d("tweetnacl").randomBytes(32).buffer,prefixAndSuffix:o()}}function s(a){var b=a.encryptionKey;a=a.prefixAndSuffix;if(b==null||a==null)throw c("FBLogger")("maw_ear").mustfixThrow("Cannot set null values for encryption key and prefix");m(b);k(a)}function f(){return t(q())}function t(a){var b=a.encryptionKey;a=a.prefixAndSuffix;if(a!=null&&b!=null){b=d("WAArrayBufferUtils").arrayBufferToString(b);return JSON.stringify({encryptionKey:b,prefixAndSuffix:a})}else return""}function u(a){if(a==="")return null;else{a=JSON.parse(a);if(a.encryptionKey==null||a.prefixAndSuffix==null)throw c("FBLogger")("maw_ear").mustfixThrow("Vault materials were not in correct format");var b=d("WAArrayBufferUtils").stringToArrayBuffer(a.encryptionKey);a=a.prefixAndSuffix;return{encryptionKey:b,prefixAndSuffix:a}}}g.TEST_ONLY_clearVaultMaterials=a;g.hasVaultBeenSetup=n;g.getVaultMaterialsSource=b;g.getVaultPrefixAndSuffix=p;g.getVaultMaterials=q;g.initializeVaultMaterials=e;g.generateNewVaultMaterials=r;g.materialsToString=f;g.fromMaterialsToString=t;g.fromStringToMaterials=u}),98);
__d("MAWVaultMaterialsStorageStatus",[],(function(a,b,c,d,e,f){"use strict";var g=!1;function a(){return g}function b(){g=!0}f.isCurrentContextHoldingLock=a;f.setIsCurrentContextHoldingLock=b}),66);
__d("MAWVault",["ExecutionEnvironment","FBLogger","MAWKeychainCrypto","MAWKeychainNaClCrypto","MAWVaultMaterials","MAWVaultMaterialsStorageStatus","gkx","hasMultipleTabs","promiseDone","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Map(),j=new Map();function k(a){return new RegExp("^[0-9]{10}##[0-9]{10}.*[0-9]{10}##[0-9]{10}$").test(a)}var l=c("gkx")("23909");function m(a){if(!l)return!1;var b=d("MAWVaultMaterials").getVaultPrefixAndSuffix();b=b==null?!1:new RegExp(b+".*"+b).test(a);return b}function n(a,b){b===void 0&&(b=!1);if(!l)return a;if(m(a)){var e=d("MAWVaultMaterials").getVaultMaterials(),f=e.encryptionKey;e=e.prefixAndSuffix;if(e==null)throw c("FBLogger")("maw_ear").mustfixThrow("Vault prefix and suffix should not be null when unvaulting");var g=new RegExp(e+"(.*)"+e);g=a.match(g);if(g==null||g.length!=2)throw c("FBLogger")("maw_ear").mustfixThrow("Could not retrieve inner value to unvault");if(f==null)throw c("FBLogger")("maw_ear").mustfixThrow("Vault encryption key was null before unvault");g=g[1];e=""+e+g+e;var i=p(f,g);return a.replace(e,function(){return i})}if(k(a))if(b)throw c("FBLogger")("maw_ear").mustfixThrow("Encountered vaulted value with incorrect key.");else c("promiseDone")(d("hasMultipleTabs").hasMultipleTabs().then(function(a){c("FBLogger")("maw_ear").mustfix("Encountered vaulted value with incorrect key. Vault material source: %s, environment: %s, hasMultipleTabs: %s, isSharedWorker: %s, isCurrentContextHoldingLock: %s",d("MAWVaultMaterials").getVaultMaterialsSource(),(h||(h=c("ExecutionEnvironment"))).isInMainThread?"main":"worker",a==null?"unknown_multi_tab":a?"multi_tab":"single_tab",d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()?"shared_worker":"dedicated_worker",d("MAWVaultMaterialsStorageStatus").isCurrentContextHoldingLock()?"holding_lock":"not_holding_lock")}));return a}function a(a){if(a==="")return a;if(!l)return a;if(!d("MAWVaultMaterials").hasVaultBeenSetup()){c("FBLogger")("maw_ear").mustfix("Attempted to vault value while materials were not setup");return a}if(m(a)){c("FBLogger")("maw_ear").warn("Attempted to vault value that's already been vaulted");return a}k(a)&&c("FBLogger")("maw_ear").mustfix("Attempted to vault value that's already been vaulted with a different key");var b=d("MAWVaultMaterials").getVaultMaterials(),e=b.encryptionKey;b=b.prefixAndSuffix;if(b==null||e==null)throw c("FBLogger")("maw_ear").mustfixThrow("Cannot vault before vault materials are set");e=o(e,a);return""+b+e+b}function b(a){if(!l)return a;if(!m(a))throw c("FBLogger")("maw_ear").mustfixThrow("Value should be vaulted");return n(a)}function o(a,b){var c=i==null?void 0:i.get(b);if(c!=null)return c;c=new TextEncoder().encode(b).buffer;a=d("MAWKeychainNaClCrypto").encryptTweetNaCl(a,new Uint8Array(c));i==null?void 0:i.set(b,a);j==null?void 0:j.set(a,b);return a}function p(a,b){var c=j==null?void 0:j.get(b);if(c!=null)return c;c=new TextDecoder().decode(d("MAWKeychainNaClCrypto").decryptTweetNaCl(a,b,void 0,d("MAWKeychainCrypto").ADDITIONAL_DATA.byteLength));i==null?void 0:i.set(c,b);j==null?void 0:j.set(b,c);return c}g.isVaulted=m;g.unvault=n;g.vault=a;g.unvaultOrThrow=b}),98);
__d("WAProtoConst",[],(function(a,b,c,d,e,f){"use strict";a={REPEATED:1<<6,PACKED:1<<7,REQUIRED:1<<8};b=31;c={INT32:1,INT64:2,UINT32:3,UINT64:4,SINT32:5,SINT64:6,BOOL:7,ENUM:8,FIXED64:9,SFIXED64:10,DOUBLE:11,STRING:12,BYTES:13,MESSAGE:14,FIXED32:15,SFIXED32:16,FLOAT:17,MAP:18};d={VARINT:0,BIT64:1,BINARY:2,BIT32:5};e={ONEOF:"__oneofs__",RESERVED:"__reserved__",RESERVED_TAGS:"tags",RESERVED_FIELDS:"fields"};f.FLAGS=a;f.TYPE_MASK=b;f.TYPES=c;f.ENC=d;f.KEYS=e}),66);
__d("WACommon.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={EVERYONE:1,SILENT:2,AI:3,AI_IMAGINE:4};b={PLACEHOLDER:0,NO_PLACEHOLDER:1,IGNORE:2};c={};e={};f={};var h={};c.internalSpec={remoteJid:[1,(d=d("WAProtoConst")).TYPES.STRING],fromMe:[2,d.TYPES.BOOL],id:[3,d.TYPES.STRING],participant:[4,d.TYPES.STRING]};e.internalSpec={commandType:[1,d.TYPES.ENUM,a],offset:[2,d.TYPES.UINT32],length:[3,d.TYPES.UINT32],validationToken:[4,d.TYPES.STRING]};f.internalSpec={text:[1,d.TYPES.STRING],mentionedJid:[2,d.FLAGS.REPEATED|d.TYPES.STRING],commands:[3,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e]};h.internalSpec={payload:[1,d.TYPES.BYTES],version:[2,d.TYPES.INT32]};g.COMMAND_COMMAND_TYPE=a;g.FUTURE_PROOF_BEHAVIOR=b;g.MessageKeySpec=c;g.CommandSpec=e;g.MessageTextSpec=f;g.SubProtocolSpec=h}),98);
__d("WAArmadilloXMA.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={INFO:0,EYE_OFF:1,NEWS_OFF:2,WARNING:3,PRIVATE:4,NONE:5,MEDIA_LABEL:6,POST_COVER:7,POST_LABEL:8,WARNING_SCREENS:9};b={OPEN_NATIVE:11};c={SINGLE:0,HSCROLL:1,PORTRAIT:3,STANDARD_DXMA:12,LIST_DXMA:15,GRID:16};e={UNSUPPORTED:-1,IG_STORY_PHOTO_MENTION:4,IG_SINGLE_IMAGE_POST_SHARE:9,IG_MULTIPOST_SHARE:10,IG_SINGLE_VIDEO_POST_SHARE:11,IG_STORY_PHOTO_SHARE:12,IG_STORY_VIDEO_SHARE:13,IG_CLIPS_SHARE:14,IG_IGTV_SHARE:15,IG_SHOP_SHARE:16,IG_PROFILE_SHARE:19,IG_STORY_PHOTO_HIGHLIGHT_SHARE:20,IG_STORY_VIDEO_HIGHLIGHT_SHARE:21,IG_STORY_REPLY:22,IG_STORY_REACTION:23,IG_STORY_VIDEO_MENTION:24,IG_STORY_HIGHLIGHT_REPLY:25,IG_STORY_HIGHLIGHT_REACTION:26,IG_EXTERNAL_LINK:27,IG_RECEIVER_FETCH:28,FB_FEED_SHARE:1e3,FB_STORY_REPLY:1001,FB_STORY_SHARE:1002,FB_STORY_MENTION:1003,FB_FEED_VIDEO_SHARE:1004,FB_GAMING_CUSTOM_UPDATE:1005,FB_PRODUCER_STORY_REPLY:1006,FB_EVENT:1007,FB_FEED_POST_PRIVATE_REPLY:1008,FB_SHORT:1009,FB_COMMENT_MENTION_SHARE:1010,FB_POST_MENTION:1011,MSG_EXTERNAL_LINK_SHARE:2e3,MSG_P2P_PAYMENT:2001,MSG_LOCATION_SHARING:2002,MSG_LOCATION_SHARING_V2:2003,MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY:2004,MSG_HIGHLIGHTS_TAB_LOCAL_EVENT_REPLY:2005,MSG_RECEIVER_FETCH:2006,MSG_IG_MEDIA_SHARE:2007,MSG_GEN_AI_SEARCH_PLUGIN_RESPONSE:2008,MSG_REELS_LIST:2009,MSG_CONTACT:2010,MSG_THREADS_POST_SHARE:2011,MSG_FILE:2012,MSG_AVATAR_DETAILS:2013,MSG_AI_CONTACT:2014,MSG_MEMORIES_SHARE:2015,MSG_SHARED_ALBUM_REPLY:2016,MSG_SHARED_ALBUM:2017,MSG_OCCAMADILLO_XMA:2018,MSG_GEN_AI_SUBSCRIPTION:2021,MSG_GEN_AI_REMINDER:2022,MSG_GEN_AI_MEMU_ONBOARDING_RESPONSE:2023,MSG_NOTE_REPLY:2024,MSG_NOTE_MENTION:2025,RTC_AUDIO_CALL:3e3,RTC_VIDEO_CALL:3001,RTC_MISSED_AUDIO_CALL:3002,RTC_MISSED_VIDEO_CALL:3003,RTC_GROUP_AUDIO_CALL:3004,RTC_GROUP_VIDEO_CALL:3005,RTC_MISSED_GROUP_AUDIO_CALL:3006,RTC_MISSED_GROUP_VIDEO_CALL:3007,RTC_ONGOING_AUDIO_CALL:3008,RTC_ONGOING_VIDEO_CALL:3009,MSG_RECEIVER_FETCH_FALLBACK:3025,DATACLASS_SENDER_COPY:4e3};f={};var i={};f.internalSpec={associatedMessage:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,(d=d("WACommon.pb")).SubProtocolSpec],targetType:[2,h.TYPES.ENUM,e],targetUsername:[3,h.TYPES.STRING],targetId:[4,h.TYPES.STRING],targetExpiringAtSec:[5,h.TYPES.INT64],xmaLayoutType:[6,h.TYPES.ENUM,c],ctas:[7,h.FLAGS.REPEATED|h.TYPES.MESSAGE,i],previews:[8,h.FLAGS.REPEATED|h.TYPES.MESSAGE,d.SubProtocolSpec],titleText:[9,h.TYPES.STRING],subtitleText:[10,h.TYPES.STRING],maxTitleNumOfLines:[11,h.TYPES.UINT32],maxSubtitleNumOfLines:[12,h.TYPES.UINT32],favicon:[13,h.TYPES.MESSAGE,d.SubProtocolSpec],headerImage:[14,h.TYPES.MESSAGE,d.SubProtocolSpec],headerTitle:[15,h.TYPES.STRING],overlayIconGlyph:[16,h.TYPES.ENUM,a],overlayTitle:[17,h.TYPES.STRING],overlayDescription:[18,h.TYPES.STRING],sentWithMessageId:[19,h.TYPES.STRING],messageText:[20,h.TYPES.STRING],headerSubtitle:[21,h.TYPES.STRING],xmaDataclass:[22,h.TYPES.STRING],contentRef:[23,h.TYPES.STRING],mentionedJid:[24,h.FLAGS.REPEATED|h.TYPES.STRING],commands:[25,h.FLAGS.REPEATED|h.TYPES.MESSAGE,d.CommandSpec]};i.internalSpec={buttonType:[1,h.TYPES.ENUM,b],title:[2,h.TYPES.STRING],actionUrl:[3,h.TYPES.STRING],nativeUrl:[4,h.TYPES.STRING],ctaType:[5,h.TYPES.STRING],actionContentBlob:[6,h.TYPES.STRING]};g.EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH=a;g.EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE=b;g.EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE=c;g.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE=e;g.ExtendedContentMessageSpec=f;g.ExtendedContentMessage$CTASpec=i}),98);
__d("WAHashUtils",["WABase64"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("WABase64").encodeB64UrlSafe(a,b)}function b(a,b){return d("WABase64").encodeB64UrlSafe(a,b)}function c(a){return a}function e(a){return a}function f(a){return""+a.slice(0,3)}g.toPlaintextHash=a;g.toCiphertextHash=b;g.stringToPlaintextHash=c;g.toHashedPlaintextHash=e;g.sanitisePlaintextHash=f}),98);
__d("getReplyContentForNoteReply",["WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=a.author,e=a.msgId;c=d("WAJids").authorToUserId(c,b);b=(b=a.quote)==null?void 0:(b=b.content.msgContent)==null?void 0:b.content;a=(a=a.quote)==null?void 0:a.content.expirationTs;return{isNoteReply:!0,replyMediaExpirationTimestampMs:a!=null?a*1e3:void 0,replyMessageText:b,replySourceId:e,replyToUserId:c}}g["default"]=a}),98);
__d("MAWBridgeMsg",["LSHotEmojiSize","LSIntEnum","MAWDbMsg","MAWImageUtils","MAWMediaGalleryM2Utils","MAWMsgType","MAWUserJidWrapper","MAWVault","MAWXMAUtils","MWPBumpEntityKey","WAAssertUnreachable","WAHashUtils","WAJids","WALogger","WAMsgType","getReplyContentForNoteReply","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MAWBridgeMsg] Missing content for external link share XMA message"]);i=function(){return a};return a}function j(a,b,e){var f,g;f=((f=a.quote)==null?void 0:f.content.type)===d("WAMsgType").NOTE_REPLY;if(f)return c("getReplyContentForNoteReply")(a,e);f=(f=a.quote)==null?void 0:f.content;if(d("MAWXMAUtils").isXMAStoryShare(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryReaction(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryMention(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryHighlightShare(a.xmaMessageType)||d("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(a.xmaMessageType)||d("MAWXMAUtils").isFBXMAPostMention(a.xmaMessageType)){var h=a.author,i=a.mediaId,j=a.msgId,k=d("WAJids").authorToUserId(h,e);if(d("MAWXMAUtils").isXMAStoryMention(a.xmaMessageType)||d("MAWXMAUtils").isFBXMAPostMention(a.xmaMessageType)){var l=a.threadJid,m;l!=null&&(m=d("WAJids").interpretAsUserJid(l));m!=null&&(k=d("WAJids").userIdFromJid(m))}i!=null&&a.plaintextHash==null&&d("MWPBumpEntityKey").bumpEntityKeyWithAppId("maw.reply_attachment_media_missing_plaintext_hash","bridge_msg_get_reply_content");return{isFBPostMention:d("MAWXMAUtils").isFBXMAPostMention(a.xmaMessageType),isFBStoryMention:d("MAWXMAUtils").isFBXMAStoryMention(a.xmaMessageType),isIGStoryMention:d("MAWXMAUtils").isIGXMAStoryMention(a.xmaMessageType),isIGXMAStoryShare:d("MAWXMAUtils").isIGXMAStoryShare(a.xmaMessageType),isMsgHighlightsTabFriendUpdatesReply:d("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(a.xmaMessageType),isStoryHighlightShare:d("MAWXMAUtils").isXMAStoryHighlightShare(a.xmaMessageType),isStoryReaction:d("MAWXMAUtils").isXMAStoryReaction(a.xmaMessageType),isStoryReply:d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType),replyMediaExpirationTimestampMs:f==null?void 0:f.expirationTs,replyMediaId:i,replyMediaUrlMimeType:i!=null?"image/jpeg":void 0,replyPlaintextHash:(l=a.plaintextHash)!=null?l:void 0,replySenderIsMe:h===d("WAJids").AUTHOR_ME||k===e,replySourceId:j,replySourceTimestampMs:a.sortOrderMs,replyStatusType:i!=null?"Image":void 0,replyToUserId:k,storyShareAuthor:b==null?void 0:b.storyShareAuthor}}l=(f==null?void 0:f.type)===d("MAWMsgType").MSG_TYPE.XMA&&c("gkx")("458");if(f==null||(f==null?void 0:f.msgId)==null&&(f==null?void 0:f.sourceId)==null&&!l)return;h=f||{};j=h.author;i=h.mediaId;k=h.msgId;var n=h.plaintextHash,o=h.sourceId,p=h.specialTextSize,q=h.ts,r=h.type;h=h.xmaMessageType;q=q!=null?q*1e3:void 0;g=f.type===d("MAWMsgType").MSG_TYPE.TEXT||d("MAWXMAUtils").isXMAExternalLinkShare(h)?(g=f.msgContent)==null?void 0:g.content:void 0;var s=d("WAJids").authorToUserId(j,e),t=f.type===d("MAWMsgType").MSG_TYPE.TEXT?f.msgContent.mentionedJids:void 0;j=j===d("WAJids").AUTHOR_ME||s===e;e=b||{};b=e.replyMediaId;var u=e.replyMediaPreviewHeight,v=e.replyMediaPreviewWidth,w=e.replyMediaUrlFallback,x=e.replyMediaUrlMimeType,y=e.replyPlaintextHash;e=e.replyXMAId;if(d("MAWXMAUtils").isXMAStoryReply(h)){return{isStoryProducerReply:d("MAWXMAUtils").isXMAStoryProducerReply(h),isStoryReaction:d("MAWXMAUtils").isXMAStoryReaction(h),isStoryReply:!0,replyMediaExpirationTimestampMs:f==null?void 0:f.expirationTs,replyMediaId:i,replyMediaUrlMimeType:i!=null?"image/jpeg":void 0,replyPlaintextHash:(f=y!=null?d("WAHashUtils").stringToPlaintextHash(y):n)!=null?f:void 0,replySenderIsMe:j,replySourceId:o,replySourceTimestampMs:q,replyStatusType:i!=null?"Image":void 0,replyToUserId:s}}n=d("MAWImageUtils").boundHeightWidth(u,v,96*.8);f=n.height;o=n.width;return{isIGXMAPostShare:d("MAWXMAUtils").isIGXMAPostShare(h),isIGXMAStoryShare:d("MAWXMAUtils").isIGXMAStoryShare(h),isStoryReply:!1,replyMediaId:b,replyMediaPreviewHeight:r===d("MAWMsgType").MSG_TYPE.STICKER?f:u,replyMediaPreviewWidth:r===d("MAWMsgType").MSG_TYPE.STICKER?o:v,replyMediaUrlFallback:w,replyMediaUrlMimeType:x,replyMentionedJids:t,replyMessageText:g,replyPlaintextHash:y!=null?d("WAHashUtils").stringToPlaintextHash(y):void 0,replySenderIsMe:j,replySourceId:l&&k==null?a.msgId:k,replySourceTimestampMs:q,replyStatusType:p===1||p===2||p===3?d("MAWMsgType").MSG_TYPE.STICKER:r,replyToUserId:s,replyXMAId:e}}function a(a){a=a.specialTextSize;switch(a){case 1:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").SMALL);case 2:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").MEDIUM);case 3:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").LARGE);default:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").NONE)}}function b(a,b,e,f,g){var h,k,l=d("WAJids").extractUserId(d("MAWUserJidWrapper").getMyUserJid());h=((h=a.isForwarded)!=null?h:!1)&&a.type!==d("MAWMsgType").MSG_TYPE.STICKER;k=(k=a.forwardingScore)!=null?k:0;var m=d("MAWDbMsg").getCanonicalTsFromMsg(a),n=j(a,e,l),o=d("MAWXMAUtils").isXMAStoryShare(a.xmaMessageType),p=d("MAWXMAUtils").isXMAStoryReaction(a.xmaMessageType),q=d("MAWXMAUtils").isXMAExternalLinkShare(a.xmaMessageType),r=d("MAWXMAUtils").isIGXMAStoryMention(a.xmaMessageType),s=d("MAWXMAUtils").isFBXMAStoryMention(a.xmaMessageType),t=d("MAWXMAUtils").isXMAStoryHighlightShare(a.xmaMessageType),u=d("MAWXMAUtils").isXMAPostPrivateReply(a.xmaMessageType),v=d("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(a.xmaMessageType),w=d("MAWDbMsg").getSortOrderWithFallback(a),x=a.externalId;f=c("justknobx")._("3424")&&d("MAWMediaGalleryM2Utils").isMediaGalleryM2Enabled()&&a.source==="media_restore"?"EncryptedBackupsMedia":f;var y=void 0;if(!c("justknobx")._("2996"))y=(e==null?void 0:e.replyPlaintextHash)!=null?d("WAHashUtils").stringToPlaintextHash(e==null?void 0:e.replyPlaintextHash):void 0;else{y=(e==null?void 0:e.replyPlaintextHash)!=null?d("WAHashUtils").stringToPlaintextHash(e==null?void 0:e.replyPlaintextHash):(e=n==null?void 0:n.replyPlaintextHash)!=null?e:void 0}switch(a.type){case d("MAWMsgType").MSG_TYPE.TEXT:e=d("MAWVault").isVaulted(a.msgContent.content)?a.msgContent.content:d("MAWVault").vault(a.msgContent.content);return babelHelpers["extends"]({},n,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,chatJid:a.threadJid,commands:a.msgContent.commands,content:e,editCount:a.editCount,ephemeralDurationInSec:(e=a.ephemeralSetting)==null?void 0:e.ephemeralExpirationInSec,externalId:x,forwardingScore:k,instanceKey:g,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isForwarded:h,mentionedJids:a.msgContent.mentionedJids,msgId:a.msgId,offlineMsg:b,replyPlaintextHash:y,sender:d("WAJids").authorToUserId(a.author,l),sortOrderMs:w,specialTextSize:a.specialTextSize,transportKey:f,ts:m,type_:a.type});case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return babelHelpers["extends"]({},n,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,chatJid:a.threadJid,ephemeralDurationInSec:(e=a.ephemeralSetting)==null?void 0:e.ephemeralExpirationInSec,externalId:x,forwardingScore:k,groupId:a.groupId,groupIndex:a.groupIndex,groupSize:a.groupSize,instanceKey:g,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isForwarded:h,msgId:a.msgId,offlineMsg:b,replyPlaintextHash:y,sender:d("WAJids").authorToUserId(a.author,l),sortOrderMs:w,transportKey:f,ts:m,type_:a.type});case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:return babelHelpers["extends"]({},n,{ack:a.ack,chatJid:a.threadJid,externalId:x,forwardingScore:k,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isForwarded:h,msgId:a.msgId,offlineMsg:b,replyPlaintextHash:y,sender:d("WAJids").authorToUserId(a.author,l),sortOrderMs:w,transportKey:f,ts:m,type_:a.type,unsupportedType:a.msgContent.subtype});case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:return{ack:a.ack,chatJid:a.threadJid,externalId:x,forwardingScore:k,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isForwarded:h,msgId:a.msgId,offlineMsg:b,sender:d("WAJids").authorToUserId(a.author,l),sortOrderMs:w,transportKey:f,ts:m,type_:a.type};case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:return babelHelpers["extends"]({},n,{ack:a.ack,chatJid:a.threadJid,externalId:x,forwardingScore:k,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isForwarded:h,msgId:a.msgId,offlineMsg:b,replyPlaintextHash:y,sender:d("WAJids").authorToUserId(a.author,l),sortOrderMs:w,transportKey:f,ts:m,type_:a.type});case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:return{ack:a.ack,adminContent:[a.msgContent.authorName],adminType:a.msgContent.adminType,chatJid:a.threadJid,externalId:x,forwardingScore:k,isAdminMessage:!0,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isForwarded:h,msgId:a.msgId,offlineMsg:b,sender:d("WAJids").authorToUserId(a.author,l),sortOrderMs:w,transportKey:f,ts:m,type_:a.type};case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:return{ack:a.ack,adminContent:a.msgContent.adminMsgContent.map(function(a){return a==="Facebook User"?"0":a}),adminType:a.msgContent.adminType,adminVersion:a.msgContent.version,chatJid:a.threadJid,externalId:x,forwardingScore:k,isAdminMessage:!0,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isForwarded:h,msgId:a.msgId,offlineMsg:b,sender:d("WAJids").authorToUserId(a.author,l),sortOrderMs:w,transportKey:f,ts:m,type_:a.type};case d("MAWMsgType").MSG_TYPE.REVOKED:return{ack:a.ack,chatJid:a.threadJid,externalId:x,forwardingScore:k,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isForwarded:h,msgId:a.msgId,offlineMsg:b,originalTs:a.originalTs,sender:d("WAJids").authorToUserId(a.author,l),sortOrderMs:w,transportKey:f,ts:m,type_:a.type};case d("MAWMsgType").MSG_TYPE.XMA:var z;e=(e=a.msgContent)==null?void 0:e.content;z=e!=null?d("MAWVault").isVaulted(e)?(z=a.msgContent)==null?void 0:z.content:d("MAWVault").vault(e):void 0;q&&z==null&&d("WALogger").WARN(i());e=c("justknobx")._("1191")||p||q?z:void 0;return babelHelpers["extends"]({},n,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,chatJid:a.threadJid,commands:(q=a.msgContent)==null?void 0:q.commands,content:e,ephemeralDurationInSec:(z=a.ephemeralSetting)==null?void 0:z.ephemeralExpirationInSec,externalId:x,forwardingScore:k,instanceKey:g,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredXmaMsg:a.isExpiredXmaMsg,isFBPostMention:d("MAWXMAUtils").isFBXMAPostMention(a.xmaMessageType),isFBStoryMention:s,isForwarded:h,isIGStoryMention:r,isMsgHighlightsTabFriendUpdatesReply:v,isPostPrivateReply:u,isStoryHighlightShare:t,isStoryReaction:p,isStoryShare:o,mentionedJids:(n=a.msgContent)==null?void 0:n.mentionedJids,msgId:a.msgId,offlineMsg:b,replyPlaintextHash:y,sender:d("WAJids").authorToUserId(a.author,l),sortOrderMs:w,transportKey:f,ts:m,type_:a.type,xmaMessageType:a.xmaMessageType});default:return c("WAAssertUnreachable")(a.type)}}g.getSpecialTextSize=a;g.createBridgeMsg=b}),98);
__d("MAWBridgeSafeActionsWorkerAndUI",["ExecutionEnvironment","MAWBridge","Promise","err","ifRequireable"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,e,f){return(i||(i=c("ExecutionEnvironment"))).isInWorker?d("MAWBridge").getBridge().sendAndReceive("backend",a,e,f==null?void 0:f.isLoggingDisabled):new(h||(h=b("Promise")))(function(b,d){return c("ifRequireable")("MAWBridgeSendAndReceive",function(c){c=c.sendAndReceive;return b(c("backend",a,e,f))},function(){return d("MAWBridgeSendAndReceive not available in UI ifRequired")})})}function e(a,b,e){return(i||(i=c("ExecutionEnvironment"))).isInWorker?d("MAWBridge").getBridge().fireAndForget("backend",a,b,e):c("ifRequireable")("MAWBridgeFireAndForget",function(c){c=c.fireAndForget;return c("backend",a,b,e)},function(){throw c("err")("MAWBridgeFireAndForget not available in UI ifRequired")})}g.sendAndReceiveBackendWorkerAndUIShared=a;g.fireAndForgetBackendWorkerAndUIShared=e}),98);
__d("MAWBridgeTrace",["WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f,g,h,i){var j=a.ack,k=a.externalId,l=a.ts;a=a.type;var m=d("WAJids").switchOnMsgrChatJidType(b,{group:function(a){return"Group"},user:function(a){return"User"}});return{ack:j,externalId:k,isFirstMsg:!!f,openMessageOtid:e,openMessageParticipantCount:g,participantCount:h,threadJid:b,threadKey:i,threadType:m,traceType:c,ts:l,type_:a}}function b(a,b,c){return{traceContext:c,traceId:b,traceType:a}}function c(a,b,c,d){return{errorMessage:d,event:b,externalIds:a,traceType:c}}function e(a,b,c,d,e,f){return{checkPointId:a,dataTraceId:b,errorMessage:c,shouldFlush:d,syncChannel:e,tags:f}}g.createBridgeStartTraceData=a;g.createBridgeStartTraceWithTraceIdData=b;g.createBridgeUpdateTraceData=c;g.createBridgeTraceRecordCheckpointData=e}),98);
__d("MAWBridgeUIEventDataValidation",["FBLogger","I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){try{return(h||(h=d("I64"))).of_string(a)}catch(b){c("FBLogger")("maw_bridge").catching(b).mustfix("Cannot convert string to i64: %s",a)}}g.stringToI64Opt=a}),98);
__d("MAWDbMsgOrReaction",[],(function(a,b,c,d,e,f){"use strict";function g(a,b){var c=b.forMessage;b=b.forReaction;return a.msgId!=null?c(a):b(a)}function a(a,b){var c=b.forMessage,d=b.forNull;b=b.forReaction;return a==null?d():g(a,{forMessage:c,forReaction:b})}f.switchOnMsgOrReaction=g;f.switchOnMsgOrReactionNullish=a}),66);
__d("MAWExtractMsFromExternalId",["I64","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to convert externalId to number: ",""]);i=function(){return a};return a}function j(a){return new Date(a).getTime()>0}var k=2199023255551;function a(a){try{a=(h||(h=d("I64"))).of_string_opt(a);if(a!=null){return(a=l(a))!=null?a:0}}catch(a){d("WALogger").ERROR(i(),a)}return 0}function l(a){a=Number((h||(h=d("I64"))).to_string(h.and_(h.lsr_(a,22),h.of_float(k))));if(j(a)){a=Math.floor(Number(a)%1e5/100);return a}}g.extractMsFromStanzaId=a;g.extractMsFromExternalId=l}),98);
__d("MAWCalculateBumpTimestampMs",["I64","MAWDbMsgOrReaction","MAWExtractMsFromExternalId","MAWTimeUtils","WALongInt","WATimeUtils","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){b=b==null?null:d("MAWExtractMsFromExternalId").extractMsFromExternalId(b);return(h||(h=d("I64"))).add(d("MAWTimeUtils").millisTimeToTimestamp(a),h.of_int32((a=b)!=null?a:0))}function j(a){var b=a.msg;a=a.throwIfNoServerTs;a=a?c("nullthrows")(b.serverTs):b.serverTs;return i(d("WATimeUtils").castUnixTimeToMillisTime((a=a)!=null?a:b.ts),(h||(h=d("I64"))).of_string(b.externalId))}function k(a){return a.senderTimestampMs!=null?(h||(h=d("I64"))).of_string(d("WALongInt").longIntToDecimalString(a.senderTimestampMs)):i(d("WATimeUtils").castUnixTimeToMillisTime(a.ts),(h||(h=d("I64"))).of_string(a.externalId))}function a(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(a){return j({msg:a,throwIfNoServerTs:!0})},forReaction:k})}g.calculateBumpTimestampMs=i;g.calculateBumpTimestampMsForMsg=j;g.calculateBumpTimestampMsForReaction=k;g.calculateBumpTsForMsgOrReaction=a}),98);
__d("WADirectPath",["WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h="0_0_0_.enc";function a(a){return a}function b(a){if(a==null)return d("WAResultOrError").makeError("direct-path-undefined");if(a==="")return d("WAResultOrError").makeError("direct-path-empty");return a.includes(h)?d("WAResultOrError").makeError("direct-path-corrupted"):d("WAResultOrError").makeResult(a)}g.unsafeCastToDirectPath=a;g.validateDirectPath=b}),98);
__d("WAMediaEntryData.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};a.internalSpec={fileSha256:[1,(e=d("WAProtoConst")).TYPES.BYTES],mediaKey:[2,e.TYPES.BYTES],fileEncSha256:[3,e.TYPES.BYTES],directPath:[4,e.TYPES.STRING],mediaKeyTimestamp:[5,e.TYPES.INT64],serverMediaType:[6,e.TYPES.STRING],uploadToken:[7,e.TYPES.BYTES],validatedTimestamp:[8,e.TYPES.BYTES],sidecar:[9,e.TYPES.BYTES],objectId:[10,e.TYPES.STRING],fbid:[11,e.TYPES.STRING],downloadableThumbnail:[12,e.TYPES.MESSAGE,c],handle:[13,e.TYPES.STRING],filename:[14,e.TYPES.STRING],progressiveJpegDetails:[15,e.TYPES.MESSAGE,b],size:[16,e.TYPES.INT64],lastDownloadAttemptTimestamp:[17,e.TYPES.INT64]};b.internalSpec={scanLengths:[1,e.FLAGS.REPEATED|e.TYPES.UINT32],sidecar:[2,e.TYPES.BYTES]};c.internalSpec={fileSha256:[1,e.TYPES.BYTES],fileEncSha256:[2,e.TYPES.BYTES],directPath:[3,e.TYPES.STRING],mediaKey:[4,e.TYPES.BYTES],mediaKeyTimestamp:[5,e.TYPES.INT64],objectId:[6,e.TYPES.STRING]};g.MediaEntrySpec=a;g.MediaEntry$ProgressiveJpegDetailsSpec=b;g.MediaEntry$DownloadableThumbnailSpec=c}),98);
__d("WAProgressiveJpegMarkers",[],(function(a,b,c,d,e,f){"use strict";a=255;b=0;c={SOF0:192,SOF1:193,SOF2:194,SOF3:195,DHT:196,SOF5:197,SOF6:198,SOF7:199,JPG:200,SOF9:201,SOF10:202,SOF11:203,SOF13:205,SOF14:206,SOF15:207,RST0:208,RST1:209,RST2:210,RST3:211,RST4:212,RST5:213,RST6:214,RST7:215,SOI:216,EOI:217,SOS:218,DQT:219,DRI:221,APP0:224,APP1:225,APP2:226,APP3:227,APP4:228,APP5:229,APP6:230,APP7:231,APP8:232,APP9:233,APP10:234,APP11:235,APP12:236,APP13:237,APP14:238,APP15:239,COM:254,TEM:1};d=[b,c.RST0,c.RST1,c.RST2,c.RST3,c.RST4,c.RST5,c.RST6,c.RST7];f.MARKER_PREFIX=a;f.MARKER_ESCAPE_BYTE=b;f.MARKERS=c;f.SOS_STREAM=d}),66);
__d("WAProgressiveJpegGetScanOffsets",["WAProgressiveJpegMarkers","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Non-progressive JPEG marker found"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Ending marker found before end of image"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Scan found at offset ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Not a JPEG image"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["starting"]);l=function(){return a};return a}var m=d("WATagsLogger").TAGS(["media","progressiveJpegUtils"]);function a(a){m.DEV(l());if(!n(a)){m.DEV(k());return[]}var b=[],c=2,e="READ_MARKER_FIRST_BYTE_OR_ENTROPY_DATA",f=null,g=0,r=!1,s=!1,t=!1;function u(){t=!1,m.DEV(j(),c-1),b.push(c-1)}while(c<a.byteLength){f=a[c];if(r){m.ERROR(i());return[]}switch(e){case"READ_MARKER_FIRST_BYTE_OR_ENTROPY_DATA":f===d("WAProgressiveJpegMarkers").MARKER_PREFIX&&(e="READ_MARKER_SECOND_BYTE");break;case"READ_MARKER_SECOND_BYTE":if(f===d("WAProgressiveJpegMarkers").MARKER_PREFIX)e="READ_MARKER_SECOND_BYTE";else if(f===d("WAProgressiveJpegMarkers").MARKER_ESCAPE_BYTE)e="READ_MARKER_FIRST_BYTE_OR_ENTROPY_DATA";else if(f===d("WAProgressiveJpegMarkers").MARKERS.EOI)r=!0,t&&u();else if(!s&&p(f)){m.LOG(h());return[]}else o(f)?(s=!0,e="READ_MARKER_FIRST_BYTE_OR_ENTROPY_DATA"):(t&&u(),f===d("WAProgressiveJpegMarkers").MARKERS.SOS&&(t=!0),q(f)?e="READ_SIZE_FIRST_BYTE":e="READ_MARKER_FIRST_BYTE_OR_ENTROPY_DATA");break;case"READ_SIZE_FIRST_BYTE":e="READ_SIZE_SECOND_BYTE";break;case"READ_SIZE_SECOND_BYTE":c+=g*256;c+=f;c-=2;e="READ_MARKER_FIRST_BYTE_OR_ENTROPY_DATA";break}c+=1;g=f}return b}function n(a){if(a.byteLength<=2)return!1;if(a[0]!==d("WAProgressiveJpegMarkers").MARKER_PREFIX)return!1;return a[1]!==d("WAProgressiveJpegMarkers").MARKERS.SOF2&&a[1]!==d("WAProgressiveJpegMarkers").MARKERS.SOI?!1:!0}function o(a){return a===d("WAProgressiveJpegMarkers").MARKERS.SOF2||a===d("WAProgressiveJpegMarkers").MARKERS.SOF6||a===d("WAProgressiveJpegMarkers").MARKERS.SOF10||a===d("WAProgressiveJpegMarkers").MARKERS.SOF14}function p(a){return a===d("WAProgressiveJpegMarkers").MARKERS.SOF0||a===d("WAProgressiveJpegMarkers").MARKERS.SOF1||a===d("WAProgressiveJpegMarkers").MARKERS.SOF3||a===d("WAProgressiveJpegMarkers").MARKERS.SOF5||a===d("WAProgressiveJpegMarkers").MARKERS.SOF7||a===d("WAProgressiveJpegMarkers").MARKERS.JPG||a===d("WAProgressiveJpegMarkers").MARKERS.SOF9||a===d("WAProgressiveJpegMarkers").MARKERS.SOF11||a===d("WAProgressiveJpegMarkers").MARKERS.SOF13||a===d("WAProgressiveJpegMarkers").MARKERS.SOF15}function q(a){if(a===d("WAProgressiveJpegMarkers").MARKERS.TEM)return!1;return a>=d("WAProgressiveJpegMarkers").MARKERS.RST0&&a<=d("WAProgressiveJpegMarkers").MARKERS.RST7?!1:a!==d("WAProgressiveJpegMarkers").MARKERS.EOI&&a!==d("WAProgressiveJpegMarkers").MARKERS.SOI}g.getProgressiveJpegScanOffsets=a}),98);
__d("WAProgressiveJpegGetScanLengths",["WAProgressiveJpegGetScanOffsets"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=d("WAProgressiveJpegGetScanOffsets").getProgressiveJpegScanOffsets(a);return h(a)}function b(a){return a}function h(a){var b=[],c=0;for(var d=0;d<a.length;d++){var e=a[d];b.push(e-c);c=e}return b}g.getProgressiveJpegScanLengths=a;g.asProgressiveJpegScanLength=b}),98);
__d("WAServerMediaType",["WAAssertUnreachable"],(function(a,b,c,d,e,f,g){"use strict";d=["image","sticker","ptt","audio","document","video","gif","ppic","md-app-state","md-msg-hist","kyc-id","template","thumbnail-image","thumbnail-video","thumbnail-gif","thumbnail-document","thumbnail-link","payment-bg-image","novi-video","novi-image","product","product-catalog-image","xma-image","biz-cover-photo","preview","newsletter-audio","newsletter-document","newsletter-image","newsletter-gif","newsletter-ptt","newsletter-sticker","newsletter-thumbnail-link","newsletter-video","sticker-pack","thumbnail-sticker-pack","music-artwork"];function a(a){switch(a){case"image":case"sticker":case"ptt":case"audio":case"document":case"video":case"gif":case"ppic":case"md-app-state":case"md-msg-hist":case"kyc-id":case"thumbnail-image":case"thumbnail-video":case"thumbnail-gif":case"thumbnail-document":case"thumbnail-link":case"payment-bg-image":case"novi-video":case"novi-image":case"template":case"product":case"product-catalog-image":case"xma-image":case"biz-cover-photo":case"preview":case"newsletter-audio":case"newsletter-document":case"newsletter-image":case"newsletter-gif":case"newsletter-ptt":case"newsletter-sticker":case"newsletter-thumbnail-link":case"newsletter-video":case"sticker-pack":case"thumbnail-sticker-pack":case"music-artwork":return a;default:return null}}function b(a){switch(a){case"Image":return"image";case"Video":return"video";case"Ptt":return"ptt";case"Gif":return"gif";case"Sticker":return"sticker";case"DocumentFile":return"document";case"Text":case"Futureproof":case"Ciphertext":case"Unavailable":case"ExpiredEphemeral":case"Admin":case"Revoked":case"DeleteForMe":case"EphemeralSettingAdmin":case"EphemeralSyncResponse":case"EphemeralSettingChangeFromCurrentDevice":case"AlertICDC":case"GroupInvite":case"SenderKeyDistribution":case"Reaction":case"EditAction":case"ReceiverFetch":case"Raven":case"GroupPollCreate":case"GroupPollUpdate":return null;default:return c("WAAssertUnreachable")(a)}}g.SERVER_MEDIA=d;g.castToServerMediaType=a;g.getMediaType=b}),98);
__d("WABinary",["WAHex","err"],(function(a,b,c,d,e,f,g){"use strict";var h=65533,i=10,j=new Uint8Array(i),k=new Uint8Array(0);a=function(){function a(b,c){var d=this;b===void 0&&(b=k);c===void 0&&(c=!1);this.$1=new Uint8Array(0);this.$2=0;this.$4=0;this.write=function(){for(var b=0;b<arguments.length;b++){var c=b<0||arguments.length<=b?void 0:arguments[b];typeof c==="string"?d.writeString(c):typeof c==="number"?d.writeUint8(c):c instanceof a?d.writeBinary(c):c instanceof ArrayBuffer?d.writeBuffer(c):c instanceof Uint8Array&&d.writeByteArray(c)}};b instanceof ArrayBuffer?(this.$1=new Uint8Array(b),this.$2=this.$4=b.byteLength):b instanceof Uint8Array&&(this.$1=b,this.$2=this.$4=b.length);this.$5=0;this.$6=this.$3=0;this.$7=null;this.$8=c;this.$9=0;this.$10=0}var b=a.prototype;b.size=function(){return this.$2-this.$3};b.peek=function(a,b){this.$9++;var c=this.$3,d=this.$5;try{return a(this,b)}finally{this.$9--,this.$3=c-(this.$5-d)}};b.advance=function(a){this.$11(a)};b.readWithViewParser=function(a,b,c,d){return b(this.$12(),this.$11(a),a,c,d)};b.readWithBytesParser=function(a,b,c,d){return b(this.$1,this.$11(a),a,c,d)};b.readUint8=function(){return p(this,1,r,!1)};b.readInt8=function(){return p(this,1,r,!0)};b.readUint16=function(a){a===void 0&&(a=this.$8);return p(this,2,s,a)};b.readInt32=function(a){a===void 0&&(a=this.$8);return p(this,4,t,a)};b.readUint32=function(a){a===void 0&&(a=this.$8);return p(this,4,u,a)};b.readInt64=function(a){a===void 0&&(a=this.$8);return p(this,8,v,U,a)};b.readUint64=function(a){a===void 0&&(a=this.$8);return p(this,8,v,V,a)};b.readLong=function(a,b){b===void 0&&(b=this.$8);return p(this,8,v,a,b)};b.readFloat32=function(a){a===void 0&&(a=this.$8);return p(this,4,w,a)};b.readFloat64=function(a){a===void 0&&(a=this.$8);return p(this,8,x,a)};b.readVarInt=function(a){var b=this.size();b=q(this,0,y,b);return q(this,b,z,a)};b.readBuffer=function(a){a===void 0&&(a=this.size());return a===0?new ArrayBuffer(0):q(this,a,A)};b.readByteArray=function(a){a===void 0&&(a=this.size());return a===0?new Uint8Array(0):q(this,a,B)};b.readBinary=function(b,c){b===void 0&&(b=this.size());c===void 0&&(c=this.$8);if(b===0)return new a(void 0,c);b=q(this,b,B);return new a(b,c)};b.indexOf=function(a){if(a.length===0)return 0;var b=this.$1,c=this.$2,d=this.$3,e=0,f=d;for(var g=d;g<c;g++)if(b[g]===a[e]){e===0&&(f=g);e++;if(e===a.byteLength)return g-d-a.byteLength+1}else e>0&&(e=0,g=f);return-1};b.readString=function(a){return q(this,a,C)};b.ensureCapacity=function(a){this.$13(this.$3+a)};b.ensureAdditionalCapacity=function(a){this.$13(this.$4+a)};b.writeToView=function(a,b,c,d){var e=this.$14(a);return b(this.$12(),e,a,c,d)};b.writeToBytes=function(a,b,c,d){var e=this.$14(a);return b(this.$1,e,a,c,d)};b.writeUint8=function(a){S(a,0,256,"uint8"),E(this,1,F,a,!1)};b.writeInt8=function(a){S(a,-128,128,"signed int8"),E(this,1,F,a,!0)};b.writeUint16=function(a,b){b===void 0&&(b=this.$8),S(a,0,65536,"uint16"),D(this,2,G,a,b)};b.writeInt16=function(a,b){b===void 0&&(b=this.$8),S(a,-32768,32768,"signed int16"),D(this,2,H,a,b)};b.writeUint32=function(a,b){b===void 0&&(b=this.$8),S(a,0,4294967296,"uint32"),D(this,4,I,a,b)};b.writeInt32=function(a,b){b===void 0&&(b=this.$8),S(a,-2147483648,2147483648,"signed int32"),D(this,4,J,a,b)};b.writeUint64=function(a,b){b===void 0&&(b=this.$8),S(a,0,18446744073709552e3,"uint64"),D(this,8,K,a,b)};b.writeInt64=function(a,b){b===void 0&&(b=this.$8),S(a,-9223372036854776e3,9223372036854776e3,"signed int64"),D(this,8,K,a,b)};b.writeFloat32=function(a,b){b===void 0&&(b=this.$8),D(this,4,L,a,b)};b.writeFloat64=function(a,b){b===void 0&&(b=this.$8),D(this,8,M,a,b)};b.writeVarInt=function(a){S(a,-9223372036854776e3,9223372036854776e3,"varint (signed int64)");var b=a<0;a=b?-a:a;var c=Math.floor(a/4294967296);a=a-c*4294967296;b&&(c=~c,a===0?c++:a=-a);b=R(c,a);E(this,b,N,c,a)};b.writeVarIntFromHexLong=function(a){var b=d("WAHex").hexLongIsNegative(a);a=b?d("WAHex").negateHexLong(a):a;a=d("WAHex").hexLongToHex(a);var c=0,e=0;for(var f=0;f<d("WAHex").NUM_HEX_IN_LONG;f++)c=c<<4|e>>>28,e=e<<4|d("WAHex").hexAt(a,f);b&&(c=~c,e===0?c++:e=-e);a=R(c,e);E(this,a,N,c,e)};b.writeBinary=function(a){a=a.peek(function(a){return a.readByteArray()});if(a.length){var b=this.$14(a.length);this.$1.set(a,b)}};b.writeBuffer=function(a){this.writeByteArray(new Uint8Array(a))};b.writeByteArray=function(a){var b=this.$14(a.length);this.$1.set(a,b)};b.writeBufferView=function(a){this.writeByteArray(new Uint8Array(a.buffer,a.byteOffset,a.byteLength))};b.writeString=function(a){E(this,n(a),O,a)};b.writeHexLong=function(a,b){b===void 0&&(b=this.$8),D(this,8,P,a,b)};b.writeBytes=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];for(var d=0;d<b.length;d++)S(b[d],0,256,"byte");E(this,b.length,Q,b)};b.writeAtomically=function(a,b){this.$10++;var c=this.$4,d=this.$5;try{a=a(this,b);c=this.$4;d=this.$5;return a}finally{this.$10--,this.$4=c-(this.$5-d)}};b.writeWithVarIntLength=function(a,b){var c=this.$4;a=this.writeAtomically(a,b);b=this.$4;this.writeVarInt(b-c);var d=this.$4-b,e=this.$1;for(var f=0;f<d;f++)j[f]=e[b+f];for(f=b-1;f>=c;f--)e[f+d]=e[f];for(b=0;b<d;b++)e[c+b]=j[b];return a};a.build=function(){for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];var e=0;for(var f=0;f<c.length;f++){var g=c[f];typeof g==="string"?e+=n(g):typeof g==="number"?e++:g instanceof a?e+=g.size():g instanceof ArrayBuffer?e+=g.byteLength:g instanceof Uint8Array&&(e+=g.length)}var h=new a();h.ensureCapacity(e);h.write.apply(h,arguments);return h};b.$12=function(){return this.$7||(this.$7=new DataView(this.$1.buffer,this.$1.byteOffset))};b.$11=function(a){if(a<0)throw c("err")("ReadError: given negative number of bytes to read");var b=this.$3;a=b+a;if(a>this.$2)throw c("err")(b===this.$2?"ReadError: tried to read from depleted binary":"ReadError: tried to read beyond end of binary");this.$3=a;this.$9||(this.$6=a);return b};b.$13=function(a){var b=this.$1;if(a<=b.length)return a;else{var c=this.$6;a=a-c;var d=Math.max(a,2*(b.length-c),64);d=new Uint8Array(d);c?(d.set(b.subarray(c)),this.$5+=c,this.$3-=c,this.$2-=c,this.$4-=c,this.$6=0):d.set(b);this.$1=d;this.$7=null;return a}};b.$14=function(a){a=this.$13(this.$4+a);var b=this.$4;this.$4=a;this.$10||(this.$2=a);return b};return a}();var l="",m=0;function n(a){if(a===l)return m;var b=a.length,c=0;for(var d=0;d<b;d++){var e=a.charCodeAt(d);if(e<128)c++;else if(e<2048)c+=2;else if(e<55296||57344<=e&&e<=65535)c+=3;else if(55296<=e&&e<56320&&d+1!==b){e=a.charCodeAt(d+1);56320<=e&&e<57344?(d++,c+=4):c+=3}else c+=3}l=a;return m=c}function o(a,b,c){var d=b>>21;if(!a)return d===0;else{a=b&2097151;b=Boolean(a||c);return d===0||d===-1&&b}}function p(a,b,c,d,e){return a.readWithViewParser(b,c,d,e)}function q(a,b,c,d,e){return a.readWithBytesParser(b,c,d,e)}function r(a,b,c,d){return d?a.getInt8(b):a.getUint8(b)}function s(a,b,c,d){return a.getUint16(b,d)}function t(a,b,c,d){return a.getInt32(b,d)}function u(a,b,c,d){return a.getUint32(b,d)}function v(a,b,c,d,e){c=a.getInt32(e?b+4:b,e);a=a.getInt32(e?b:b+4,e);return d(c,a)}function w(a,b,c,d){return a.getFloat32(b,d)}function x(a,b,c,d){return a.getFloat64(b,d)}function y(a,b,d,e){d=Math.min(e,i);e=0;var f=128;while(e<d&&f&128)f=a[b+e++];if(e===i&&f>1)throw c("err")("ParseError: varint exceeds 64 bits");else if(f&128)return e+1;return e}function z(b,c,d,a){var e=0,f=0,g=d;d===i&&(g--,f=b[c+g]&1);for(d=g-1;d>=0;d--)e=e<<7|f>>>25,f=f<<7|b[c+d]&127;return a(e,f)}function A(a,b,c){b=b+a.byteOffset;a=a.buffer;return b===0&&c===a.byteLength?a:a.slice(b,b+c)}function B(a,b,c){return a.subarray(b,b+c)}function C(a,b,c){c=b+c;var d=[],e=null;for(b=b;b<c;b++){d.length>5e3&&(e||(e=[]),e.push(String.fromCharCode.apply(String,d)),d=[]);var f=a[b]|0;if((f&128)===0)d.push(f);else if((f&224)===192){var g=W(a,b+1,c);if(g){b++;g=(f&31)<<6|g&63;g>=128?d.push(g):d.push(h)}else d.push(h)}else if((f&240)===224){g=W(a,b+1,c);var i=W(a,b+2,c);if(g&&i){b+=2;i=(f&15)<<12|(g&63)<<6|i&63;i>=2048&&!(55296<=i&&i<57344)?d.push(i):d.push(h)}else g?(b++,d.push(h)):d.push(h)}else if((f&248)===240){i=W(a,b+1,c);g=W(a,b+2,c);var j=W(a,b+3,c);if(i&&g&&j){b+=3;f=(f&7)<<18|(i&63)<<12|(g&63)<<6|j&63;if(f>=65536&&f<=1114111){j=f-65536;d.push(55296|j>>10,56320|j&1023)}else d.push(h)}else i&&g?(b+=2,d.push(h)):i?(b++,d.push(h)):d.push(h)}else d.push(h)}f=String.fromCharCode.apply(String,d);if(e){e.push(f);return e.join("")}else return f}function D(a,b,c,d,e){return a.writeToView(b,c,d,e)}function E(a,b,c,d,e){return a.writeToBytes(b,c,d,e)}function F(a,b,c,d){a[b]=d}function G(a,b,c,d,e){a.setUint16(b,d,e)}function H(a,b,c,d,e){a.setInt16(b,d,e)}function I(a,b,c,d,e){a.setUint32(b,d,e)}function J(a,b,c,d,e){a.setInt32(b,d,e)}function K(a,b,c,d,e){c=d<0;d=c?-d:d;var f=Math.floor(d/4294967296);d=d-f*4294967296;c&&(f=~f,d===0?f++:d=-d);a.setUint32(e?b+4:b,f,e);a.setUint32(e?b:b+4,d,e)}function L(a,b,c,d,e){a.setFloat32(b,d,e)}function M(a,b,c,d,e){a.setFloat64(b,d,e)}function N(a,b,c,d,e){d=d;e=e;c=b+c-1;for(b=b;b<c;b++)a[b]=128|e&127,e=d<<25|e>>>7,d>>>=7;a[c]=e}function O(a,b,c,d){c=b;b=d.length;for(var e=0;e<b;e++){var f=d.charCodeAt(e);if(f<128)a[c++]=f;else if(f<2048)a[c++]=192|f>>6,a[c++]=128|f&63;else if(f<55296||57344<=f)a[c++]=224|f>>12,a[c++]=128|f>>6&63,a[c++]=128|f&63;else if(55296<=f&&f<56320&&e+1!==b){var g=d.charCodeAt(e+1);if(56320<=g&&g<57344){e++;f=65536+((f&1023)<<10|g&1023);a[c++]=240|f>>18;a[c++]=128|f>>12&63;a[c++]=128|f>>6&63;a[c++]=128|f&63}else a[c++]=239,a[c++]=191,a[c++]=189}else a[c++]=239,a[c++]=191,a[c++]=189}}function P(a,b,c,e,f){c=d("WAHex").hexLongIsNegative(e);e=d("WAHex").hexLongToHex(e);var g=0,h=0;for(var i=0;i<16;i++)g=g<<4|h>>>28,h=h<<4|d("WAHex").hexAt(e,i);c&&(g=~g,h===0?g++:h=-h);a.setUint32(f?b+4:b,g,f);a.setUint32(f?b:b+4,h,f)}function Q(a,b,c,d){for(var e=0;e<c;e++)a[b+e]=d[e]}function R(a,b){var c;a?(c=5,a=a>>>3):(c=1,a=b>>>7);while(a)c++,a>>>=7;return c}function S(a,b,d,e){if(typeof a!=="number"||a!==a||Math.floor(a)!==a||a<b||a>=d)throw c("err")(typeof a==="string"?'TyperError WriteError: string "'+a+'" is not a valid '+e:"TypeError WriteError: "+String(a)+" is not a valid "+e)}function T(a,b,d){var e=o(a,b,d),f;b>=0?f=b:f=a?b:4294967296+b;a=d>=0?d:4294967296+d;b=f*4294967296+a;if(!e)throw c("err")("ReadError: integer exceeded 53 bits ("+b+")");return b}function U(a,b){return T(!0,a,b)}function V(a,b){return T(!1,a,b)}function W(a,b,c){if(b>=c)return 0;c=a[b]|0;return(c&192)===128?c:0}g.Binary=a;g.numUtf8Bytes=n;g.longFitsInDouble=o;g.parseInt64OrThrow=U;g.parseUint64OrThrow=V}),98);
__d("WAHasProperty",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return Object.prototype.hasOwnProperty.call(a,b)}f["default"]=a}),66);
__d("WAProtoCompile",["WAProtoConst"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,b,c,d,e,f,g,h,i){this.names=a,this.fields=b,this.types=c,this.defaults=d,this.meta=e,this.oneofToFields=f,this.fieldToOneof=g,this.reservedTags=h?h.reduce(function(a,b){a[b]=!0;return a},{}):{},this.reservedFields=i?i.reduce(function(a,b){a[b]=!0;return a},{}):{}};function a(a){if(a.internalCompiledSpec)return a.internalCompiledSpec;var b=a.internalSpec;if(!b)throw new Error("Message Class "+String(a)+" does not have internalSpec");var c=a.internalDefaults||{},e=Object.keys(b).filter(function(a){return a!==d("WAProtoConst").KEYS.ONEOF}),f=new Array(e.length),g=[],j=[],k=new Array(e.length),l=b[d("WAProtoConst").KEYS.ONEOF]||{};e.sort(function(a,c){a=i(b,a);c=i(b,c);return a[0]-c[0]});for(var m=0;m<e.length;m++){var n=e[m],o=i(b,n);k[m]=c[n];var p=o[1],q=o[0];g.push(q);j.push(p);if((p&d("WAProtoConst").TYPE_MASK)===d("WAProtoConst").TYPES.MESSAGE)f[m]=o[2];else if((p&d("WAProtoConst").TYPE_MASK)===d("WAProtoConst").TYPES.ENUM){q=o[2];if(typeof q.cast==="function")f[m]=q;else{var r=!0,s=0;for(var t in q)r&&t!==s++&&(r=!1);t=void 0;if(r){t=[];for(r=0;r<s;r++)t.push(!0)}else{t={};for(r in q)t[q[r]]=!0}f[m]=t}}else if((p&d("WAProtoConst").TYPE_MASK)===d("WAProtoConst").TYPES.MAP){if(o.length!==3)throw new Error("Map field "+n+" should have exactly three elements in its internalSpec");f[m]=o[2]}else f[m]=null}var u={};s=function(a){l[a].forEach(function(b){u[b]||(u[b]=[]),u[b].push(a)})};for(r in l)s(r);q=b[d("WAProtoConst").KEYS.RESERVED]&&b[d("WAProtoConst").KEYS.RESERVED][d("WAProtoConst").KEYS.RESERVED_TAGS];t=b[d("WAProtoConst").KEYS.RESERVED]&&b[d("WAProtoConst").KEYS.RESERVED][d("WAProtoConst").KEYS.RESERVED_FIELDS];p=new h(e,g,j,k,f,l,u,q,t);a.internalCompiledSpec=p;return p}function i(a,b){a=a[b];if(a==null)throw new Error("fieldData of "+b+" is missing");return a}g.Spec=h;g.compileSpec=a}),98);
__d("WAProtoUtils",["WAProtoConst"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a&d("WAProtoConst").FLAGS.PACKED)return d("WAProtoConst").ENC.BINARY;a=a&d("WAProtoConst").TYPE_MASK;if(a<=d("WAProtoConst").TYPES.ENUM)return d("WAProtoConst").ENC.VARINT;else if(a<=d("WAProtoConst").TYPES.DOUBLE)return d("WAProtoConst").ENC.BIT64;else if(a<=d("WAProtoConst").TYPES.MESSAGE)return d("WAProtoConst").ENC.BINARY;else if(a===d("WAProtoConst").TYPES.MAP)return d("WAProtoConst").ENC.BINARY;else return d("WAProtoConst").ENC.BIT32}g.typeToEncType=a}),98);
__d("WAProtoValidate",["WAHasProperty","WALogger","WAProtoCompile","WAProtoConst"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(['"','" is not an array']);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(['"','" is not ',""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(['"','" is out of range']);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(['"','" is not a valid int']);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(['"','" is not a valid long']);l=function(){return a};return a}var m=Number.MAX_SAFE_INTEGER;function n(a,b){a=o(a,b);if(a){a.reverse();throw new TypeError("Message missing required value "+a.join("."))}}function a(a,b){n(a,b);b=u(b,a);if(b){b.path.reverse();throw new TypeError("Invalid value at "+b.path.join(".")+": "+b.error)}}function o(a,b){a=d("WAProtoCompile").compileSpec(a);var e=a.names,f=a.types;a=a.meta;var g=void 0;for(var h=0;h<f.length&&!g;h++){var i=f[h],j=e[h],k=c("WAHasProperty")(b,j)?b[j]:void 0;if(i&d("WAProtoConst").FLAGS.REQUIRED&&k==null)g=[j];else if((i&d("WAProtoConst").TYPE_MASK)===d("WAProtoConst").TYPES.MESSAGE&&i&d("WAProtoConst").FLAGS.REPEATED&&k!=null){var l=a[h],m=void 0;for(m=0;m<k.length&&!g;m++)g=o(l,k[m]);g&&g.push(j+"["+m+"]")}else(i&d("WAProtoConst").TYPE_MASK)===d("WAProtoConst").TYPES.MESSAGE&&k!=null&&(g=o(a[h],k),g&&g.push(j))}return g}function p(a,b,c){if(typeof a==="string")if(/^-?0x[0-9a-f]{16}$/i.test(a))return!1;else{d("WALogger").LOG(l(),s(a)).color("red");return{path:[],error:"value must be a hex string of the form '0x123...' or '-0x123...' where the tail is always 16 characters long"}}else return q(a,b,c)}function q(a,b,c){if(typeof a!=="number"||a!==a||Math.floor(a)!==a){d("WALogger").LOG(k(),s(a)).color("red");return{path:[],error:"value must be an int"}}else if(a<b||a>=c){d("WALogger").LOG(j(),s(a)).color("red");return{path:[],error:"value is out of range"}}else return!1}function r(a,b,c){if(a)return void 0;else{d("WALogger").LOG(i(),s(c),b).color("red");return{path:[],error:"value is invalid"}}}function s(a){if(typeof a==="string")return'"'+a+'"';else if(Array.isArray(a))return"["+a.join(", ")+"]";else return""+a}var t=[void 0,function(a){return q(a,-2147483648,2147483648)},function(a){return p(a,-m,m+1)},function(a){return q(a,0,4294967296)},function(a){return p(a,0,m+1)},function(a){return q(a,-2147483648,2147483648)},function(a){return p(a,-m,m+1)},function(a){return r(typeof a==="boolean","boolean",a)},function(a,b){return r(typeof a==="number"&&(b[a]||b.cast(a)!==void 0),"in enum",a)},function(a){return p(a,0,m+1)},function(a){return p(a,-m,m+1)},function(a){return r(typeof a==="number","number",a)},function(a){return r(typeof a==="string","string",a)},function(a){return r(a instanceof ArrayBuffer||a instanceof Uint8Array,"ArrayBuffer or Uint8Array",a)},u,function(a){return q(a,0,4294967296)},function(a){return q(a,-2147483648,2147483648)},function(a){return r(typeof a==="number","number",a)}];function u(a,b){b=d("WAProtoCompile").compileSpec(b);var c=b.names,e=b.fields,f=b.types,g=b.meta,i=b.oneofToFields,j=b.fieldToOneof,k=b.reservedTags,l=b.reservedFields,m=void 0;b=function(b){var n=c[b],o=f[b],p=a[n],q=o&d("WAProtoConst").TYPE_MASK,r=t[q],u=(o&d("WAProtoConst").TYPE_MASK)===d("WAProtoConst").TYPES.MAP;if(r===void 0&&!u)throw new Error("Can not find the validator for type "+q);if(o&(d("WAProtoConst").FLAGS.PACKED|d("WAProtoConst").FLAGS.REPEATED)&&p!=null)if(!Array.isArray(p))d("WALogger").LOG(h(),s(p)).color("red"),m={path:[n],error:"repeated field must be array"};else{q=g[b];for(o=0;o<p.length&&!m;o++)m=r(p[o],q),m&&m.path.push(n+"["+o+"]")}else if(u&&p!=null){o=g[b];q=o[0];u=o[1];o=typeof u==="object"?d("WAProtoConst").TYPES.MESSAGE:u;var v=t[q],w=t[o];if(v===void 0||w===void 0)throw new Error("Can not find the validator for Map with key type "+q+", value type "+o);for(var o=p,x=Array.isArray(o),y=0,o=x?o:o[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var z;if(x){if(y>=o.length)break;z=o[y++]}else{y=o.next();if(y.done)break;z=y.value}z=z;var A=z[0];z=z[1];m=v(A,q);if(m){m.path.push(n+"'s key ["+A+"]");return{v:m}}m=w(z,u);if(m){m.path.push(n+"["+A+"]'s value");return{v:m}}}}else if(p!=null){m=r(p,g[b]);m&&m.path.push(n);z=j[n];z&&z.forEach(function(b){var c=i[b].filter(function(a){return a!==n});c.forEach(function(c){typeof a[c]!=="undefined"&&(m={path:[b],error:"oneof '"+b+"' has fields '"+n+"' and '"+c+"' set"})})});k[e[b]]&&(m={path:[n],error:"tag "+e[b]+" is reserved"});l[n]&&(m={path:[n],error:"field "+n+" is reserved"})}};for(var n=0;n<c.length&&!m;n++){var o=b(n);if(typeof o==="object")return o.v}return m}g.checkRequirements=n;g.checkValid=a}),98);
__d("decodeProtobuf",["WABinary","WAHasProperty","WAHex","WAProtoCompile","WAProtoConst","WAProtoUtils","WAProtoValidate"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b=new(d("WABinary").Binary)(b);b=n(a,b,void 0,!1);d("WAProtoValidate").checkRequirements(a,b);return b}function b(a,b){b=new(d("WABinary").Binary)(b);b=n(a,b,void 0,!0);d("WAProtoValidate").checkRequirements(a,b);return b}function e(a){return c("WAHasProperty")(a,"$$unsafeUnknownFields")?a.$$unsafeUnknownFields:null}function h(a,b,c){if(a!==d("WAProtoUtils").typeToEncType(b))throw new Error("FormatError: "+c+" encoded with wire type "+a)}function i(a,b,c){switch(b){case d("WAProtoConst").TYPES.INT32:return j(c,-2147483648,2147483648,a,d("WABinary").parseInt64OrThrow);case d("WAProtoConst").TYPES.INT64:return c.readVarInt(k);case d("WAProtoConst").TYPES.UINT32:return j(c,0,4294967296,a,d("WABinary").parseUint64OrThrow);case d("WAProtoConst").TYPES.UINT64:return c.readVarInt(l);case d("WAProtoConst").TYPES.SINT32:b=j(c,0,4294967296,a,d("WABinary").parseInt64OrThrow);return b&1?~(b>>>1):b>>>1;case d("WAProtoConst").TYPES.SINT64:return c.readVarInt(m);case d("WAProtoConst").TYPES.BOOL:return!!j(c,0,2,a,d("WABinary").parseUint64OrThrow);case d("WAProtoConst").TYPES.ENUM:return c.readVarInt(d("WABinary").parseInt64OrThrow);case d("WAProtoConst").TYPES.FIXED64:return c.readLong(l,!0);case d("WAProtoConst").TYPES.SFIXED64:return c.readLong(k,!0);case d("WAProtoConst").TYPES.DOUBLE:return c.readFloat64(!0);case d("WAProtoConst").TYPES.STRING:return c.readString(c.readVarInt(d("WABinary").parseUint64OrThrow));case d("WAProtoConst").TYPES.BYTES:return c.readBuffer(c.readVarInt(d("WABinary").parseUint64OrThrow));case d("WAProtoConst").TYPES.FIXED32:return c.readUint32(!0);case d("WAProtoConst").TYPES.SFIXED32:return c.readInt32(!0);case d("WAProtoConst").TYPES.FLOAT:return c.readFloat32(!0)}}function j(a,b,c,d,e){a=a.readVarInt(e);if(a<b||a>=c)throw new Error("FormatError: "+d+" encoded with out-of-range value "+a);return a}function k(a,b){var c=d("WABinary").longFitsInDouble(!0,a,b);if(c){c=o(b);return a*4294967296+c}else{c=a<0;var e;c?e=b===0?-a:~a:e=a;a=c?-b:b;return d("WAHex").createHexLongFrom32Bits(e,a,c)}}function l(a,b){var c=d("WABinary").longFitsInDouble(!1,a,b);if(c){c=o(a);var e=o(b);return c*4294967296+e}else return d("WAHex").createHexLongFrom32Bits(a,b)}function m(a,b){var c=a>>>1;a=a<<31|b>>>1;b&1&&(c=~c,a=~a);return k(c,a)}function n(a,b,c,e){var f=d("WAProtoCompile").compileSpec(a),g=f.names,k=f.fields,l=f.types,m=f.meta,o=f.oneofToFields,p=f.fieldToOneof,q=f.reservedTags,r=f.reservedFields;f=a.internalDefaults;var s=c||babelHelpers["extends"]({},f)||{};s.$$unknownFieldCount=(a=c==null?void 0:c.$$unknownFieldCount)!=null?a:0;for(f=0;f<g.length;f++)l[f]&d("WAProtoConst").FLAGS.REPEATED?s[g[f]]=[]:l[f]===(d("WAProtoConst").TYPES.MAP&d("WAProtoConst").TYPE_MASK)&&(s[g[f]]=new Map());var t=0;c=k.length>0;a=k[0];while(b.size()){f=j(b,0,4294967296,"field and enc type",d("WABinary").parseInt64OrThrow);var u=f&7,v=f>>>3;if(c&&v!==a){f=t;do++t===k.length&&(t=0),a=k[t];while(v!==a&&t!==f)}if(c&&v===a)(function(){var a=g[t],c=l[t];h(u,c,a);var f=c&d("WAProtoConst").TYPE_MASK,k=m[t];if(c&d("WAProtoConst").FLAGS.PACKED){var w=b.readVarInt(d("WABinary").parseUint64OrThrow);w=b.readBinary(w);while(w.size()){var x=i(a,f,w);(f!==d("WAProtoConst").TYPES.ENUM||k[x]||(k.cast==null?void 0:k.cast(x))!==void 0)&&s[a].push(x)}}else if(f===d("WAProtoConst").TYPES.MESSAGE){x=b.readVarInt(d("WABinary").parseUint64OrThrow);w=b.readBinary(x);if(c&d("WAProtoConst").FLAGS.REPEATED)s[a].push(n(k,w,void 0,e));else{x=s[a];s[a]=n(k,w,x,e)}}else if(f===d("WAProtoConst").TYPES.MAP){w=b.readVarInt(d("WABinary").parseUint64OrThrow);x=b.readBinary(w);var y,z;for(w=0;w<m[t].length;w++){var A=j(x,0,4294967296,"map field and enc type",d("WABinary").parseInt64OrThrow),B=A&7;A=A>>>3;var C=void 0;switch(B){case d("WAProtoConst").ENC.VARINT:C=x.readVarInt(d("WABinary").parseInt64OrThrow);break;case d("WAProtoConst").ENC.BIT64:C=x.readBinary(8);break;case d("WAProtoConst").ENC.BINARY:B=k[w];if(B===d("WAProtoConst").TYPES.BYTES||B===d("WAProtoConst").TYPES.STRING)C=i(a,B,x);else{var D=x.readVarInt(d("WABinary").parseUint64OrThrow);D=x.readBinary(D);C=n(B,D,void 0,e)}break;case d("WAProtoConst").ENC.BIT32:C=x.readBinary(4);break}A===1?y=C:z=C}s[a].set(y,z)}else{B=i(a,f,b);(f!==d("WAProtoConst").TYPES.ENUM||k[B]||(k.cast==null?void 0:k.cast(B))!==void 0)&&(c&d("WAProtoConst").FLAGS.REPEATED?s[a].push(B):s[a]=B)}D=p[a];D&&typeof s[a]!=="undefined"&&D.forEach(function(b){b=o[b].filter(function(b){return b!==a});b.forEach(function(a){delete s[a]})});(q[v]||r[a])&&delete s[a]})();else{s.$$unknownFieldCount++;if(e){s.$$unsafeUnknownFields||(s.$$unsafeUnknownFields={});f=void 0;switch(u){case d("WAProtoConst").ENC.VARINT:f=b.readVarInt(d("WABinary").parseInt64OrThrow);break;case d("WAProtoConst").ENC.BIT64:f=b.readBinary(8);break;case d("WAProtoConst").ENC.BINARY:f=b.readBinary(b.readVarInt(d("WABinary").parseUint64OrThrow));break;case d("WAProtoConst").ENC.BIT32:f=b.readBinary(4);break}s.$$unsafeUnknownFields[v]=f}else u===d("WAProtoConst").ENC.VARINT?b.readVarInt(d("WABinary").parseInt64OrThrow):u===d("WAProtoConst").ENC.BIT64?b.advance(8):u===d("WAProtoConst").ENC.BINARY?b.advance(b.readVarInt(d("WABinary").parseUint64OrThrow)):u===d("WAProtoConst").ENC.BIT32&&b.advance(4)}}return s}function o(a){return a>=0?a:4294967296+a}g.decodeProtobuf=a;g.decodeProtobufWithUnknowns=b;g.getUnknownFields=e}),98);
__d("encodeProtobuf",["WABinary","WAHex","WAProtoCompile","WAProtoConst","WAProtoUtils","WAProtoValidate"],(function(a,b,c,d,e,f,g){"use strict";var h=void 0,i=128;function a(a,b,c){c===void 0&&(c=new(d("WABinary").Binary)());d("WAProtoValidate").checkValid(a,b);o(c,b,a);h=void 0;return c}function b(){return h!==void 0?"Last encoded value for "+h:"No information known"}function c(a,b){a.writeVarInt(b)}function e(a,b){if(typeof b==="number"&&b<4503599627370496&&b>=-4503599627370496)a.writeVarInt(b>=0?2*b:2*-b-1);else{var c=new(d("WABinary").Binary)(),e;typeof b==="number"?(e=b<0,c.writeVarInt(e?-b:b)):(e=d("WAHex").hexLongIsNegative(b),c.writeVarIntFromHexLong(e?d("WAHex").negateHexLong(b):b));b=c.peek(function(){return c.readByteArray()});var f=b.byteLength;if(e){var g=0,h;do h=b[g],b[g]=h&i|(h&127)-1&127,g++;while(b[g-1]===255)}h=e?1:0;for(g=0;g<f;g++){e=b[g];var j=e&i|(e&63)<<1|h;h=(e&64)>>6;b[g]=j}h===1&&(b[f-1]|=i,c.writeInt8(1));a.writeBinary(c)}}function f(a,b){typeof b==="number"?a.writeVarInt(b):a.writeVarIntFromHexLong(b)}function j(a,b){a.writeVarInt(d("WABinary").numUtf8Bytes(b)),a.writeString(b)}function k(a,b){a.writeVarInt(b.byteLength),a.writeBuffer(b)}function l(a,b,c){a.writeWithVarIntLength(function(a,b){return o(a,b,c)},b)}var m=[void 0,c,f,c,f,e,e,function(a,b){a.writeVarInt(b?1:0)},c,function(a,b){typeof b==="number"?a.writeUint64(b,!0):a.writeHexLong(b,!0)},function(a,b){typeof b==="number"?a.writeInt64(b,!0):a.writeHexLong(b,!0)},function(a,b){a.writeFloat64(b,!0)},j,k,l,function(a,b){a.writeUint32(b,!0)},function(a,b){a.writeInt32(b,!0)},function(a,b){a.writeFloat32(b,!0)}];f=function(a){if(a==null)return void 0;var b=a;function c(a,c){for(var d=0;d<c.length;d++)b(a,c[d])}return function(a,b){a.writeWithVarIntLength(c,b)}};var n=m.map(f);function o(a,b,c){var e=d("WAProtoCompile").compileSpec(c),f=e.names,g=e.fields,i=e.types;e=e.meta;c=c.internalDefaults;for(var j=0;j<f.length;j++){var k=f[j],l=b[k];l==null&&c&&(l=c[k]);if(l!=null){h=k;k=g[j];var o=i[j],p=o&d("WAProtoConst").TYPE_MASK,q=e[j];k=k*8|d("WAProtoUtils").typeToEncType(o);if(o&d("WAProtoConst").FLAGS.PACKED){if(l.length>0){a.writeVarInt(k);var r=n[p];r(a,l,q)}}else if(o&d("WAProtoConst").FLAGS.REPEATED)for(r=0;r<l.length;r++){a.writeVarInt(k);o=m[p];o(a,l[r],q)}else if(p===d("WAProtoConst").TYPES.MAP)for(var o=l,r=Array.isArray(o),s=0,o=r?o:o[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var t;if(r){if(s>=o.length)break;t=o[s++]}else{s=o.next();if(s.done)break;t=s.value}t=t;var u=t[0];t=t[1];a.writeVarInt(k);var v=q[0],w=q[1],x=typeof w==="object"?d("WAProtoConst").TYPES.MESSAGE:w,y=m[v],z=m[x];if(y==null||z==null)throw new Error("Invalid encoder for map key/value");var A=new(d("WABinary").Binary)(),B=1*8|d("WAProtoUtils").typeToEncType(v);A.writeVarInt(B);y(A,u,v);B=2*8|d("WAProtoUtils").typeToEncType(x);A.writeVarInt(B);z(A,t,w);a.writeVarInt(A.size());a.writeBinary(A)}else{a.writeVarInt(k);y=m[p];y(a,l,q)}}}}g.encodeProtobuf=a;g.encodeErrorInfo=b}),98);
__d("WAMediaUtils",["WACryptoDependencies","WADirectPath","WAGlobals","WALongInt","WAMediaEntryData.pb","WAProgressiveJpegGetScanLengths","WAResultOrError","WAServerMediaType","WATimeUtils","decodeProtobuf","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=new Uint8Array(32);d("WACryptoDependencies").getCrypto().getRandomValues(a);return a.buffer}function i(a){return a}function a(){return h()}function j(a){return a}function k(a){return a}function b(a){return a}function e(a){return a}function f(a,b){a=d("decodeProtobuf").decodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,b);b=a.fileSha256;var c=a.mediaKey,e=a.fileEncSha256,f=a.directPath,g=a.mediaKeyTimestamp,h=a.sidecar,i=a.objectId,j=a.fbid,l=a.serverMediaType,m=a.downloadableThumbnail,n=a.filename,o=a.progressiveJpegDetails;a=a.size;f=d("WADirectPath").validateDirectPath(f);return{fileSha256:b,mediaKey:c,fileEncSha256:e,directPath:f.success?f.value:null,mediaKeyTimestamp:d("WALongInt").maybeNumberOrThrowIfTooLarge(g),sidecar:h&&k(h),objectId:i,fbid:j,downloadableThumbnail:m==null?void 0:{directPath:m.directPath,fileEncSha256:m.fileEncSha256,fileSha256:m.fileSha256,mediaKey:m.mediaKey,mediaKeyTimestamp:d("WALongInt").maybeNumberOrThrowIfTooLarge(m.mediaKeyTimestamp),objectId:m.objectId},serverMediaType:l,filename:n,progressiveJpegDetails:o&&s(o),size:a==null?void 0:d("WALongInt").numberOrThrowIfTooLarge(a)}}function l(a){var b=a.fileSha256,c=a.fileEncSha256,e=a.mediaKey,f=a.directPath,g=a.mediaKeyTimestamp,h=a.serverMediaType,i=a.objectId,j=a.fbid,k=a.downloadableThumbnail,l=a.filename,m=a.progressiveJpegDetails;a=a.size;b=d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,{fileSha256:b,fileEncSha256:c,mediaKey:e,directPath:f,mediaKeyTimestamp:g,serverMediaType:h,objectId:i,fbid:j,downloadableThumbnail:k,filename:l,progressiveJpegDetails:m,size:a});return b.readByteArray()}function m(a){return d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,a).readByteArray()}function n(a,b){return d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,babelHelpers["extends"]({},a,{directPath:b})).readByteArray()}function o(a,b){return d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,babelHelpers["extends"]({},a,{downloadableThumbnail:babelHelpers["extends"]({},a.downloadableThumbnail,{directPath:b})})).readByteArray()}function p(a,b){a=babelHelpers["extends"]({},a,{fbid:b});return d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,a).readByteArray()}function q(a,b){a=babelHelpers["extends"]({},a,{objectId:b});return d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,a).readByteArray()}function r(a){if(a==null)return null;a.$$unknownFieldCount;var b=a.directPath,c=a.objectId,e=babelHelpers.objectWithoutPropertiesLoose(a,["$$unknownFieldCount","directPath","objectId"]);b=d("WADirectPath").validateDirectPath(b);return babelHelpers["extends"]({},e,{directPath:b.success?b.value:null,objectId:c,mediaKey:a.mediaKey&&i(a.mediaKey),mediaKeyTimestamp:a.mediaKeyTimestamp==null?null:d("WATimeUtils").castToUnixTime(d("WALongInt").numberOrThrowIfTooLarge(a.mediaKeyTimestamp))})}function s(a){if(a==null)return null;return a.scanLengths==null||a.sidecar==null?null:{sidecar:a.sidecar,scanLengths:a.scanLengths.map(function(a){return d("WAProgressiveJpegGetScanLengths").asProgressiveJpegScanLength(d("WALongInt").numberOrThrowIfTooLarge(a))})}}function t(a){a=d("decodeProtobuf").decodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,a);var b=a.serverMediaType,c=a.mediaKey,e=a.mediaKeyTimestamp,f=a.uploadToken,g=a.downloadableThumbnail,h=a.progressiveJpegDetails,k=a.size,l=a.lastDownloadAttemptTimestamp,m=a.sidecar,n=a.directPath,o=a.objectId;a=babelHelpers.objectWithoutPropertiesLoose(a,["serverMediaType","mediaKey","mediaKeyTimestamp","uploadToken","downloadableThumbnail","progressiveJpegDetails","size","lastDownloadAttemptTimestamp","sidecar","directPath","objectId"]);var p=null;h!=null&&h.scanLengths!=null&&h.sidecar!=null&&(p={sidecar:h.sidecar,scanLengths:h.scanLengths.map(function(a){return d("WAProgressiveJpegGetScanLengths").asProgressiveJpegScanLength(d("WALongInt").numberOrThrowIfTooLarge(a))})});h=d("WADirectPath").validateDirectPath(n);return babelHelpers["extends"]({},a,{objectId:o,directPath:h.success?h.value:void 0,sidecar:m,serverMediaType:b==null?null:d("WAServerMediaType").castToServerMediaType(b),mediaKey:c&&i(c),mediaKeyTimestamp:e==null?null:d("WATimeUtils").castToUnixTime(d("WALongInt").numberOrThrowIfTooLarge(e)),uploadToken:f&&j(f),progressiveJpegDetails:p,downloadableThumbnail:g&&r(g),size:d("WALongInt").maybeNumberOrThrowIfTooLarge(k),lastDownloadAttemptTimestamp:l==null?null:d("WATimeUtils").castToUnixTime(d("WALongInt").numberOrThrowIfTooLarge(l))})}function u(a){var b=a.directPath,c=a.fileEncSha256,e=a.fileSha256,f=a.mediaKey,g=a.serverMediaType;if(f==null)return d("WAResultOrError").makeError("media-entry-invalid-media-key");else if(b==null)return d("WAResultOrError").makeError("media-entry-invalid-direct-path");else if(c==null)return d("WAResultOrError").makeError("media-entry-invalid-file-enc-sha256");else if(e==null)return d("WAResultOrError").makeError("media-entry-invalid-file-sha256");else if(g==null)return d("WAResultOrError").makeError("media-entry-invalid-server-media-type");return d("WAResultOrError").makeResult(babelHelpers["extends"]({},a,{directPath:b,fileEncSha256:c,fileSha256:e,mediaKey:f,serverMediaType:g}))}function v(a){var b=a.directPath,c=a.fileEncSha256,e=a.fileSha256,f=a.mediaKey,g=[];f==null?g.push("media-entry-invalid-media-key"):b==null?g.push("media-entry-invalid-direct-path"):c==null?g.push("media-entry-invalid-file-enc-sha256"):e==null&&g.push("media-entry-invalid-file-sha256");return f!=null&&b!=null&&c!=null&&e!=null?d("WAResultOrError").makeResult(babelHelpers["extends"]({},a,{directPath:b,fileEncSha256:c,fileSha256:e,mediaKey:f})):d("WAResultOrError").makeError(g)}function w(a){var b="image/jpeg";switch(a){case"image":b="image/jpeg";break;case"ptt":b="audio/wav";break;case"video":b="video/mp4";break;case"gif":b="image/gif";break;case"sticker":b="image/webp";break;case"preview":b="image/jpeg";break;case"document":b=d("WAGlobals").getConfig().isOctetStreamAttachmentMimeTypeEnabled()===!0?"application/octet-stream":"application/pdf";break;case"xma-image":b="image/jpeg";break;default:throw c("err")("Unsupported server media type: "+a)}return b}var x=function(){return"TransformStream"in self};g.createMediaKey=h;g.castToMediaKey=i;g.createUploadToken=a;g.castToUploadToken=j;g.castToStreamingSidecar=k;g.stringToDeliveryObjectId=b;g.stringToBackupEntFbid=e;g.mediaEntryDataToRawData=f;g.rawDataToMediaEntry=l;g.encodeMediaEntryForUpload=m;g.encodeMediaEntryWithUpdatedPath=n;g.encodeMediaEntryDownloadableThumbnailWithUpdatedPath=o;g.encodeMediaEntryWithUpdatedFbid=p;g.encodeMediaEntryWithUpdatedObjectId=q;g.convertMediaDownloadableThumbnailToDownloadableThumbnail=r;g.decodeMediaEntryData=t;g.validateDecodedMediaEntryForDownload=u;g.validateDownloadableThumbnailForDownload=v;g.getMimeTypeFromServerMediaType=w;g.isTransformStreamSupported=x}),98);
__d("MAWDbMedia",["I64","WAMediaUtils","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i="Image",j="Video",k="Ptt",l="Gif",m="Sticker",n="DocumentFile",o={DOCUMENT_FILE:n,GIF:l,IMAGE:i,PTT:k,STICKER:m,VIDEO:j};function a(a){return a}function b(a){return a}function c(a){return(h||(h=d("I64"))).of_float(a)}function e(a){return(h||(h=d("I64"))).to_float(a)}function f(a,b){a=a.mediaEntries.get(b);if(a==null)return d("WAResultOrError").makeError("missing-media-entry");b=d("WAMediaUtils").decodeMediaEntryData(a);a=b.serverMediaType;return a==null?d("WAResultOrError").makeError("missing-server-media-type"):d("WAResultOrError").makeResult(a)}g.IMAGE=i;g.VIDEO=j;g.PTT=k;g.GIF=l;g.STICKER=m;g.DOCUMENT_FILE=n;g.MEDIA_TYPE=o;g.convertNumberToMediaId=a;g.convertToMediaId64=b;g.convertMediaIdToMediaId64=c;g.convertMediaId64ToMediaId=e;g.getServerMediaType=f}),98);
__d("MAWEARDebugs",["FBLogger","MAWCryptoConsts","MAWCurrentUser","Promise","WATimeUtils","WebAsyncStorage","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i="MAWDbEncryption_S456130_"+d("MAWCurrentUser").getID();function a(a){var e=a.encryptionKey,f=a.incrementCreationCount,g=a.incrementDeletionCount;return new(h||(h=b("Promise")))(function(a,b){c("WebAsyncStorage").getItem(i,function(h,j){try{if(h!=null)return b(h);var k=(h=j)!=null?h:{};k.metadataCreationTime==null&&(k.metadataCreationTime=d("WATimeUtils").castToUnixTime(Date.now()/1e3));if(g===!0){k.deletionCount=((j=k.deletionCount)!=null?j:0)+1}if(f===!0){k.creationCount=((h=k.creationCount)!=null?h:0)+1}if(e!=null){var l;j="version_"+e.version;h=e.dbEntry.seed;k[j]=(l=k[j])!=null?l:{seeds:[]};k[j].seeds.includes(h)||k[j].seeds.push(h)}c("WebAsyncStorage").setItem(i,k,function(c){if(c!=null)return b(c);a(k)})}catch(a){b(a)}})})["catch"](function(a){throw c("FBLogger")("maw_db_ear").catching(a).mustfix("[S456130] Unable to update AsyncStorage metadata")})}function e(a,e){return new(h||(h=b("Promise")))(function(f,g){c("WebAsyncStorage").getItem(i,function(){var h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,h){if(b!=null)return g(b);try{var i;if(h==null||e==null)return c("FBLogger")("maw_db_ear").info("[S456130] Failed to access logging metadata: result %s - encryptionKey %s",Boolean(h),Boolean(e));b="version_"+e.version;c("FBLogger")("maw_db_ear").info("[S456130] Encryption key version %s analysis: seeds array length %s - keyFound %s - deletionCount %s - creationCount %s - trusted %s - errName %s",e.version,(i=h[b])==null?void 0:i.seeds.length,(i=h[b])==null?void 0:i.seeds.includes(e.dbEntry.seed),h.deletionCount,h.creationCount,h.metadataCreationTime==null?!1:h.metadataCreationTime<=e.dbEntry.expiration-d("MAWCryptoConsts").ENC_KEY_TTL,a.name);f()}catch(a){g(a)}});return function(a,b){return h.apply(this,arguments)}}())})}g.touchDbEncryptionKeyVersion_S456130=a;g.analyseEncryptionKeyResult_S456130=e}),98);
__d("MAWSendQplToServer",["BrowserLockManager","ExecutionEnvironment","MAWEBSwitch","QPLUserFlow","WAExceededStorageQuota","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,d,e){c("QPLUserFlow").start(a,{annotations:babelHelpers["extends"]({},b||{},{bool:babelHelpers["extends"]({},(b==null?void 0:b.bool)||{},{is_eb_enabled:c("MAWEBSwitch").isEnabled(),isDev:0,isFromUIThread:(h||(h=c("ExecutionEnvironment"))).isInMainThread,isGifSearchEnbled:!0,isLockApiSupported:c("BrowserLockManager")!=null,processAcksInOneQueue:c("gkx")("23955"),useSharedWorker:"SharedWorkerGlobalScope"in self&&self instanceof self.SharedWorkerGlobalScope})}),instanceKey:d,timeoutInMs:e});return i(a,d)}function i(a,b){return{addAnnotations:function(d){c("QPLUserFlow").addAnnotations(a,d,{instanceKey:b})},addPoint:function(d,e){e&&c("QPLUserFlow").addAnnotations(a,e,{instanceKey:b}),c("QPLUserFlow").addPoint(a,d,{instanceKey:b})},endCancel:function(e){var f;c("QPLUserFlow").addAnnotations(a,babelHelpers["extends"]({},e,{bool:babelHelpers["extends"]({},e==null?void 0:e.bool,{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}),string:babelHelpers["extends"]({},e==null?void 0:e.string,{threadID:e==null?void 0:(f=e.string)==null?void 0:f.jid})}),{instanceKey:b});c("QPLUserFlow").endCancel(a,{annotations:e,instanceKey:b})},endFail:function(e,f){var g;c("QPLUserFlow").addAnnotations(a,babelHelpers["extends"]({},f,{bool:babelHelpers["extends"]({},f==null?void 0:f.bool,{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}),string:babelHelpers["extends"]({},f==null?void 0:f.string,{threadID:f==null?void 0:(g=f.string)==null?void 0:g.jid})}),{instanceKey:b});c("QPLUserFlow").endFailure(a,e,{annotations:f,instanceKey:b})},endSuccess:function(e){c("QPLUserFlow").addAnnotations(a,{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}},{instanceKey:b}),c("QPLUserFlow").endSuccess(a,{annotations:e,instanceKey:b})},markError:function(d,e,f){return c("QPLUserFlow").markError(a,d,{debugInfo:e,error:f,instanceKey:b})}}}g.startQplUserFlow=a;g.makeMAWQPLProxyForExistingQPLUserFlow=i}),98);
__d("MAWQplProxy",["Deferred","ExecutionEnvironment","MAWBridge","MAWSendQplToServer","QPLEvent","asyncToGeneratorRuntime","gkx","justknobx","performanceAbsoluteNow","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=(h=c("gkx")("23949"))!=null?h:!1,m=new Set([25313175,25310776,1056839232,1056847537,521478596,521479468,521476165,521480391]),n=0,o=(j||(j=c("performanceAbsoluteNow")))()-Date.now();function p(){return Date.now()}var q=new(c("Deferred"))();h=function(){q.resolve()};function r(a,b,e,f,g){f===void 0&&(f=!1),c("promiseDone")(q.getPromise(),function(){return d("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{name:b,type:"point"},annotations:e==null?void 0:e.annotations,event:a,instanceKey:e==null?void 0:e.instanceKey,performanceAndDateSkew:o,timestamp:f?p():void 0},!0,void 0,g)})}function a(a,b,c,d,e){t(a,{bool:(a={},a[b]=c,a)},d,e)}function e(a,b,c,d,e){t(a,{string:(a={},a[b]=c,a)},d,e)}function f(a,b,c,d,e){t(a,{"int":(a={},a[b]=c,a)},d,e)}function s(a,b,c,d){t(a,{"double":b},c,d)}function t(a,b,e,f){c("promiseDone")(q.getPromise(),function(){return d("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{type:"annotations"},annotations:b,event:a,instanceKey:e},!0,void 0,f)})}function u(a,b,e,f,g){g===void 0&&(g=!1);var h=p();c("promiseDone")(q.getPromise(),function(){return d("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{name:b,type:"failure"},annotations:e,event:a,instanceKey:f,timestamp:g?h:void 0},!0)})}function v(a,b,e,f){f===void 0&&(f=!1);var g=p();c("promiseDone")(q.getPromise(),function(){return d("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{type:"success"},annotations:b,event:a,instanceKey:e,timestamp:f?g:void 0},!0)})}function w(a,b,e,f){f===void 0&&(f=!1);var g=p();c("promiseDone")(q.getPromise(),function(){return d("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{type:"cancel"},annotations:b,event:a,instanceKey:e,timestamp:f?g:void 0},!0)})}function x(a,b,e){c("promiseDone")(q.getPromise(),function(){return d("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{name:b,type:"error"},debugInfo:e==null?void 0:e.debugInfo,error:e==null?void 0:e.error,event:a,instanceKey:e==null?void 0:e.instanceKey},!0)})}function y(a,b,c,d,e){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d,e){r(a,b+"_start",{annotations:d,instanceKey:e});d=(yield c());r(a,b+"_end",{instanceKey:e});return d});return z.apply(this,arguments)}var A=c("justknobx")._("2596");function B(a,b,e,f,g){g===void 0&&(g=!1);e==null&&n++;var h=(e=e)!=null?e:n,i=(e=f)!=null?e:A;if(!(k||(k=c("ExecutionEnvironment"))).isInWorker||!D(a))return d("MAWSendQplToServer").startQplUserFlow(a,b,h,i);c("promiseDone")(q.getPromise(),function(){return d("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{type:"start"},annotations:babelHelpers["extends"]({},b||{},{bool:babelHelpers["extends"]({},(b==null?void 0:b.bool)||{})}),event:a,instanceKey:h,timeoutInMs:i,timestamp:g?p():void 0},!0)});return{addAnnotations:function(b){return t(a,b,h)},addPoint:function(b,c){return r(a,b,{annotations:c,instanceKey:h})},endCancel:function(b){return w(a,b,h)},endFail:function(b,c){return u(a,b,c,h)},endSuccess:function(b){return v(a,b,h)},markError:function(b,c,d){return x(a,b,{debugInfo:c,error:d,instanceKey:h})}}}function C(a,b){return!(k||(k=c("ExecutionEnvironment"))).isInWorker||!D(a)?d("MAWSendQplToServer").makeMAWQPLProxyForExistingQPLUserFlow(a,b):{addAnnotations:function(c){return t(a,c,b)},addPoint:function(c,d){return r(a,c,{annotations:d,instanceKey:b})},endCancel:function(c){return w(a,c,b)},endFail:function(c,d){return u(a,c,d,b)},endSuccess:function(c){return v(a,c,b)},markError:function(c,d,e){return x(a,c,{debugInfo:d,error:e,instanceKey:b})}}}function D(a){return l||m.has((i||(i=d("QPLEvent"))).getMarkerId(a))}g.performanceAbsoluteNow=p;g.resolveWorkerBridge=h;g.sendQplPointThroughBridge=r;g.sendQPLBoolAnnotationThroughBridge=a;g.sendQPLStringAnnotationThroughBridge=e;g.sendQPLIntAnnotationThroughBridge=f;g.sendQPLDoubleAnnotationsThroughBridge=s;g.sendQPLAnnotationsThroughBridge=t;g.sendQPLFailThroughBridge=u;g.sendQPLSuccessThroughBridge=v;g.sendQPLCancelThroughBridge=w;g.sendQPLErrorThroughBridge=x;g.measurePerfInQPL=y;g.DEFAULT_WORKER_QPL_TIMEOUT_MS=A;g.startQplUserFlow=B;g.makeQplUserFlowFromExistedInstance=C}),98);
__d("MWEBODSEntityName.enum",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({MW_EB_PIN_RESTORE_AUTH:"mw_eb_pin_restore_auth",MW_EB_RC_RESTORE_AUTH:"mw_eb_rc_restore_auth",MW_EB_AUTO_RESTORE_AUTH:"mw_eb_auto_restore_auth",MW_EB_OTC_AUTH:"mw_eb_otc_auth",MW_EB_ONBOARDING_AUTH:"mw_eb_onboarding_auth",MW_EBSM_HYDRATION:"mw_ebsm_hydration",MW_EBSM_IDB:"mw_eb_ebsm_idb",MW_EBSM_CORRUPTION:"mw_ebsm_corruption",MW_EBSM_RESTORE_PERSISTENCE_ERROR:"mw_ebsm_restore_persistence",MW_EBSM_IDB_TABLE_DELETION:"mw_ebsm_idb_table_deletion",MW_EB_SWITCH_CONSISTENCY:"mw_eb_switch_consistency",MAW_EB_UPLOAD_TRACKING:"maw_eb_upload_tracking",MAW_EB_UPLOAD_COUNTER:"maw_eb_upload_counter",MAW_EB_RESTORE_COUNTER:"maw_eb_restore_counter"});c=a;f["default"]=c}),66);
__d("MAWEBRestoreTrackingUtils",["LSIntEnum","LSMEBTaskCreationSource","MAWQplProxy","MWEBODSEntityName.enum","ODS","QPLUserFlow","WAHashStringToNumber","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j={dyi:c("justknobx")._("467"),frontloaded:20,initial:20,paginated:c("justknobx")._("3177"),point:1,search:c("justknobx")._("2477")};function a(a,b,e,f){if(b!=null){p({querySource:e,runningInWorker:(e=f)!=null?e:!1,taskSource:a,traceId:b,triggerType:"paginated"})}(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.paginated")}function b(a){var b=a.querySource,e=a.runningInWorker,f=a.taskSource;a=a.traceId;if(a!=null){p({querySource:b,runningInWorker:(b=e)!=null?b:!1,taskSource:f,traceId:a,triggerType:"initial"})}(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.initial")}function e(a,b,e){if(b!=null){p({querySource:"LS",runningInWorker:(e=e)!=null?e:!1,taskSource:a,traceId:b,triggerType:"dyi"})}(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.dyi")}function f(a,b,e){if(b!=null){p({querySource:"LS",runningInWorker:(e=e)!=null?e:!1,taskSource:a,traceId:b,triggerType:"frontloaded"})}(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.frontloaded")}function k(a,b,e,f){if(b!=null){p({querySource:e,runningInWorker:(e=f)!=null?e:!1,taskSource:a,traceId:b,triggerType:"point"})}(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.point")}function l(a){var b=a.querySource,e=a.runningInWorker;a=a.traceId;if(a!=null){p({querySource:b,runningInWorker:(b=e)!=null?b:!1,taskSource:c("LSMEBTaskCreationSource").FTS_INDEX_EB_MESSAGES_WEB,traceId:a,triggerType:"search"})}(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.search")}function m(a,b){a!=null&&(b!=null&&b?d("MAWQplProxy").sendQPLSuccessThroughBridge(c("qpl")._(521476165,"2432"),void 0,d("WAHashStringToNumber").hashStringToNumber(a)):c("QPLUserFlow").endSuccess(c("qpl")._(521476165,"2432"),{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})),(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.decryption.success")}function n(a,b,e,f){e===void 0&&(e="restore_failure"),a!=null&&(b!=null&&b?d("MAWQplProxy").sendQPLFailThroughBridge(c("qpl")._(521476165,"2432"),e,f,d("WAHashStringToNumber").hashStringToNumber(a)):c("QPLUserFlow").endFailure(c("qpl")._(521476165,"2432"),e,{annotations:f,instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})),(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.decryption.failure")}function o(a){u("protobuf",a)}function p(a){var b=a.querySource,e=a.runningInWorker,f=a.taskSource,g=a.traceId;a=a.triggerType;if(e!=null&&e){var h;d("MAWQplProxy").startQplUserFlow(c("qpl")._(521476165,"2432"),{bool:{runningInWorker:(h=e)!=null?h:!1},"int":{requestedMessagesCount:(h=j[a])!=null?h:10},string:{querySource:b,taskSource:v(f),traceId:g,triggerType:a}},d("WAHashStringToNumber").hashStringToNumber(g),c("justknobx")._("2950"))}else{c("QPLUserFlow").start(c("qpl")._(521476165,"2432"),{annotations:{bool:{runningInWorker:(h=e)!=null?h:!1},"int":{requestedMessagesCount:(e=j[a])!=null?e:10},string:{querySource:b,taskSource:v(f),traceId:g,triggerType:a}},instanceKey:d("WAHashStringToNumber").hashStringToNumber(g),timeoutInMs:c("justknobx")._("2950")})}}function q(a){var b=a.pointName,e=a.traceId;a=a.type;c("QPLUserFlow").addAnnotations(c("qpl")._(521476165,"2432"),{string:{type:a}},{instanceKey:d("WAHashStringToNumber").hashStringToNumber(e)});c("QPLUserFlow").addPoint(c("qpl")._(521476165,"2432"),b,{instanceKey:d("WAHashStringToNumber").hashStringToNumber(e)})}function r(a){var b=a.annotations,e=a.pointName;a=a.traceId;c("QPLUserFlow").addAnnotations(c("qpl")._(521476165,"2432"),b,{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)});c("QPLUserFlow").addPoint(c("qpl")._(521476165,"2432"),e,{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})}function s(a){var b=a.annotations,e=a.pointName;a=a.traceId;a!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(521476165,"2432"),e,{annotations:b,instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})}function t(a){var b=a.pointName;a=a.traceId;d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(521476165,"2432"),b,{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})}function u(a,b){b=b?(i||(i=d("LSIntEnum"))).unwrapIntEnum(b):null;(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore."+a+"."+v(b))}function v(a){return(a=a==null?void 0:a.toString())!=null?a:"unknown"}g.markEBRestorePaginated=a;g.markEBRestoreInitial=b;g.markEBRestoreDYI=e;g.markEBRestoreFrontloaded=f;g.markEBRestorePoint=k;g.markEBRestoreSearch=l;g.markEBRestoreSuccess=m;g.markEBRestoreFail=n;g.markEBRestoreProtobuf=o;g.addQPLRestorePoint=q;g.addQPLRestorePointWithAnnotations=r;g.addQPLRestorePointWithAnnotationsWorker=s;g.addQPLRestorePointWorker=t}),98);
__d("MWEBODSEntityKey.enum",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({START:"start",SUCCESS:"success",FAIL:"fail",INCORRECT_PIN_CODE:"incorrect_pin_code",INCORRECT_RECOVERY_CODE:"incorrect_recovery_code",TIMEOUT:"timeout"});c=a;f["default"]=c}),66);
__d("MWEBODSCategory",[],(function(a,b,c,d,e,f){"use strict";a=7319;f["default"]=a}),66);
__d("MWEBODSUtils",["CurrentMessengerUser","MWEBODSCategory","ODS"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e){var f=d("CurrentMessengerUser").getAppID();f=f!=null?f.toString():"unknown";f=a+"."+f;(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),f,b,(f=e)!=null?f:1);h.bumpEntityKey(c("MWEBODSCategory"),a,b,(f=e)!=null?f:1)}function b(a,b,c){b===void 0&&(b=100);c===void 0&&(c=5);if(a===0)return"zero";if(a<0)return"negative";if(c<=0)return"invalidIncrement";if(a>b)return"greaterThanLimit";a=Math.floor((a-1)/c)*c+1;c=Math.min(a+c-1,b);return a+"-"+c}g.markODSForEB=a;g.getBucketName=b}),98);
__d("WAGetHashFromProtocolMsgId",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a.externalId+"_"+a.author+"_"+a.chat}f.getHashFromProtocolMsgId=a}),66);
__d("MAWEBUploadTrackingUtils",["MAWAckLevel","MAWEBSwitch","MAWExternalId","MAWMsgType","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","MWEBODSUtils","ODS","QPLUserFlow","QuickPerformanceLogger","WAExceededStorageQuota","WAGetHashFromProtocolMsgId","WAGlobals","WAHashStringToNumber","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j={ERROR_FETCHING_DB_MESSAGE:"error_fetching_db_message",FAILED_TO_ACK_MESSAGE:"failed_to_ack_message",FAILED_TO_CONSTRUCT_ECHO_MESSAGE:"failed_to_construct_echo_message",MESSAGE_UPLOAD_TIMEOUT:"message_upload_timeout",RUNTIME_ERROR:"runtime_error"};function a(a,b,e,f,g,h,j,l,m){g===void 0&&(g=!1);h===void 0&&(h=!1);l===void 0&&(l="unknown");m===void 0&&(m=0);if(!c("MAWEBSwitch").isEnabled())return;c("QPLUserFlow").start(c("qpl")._(521481602,"829"),{annotations:{bool:{eb_switch:c("MAWEBSwitch").isEnabled(),eb_upload_queue:!0,fromUploadQueue:g,is_retroactive_upload:h,middleware_init:!1},"int":{attachmentsSize:(g=j)!=null?g:0,instanceKey:f,retryCount:m},string:{externalId:a,msgType:b,payloadType:l,triggerType:e}},instanceKey:f,timeoutInMs:c("justknobx")._("1405")});k(f,"upload_tracking_started");(i||(i=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,c("MWEBODSEntityKey.enum").START);d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload."+((h=b)!=null?h:"unknown"));g=d("MAWMsgType").isMAWSupportedMediaType((j=b)!=null?j:"Text")?"media":"non-media";d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload."+g)}function b(a,b,c,d){switch(a){case"success":m(b,c,d);break;case"fail":l(b,c,d);break;case"point":k(b,c,d);break}}function k(a,b,d){d&&c("QPLUserFlow").addAnnotations(c("qpl")._(521481602,"829"),d,{instanceKey:a}),c("QPLUserFlow").addPoint(c("qpl")._(521481602,"829"),b,{instanceKey:a})}function l(a,b,e){e&&c("QPLUserFlow").addAnnotations(c("qpl")._(521481602,"829"),e,{instanceKey:a});c("QPLUserFlow").endFailure(c("qpl")._(521481602,"829"),b,{annotations:{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0},string:{threadID:e==null?void 0:(b=e.string)==null?void 0:b.jid}},instanceKey:a});(i||(i=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,c("MWEBODSEntityKey.enum").FAIL)}function m(a,b,e){k(a,b),e&&c("QPLUserFlow").addAnnotations(c("qpl")._(521481602,"829"),e,{instanceKey:a}),c("QPLUserFlow").endSuccess(c("qpl")._(521481602,"829"),{annotations:{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}},instanceKey:a}),(i||(i=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,c("MWEBODSEntityKey.enum").SUCCESS)}function e(a,b,e){k(a,b);e&&c("QPLUserFlow").addAnnotations(c("qpl")._(521481602,"829"),e,{instanceKey:a});c("QPLUserFlow").endTimeout(c("qpl")._(521481602,"829"),{annotations:{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0},string:{threadID:e==null?void 0:(b=e.string)==null?void 0:b.jid}},instanceKey:a});(i||(i=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,c("MWEBODSEntityKey.enum").TIMEOUT)}function f(a,b,d){var e=c("qpl")._(521481602,"829");k(a,b);d&&(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(e,d,{instanceKey:a});(h||(h=c("QuickPerformanceLogger"))).markerEnd(e,52,a,h.currentTimestamp())}function n(){return d("WAHashStringToNumber").hashStringToNumber(d("MAWExternalId").generateExternalId())}function o(a,b){b===void 0&&(b=0);return d("WAHashStringToNumber").hashStringToNumber(d("WAGetHashFromProtocolMsgId").getHashFromProtocolMsgId(a)+"_"+d("WAGlobals").getMyDeviceJid()+"_"+b)}function p(a){return c("MAWEBSwitch").isEnabled()&&d("MAWMsgType").isEBSupportedMsgType(a.type)&&a.ack>=d("MAWAckLevel").ACK.sent&&a.serverTs!=null&&!(a.ephemeralSetting!=null&&a.ephemeralSetting.ephemeralExpirationInSec>0)}g.EBUploadTrackingWorkerFailurePoints=j;g.startUploadTracking=a;g.handleBridgeEbUploadTrackingQPL=b;g.addPointWorkerOnly=k;g.endFailWorkerOnly=l;g.endSuccessWorkerOnly=m;g.endTimeoutWorkerOnly=e;g.endRetryWorkerOnly=f;g.genInstanceKeyOnly=n;g.genInstanceKeyForUploadQueue=o;g.isUploadSupported=p}),98);
__d("MAWIndexedDbMetadata",[],(function(a,b,c,d,e,f){"use strict";var g="v1",h="v1",i="v1",j="v1",k="v1",l="v1",m="v1",n="messenger_web_"+g,o="messenger_web_v3",p="messenger_web_encryption_"+h,q="messenger_web_signal_"+i,r="messenger_web_signal_v3",s="messenger_web_log_"+j,t="messenger_web_eb_lsdb_"+k,u="messenger_web_ebdb_"+m,v="messenger_web_fts_"+l;function a(a){return n+"_"+a}function b(a){return v+"_"+a}function c(a){return o+"_"+a}function d(a){return p+"_"+a}function e(a){return q+"_"+a}function w(a){return r+"_"+a}function x(a){return"reverb_"+a+"_DEV"}function y(a){return s+"_"+a}function z(a){return t+"_"+a}function A(a){return u+"_"+a}f.dbName=a;f.ftsDbName=b;f.restoreDbName2=c;f.encryptionDbName=d;f.jobsDbName=e;f.signalWorm=w;f.webReverDbbName=x;f.logDbName=y;f.ebLSDBName=z;f.ebdbName=A}),66);
__d("MAWIndexedDBDeletion",["CurrentMessengerUser","FBLogger","MAWIndexedDbMetadata","Promise","asyncToGeneratorRuntime","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,d){return indexedDB==null||a==null?(h||(h=b("Promise"))).resolve():new(h||(h=b("Promise")))(function(b,e){var f=indexedDB.deleteDatabase(a);f.onsuccess=function(){c("FBLogger")("maw_db").warn("%s db was deleted",d),b()};f.onblocked=function(){c("recoverableViolation")("Cannot delete "+d+" db: blocked. Make sure DB is closed.","maw_db")};f.onerror=function(){c("recoverableViolation")("Cannot delete "+d+" db","maw_db"),e(f.error)}})}function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("CurrentMessengerUser").getID();yield (h||(h=b("Promise"))).all([i(d("MAWIndexedDbMetadata").dbName(a),"maw_v1"),i(d("MAWIndexedDbMetadata").restoreDbName2(a),"maw_v3"),i(d("MAWIndexedDbMetadata").jobsDbName(a),"signal"),i(d("MAWIndexedDbMetadata").logDbName(a),"logDb")])});return j.apply(this,arguments)}g.deleteDB=i;g.deleteMAWPersistence=a}),98);
__d("MAWLocalStorage",["LocalStorageWrapper","MWLocalStorageErrorHandler","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["not storage found"]);h=function(){return a};return a}function i(a){d("WALogger").LOG([a])}function j(a){d("WALogger").ERROR([a])}function a(){return d("LocalStorageWrapper").getStorage(i)}function b(){return d("LocalStorageWrapper").isLocalStorageAvailable(i)}function c(a,b,c){return d("LocalStorageWrapper").setItemGuarded(a,b,c,j,d("MWLocalStorageErrorHandler").onQuotaExceeded)}function e(a,b){a==null?d("WALogger").ERROR(h()):a.removeItem(b)}g.getStorage=a;g.isLocalStorageAvailable=b;g.setItemGuarded=c;g.removeItemGuarded=e}),98);
__d("MWTabCommunicationChannel",["MAWLocalStorage"],(function(a,b,c,d,e,f,g){"use strict";var h=typeof window!=="undefined"?window:self;function i(a){var b=d("MAWLocalStorage").getStorage(),c=function(c){d("MAWLocalStorage").setItemGuarded(b,a,JSON.stringify(c))},e=function(c){window.removeEventListener("storage",c),d("MAWLocalStorage").removeItemGuarded(b,a)},f=function(a){window.addEventListener("storage",a)},g=function(b){return b!=null&&b.key===a&&typeof b.newValue==="string"?JSON.parse(b.newValue):null};return{getMessage:g,onRequestReceived:function(a){var b=function(b){b=g(b);b!=null&&a(b)};f(b);return{release:function(){e(b)}}},sendMessage:c,stopWaitingForReply:e,waitForReply:f}}function j(a){var b=new h.BroadcastChannel(a),c=new Set();b.addEventListener("message",function(a){c.forEach(function(b){b(a)})});var d=function(a){c.add(a)},e=function(a){c["delete"](a)};a=function(a){b.postMessage(JSON.stringify(a))};var f=function(a){return a!=null&&typeof a.data==="string"?JSON.parse(a.data):null};return{getMessage:f,onRequestReceived:function(a){var b=function(b){b=f(b);b!=null&&a(b)};d(b);return{release:function(){e(b)}}},sendMessage:a,stopWaitingForReply:e,waitForReply:d}}function a(a){return h.BroadcastChannel!=null?j(a):i(a)}g.getChannel=a}),98);
__d("MWTabCommunication",["MWTabCommunicationChannel","Promise","clearTimeout","pageID","promiseDone","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(a,b){var c=this;this.$2=null;this.$5=function(a){a=c.$4.getMessage(a);a!=null&&a.a==="sb"&&a.t!==c.tabID()&&a.r===c.tabID()&&a.k!=null&&(c.$2&&c.$2(a.k),c.$4.stopWaitingForReply(c.$5),c.$2=null)};this.$1=a;this.$3=b!=null?b:500;this.$4=d("MWTabCommunicationChannel").getChannel(a)}var e=a.prototype;e.tabID=function(){return c("pageID")};e.$6=function(){var a={a:"r",t:this.tabID()};this.$4.sendMessage(a)};e.listenToRequest=function(a){return this.listenToRequestAsync(function(){return(h||(h=b("Promise"))).resolve(a())})};e.listenToRequestAsync=function(a){var b=this,d=function(d){d.a==="r"&&d.t!==b.tabID()&&c("promiseDone")(a().then(function(a){a={a:"sb",k:a,r:d.t,t:b.tabID()};b.$4.sendMessage(a)}))};return this.$4.onRequestReceived(d)};e.$7=function(){var a=this;return new(h||(h=b("Promise")))(function(b){a.$2=b,a.$4.waitForReply(a.$5),a.$6()})};e.request=function(a,d){var e=this,f,g=function(){f!=null&&c("clearTimeout")(f)};return(h||(h=b("Promise"))).race([this.$7().then(function(b){e.$4.stopWaitingForReply(e.$5);return a(b)}),new h(function(a){f=c("setTimeout")(function(){a(d()),e.$4.stopWaitingForReply(e.$5)},e.$3)})]).then(function(a){g();return a})};return a}();g.MWTabCommunication=a}),98);
__d("MWEARKeychainV3",["$InternalEnum","Deferred","ExecutionEnvironment","FBLogger","LSPlatformLsInitLog","MAWCryptoConsts","MAWCurrentUser","MAWEARGenNewKeychainCryptoKey","MAWGenKeychainCryptoKeyWithVersion","MAWQplProxy","MAWReliabilityMonitor","MWEARKeychainV3Errors","MWTabCommunication","Promise","QPLUserFlow","Random","ReStoreTabNotifier","WAArrayBufferUtils","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","err","getErrorSafe","gkx","memoizeOneWithArgs","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(){return{accountKey:null,databaseEncryptionKeys:new Map(),dbReady:new(c("Deferred"))(),latestVersion:d("MAWCryptoConsts").VERSION}},k={global_ear:j(),maw_ear:j()},l=null,m=function(){var a=Object.keys(k).reduce(function(a,b){a[b]="none";return a},{});return{get:function(b){return a[b]},is:function(b,c){return a[b]===c},set:function(b,c){a[b]=c;(b=l)==null?void 0:b.updateState()}}}();function a(a){k[a]=j(),m.set(a,"none")}function e(a,b){m.set(a,b)}function n(a){var b=d("Random").uint32();while(a.some(function(a){return a.randomisedVersion===b}))b=d("Random").uint32();return b}var o={global_ear:function(){return null},maw_ear:function(){return null}},p=function(a){return o[a]()},q=function(a,b){o[a]=function(){return b}},r=function(a,b){q(a,b),x(a).dbReady.resolve()},s={global_ear:"browserEncryptionMetaV2",maw_ear:"encryptionMetaV3"},t=c("memoizeOneWithArgs")(function(a,b){return new(d("MWTabCommunication").MWTabCommunication)("ear_keys_"+b+"_"+a)});function f(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b===void 0&&(b=N);c("gkx")("9396")&&c("FBLogger")("maw_ear").info("Initialise EAR keychain: %s",a);l=K(a);if(m.is(a,"success")&&x(a).databaseEncryptionKeys.size!==0)return d("WAResultOrError").makeResult(w(a));var e=d("MAWCurrentUser").getID(),f=c("ReStoreTabNotifier")("channel-ear-keychain-v3-"+e);f.onEventReceive("notifyEarKeychainV2",G);b(a+"_ear_init_start");try{f=(yield L(f,a,void 0,b));b(a+"_ear_import_end");for(f of f)x(a).databaseEncryptionKeys.set(f.result.version,{dbEntry:f.entry,keys:f.result.keys});F(a);t(a,e).listenToRequest(function(){return JSON.stringify(Array.from(x(a).databaseEncryptionKeys.entries()).map(function(a){var b=a[0];a=a[1];var c=a.dbEntry;a=a.keys;return[b,{dbEntry:c,keys:a.map(function(a){return d("WAArrayBufferUtils").arrayBufferToString(a)})}]}))});f=(i||(i=c("ExecutionEnvironment"))).isInWorker?"Worker":"UI";b(a+"_ear_init_end",{string_array:(e={},e[a+"_randomisedVersionKeys"+f]=v(a).map(function(a){a[0];a=a[1].dbEntry;return String(a.randomisedVersion)}),e)});m.set(a,"success");return d("WAResultOrError").makeResult(w(a))}catch(e){m.set(a,"failure");b(a+"_ear_init_error");c("gkx")("9396")&&c("FBLogger")("messenger_e2ee_web").catching(c("getErrorSafe")(e)).mustfix("Failed to setup EAR Keychain V3. Namespace: %s",a);return d("WAResultOrError").makeError("keychain-setup-failure",e)}});return u.apply(this,arguments)}function v(a){return Array.from(x(a).databaseEncryptionKeys.entries())}function w(a){return x(a).latestVersion}function x(a){return k[a]}function y(a,b){var e=(b=b)!=null?b:w(a),f=x(a).databaseEncryptionKeys.get(e);if(f==null){c("promiseDone")(C(a).then(function(a){var b=a.map(function(a){return a.version}).includes(e);c("FBLogger")("messenger_e2ee_web").info("EAR Keychain DB match found: %s. Version = %s. NumberVersions = %s",b,e,a.length)}));b=w(a);var g=Array.from(x(a).databaseEncryptionKeys.keys());c("FBLogger")("messenger_e2ee_web").mustfix("EAR Key v%s was null. Latest version: %s has key: %s, keychain length: %s, currentLatestVersion: %s, init status %s, in worker %s",e,b,x(a).databaseEncryptionKeys.get(b)==null,x(a).databaseEncryptionKeys.size,Math.max.apply(Math,g),m.get(a),(i||(i=c("ExecutionEnvironment"))).isInWorker);throw new(d("MWEARKeychainV3Errors").EARKeychainNotFoundError)("EAR Key "+e+" was null.")}Math.random()<1/1e4&&c("promiseDone")(C(a).then(function(a){a=a.find(function(a){return e===a.version});if(a==null)return"key_not_found";return a.seed===f.dbEntry.seed?"key_match":"key_mismatch"}),function(a){c("FBLogger")("maw_ear").info("EAR Key consistency: %s",a)});return{dbEntry:f.dbEntry,keys:f.keys,randomisedVersion:f.dbEntry.randomisedVersion,version:e}}function z(a){return c("MAWGenKeychainCryptoKeyWithVersion")(a.key,a.seed,a.version,a.formatVersion,a.accountKeyString,a.userKeyBaseString,a.appIdOrigin)}var A=b("$InternalEnum")({UNKNOWN:-1,NO_KEY:0,EBSM_EARV2_UPGRADE:1,RANDOMISED_VERSION_UPGRADE:2,EXPIRED_KEY:3,FORCE_KEY_ROTATION:4});function B(a){var b;if(a.length===0)return{reason:A.NO_KEY,result:!0};a=a[a.length-1];b=(b=a.formatVersion)!=null?b:1;if(c("gkx")("7292")&&b<2)return{reason:A.EBSM_EARV2_UPGRADE,result:!0};b=a.randomisedVersion;if(b==null&&c("gkx")("8051"))return{reason:A.RANDOMISED_VERSION_UPGRADE,result:!0};return!d("WATimeUtils").isInFuture(a.expiration)?{reason:A.EXPIRED_KEY,result:!0}:{result:!1}}function C(a){var c=E(a,"readonly");return new(h||(h=b("Promise")))(function(b,d){c.onabort=function(){return d(c.error)};c.onerror=function(){return d(c.error)};var e=c.objectStore(s[a]).getAll();e.onsuccess=function(){return b(e.result)};e.onerror=function(){return d(e.error)}}).then(D)}function D(a){var b=a.find(function(a){return a.version==null});b!=null&&c("FBLogger")("messenger_e2ee_web").mustfix("EAR Keychain Rotation null version: fields nonnull: %s %s %s %s %s %s",b.id==null,b.key==null,b.seed==null,b.formatVersion==null,b.accountKeyString==null,b.userKeyBaseString==null);b=a.filter(function(a){return a.version!=null});return b.sort(function(a,b){return a.version-b.version})}function E(a,b){var d=p(a);if(d==null)throw c("err")("Encryption IndexDB should've been initialized. Namespace: %s",a);return d.transaction(s[a],b,{durability:"strict"})}var F=function(a){var b=Array.from(x(a).databaseEncryptionKeys.keys());b.length>0?x(a).latestVersion=Math.max.apply(Math,b):c("FBLogger")("messenger_e2ee_web").mustfix("EAR latest version does not exist")},G=function(a){var d=a.namespace,e=a.version;c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{c("FBLogger")("maw_ear").info("Received key rotation notification. Namespace: %s",d);c("gkx")("1630")&&(yield x(d).dbReady.getPromise());var a=(yield C(d)).find(function(a){return a.version===e});if(a==null)throw c("err")("Notified new Ear Key but missing in DB");var b=(yield z(a));x(d).databaseEncryptionKeys.set(b.version,{dbEntry:a,keys:b.keys});F(d);c("FBLogger")("maw_ear").info("Rotated key successfully. Namespace: %s",d)}catch(a){return c("FBLogger")("maw_ear").catching(a).mustfix("Failed to handleNewVersion. In worker %s. Namespace: %s.",(i||(i=c("ExecutionEnvironment"))).isInWorker,d)}})())};function H(a){return m.get(a)!=="none"}function I(a){return m.get(a)}function J(a){if(m.is(a,"success")){x(a).databaseEncryptionKeys.size===0&&c("FBLogger")("messenger_e2ee_web").mustfix("Keychain initialised but no keys present");return!0}return!1}function K(a){return d("MAWReliabilityMonitor").MAWReliabilityMonitorSingleton.startMonitoring("EARv3",function(){return{extra:{isKeychainInitialised:J(a).toString(),latestVersion:w(a).toString()},reason:m.get(a),state:function(){switch(m.get(a)){case"none":return d("MAWReliabilityMonitor").HealthReportState.PENDING;case"success":return d("MAWReliabilityMonitor").HealthReportState.OK;case"failure":return d("MAWReliabilityMonitor").HealthReportState.ERROR;default:return d("MAWReliabilityMonitor").HealthReportState.UNKNOWN}}()}})}function L(a,b,c,d){return M.apply(this,arguments)}function M(){M=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,d,e,f){var g=(yield c("MAWEARGenNewKeychainCryptoKey")());f(d+"_ear_raw_key_generated");var j=(yield new(h||(h=b("Promise")))(function(b,h){var j=E(d,"readwrite");j.onerror=function(){return h(j.error)};j.onabort=function(){return h(j.error)};var k=j.objectStore(s[d]).getAll();k.onerror=function(){return h(k.error)};k.onsuccess=function(){var l;f(d+"_ear_keys_fetched");var m=D(k.result),o=B(m),p=o.reason;o=o.result;if((e==null?void 0:e.forceKeyRotation)!==!0&&!o)return b(m);p=(e==null?void 0:e.forceKeyRotation)===!0?A.FORCE_KEY_ROTATION:(o=p)!=null?o:A.UNKNOWN;o=m.map(function(a){return a.version});l=(l=o[o.length-1])!=null?l:0;c("FBLogger")("messenger_e2ee_web").info("Key rotation. EAR versions: %s. Latest version: %s. Namespace: %s, Worker: %s",o.toString(),l,d,(i||(i=c("ExecutionEnvironment"))).isInWorker);var q=babelHelpers["extends"]({},g,{randomisedVersion:n(m),source:p,version:l+1});f(d+"_ear_adding_new_key");j.oncomplete=function(){m.push(babelHelpers["extends"]({},q,{id:q.version})),a.postMessage("notifyEarKeychainV2",{namespace:d,version:q.version}),f(d+"_ear_gen_key_end"),b(m)};var r=j.objectStore(s[d]).add(q);r.onerror=function(){return h(c("FBLogger")("messenger_e2ee_web").catching(r.error).mustfixThrow("Failed to rotate EAR key"))}}}));f(d+"_ear_import_start");j=(yield h.allSettled(j.map(function(a){return z(a).then(function(b){return{entry:a,result:b}})})));var k=j[j.length-1];if(k.status==="rejected"){var l;l=(l=e==null?void 0:e.corruptedEARRetryCount)!=null?l:0;if(l>=1)throw k.reason;return L(a,d,{corruptedEARRetryCount:l+1,forceKeyRotation:!0},f)}return j.map(function(a){if(a.status==="fulfilled")return a.value}).filter(Boolean)});return M.apply(this,arguments)}var N=function(a,b){d("LSPlatformLsInitLog").addPoint(a,b),O(a,b)},O=function(a,b){var e=c("qpl")._(25310776,"6155");(i||(i=c("ExecutionEnvironment"))).isInWorker?d("MAWQplProxy").sendQplPointThroughBridge(e,"backend_"+a,{annotations:b}):(c("QPLUserFlow").addPoint(e,"ui_"+a),b!=null&&c("QPLUserFlow").addAnnotations(e,b))},P=function(a,b){return t(a,b).request(function(b){b=JSON.parse(b);b.forEach(function(b){var c=b[0];b=b[1];var e=b.keys.map(d("WAArrayBufferUtils").stringToArrayBuffer);x(a).databaseEncryptionKeys.set(c,{dbEntry:b.dbEntry,keys:e})});F(a);m.set(a,"success");return!0},function(){return!1})};g.resetKeychain__TEST_ONLY_DO_NOT_USE=a;g.setInitStatus__TEST_ONLY_DO_NOT_USE=e;g.generateNewRandomisedVersionNumber=n;g.setNamespaceSourceDbWithoutMarkingDbReady=q;g.setNamespaceSourceDbAndMarkAsReady=r;g.getEncryptionKeysTabCommunication=t;g.init=f;g.getLatestVersion=w;g.getKeychain=x;g.getDbEncryptionKey=y;g.isKeychainSettled=H;g.getKeychainInitStatus=I;g.isKeychainInitialised=J;g.logMawInitPoint=O;g.importKeysFromOtherTab=P}),98);
__d("WAWorkerGlobalScope",[],(function(a,b,c,d,e,f){"use strict";a=function(){if(typeof window!=="undefined")return window;return typeof globalThis!=="undefined"?globalThis:self}();f.workerGlobalScope=a}),66);
__d("MAWEncryptionIndexedDbV2",["BrowserLockManager","EARInitType","ExecutionEnvironment","FBLogger","IndexedDbPolyfills","MAWCurrentUser","MAWEARDebugs","MAWIndexedDBDeletion","MAWIndexedDbMetadata","MAWQplProxy","MWEARKeychainV3","Promise","QPLUserFlow","WALogger","WAWorkerGlobalScope","err","gkx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Armadillo Web Remote Presence] MAW RP Initialising EAR"]);j=function(){return a};return a}b("IndexedDbPolyfills");var k="browserEncryptionMetaV2",l="version",m=1,n=null,o=null,p=null;function a(){return n}function e(){return n!=null}var q=function(b){babelHelpers.inheritsLoose(a,b);function a(){return b.apply(this,arguments)||this}return a}(babelHelpers.wrapNativeSuper(Error));function r(a,e){e===void 0&&(e=0);var f=d("MAWCurrentUser").getID(),g=c("gkx")("1030");if(e>m){u(a,"ear_idb_retry_failed_max_reached");return(i||(i=b("Promise"))).reject(new q())}if(n!=null){u(a,"ear_db_exists");return(i||(i=b("Promise"))).resolve()}if(indexedDB==null){u(a,"ear_idb_unavailable");return(i||(i=b("Promise"))).reject(c("err")("IndexedDB API not available"))}u(a,"ear_db_open_start",{bool:{browserLockEnabled:c("BrowserLockManager")!=null}});return new(i||(i=b("Promise")))(function(b,i){var j=function(c){r(a,e+1).then(b)["catch"](function(a){if(a instanceof q)return i(c);i(a)})};try{p=d("MAWIndexedDbMetadata").encryptionDbName(f);var m=indexedDB.open(p),t=d("WAWorkerGlobalScope").workerGlobalScope.setTimeout(function(){i(c("err")("IndexedDB initialisation timeout in %s flow, isInWorker: %s, openRequest: %s",String(a),(h||(h=c("ExecutionEnvironment"))).isInWorker?"true":"false",m.readyState))},g?6e4:1e4);m.onupgradeneeded=function(b){d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(t);u(a,"ear_db_upgrade_start");b=b.target.result;if(!b.objectStoreNames.contains(k)){b=b.createObjectStore(k,{autoIncrement:!0,keyPath:"id"});b.createIndex(l,l,{unique:!0})}u(a,"ear_db_upgrade_end");void d("MAWEARDebugs").touchDbEncryptionKeyVersion_S456130({incrementCreationCount:!0})};m.onblocked=function(){u(a,"ear_db_open_blocked"),d("WAWorkerGlobalScope").workerGlobalScope.setTimeout(function(){i(c("err")("EAR Open timed out while blocked"))},2e3)};m.onsuccess=function(e){d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(t);var f=e.target.result;if(!f.objectStoreNames.contains(k)){e=m.result.objectStoreNames.contains(k);c("FBLogger")("maw_ear").warn("Missing encryption meta table. Is store present: %s",e);d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(t);return s(f,"missing_encryption_meta_table").then(function(){j(c("err")("Malformed encryption DB"))})["catch"](function(b){u(a,"ear_idb_retry_failed_delete_failed");return i(c("err")("Failed to delete malformed encryption DB: "+b.message))})}f.onversionchange=function(){f.close(),c("FBLogger")("messenger_e2ee_web").info("EAR onversionchange triggered"),void d("MAWEARDebugs").touchDbEncryptionKeyVersion_S456130({incrementDeletionCount:!0}),d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(t),o==null?void 0:o()};u(a,"ear_db_open_end");n=f;d("MWEARKeychainV3").setNamespaceSourceDbAndMarkAsReady("global_ear",n);b()};m.onerror=function(){d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(t);if(m.error.name==="UnknownError"&&g){u(a,"ear_db_open_error_unknown_error");return j(m.error)}u(a,"ear_db_open_error");i(m.error)}}catch(b){u(a,"ear_db_error"),i(b)}})}function f(a){o=o==null?a:o}function s(a,b){a===void 0&&(a=n);c("FBLogger")("maw_ear").warn("EAR DB deletion triggered: %s",b);a!=null&&a.close();void d("MAWEARDebugs").touchDbEncryptionKeyVersion_S456130({incrementDeletionCount:!0});return d("MAWIndexedDBDeletion").deleteDB(p,"ear")}function t(a){switch(a){case c("EARInitType").EB_INIT:return c("qpl")._(521477507,"1406");case c("EARInitType").MAW_INIT:return c("qpl")._(25310776,"6155");case c("EARInitType").MAW_RP_INIT:d("WALogger").DEV(j());return c("qpl")._(25310776,"6155");case c("EARInitType").LS_INIT:return c("qpl")._(25305590,"1127");case c("EARInitType").MAW_IN_UI_INIT:return null}}function u(a,b,e){a=t(a);if(a==null)return;(h||(h=c("ExecutionEnvironment"))).isInWorker?d("MAWQplProxy").sendQplPointThroughBridge(a,"worker_"+b,{annotations:e}):(c("QPLUserFlow").addPoint(a,b),e!=null&&c("QPLUserFlow").addAnnotations(a,e))}g.storeName=k;g.ENCRYPTION_MAW_STORES_INDEX=l;g.getEncryptionDB=a;g.isEncryptionDBInited=e;g.makeEncryptionDB=r;g.maybeSetEncryptionDbOnVersionChange=f;g.deleteEncryptionDB_UNSAFE=s}),98);
__d("MAWErrorObject",["err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a instanceof Error)return a;else if(typeof a==="string")return c("err")(a);else return null}g.getErrorObject=a}),98);
__d("MAWFolderTypes",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;c=2;d=3;e=10;var g=15,h={ARCHIVED:e,INBOX:a,OTHER:c,PENDING:b,RESTRICTED:g,SPAM:d};f.INBOX=a;f.PENDING=b;f.OTHER=c;f.SPAM=d;f.ARCHIVED=e;f.RESTRICTED=g;f.FOLDER_ID=h}),66);
__d("MAWFrontendMediaUtils",["MAWDbMedia"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){if(a==="image/gif")return{mediaType:d("MAWDbMedia").MEDIA_TYPE.GIF,serverMediaType:"gif"};if(a==="image/webp"&&b!==!0)return{mediaType:d("MAWDbMedia").MEDIA_TYPE.STICKER,serverMediaType:"sticker"};c=(c=c)!=null?c:a.split("/")[0];switch(c){case"image":if(b===!0)return{mediaType:d("MAWDbMedia").MEDIA_TYPE.IMAGE,serverMediaType:"xma-image"};else return{mediaType:d("MAWDbMedia").MEDIA_TYPE.IMAGE,serverMediaType:"image"};case"video":return{mediaType:d("MAWDbMedia").MEDIA_TYPE.VIDEO,serverMediaType:"video"};case"audio":return{mediaType:d("MAWDbMedia").MEDIA_TYPE.PTT,serverMediaType:"ptt"};case"application":default:return{mediaType:d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE,serverMediaType:"document"}}}g.getMediaTypeAndServerMediaTypeFromBlob=a}),98);
__d("MAWIsLiveLocationXmaEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("3758")===!0}g.isLiveLocationXmaEnabled=a}),98);
__d("MAWIsMemoriesXmaEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a?c("gkx")("9266"):c("gkx")("9267")}g.isMemoriesXmaEnabled=a}),98);
__d("MAWTransactionMode",[],(function(a,b,c,d,e,f){"use strict";a="r!";b="rw!";f.READONLY=a;f.READWRITE=b}),66);
__d("WALRUMap",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){a=a.max;this.$1=new Map();this.$2=a}var b=a.prototype;b.has=function(a){return this.$1.has(a)};b.get=function(a){return this.$1.get(a)};b.set=function(a,b){this.$1["delete"](a);this.$1.set(a,b);if(this.$1.size>this.$2){a=this.$1.keys().next().value;a!=null&&this.$1["delete"](a)}};b["delete"]=function(a){this.$1["delete"](a)};b.clear=function(){this.$1.clear()};b.size=function(){return this.$1.size};return a}();f.LRUMap=a}),66);
__d("MAWJobActionsV2",["MAWTransactionMode","Promise","WAHex","WALRUMap","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return new(h||(h=b("Promise")))(function(b,c){a.onsuccess=b,a.onerror=c})}function j(a){return i(a).then(function(a){return a.target.result})}function k(a,c,e){return new(h||(h=b("Promise")))(function(b,f){var g=a(d("MAWTransactionMode").READONLY).index(c);g=g.openCursor(IDBKeyRange.only(e));var h=[];g.onsuccess=function(a){a=a.target.result;if(!a){b(h);return}h.push(a.value);a["continue"]()};g.onerror=function(a){return f(a)}})}var l=new(d("WALRUMap").LRUMap)({max:100});function a(a,c){var e,f=c.args,g=c.scheduleConfig,i=c.type,l=c.uniqKey;c=c.version;c=c===void 0?1:c;e=JSON.stringify([i,(e=l)!=null?e:d("WAHex").randomHex(32)]);var n={backedOffCount:0,current:f,original:f,scheduleConfig:g,startTime:d("WATimeUtils").unixTime(),step:"$unstarted",stepFirstStartTime:null,stepHardStartCountAfterTimeout:0,stepUnexpectedErrorCount:0,type:i,uniqKey:e,version:c,waitUntil:null},o=function(){var b,c=a().add(n),d=j(c);if(n.uniqKey==null&&typeof ((b=c.transaction)==null?void 0:b.commit)==="function")try{c.transaction.commit()}catch(a){}return d.then(function(a){return{id:a,newlyCreated:!0}})};if(l!=null)return k(a,"uniqKey",e).then(function(c){if(c.length===0)return o();var d=[],e=null;c.forEach(function(b){b.step!=="$finished"?e=b:d.push(m(a,b.jobId))});return(h||(h=b("Promise"))).all(d).then(function(){return e!=null?{id:e.jobId,newlyCreated:!1}:o()})});else return o()}function m(a,b){return j(a()["delete"](b))}function e(a,b){return j(a().get(b))}function f(a,b){return j(a().put(b))}function n(a){return j(a().getAll())}function o(a){try{return i(a().clear()).then(c("emptyFunction"))}catch(a){if(a.name==="NotFoundError")return(h||(h=b("Promise"))).resolve();throw a}}g.recentFinishedJobsCache=l;g.maybeCreateJob=a;g.deletePersistedJob=m;g.readPersistedJob=e;g.updatePersistedJob=f;g.readAllPersistedJobs=n;g.clearJobs=o}),98);
__d("MAWKeychain",["MWEARKeychainV3"],(function(a,b,c,d,e,f,g){"use strict";a={getDbEncryptionKey:d("MWEARKeychainV3").getDbEncryptionKey,getLatestVersion:d("MWEARKeychainV3").getLatestVersion,init:d("MWEARKeychainV3").init};g["default"]=a}),98);
__d("MAWMessagesDirection",["I64","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return c("err")("Unhandled direction: "+a)}function a(a,b){return k(a,{asc:b.maxTimestampMs,desc:b.minTimestampMs})}function b(a,b){return k(a,{asc:b.maxMessageId,desc:b.minMessageId})}function e(a,b){return b==="desc"&&(h||(h=d("I64"))).equal(a.maxTimestampMs,(h||(h=d("I64"))).max_int)&&a.minMessageId===a.maxMessageId&&a.hasMoreBefore&&!a.hasMoreAfter}function f(a){return k(a,{asc:"after",desc:"before"})}function j(a){return l(a,{after:"asc",before:"desc"})}function k(a,b){var c=b.asc;b=b.desc;switch(a){case"asc":return c;case"desc":return b;default:a;throw i(a)}}function l(a,b){var c=b.after;b=b.before;switch(a){case"after":return c;case"before":return b;default:a;throw i(a)}}g.unhandledDirectionError=i;g.getI64RangeTimestampForDirection=a;g.getRangeMsgIdForDirection=b;g.isFirstPageRange=e;g.translateMwpDirectionToMawDirection=f;g.translateMawDirectionToMwpDirection=j;g.switchOnMWPMessagesDirection=k;g.switchOnMAWMessagesDirection=l}),98);
__d("MAWMiActOnActThreadReadyQueue",["FBLogger","I64","LSPlatformLsInitLog","MAWInit","MAWMIC","MAWVerifyThreadExistsUtils","QPLUserFlow","WALoggerDeferred","asyncToGeneratorRuntime","clearTimeout","promiseDone","qpl","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MiActMapping] Executing queued action on ACT thread ready: "," for threadKey: ",""]);i=function(){return a};return a}var j=new Map(),k=3e4;function a(a,b,e,f,g,i){c("QPLUserFlow").addPoint(c("qpl")._(1056846543,"1530"),"enqueue_by_thread_key_start",{instanceKey:i});var l=(h||(h=d("I64"))).to_string(a);a=(a=j.get(l))!=null?a:[];var m=c("setTimeout")(function(){c("QPLUserFlow").endFailure(c("qpl")._(1056846543,"1530"),"enqueue_by_thread_key_timeout",{annotations:{bool:{during_mic:d("MAWMIC").duringMIC(),is_thread_requested:d("MAWVerifyThreadExistsUtils").isThreadRequested(l),ls_sync_has_ended:d("LSPlatformLsInitLog").LsSync.hasEnded(),maw_init_completed:d("MAWInit").MAWInitState.isCompleted()}},instanceKey:i}),c("FBLogger")("messenger_e2ee_web").mustfix("[MiActMapping] Took longer than %s ms to execute: %s in threadState: %s for threadKey: %s, onActThreadReady",k,f,g,l),e()},k);a.push({callback:b,description:f,telemetryInstanceKey:i,threadState:g,timeoutId:m});j.set(l,a)}function e(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=(h||(h=d("I64"))).to_string(a),g=j.get(f);if(g==null||g.length===0)return;while(g.length!==0){var k=g.shift();if(k==null)continue;var l=k.callback,m=k.description,n=k.telemetryInstanceKey,o=k.threadState;k=k.timeoutId;try{c("QPLUserFlow").addPoint(c("qpl")._(1056846543,"1530"),"enqueue_by_thread_key_end",{instanceKey:n}),c("promiseDone")(d("WALoggerDeferred").LOG(i(),m,f)),c("FBLogger")("messenger_e2ee_web").info("[MiActMapping] Executing queued action on ACT thread ready: %s, original threadState: %s called by: %s",m,o,e),c("QPLUserFlow").endSuccess(c("qpl")._(1056846543,"1530"),{instanceKey:n}),yield l(a,b),c("clearTimeout")(k)}catch(a){c("clearTimeout")(k),c("QPLUserFlow").endFailure(c("qpl")._(1056846543,"1530"),"process_queue_on_act_thread_ready_failure",{instanceKey:n}),c("FBLogger")("messenger_e2ee_web").catching(a).mustfix("[MiActMapping] Error executing callback on ACT thread ready: %s, original threadState: %s, threadKey: %s",m,o,f)}}j["delete"](f)});return l.apply(this,arguments)}g.enqueueByThreadKey=a;g.processQueueOnActThreadReady=e}),98);
__d("MWXMAV2IsDataclassLiveLocationXMA",[],(function(a,b,c,d,e,f){"use strict";function a(a){if(a==null)return!1;a=JSON.parse(a);if(a==null)return!1;a=a.content;if(a==null||(a==null?void 0:a.__typename)!=="XMSGXmaSingleContent")return!1;a=a.custom_template_data;if(a==null||(a==null?void 0:a.__typename)!=="XMSGXmaLocationTemplateData")return!1;a=a.location_metadata;return a==null||(a==null?void 0:a.__typename)!=="XMSGXmaLiveLocationMetadata"?!1:!0}f.isDataclassLiveLocationXMA=a}),66);
__d("MAWParseXMAFBConfig",["MAWIsLiveLocationXmaEnabled","MAWIsMemoriesXmaEnabled","MWXMAV2IsDataclassLiveLocationXMA","WAArmadilloXMA.pb","gkx","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set([(b=d("WAArmadilloXMA.pb")).EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_SHORT,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_PRIVATE_REPLY,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_LOCAL_EVENT_REPLY,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH]);function a(a){var b,e=a.fbTargetType,f=a.silentExposure;a=a.xmaDataclass;if(e!=null&&h.has(e))return!0;b=(b=f)!=null?b:!1;switch(e){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT:return b?c("gkx")("5304"):c("gkx")("4902");case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_AI_CONTACT:return b?c("gkx")("9338"):c("gkx")("9339");case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING:return a!=null&&d("MWXMAV2IsDataclassLiveLocationXMA").isDataclassLiveLocationXMA(a)?d("MAWIsLiveLocationXmaEnabled").isLiveLocationXmaEnabled():b?c("gkx")("5320"):c("gkx")("6952");case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_POST_MENTION:return b?c("gkx")("2605"):c("gkx")("2722");case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_MEMORIES_SHARE:return d("MAWIsMemoriesXmaEnabled").isMemoriesXmaEnabled((a=f)!=null?a:!1);default:c("recoverableViolation")("MAWParseXMAFBConfig encountered an unknown unsupported XMA type: "+String(e),"messenger_web_sharing");return!1}}g.FB_FULLY_SUPPORTED_TARGET_TYPES=h;g.isFBSupportedTargetType=a}),98);
__d("RavenMessagingState",[],(function(a,b,c,d,e,f){a=Object.freeze({PERMANENT:0,UNSEEN:1,SEEN:2,REPLAYED:3,EXPIRED:4});f["default"]=a}),66);
__d("MAWRavenUtils",["EphemeralMediaViewMode","MAWMsg","RavenMessagingState"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a){switch(a){case d("MAWMsg").MAWRavenMsgEphemeralMediaState.PERMANENT:return c("RavenMessagingState").PERMANENT;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN:return c("RavenMessagingState").UNSEEN;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.SEEN:return c("RavenMessagingState").SEEN;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.REPLAYED:return c("RavenMessagingState").REPLAYED;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.EXPIRED:return c("RavenMessagingState").EXPIRED}},i=function(a){switch(a){case d("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT:return c("EphemeralMediaViewMode").PERMANENT;case d("MAWMsg").MAWRavenMsgEphemeralType.ALLOW_REPLAY:return c("EphemeralMediaViewMode").REPLAYABLE;case d("MAWMsg").MAWRavenMsgEphemeralType.VIEW_ONCE:return c("EphemeralMediaViewMode").READ_ONCE}};b=function(a,b){return{ephemeralMediaState:b,ephemeralMediaViewMode:i(a)}};function a(a,b){switch(b){case d("MAWMsg").MAWRavenMsgEphemeralType.VIEW_ONCE:return a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN?c("RavenMessagingState").SEEN:h(a);case d("MAWMsg").MAWRavenMsgEphemeralType.ALLOW_REPLAY:if(a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN)return c("RavenMessagingState").SEEN;else if(a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.SEEN)return c("RavenMessagingState").REPLAYED;return h(a);case d("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT:return h(a)}}g.getEphemeralMediaState=h;g.getEphemeralMediaViewMode=i;g.deriveRavenSettings=b;g.getNextRavenMessageEphemeralState=a}),98);
__d("MAWThreadBumpType",[],(function(a,b,c,d,e,f){"use strict";a="NO_UPDATE";b="LOCAL_ONLY";c="LOCAL_AND_SERVER";d=Object.freeze({LOCAL_AND_SERVER:c,LOCAL_ONLY:b,NO_UPDATE:a});f.THREAD_BUMP_TYPE=d}),66);
__d("MAWThreadUpdateMiddlewareGatingUtil",["MAWMsgType","gkx","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:return c("gkx")("5915");case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return c("gkx")("5916");case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.RAVEN_ACTION:return c("gkx")("6762");case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return!1;default:a;return!1}}function b(){return c("gkx")("3739")}function e(){return c("gkx")("8147")}function f(){return j()}function h(){return c("gkx")("6484")}function i(){var a;return(a=c("qex")._("130"))!=null?a:!1}function j(){var a;return(a=c("qex")._("67"))!=null?a:!0}function k(){var a;return(a=c("qex")._("385"))!=null?a:!1}function l(){var a;return(a=c("qex")._("426"))!=null?a:!1}function m(){var a;return(a=c("qex")._("74"))!=null?a:!1}function n(){var a;return(a=c("qex")._("95"))!=null?a:!1}function o(a,b){var d,e=!1,f=e,g="none",h=g;switch(a){case"exposure_logging_disabled":f=(d=c("qex")._("987"))!=null?d:e;h=(d=c("qex")._("1223"))!=null?d:g;break;case"exposure_logging_enabled":f=(d=c("qex")._("1264"))!=null?d:e;h=(d=c("qex")._("1273"))!=null?d:g;break;default:a;return!1}switch(b){case"not_specifically_incoming_or_outgoing":case"incoming_msg":return f;case"outgoing_msg_from_HIM":return f&&h==="him";case"outgoing_msg_from_send_reporter_v1":return f&&h==="send_reporter_v1";case"outgoing_msg_from_send_reporter_v2":return f&&h==="send_reporter_v2";default:b;return!1}}g.isThreadUpdateEnabledViaMiddlewareForMsgType=a;g.isThreadUpdateEnabledViaMiddlewareForReactions=b;g.isPeristedUnbumpEnabled=e;g.isThrottledUpdatesEnabled=f;g.isFixEnabledForUnthrottlingOutgoingMsgs=h;g.isMiddlewareProcessingExclusiveToOQ=i;g.isMiddlewareCacheOptimizationEnabled=k;g.isMiddlewareCacheReverseOQBatchEnabled=l;g.isMiddlewareFilterOptimisticEnabled=m;g.isMiddlewareFilterSpamEnabled=n;g.isNewMiThreadCreationFlowEnabled=o}),98);
__d("MAWThreadUpdateType",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;c=2;d=3;e=Object.freeze({BUMP_THREAD:c,MARK_THREAD_AS_UNREAD:d,NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:a,SNIPPET_ONLY:b});f.THREAD_UPDATE_TYPE=e}),66);
__d("MAWTraceUtils",["LSDataTraceCheckPoint","LSDataTraceTag","LSIntEnum","LSRequestId","MAWBridge","MAWBridgeTrace","MAWMsgType"],(function(a,b,c,d,e,f,g){"use strict";var h,i="backup_upload",j="media_backup",k="vesta_registration",l="vesta_login";function m(){return c("LSRequestId").generate()}function a(a,b,c){c=(c=c)!=null?c:m();d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"StartTraceWithTraceId",value:d("MAWBridgeTrace").createBridgeStartTraceWithTraceIdData(a,c,b)}]},!0);return c}function n(a,b,c,e,f){if(a!=null){c=c.length>0?c.map(function(a){return a.toString()}).join(","):void 0;d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"TraceRecordCheckpoint",value:d("MAWBridgeTrace").createBridgeTraceRecordCheckpointData(b,a,f,e,-1,c)}]},!0)}}function b(a,b,e,f){n(a,b,e,!1),n(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE),e,!0,f)}function e(a,b,e){n(a,b,e,!1),n(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_AND_FLUSH),e,!0)}function f(a,b,e){n(a,b,e,!1),n(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_AND_FLUSH),e,!0)}function o(a){switch(a){case d("MAWMsgType").MSG_TYPE.TEXT:return d("LSDataTraceTag").messageTypeText;case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:return d("LSDataTraceTag").messageTypeFutureproof;case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:return d("LSDataTraceTag").messageTypeCiphertext;case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:return d("LSDataTraceTag").messageTypeUnavailable;case d("MAWMsgType").MSG_TYPE.IMAGE:return d("LSDataTraceTag").messageTypeImage;case d("MAWMsgType").MSG_TYPE.VIDEO:return d("LSDataTraceTag").messageTypeVideo;case d("MAWMsgType").MSG_TYPE.PTT:return d("LSDataTraceTag").messageTypePtt;case d("MAWMsgType").MSG_TYPE.ADMIN:return d("LSDataTraceTag").messageTypeAdmin;case d("MAWMsgType").MSG_TYPE.REVOKED:return d("LSDataTraceTag").messageTypeRevoked;case d("MAWMsgType").MSG_TYPE.GIF:return d("LSDataTraceTag").messageTypeGif;case d("MAWMsgType").MSG_TYPE.STICKER:return d("LSDataTraceTag").messageTypeSticker;case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:return d("LSDataTraceTag").messageTypeExpiredEphemeral;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:return d("LSDataTraceTag").messageTypeEphemeralSettingAdmin;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:return d("LSDataTraceTag").messageTypeEphemeralSyncResponse;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:return d("LSDataTraceTag").messageTypeEphemeralScreenshotAction;case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:return d("LSDataTraceTag").messageTypeDeleteForMe;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:return d("LSDataTraceTag").messageTypeEphemeralSettingChangeFromCurrentDevice;case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:return d("LSDataTraceTag").messageTypeAlertICDC;case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:return d("LSDataTraceTag").messageTypeGroupInvite;case d("MAWMsgType").MSG_TYPE.XMA:return d("LSDataTraceTag").messageTypeXMA;case d("MAWMsgType").MSG_TYPE.REACTION:return d("LSDataTraceTag").messageTypeReaction;case d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:return d("LSDataTraceTag").messageTypeSenderKeyDistribution;default:return d("LSDataTraceTag").messageTypeNone}}g.CONTEXT_BACKUP_UPLOAD=i;g.CONTEXT_MEDIA_BACKUP=j;g.CONTEXT_VESTA_REGISTRATION=k;g.CONTEXT_VESTA_LOGIN=l;g.createTraceId=m;g.startNewTrace=a;g.recordCheckpointForTrace=n;g.recordFailureAndFlushForTraceId=b;g.recordSuccessAndFlushForTraceId=e;g.recordInvalidUploadRequestAndFlushTrace=f;g.getTagForMsgType=o}),98);
__d("MWSetupDBEncryption",["BrowserLockManager","ExecutionEnvironment","FBLogger","MAWEncryptionIndexedDbV2","MAWKeychain","MWEARKeychainV3","Promise","WAResultOrError","asyncToGeneratorRuntime","getErrorSafe","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(a,b){return b()};function a(a){j=a}var k="mw_ear_db";function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{yield d("MAWEncryptionIndexedDbV2").makeEncryptionDB(a);return yield j("init_setup_keychain",function(){return c("MAWKeychain").init("global_ear")})}catch(e){var b=e instanceof Error?e:c("getErrorSafe")(e);c("FBLogger")("messenger_e2ee_web").catching(b).mustfix("[%s] EAR setup error",String(a));return d("WAResultOrError").makeError("keychain-setup-failure",b)}});return m.apply(this,arguments)}function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(d("MAWEncryptionIndexedDbV2").getEncryptionDB()!=null&&d("MWEARKeychainV3").isKeychainInitialised("global_ear"))return(i||(i=b("Promise"))).resolve(d("WAResultOrError").makeResult(d("MWEARKeychainV3").getLatestVersion("global_ear")));if(c("BrowserLockManager")!=null)return new(i||(i=b("Promise")))(function(d,e){c("promiseDone")(c("BrowserLockManager").request(k,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var b=(yield l(a));d(b)}catch(a){e(a)}})),function(a){},function(a){e(a)})});else return l(a)});return o.apply(this,arguments)}function e(a,c){c===void 0&&(c=function(a){return!0});var d=null;return function(e){d==null&&(d=a(e).then(function(a){d=c(a)?(i||(i=b("Promise"))).resolve(a):null;return a})["catch"](function(a){d=null;throw a}));return d}}f=e(function(a){return n(a)},function(a){return(a==null?void 0:a.success)===!0});e=c("justknobx")._("2804")||(h||(h=c("ExecutionEnvironment"))).isInWorker?f:n;g.setPerformanceMeasurementTool=a;g.init=e}),98);
__d("WAByteArray",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){b=b;var c=new Uint8Array(a);for(a=a-1;a>=0;a--)c[a]=b&255,b>>>=8;return c}function b(a){return a.buffer.slice(a.byteOffset,a.byteLength+a.byteOffset)}function c(a,b){if(!a||!b)return!1;a=new Uint8Array(a);b=new Uint8Array(b);var c=a.length,d=b.length;if(c!==d)return!1;for(d=0;d<c;d++)if(a[d]!==b[d])return!1;return!0}f.intToBytes=a;f.uint8ArrayToBuffer=b;f.compareArrayBuffer=c}),66);
__d("WAMediaTransport.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={NONE:0,LQ_4K:1,HQ_4K:2};b={NONE:0,GIPHY:1,TENOR:2};c={TALKING_A:0,IDLE_A:1,TALKING_B:2,IDLE_B:3,BACKGROUND:4};e={UNKNOWN:0,OPUS:1};f={};var i={},j={},k={},l={},m={},n={},o={},p={},q={},r={},s={},t={},u={},v={},w={},x={},y={},z={},A={},B={},C={},D={},E={},F={};f.internalSpec={integral:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,l],ancillary:[2,h.TYPES.MESSAGE,i]};i.internalSpec={fileLength:[1,h.TYPES.UINT64],mimetype:[2,h.TYPES.STRING],thumbnail:[3,h.TYPES.MESSAGE,j],objectId:[4,h.TYPES.STRING]};j.internalSpec={jpegThumbnail:[1,h.TYPES.BYTES],downloadableThumbnail:[2,h.TYPES.MESSAGE,k],thumbnailWidth:[3,h.TYPES.UINT32],thumbnailHeight:[4,h.TYPES.UINT32]};k.internalSpec={fileSha256:[1,h.TYPES.BYTES],fileEncSha256:[2,h.TYPES.BYTES],directPath:[3,h.TYPES.STRING],mediaKey:[4,h.TYPES.BYTES],mediaKeyTimestamp:[5,h.TYPES.INT64],objectId:[6,h.TYPES.STRING],thumbnailScansSidecar:[7,h.TYPES.BYTES],thumbnailScanLengths:[8,h.FLAGS.REPEATED|h.TYPES.UINT32]};l.internalSpec={fileSha256:[1,h.TYPES.BYTES],mediaKey:[2,h.TYPES.BYTES],fileEncSha256:[3,h.TYPES.BYTES],directPath:[4,h.TYPES.STRING],mediaKeyTimestamp:[5,h.TYPES.INT64]};m.internalSpec={integral:[1,h.TYPES.MESSAGE,o],ancillary:[2,h.TYPES.MESSAGE,n]};n.internalSpec={height:[1,h.TYPES.UINT32],width:[2,h.TYPES.UINT32],scansSidecar:[3,h.TYPES.BYTES],scanLengths:[4,h.FLAGS.REPEATED|h.TYPES.UINT32],midQualityFileSha256:[5,h.TYPES.BYTES],hdType:[6,h.TYPES.ENUM,a],memoriesConceptScores:[7,h.FLAGS.REPEATED|h.FLAGS.PACKED|h.TYPES.FLOAT],memoriesConceptIds:[8,h.FLAGS.REPEATED|h.FLAGS.PACKED|h.TYPES.UINT32]};o.internalSpec={transport:[1,h.TYPES.MESSAGE,f]};p.internalSpec={integral:[1,h.TYPES.MESSAGE,r],ancillary:[2,h.TYPES.MESSAGE,q]};q.internalSpec={seconds:[1,h.TYPES.UINT32],caption:[2,h.TYPES.MESSAGE,d("WACommon.pb").MessageTextSpec],gifPlayback:[3,h.TYPES.BOOL],height:[4,h.TYPES.UINT32],width:[5,h.TYPES.UINT32],sidecar:[6,h.TYPES.BYTES],gifAttribution:[7,h.TYPES.ENUM,b],accessibilityLabel:[8,h.TYPES.STRING]};r.internalSpec={transport:[1,h.TYPES.MESSAGE,f]};s.internalSpec={integral:[1,h.TYPES.MESSAGE,w],ancillary:[2,h.TYPES.MESSAGE,t]};t.internalSpec={seconds:[1,h.TYPES.UINT32],avatarAudio:[2,h.TYPES.MESSAGE,u]};u.internalSpec={poseId:[1,h.TYPES.UINT32],avatarAnimations:[2,h.FLAGS.REPEATED|h.TYPES.MESSAGE,v]};v.internalSpec={fileSha256:[1,h.TYPES.BYTES],fileEncSha256:[2,h.TYPES.BYTES],directPath:[3,h.TYPES.STRING],mediaKey:[4,h.TYPES.BYTES],mediaKeyTimestamp:[5,h.TYPES.INT64],objectId:[6,h.TYPES.STRING],animationsType:[7,h.TYPES.ENUM,c]};w.internalSpec={transport:[1,h.TYPES.MESSAGE,f],audioFormat:[2,h.TYPES.ENUM,e]};x.internalSpec={integral:[1,h.TYPES.MESSAGE,z],ancillary:[2,h.TYPES.MESSAGE,y]};y.internalSpec={pageCount:[1,h.TYPES.UINT32]};z.internalSpec={transport:[1,h.TYPES.MESSAGE,f]};A.internalSpec={integral:[1,h.TYPES.MESSAGE,C],ancillary:[2,h.TYPES.MESSAGE,B]};B.internalSpec={pageCount:[1,h.TYPES.UINT32],height:[2,h.TYPES.UINT32],width:[3,h.TYPES.UINT32],firstFrameLength:[4,h.TYPES.UINT32],firstFrameSidecar:[5,h.TYPES.BYTES],mustacheText:[6,h.TYPES.STRING],isThirdParty:[7,h.TYPES.BOOL],receiverFetchId:[8,h.TYPES.STRING],accessibilityLabel:[9,h.TYPES.STRING]};C.internalSpec={transport:[1,h.TYPES.MESSAGE,f],isAnimated:[2,h.TYPES.BOOL],receiverFetchId:[3,h.TYPES.STRING]};D.internalSpec={integral:[1,h.TYPES.MESSAGE,F],ancillary:[2,h.TYPES.MESSAGE,E]};E.internalSpec={displayName:[1,h.TYPES.STRING]};F.internalSpec={vcard:[1,h.TYPES.STRING],downloadableVcard:[2,h.TYPES.MESSAGE,f],__oneofs__:{contact:["vcard","downloadableVcard"]}};g.IMAGE_TRANSPORT_ANCILLARY_HD_TYPE=a;g.VIDEO_TRANSPORT_ANCILLARY_ATTRIBUTION=b;g.AUDIO_TRANSPORT_ANCILLARY_AVATAR_AUDIO_ANIMATIONS_TYPE=c;g.AUDIO_TRANSPORT_INTEGRAL_AUDIO_FORMAT=e;g.WAMediaTransportSpec=f;g.WAMediaTransport$AncillarySpec=i;g.WAMediaTransport$Ancillary$ThumbnailSpec=j;g.WAMediaTransport$Ancillary$Thumbnail$DownloadableThumbnailSpec=k;g.WAMediaTransport$IntegralSpec=l;g.ImageTransportSpec=m;g.ImageTransport$AncillarySpec=n;g.ImageTransport$IntegralSpec=o;g.VideoTransportSpec=p;g.VideoTransport$AncillarySpec=q;g.VideoTransport$IntegralSpec=r;g.AudioTransportSpec=s;g.AudioTransport$AncillarySpec=t;g.AudioTransport$Ancillary$AvatarAudioSpec=u;g.AudioTransport$Ancillary$AvatarAudio$DownloadableAvatarAnimationsSpec=v;g.AudioTransport$IntegralSpec=w;g.DocumentTransportSpec=x;g.DocumentTransport$AncillarySpec=y;g.DocumentTransport$IntegralSpec=z;g.StickerTransportSpec=A;g.StickerTransport$AncillarySpec=B;g.StickerTransport$IntegralSpec=C;g.ContactTransportSpec=D;g.ContactTransport$AncillarySpec=E;g.ContactTransport$IntegralSpec=F}),98);
__d("WAMediaHdType",[],(function(a,b,c,d,e,f,g){"use strict";a=0;b=1;c=2;d={HD_TYPE_NONE:a,HD_TYPE_LQ_4K:b,HD_TYPE_HQ_4K:c};g.HD_TYPE_NONE=a;g.HD_TYPE_LQ_4K=b;g.HD_TYPE_HQ_4K=c;g.HD_TYPE=d}),98);
__d("WAMediaQplHelper",[],(function(a,b,c,d,e,f){"use strict";function a(a){if(a==null||a<0||a>1e3*1024*1024)return"invalid_size";else if(a<=1*1024)return"size lower than 1 KB";else if(a<=50*1024)return"size between 1 KB and 50 KB";else if(a<=100*1024)return"size between 50 KB and 100 KB";else if(a<=500*1024)return"size between 100 KB and 500 KB";else if(a<=1*1024*1024)return"size between 500 KB and 1 MB";else if(a<=2*1024*1024)return"size between 1 MB and 2 MB";else if(a<=5*1024*1024)return"size between 2 MB and 5 MB";else if(a<=10*1024*1024)return"size between 5 MB and 10 MB";else if(a<=20*1024*1024)return"size between 10 MB and 20 MB";else if(a<=25*1024*1024)return"size between 20 MB and 25 MB";else if(a<=30*1024*1024)return"size between 25 MB and 30 MB";else if(a<=50*1024*1024)return"size between 30 MB and 50 MB";else if(a<=75*1024*1024)return"size between 50 MB and 75 MB";else if(a<=100*1024*1024)return"size between 75 MB and 100 MB";else return"size above 100 MB"}f.convertIntegerSizeToStringBucket=a}),66);
__d("WAPromiseTimeout",["Promise","WACustomError"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,c,e){var f=null,g=new(h||(h=b("Promise")))(function(a,b){f=setTimeout(function(){b(new(d("WACustomError").TimeoutError)(e)),clearTimeout(f)},c)});return h.race([a,g])["finally"](function(){clearTimeout(f)})};g.promiseTimeout=a}),98);/*FB_PKG_DELIM*/
__d("Base64",[],(function(a,b,c,d,e,f){var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function h(a){a=a.charCodeAt(0)<<16|a.charCodeAt(1)<<8|a.charCodeAt(2);return String.fromCharCode(g.charCodeAt(a>>>18),g.charCodeAt(a>>>12&63),g.charCodeAt(a>>>6&63),g.charCodeAt(a&63))}var i=">___?456789:;<=_______\0\x01\x02\x03\x04\x05\x06\x07\b\t\n\v\f\r\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19______\x1a\x1b\x1c\x1d\x1e\x1f !\"#$%&'()*+,-./0123";function j(a){a=i.charCodeAt(a.charCodeAt(0)-43)<<18|i.charCodeAt(a.charCodeAt(1)-43)<<12|i.charCodeAt(a.charCodeAt(2)-43)<<6|i.charCodeAt(a.charCodeAt(3)-43);return String.fromCharCode(a>>>16,a>>>8&255,a&255)}var k={encode:function(a){a=unescape(encodeURI(a));var b=(a.length+2)%3;a=(a+"\0\0".slice(b)).replace(/[\s\S]{3}/g,h);return a.slice(0,a.length+b-2)+"==".slice(b)},decode:function(a){a=a.replace(/[^A-Za-z0-9+\/]/g,"");var b=a.length+3&3;a=(a+"AAA".slice(b)).replace(/..../g,j);a=a.slice(0,a.length+b-3);try{return decodeURIComponent(escape(a))}catch(a){throw new Error("Not valid UTF-8")}},encodeObject:function(a){return k.encode(JSON.stringify(a))},decodeObject:function(a){return JSON.parse(k.decode(a))},encodeNums:function(a){return String.fromCharCode.apply(String,a.map(function(a){return g.charCodeAt((a|-(a>63?1:0))&-(a>0?1:0)&63)}))}};a=k;f["default"]=a}),66);
__d("CacheStorage",["ErrorGuard","ExecutionEnvironment","WebStorage","cr:6943","cr:8958","emptyFunction","err"],(function(a,b,c,d,e,f,g){var h,i,j,k="_@_",l="3b",m="CacheStorageVersion",n={length:0,getItem:a=c("emptyFunction"),setItem:a,clear:a,removeItem:a,key:a};d=function(){function a(a){this._store=a}var b=a.prototype;b.getStore=function(){return this._store};b.keys=function(){var a=[];for(var b=0;b<this._store.length;b++){var c=this._store.key(b);c!=null&&a.push(c)}return a};b.get=function(a){return this._store.getItem(a)};b.set=function(a,b){this._store.setItem(a,b)};b.remove=function(a){this._store.removeItem(a)};b.clear=function(){this._store.clear()};b.clearWithPrefix=function(a){a=a||"";var b=this.keys();for(var c=0;c<b.length;c++){var d=b[c];d!=null&&d.startsWith(a)&&this.remove(d)}};return a}();e=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b;return a.call(this,(b=(h||(h=c("WebStorage"))).getLocalStorage())!=null?b:n)||this}b.available=function(){return!!(h||(h=c("WebStorage"))).getLocalStorage()};return b}(d);g=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b;return a.call(this,(b=(h||(h=c("WebStorage"))).getSessionStorage())!=null?b:n)||this}b.available=function(){return!!(h||(h=c("WebStorage"))).getSessionStorage()};return b}(d);var o=function(){function a(){this._store={}}var b=a.prototype;b.getStore=function(){return this._store};b.keys=function(){return Object.keys(this._store)};b.get=function(a){return this._store[a]===void 0?null:this._store[a]};b.set=function(a,b){this._store[a]=b};b.remove=function(a){a in this._store&&delete this._store[a]};b.clear=function(){this._store={}};b.clearWithPrefix=function(a){a=a||"";var b=this.keys();for(var c=0;c<b.length;c++){var d=b[c];d.startsWith(a)&&this.remove(d)}};a.available=function(){return!0};return a}(),p={memory:o,localstorage:e,sessionstorage:g};a=function(){function a(a,d){this._changeCallbacks=[];this._key_prefix="_cs_";this._exception=null;d&&(this._key_prefix=d);a==="AUTO"||!a?d="memory":d=a;d&&(!p[d]||!p[d].available()?((i||(i=c("ExecutionEnvironment"))).canUseDOM,this._backend=new o()):this._backend=new p[d]());a=this.useBrowserStorage();a&&b("cr:6943").listen(window,"storage",this._onBrowserValueChanged.bind(this));d=a?this._backend.getStore().getItem(m):this._backend.getStore()[m];d!==l&&this.clearOwnKeys()}var d=a.prototype;d.useBrowserStorage=function(){return this._backend.getStore()===(h||(h=c("WebStorage"))).getLocalStorage()||this._backend.getStore()===(h||(h=c("WebStorage"))).getSessionStorage()};d.addValueChangeCallback=function(a){var b=this;this._changeCallbacks.push(a);return{remove:function(){b._changeCallbacks.slice(b._changeCallbacks.indexOf(a),1)}}};d._onBrowserValueChanged=function(a){this._changeCallbacks&&String(a.key).startsWith(this._key_prefix)&&this._changeCallbacks.forEach(function(b){b(a.key,a.oldValue,a.newValue)})};d.keys=function(){var a=this,b=[];(j||(j=c("ErrorGuard"))).guard(function(){if(a._backend){var c=a._backend.keys(),d=a._key_prefix.length;for(var e=0;e<c.length;e++)c[e].substr(0,d)==a._key_prefix&&b.push(c[e].substr(d))}},{name:"CacheStorage"})();return b};d.set=function(d,e,f){if(this._backend){if(this.useBrowserStorage()&&a._persistentWritesDisabled){this._exception=c("err")("writes disabled");return!1}var g;typeof e==="string"?g=k+e:!f?(g={__t:Date.now(),__v:e},g=b("cr:8958").stringify(g)):g=b("cr:8958").stringify(e);f=this._backend;e=this._key_prefix+d;d=!0;var h=null;while(d)try{h=null,f.set(e,g),d=!1}catch(a){h=a;var i=f.keys().length;this._evictCacheEntries();d=f.keys().length<i}if(h!==null){this._exception=h;return!1}else{this._exception=null;return!0}}this._exception=c("err")("no back end");return!1};d.getLastSetExceptionMessage=function(){return this._exception?this._exception.message:null};d.getLastSetException=function(){return this._exception};d.getStorageKeyCount=function(){var a=this._backend;return a?a.keys().length:0};d._evictCacheEntries=function(){var c=[],d=this._backend;d.keys().forEach(function(e){if(e===m)return;var g=d.get(e);if(g===void 0){d.remove(e);return}if(a._hasMagicPrefix(g))return;try{g=b("cr:8958").parse(g,f.id)}catch(a){d.remove(e);return}g&&g.__t!==void 0&&g.__v!==void 0&&c.push([e,g.__t])});c.sort(function(a,b){return a[1]-b[1]});for(var e=0;e<Math.ceil(c.length/2);e++)d.remove(c[e][0])};d.get=function(d,e){var g;if(this._backend){(j||(j=c("ErrorGuard"))).applyWithGuard(function(){g=this._backend.get(this._key_prefix+d)},this,[],{onError:function(){g=null},name:"CacheStorage:get"});if(g!=null)if(a._hasMagicPrefix(g))g=g.substr(k.length);else try{g=b("cr:8958").parse(g,f.id),g&&g.__t!==void 0&&g.__v!==void 0&&(g=g.__v)}catch(a){g=void 0}else g=void 0}g===void 0&&e!==void 0&&(g=e,this.set(d,g));return g};d.remove=function(a){this._backend&&(j||(j=c("ErrorGuard"))).applyWithGuard(this._backend.remove,this._backend,[this._key_prefix+a],{name:"CacheStorage:remove"})};d._setVersion=function(){var a=this;(j||(j=c("ErrorGuard"))).applyWithGuard(function(){a.useBrowserStorage()?a._backend.getStore().setItem(m,l):a._backend.getStore()[m]=l},this,[],{name:"CacheStorage:setVersion"})};d.clear=function(){this._backend&&((j||(j=c("ErrorGuard"))).applyWithGuard(this._backend.clear,this._backend,[],{name:"CacheStorage:clear"}),this._setVersion())};d.clearOwnKeys=function(){this._backend&&((j||(j=c("ErrorGuard"))).applyWithGuard(this._backend.clearWithPrefix,this._backend,[this._key_prefix],{name:"CacheStorage:clearOwnKeys"}),this._setVersion())};a.getAllStorageTypes=function(){return Object.keys(p)};a._hasMagicPrefix=function(a){return a.substr(0,k.length)===k};a.disablePersistentWrites=function(){a._persistentWritesDisabled=!0};return a}();a._persistentWritesDisabled=!1;f.exports=a}),34);
__d("CometFocusTableContext",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");b=a.createContext({FocusCell:null,FocusRow:null,FocusTable:null});g["default"]=b}),98);
__d("CometSuspenseFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1828945");b=d("FalcoLoggerInternal").create("comet_suspense",a);e=b;g["default"]=e}),98);
__d("TWriteBuffer",[],(function(a,b,c,d,e,f){a=function(){function a(b){b===void 0&&(b=a.DEFAULT_BYTE_BUFFER_SIZE),this.$1=new DataView(new ArrayBuffer(b)),this.$2=0}var b=a.prototype;b.write=function(a){this.$2+a.length>this.$1.byteLength&&this.$3(this.$2+a.length);for(var b=0;b<a.length;b++)this.$1.setUint8(this.$2+b,a[b]);this.$2+=a.length;return a.length};b.writeByte=function(a){this.$2+1>this.$1.byteLength&&this.$3(this.$2+1);this.$1.setUint8(this.$2,a);this.$2++;return 1};b.writeFloatBE=function(a){this.$2+Float32Array.BYTES_PER_ELEMENT>this.$1.byteLength&&this.$3(this.$2+Float32Array.BYTES_PER_ELEMENT);this.$1.setFloat32(this.$2,a);this.$2+=Float32Array.BYTES_PER_ELEMENT;return Float32Array.BYTES_PER_ELEMENT};b.writeDoubleBE=function(a){this.$2+Float64Array.BYTES_PER_ELEMENT>this.$1.byteLength&&this.$3(this.$2+Float64Array.BYTES_PER_ELEMENT);this.$1.setFloat64(this.$2,a);this.$2+=Float64Array.BYTES_PER_ELEMENT;return Float64Array.BYTES_PER_ELEMENT};b.toByteArray=function(){var a=new Uint8Array(this.$1.buffer,0,this.$2);return a};b.currentSize=function(){return this.$2};b.getUnderlyingDataView=function(){return this.$1};b.$3=function(a){a=a*2;if(!Number.isSafeInteger(a))throw new Error("unable to resize");a=new DataView(new ArrayBuffer(a));for(var b=0;b<this.$2;b++)a.setUint8(b,this.$1.getUint8(b));this.$1=a};b.readByte=function(){throw new Error("operation not supported")};b.readBytes=function(a){throw new Error("operation not supported")};b.readFloatBE=function(){throw new Error("operation not supported")};b.readDoubleBE=function(){throw new Error("operation not supported")};return a}();a.DEFAULT_BYTE_BUFFER_SIZE=16;f["default"]=a}),66);
__d("StringToUtf8",["TWriteBuffer"],(function(a,b,c,d,e,f,g){a=function(a){var b=new(c("TWriteBuffer"))(a.length),d;for(var e=0;e<a.length;e++){d=a.charCodeAt(e);if(d<128)b.writeByte(d);else if(d<2048)b.writeByte(d>>6|192),b.writeByte(d&63|128);else if((d&64512)==55296){if(e+1>=a.length)throw new Error("UTF-16 string is truncated: ["+d.toString(16)+"]");if((a.charCodeAt(e+1)&64512)!==56320)throw new Error("Invalid UTF-16 string: ["+d.toString(16)+", "+a.charCodeAt(e+1).toString(16)+"]");d=65536+((d&1023)<<10)+(a.charCodeAt(++e)&1023);b.writeByte(d>>18|240);b.writeByte(d>>12&63|128);b.writeByte(d>>6&63|128);b.writeByte(d&63|128)}else b.writeByte(d>>12|224),b.writeByte(d>>6&63|128),b.writeByte(d&63|128)}return b.toByteArray()};g.StringToUtf8=a}),98);
__d("ThriftTypes",[],(function(a,b,c,d,e,f){a=Object.freeze({STOP:0,VOID:1,BOOL:2,BYTE:3,I08:3,DOUBLE:4,I16:6,I32:8,I64:10,STRING:11,STRUCT:12,MAP:13,SET:14,LIST:15,FLOAT:19});b=a;f["default"]=b}),66);
__d("Utf8ToString",[],(function(a,b,c,d,e,f){var g=function(a,b){throw new Error(a+": ["+b.map(function(a){return a.toString(16)}).toString()+"]")},h=function(a){g("Invalid UTF-8 sequence",a)},i=function(a,b){g("Not enough bytes for "+a+"-byte sequence",b)};a=function(a){var b=0,c=[];while(b<a.length){var d=a[b++];if(d<128)c.push(String.fromCharCode(d));else if(d>=128&&d<194)h([d]);else if(d>=194&&d<224){b>=a.length&&i(2,[d]);var e=a[b++];(e&192)!==128&&h([d,e]);c.push(String.fromCharCode((d&31)<<6|e&63))}else if(d>=240&&d<245){b+2>=a.length&&i(4,[d]);e=a[b++];var f=a[b++],g=a[b++];(d==240&&(!(e>=144&&e<192)||(f&192)!==128||(g&192)!==128)||d>=241&&d<244&&((e&192)!==128||(f&192)!==128||(g&192)!==128)||d==244&&(!(e>=128&&e<144)||(f&192)!==128||(g&192)!==128))&&h([d,e,f,g]);e=((d&7)<<18|(e&63)<<12|(f&63)<<6|g&63)-65536;c.push(String.fromCharCode(55296+(e>>10)));c.push(String.fromCharCode(56320+(e&1023)))}else if(d>=245)h([d]);else{b+1>=a.length&&i(3,[d]);f=a[b++];g=a[b++];d==224?f>=160&&f<192||h([d,f,g]):d>=225&&d<237?f>=128&&f<192||h([d,f,g]):d==237?f>=128&&f<160||h([d,f,g]):d>=238&&d<240&&(f>=128&&f<192||h([d,f,g]));g>=128&&g<192||h([d,f,g]);c.push(String.fromCharCode((d&15)<<12|(f&63)<<6|g&63))}}return c.join("")};f.Utf8ToString=a}),66);
__d("jsbi",[],(function(a,b,c,d,e,f){(function(a,b){"object"==typeof f&&"undefined"!=typeof e?e.exports=b():"function"==typeof define&&define.amd?define(b):a.JSBI=b()})(this,function(){"use strict";function a(b){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a(b)}function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function c(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function d(a,b,d){return b&&c(a.prototype,b),d&&c(a,d),a}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&g(a,b)}function f(a){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},f(a)}function g(a,b){return g=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},g(a,b)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function i(){return i=h()?Reflect.construct:function(a,b,c){var d=[null];d.push.apply(d,b);b=Function.bind.apply(a,d);a=new b;return c&&g(a,c.prototype),a},i.apply(null,arguments)}function j(a){return-1!==Function.toString.call(a).indexOf("[native code]")}function k(a){var b="function"==typeof Map?new Map:void 0;return k=function(a){function c(){return i(a,arguments,f(this).constructor)}if(null===a||!j(a))return a;if("function"!=typeof a)throw new TypeError("Super expression must either be null or a function");if("undefined"!=typeof b){if(b.has(a))return b.get(a);b.set(a,c)}return c.prototype=Object.create(a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),g(c,a)},k(a)}function l(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function m(a,b){return b&&("object"==typeof b||"function"==typeof b)?b:l(a)}var n=function(c){var h=Math.abs,i=Math.max,j=Math.imul,k=Math.clz32;function g(a,c){if(b(this,g),a>g.__kMaxLength)throw new RangeError("Maximum BigInt size exceeded");return a=m(this,f(g).call(this,a)),a.sign=c,a}return e(g,c),d(g,[{key:"toDebugString",value:function(){var a=["BigInt["],b=!0,c=!1,d=void 0;try{for(var e,e,f=this[Symbol.iterator]();!(b=(e=f.next()).done);b=!0)e=e.value,a.push((e?(e>>>0).toString(16):e)+", ")}catch(a){c=!0,d=a}finally{try{b||null==f["return"]||f["return"]()}finally{if(c)throw d}}return a.push("]"),a.join("")}},{key:"toString",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10;if(2>a||36<a)throw new RangeError("toString() radix argument must be between 2 and 36");return 0===this.length?"0":0==(a&a-1)?g.__toStringBasePowerOfTwo(this,a):g.__toStringGeneric(this,a,!1)}},{key:"__copy",value:function(){for(var a=new g(this.length,this.sign),b=0;b<this.length;b++)a[b]=this[b];return a}},{key:"__trim",value:function(){for(var a=this.length,b=this[a-1];0===b;)a--,b=this[a-1],this.pop();return 0===a&&(this.sign=!1),this}},{key:"__initializeDigits",value:function(){for(var a=0;a<this.length;a++)this[a]=0}},{key:"__clzmsd",value:function(){return k(this[this.length-1])}},{key:"__inplaceMultiplyAdd",value:function(a,b,c){c>this.length&&(c=this.length);for(var d=65535&a,a=a>>>16,e=0,f=65535&b,b=b>>>16,i=0;i<c;i++){var n=this.__digit(i),m=65535&n;n=n>>>16;var o=j(m,d);m=j(m,a);var p=j(n,d);n=j(n,a);var q=f+(65535&o);o=b+e+(q>>>16)+(o>>>16)+(65535&m)+(65535&p);f=(m>>>16)+(p>>>16)+(65535&n)+(o>>>16),e=f>>>16,f&=65535,b=n>>>16;this.__setDigit(i,65535&q|o<<16)}if(0!==e||0!==f||0!==b)throw new Error("implementation bug")}},{key:"__inplaceAdd",value:function(a,b,c){for(var d,e=0,f=0;f<c;f++)d=this.__halfDigit(b+f)+a.__halfDigit(f)+e,e=d>>>16,this.__setHalfDigit(b+f,d);return e}},{key:"__inplaceSub",value:function(a,b,c){var d=0;if(1&b){b>>=1;for(var e=this.__digit(b),f=65535&e,k=0;k<c-1>>>1;k++){var l=a.__digit(k),m=(e>>>16)-(65535&l)-d;d=1&m>>>16,this.__setDigit(b+k,m<<16|65535&f),e=this.__digit(b+k+1),f=(65535&e)-(l>>>16)-d,d=1&f>>>16}m=a.__digit(k);l=(e>>>16)-(65535&m)-d;d=1&l>>>16,this.__setDigit(b+k,l<<16|65535&f);if(b+k+1>=this.length)throw new RangeError("out of bounds");0==(1&c)&&(e=this.__digit(b+k+1),f=(65535&e)-(m>>>16)-d,d=1&f>>>16,this.__setDigit(b+a.length,4294901760&e|65535&f))}else{b>>=1;for(l=0;l<a.length-1;l++){k=this.__digit(b+l);m=a.__digit(l);e=(65535&k)-(65535&m)-d;d=1&e>>>16;f=(k>>>16)-(m>>>16)-d;d=1&f>>>16,this.__setDigit(b+l,f<<16|65535&e)}k=this.__digit(b+l);m=a.__digit(l);f=(65535&k)-(65535&m)-d;d=1&f>>>16;e=0;0==(1&c)&&(e=(k>>>16)-(m>>>16)-d,d=1&e>>>16),this.__setDigit(b+l,e<<16|65535&f)}return d}},{key:"__inplaceRightShift",value:function(a){if(0!==a){for(var b,c=this.__digit(0)>>>a,d=this.length-1,e=0;e<d;e++)b=this.__digit(e+1),this.__setDigit(e,b<<32-a|c),c=b>>>a;this.__setDigit(d,c)}}},{key:"__digit",value:function(a){return this[a]}},{key:"__unsignedDigit",value:function(a){return this[a]>>>0}},{key:"__setDigit",value:function(a,b){this[a]=0|b}},{key:"__setDigitGrow",value:function(a,b){this[a]=0|b}},{key:"__halfDigitLength",value:function(){var a=this.length;return 65535>=this.__unsignedDigit(a-1)?2*a-1:2*a}},{key:"__halfDigit",value:function(a){return 65535&this[a>>>1]>>>((1&a)<<4)}},{key:"__setHalfDigit",value:function(a,b){var c=a>>>1,d=this.__digit(c);a=1&a?65535&d|b<<16:4294901760&d|65535&b;this.__setDigit(c,a)}}],[{key:"BigInt",value:function(b){var c=Math.floor,d=Number.isFinite;if("number"==typeof b){if(0===b)return g.__zero();if((0|b)===b)return 0>b?g.__oneDigit(-b,!0):g.__oneDigit(b,!1);if(!d(b)||c(b)!==b)throw new RangeError("The number "+b+" cannot be converted to BigInt because it is not an integer");return g.__fromDouble(b)}if("string"==typeof b){d=g.__fromString(b);if(null===d)throw new SyntaxError("Cannot convert "+b+" to a BigInt");return d}if("boolean"==typeof b)return!0===b?g.__oneDigit(1,!1):g.__zero();if("object"===a(b)){if(b.constructor===g)return b;c=g.__toPrimitive(b);return g.BigInt(c)}throw new TypeError("Cannot convert "+b+" to a BigInt")}},{key:"toNumber",value:function(a){var b=a.length;if(0===b)return 0;if(1===b){var c=a.__unsignedDigit(0);return a.sign?-c:c}c=a.__digit(b-1);var d=k(c),e=32*b-d;if(1024<e)return a.sign?-Infinity:1/0;e=e-1;c=c;b=b-1;d=d+1;var f=32===d?0:c<<d;f>>>=12;var h=d-12,i=12<=d?0:c<<20+d;d=20+d;0<h&&0<b&&(b--,c=a.__digit(b),f|=c>>>32-h,i=c<<h,d=h),0<d&&0<b&&(b--,c=a.__digit(b),i|=c>>>32-d,d-=32);h=g.__decideRounding(a,d,b,c);if((1===h||0===h&&1==(1&i))&&(i=i+1>>>0,0===i&&(f++,0!=f>>>20&&(f=0,e++,1023<e))))return a.sign?-Infinity:1/0;d=a.sign?-2147483648:0;return e=e+1023<<20,g.__kBitConversionInts[1]=d|e|f,g.__kBitConversionInts[0]=i,g.__kBitConversionDouble[0]}},{key:"unaryMinus",value:function(a){if(0===a.length)return a;var b=a.__copy();return b.sign=!a.sign,b}},{key:"bitwiseNot",value:function(a){return a.sign?g.__absoluteSubOne(a).__trim():g.__absoluteAddOne(a,!0)}},{key:"exponentiate",value:function(a,b){if(b.sign)throw new RangeError("Exponent must be positive");if(0===b.length)return g.__oneDigit(1,!1);if(0===a.length)return a;if(1===a.length&&1===a.__digit(0))return a.sign&&0==(1&b.__digit(0))?g.unaryMinus(a):a;if(1<b.length)throw new RangeError("BigInt too big");b=b.__unsignedDigit(0);if(1===b)return a;if(b>=g.__kMaxLengthBits)throw new RangeError("BigInt too big");if(1===a.length&&2===a.__digit(0)){var c=1+(b>>>5),d=a.sign&&0!=(1&b);d=new g(c,d);d.__initializeDigits();var e=1<<(31&b);return d.__setDigit(c-1,e),d}c=null;e=a;for(0!=(1&b)&&(c=a),b>>=1;0!==b;b>>=1)e=g.multiply(e,e),0!=(1&b)&&(null===c?c=e:c=g.multiply(c,e));return c}},{key:"multiply",value:function(a,b){if(0===a.length)return a;if(0===b.length)return b;var c=a.length+b.length;32<=a.__clzmsd()+b.__clzmsd()&&c--;c=new g(c,a.sign!==b.sign);c.__initializeDigits();for(var d=0;d<a.length;d++)g.__multiplyAccumulate(b,a.__digit(d),c,d);return c.__trim()}},{key:"divide",value:function(a,b){if(0===b.length)throw new RangeError("Division by zero");if(0>g.__absoluteCompare(a,b))return g.__zero();var c=a.sign!==b.sign,d=b.__unsignedDigit(0);if(1===b.length&&65535>=d){if(1===d)return c===a.sign?a:g.unaryMinus(a);d=g.__absoluteDivSmall(a,d,null)}else d=g.__absoluteDivLarge(a,b,!0,!1);return d.sign=c,d.__trim()}},{key:"remainder",value:function(a,b){if(0===b.length)throw new RangeError("Division by zero");if(0>g.__absoluteCompare(a,b))return a;var c=b.__unsignedDigit(0);if(1===b.length&&65535>=c){if(1===c)return g.__zero();c=g.__absoluteModSmall(a,c);return 0===c?g.__zero():g.__oneDigit(c,a.sign)}c=g.__absoluteDivLarge(a,b,!1,!0);return c.sign=a.sign,c.__trim()}},{key:"add",value:function(a,b){var c=a.sign;return c===b.sign?g.__absoluteAdd(a,b,c):0<=g.__absoluteCompare(a,b)?g.__absoluteSub(a,b,c):g.__absoluteSub(b,a,!c)}},{key:"subtract",value:function(a,b){var c=a.sign;return c===b.sign?0<=g.__absoluteCompare(a,b)?g.__absoluteSub(a,b,c):g.__absoluteSub(b,a,!c):g.__absoluteAdd(a,b,c)}},{key:"leftShift",value:function(a,b){return 0===b.length||0===a.length?a:b.sign?g.__rightShiftByAbsolute(a,b):g.__leftShiftByAbsolute(a,b)}},{key:"signedRightShift",value:function(a,b){return 0===b.length||0===a.length?a:b.sign?g.__leftShiftByAbsolute(a,b):g.__rightShiftByAbsolute(a,b)}},{key:"unsignedRightShift",value:function(){throw new TypeError("BigInts have no unsigned right shift; use >> instead")}},{key:"lessThan",value:function(a,b){return 0>g.__compareToBigInt(a,b)}},{key:"lessThanOrEqual",value:function(a,b){return 0>=g.__compareToBigInt(a,b)}},{key:"greaterThan",value:function(a,b){return 0<g.__compareToBigInt(a,b)}},{key:"greaterThanOrEqual",value:function(a,b){return 0<=g.__compareToBigInt(a,b)}},{key:"equal",value:function(a,b){if(a.sign!==b.sign)return!1;if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(a.__digit(c)!==b.__digit(c))return!1;return!0}},{key:"notEqual",value:function(a,b){return!g.equal(a,b)}},{key:"bitwiseAnd",value:function(a,b){if(!a.sign&&!b.sign)return g.__absoluteAnd(a,b).__trim();if(a.sign&&b.sign){var c=i(a.length,b.length)+1;c=g.__absoluteSubOne(a,c);var d=g.__absoluteSubOne(b);return c=g.__absoluteOr(c,d,c),g.__absoluteAddOne(c,!0,c).__trim()}if(a.sign){d=[b,a];a=d[0],b=d[1]}return g.__absoluteAndNot(a,g.__absoluteSubOne(b)).__trim()}},{key:"bitwiseXor",value:function(a,b){if(!a.sign&&!b.sign)return g.__absoluteXor(a,b).__trim();if(a.sign&&b.sign){var c=i(a.length,b.length);c=g.__absoluteSubOne(a,c);var d=g.__absoluteSubOne(b);return g.__absoluteXor(c,d,c).__trim()}d=i(a.length,b.length)+1;if(a.sign){c=[b,a];a=c[0],b=c[1]}c=g.__absoluteSubOne(b,d);return c=g.__absoluteXor(c,a,c),g.__absoluteAddOne(c,!0,c).__trim()}},{key:"bitwiseOr",value:function(a,b){var c=i(a.length,b.length);if(!a.sign&&!b.sign)return g.__absoluteOr(a,b).__trim();if(a.sign&&b.sign){var d=g.__absoluteSubOne(a,c),e=g.__absoluteSubOne(b);return d=g.__absoluteAnd(d,e,d),g.__absoluteAddOne(d,!0,d).__trim()}if(a.sign){e=[b,a];a=e[0],b=e[1]}d=g.__absoluteSubOne(b,c);return d=g.__absoluteAndNot(d,a,d),g.__absoluteAddOne(d,!0,d).__trim()}},{key:"asIntN",value:function(a,b){if(0===b.length)return b;if(0===a)return g.__zero();if(a>=g.__kMaxLengthBits)return b;var c=a+31>>>5;if(b.length<c)return b;var d=b.__unsignedDigit(c-1),e=1<<(31&a-1);if(b.length===c&&d<e)return b;if(!((d&e)===e))return g.__truncateToNBits(a,b);if(!b.sign)return g.__truncateAndSubFromPowerOfTwo(a,b,!0);if(0==(d&e-1)){for(var f=c-2;0<=f;f--)if(0!==b.__digit(f))return g.__truncateAndSubFromPowerOfTwo(a,b,!1);return b.length===c&&d===e?b:g.__truncateToNBits(a,b)}return g.__truncateAndSubFromPowerOfTwo(a,b,!1)}},{key:"asUintN",value:function(a,b){if(0===b.length)return b;if(0===a)return g.__zero();if(b.sign){if(a>g.__kMaxLengthBits)throw new RangeError("BigInt too big");return g.__truncateAndSubFromPowerOfTwo(a,b,!1)}if(a>=g.__kMaxLengthBits)return b;var c=a+31>>>5;if(b.length<c)return b;var d=31&a;if(b.length==c){if(0==d)return b;c=b.__digit(c-1);if(0==c>>>d)return b}return g.__truncateToNBits(a,b)}},{key:"ADD",value:function(a,b){if(a=g.__toPrimitive(a),b=g.__toPrimitive(b),"string"==typeof a)return"string"!=typeof b&&(b=b.toString()),a+b;if("string"==typeof b)return a.toString()+b;if(a=g.__toNumeric(a),b=g.__toNumeric(b),g.__isBigInt(a)&&g.__isBigInt(b))return g.add(a,b);if("number"==typeof a&&"number"==typeof b)return a+b;throw new TypeError("Cannot mix BigInt and other types, use explicit conversions")}},{key:"LT",value:function(a,b){return g.__compare(a,b,0)}},{key:"LE",value:function(a,b){return g.__compare(a,b,1)}},{key:"GT",value:function(a,b){return g.__compare(a,b,2)}},{key:"GE",value:function(a,b){return g.__compare(a,b,3)}},{key:"EQ",value:function(b,c){for(;;){if(g.__isBigInt(b))return g.__isBigInt(c)?g.equal(b,c):g.EQ(c,b);if("number"==typeof b){if(g.__isBigInt(c))return g.__equalToNumber(c,b);if("object"!==a(c))return b==c;c=g.__toPrimitive(c)}else if("string"==typeof b){if(g.__isBigInt(c))return b=g.__fromString(b),null!==b&&g.equal(b,c);if("object"!==a(c))return b==c;c=g.__toPrimitive(c)}else if("boolean"==typeof b){if(g.__isBigInt(c))return g.__equalToNumber(c,+b);if("object"!==a(c))return b==c;c=g.__toPrimitive(c)}else if("symbol"===a(b)){if(g.__isBigInt(c))return!1;if("object"!==a(c))return b==c;c=g.__toPrimitive(c)}else if("object"===a(b)){if("object"===a(c)&&c.constructor!==g)return b==c;b=g.__toPrimitive(b)}else return b==c}}},{key:"NE",value:function(a,b){return!g.EQ(a,b)}},{key:"__zero",value:function(){return new g(0,!1)}},{key:"__oneDigit",value:function(a,b){b=new g(1,b);return b.__setDigit(0,a),b}},{key:"__decideRounding",value:function(a,b,c,d){if(0<b)return-1;if(0>b)b=-b-1;else{if(0===c)return-1;c--,d=a.__digit(c),b=31}b=1<<b;if(0==(d&b))return-1;if(b-=1,0!=(d&b))return 1;for(;0<c;)if(c--,0!==a.__digit(c))return 1;return 0}},{key:"__fromDouble",value:function(a){g.__kBitConversionDouble[0]=a;var b,c=2047&g.__kBitConversionInts[1]>>>20;c=c-1023;var d=(c>>>5)+1;a=new g(d,0>a);var e=1048575&g.__kBitConversionInts[1]|1048576,f=g.__kBitConversionInts[0],k=20;c=31&c;var n=0;if(c<k){var m=k-c;n=m+32,b=e>>>m,e=e<<32-m|f>>>m,f<<=32-m}else if(c===k)n=32,b=e,e=f;else{m=c-k;n=32-m,b=e<<m|f>>>32-m,e=f<<m}a.__setDigit(d-1,b);for(c=d-2;0<=c;c--)0<n?(n-=32,b=e,e=f):b=0,a.__setDigit(c,b);return a.__trim()}},{key:"__isWhitespace",value:function(a){return!!(13>=a&&9<=a)||(159>=a?32==a:131071>=a?160==a||5760==a:196607>=a?(a&=131071,10>=a||40==a||41==a||47==a||95==a||4096==a):65279==a)}},{key:"__fromString",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c=0,d=a.length,e=0;if(e===d)return g.__zero();for(var f=a.charCodeAt(e);g.__isWhitespace(f);){if(++e===d)return g.__zero();f=a.charCodeAt(e)}if(43===f){if(++e===d)return null;f=a.charCodeAt(e),c=1}else if(45===f){if(++e===d)return null;f=a.charCodeAt(e),c=-1}if(0===b){if(b=10,48===f){if(++e===d)return g.__zero();if(f=a.charCodeAt(e),88===f||120===f){if(b=16,++e===d)return null;f=a.charCodeAt(e)}else if(79===f||111===f){if(b=8,++e===d)return null;f=a.charCodeAt(e)}else if(66===f||98===f){if(b=2,++e===d)return null;f=a.charCodeAt(e)}}}else if(16===b&&48===f){if(++e===d)return g.__zero();if(f=a.charCodeAt(e),88===f||120===f){if(++e===d)return null;f=a.charCodeAt(e)}}for(;48===f;){if(++e===d)return g.__zero();f=a.charCodeAt(e)}var m=d-e,i=g.__kMaxBitsPerChar[b],j=g.__kBitsPerCharTableMultiplier-1;if(m>1073741824/i)return null;var k=i*m+j>>>g.__kBitsPerCharTableShift,l=new g(k+31>>>5,!1),n=10>b?b:10,o=10<b?b-10:0;if(0==(b&b-1)){i>>=g.__kBitsPerCharTableShift;var p=[],q=[],r=!1;do{for(var s,t=0,u=0;;){if(void 0,f-48>>>0<n)s=f-48;else if((32|f)-97>>>0<o)s=(32|f)-87;else{r=!0;break}if(u+=i,t=t<<i|s,++e===d){r=!0;break}if(f=a.charCodeAt(e),32<u+i)break}p.push(t),q.push(u)}while(!r);g.__fillFromParts(l,p,q)}else{l.__initializeDigits();var v=!1,w=0;do{for(var x,y=0,z=1;;){if(void 0,f-48>>>0<n)x=f-48;else if((32|f)-97>>>0<o)x=(32|f)-87;else{v=!0;break}var A=z*b;if(4294967295<A)break;if(z=A,y=y*b+x,w++,++e===d){v=!0;break}f=a.charCodeAt(e)}j=32*g.__kBitsPerCharTableMultiplier-1;var B=i*w+j>>>g.__kBitsPerCharTableShift+5;l.__inplaceMultiplyAdd(z,y,B)}while(!v)}if(e!==d){if(!g.__isWhitespace(f))return null;for(e++;e<d;e++)if(f=a.charCodeAt(e),!g.__isWhitespace(f))return null}return 0!==c&&10!==b?null:(l.sign=-1===c,l.__trim())}},{key:"__fillFromParts",value:function(a,b,c){for(var d=0,e=0,f=0,k=b.length-1;0<=k;k--){var l=b[k],m=c[k];e|=l<<f,f+=m,32===f?(a.__setDigit(d++,e),f=0,e=0):32<f&&(a.__setDigit(d++,e),f-=32,e=l>>>m-f)}if(0!==e){if(d>=a.length)throw new Error("implementation bug");a.__setDigit(d++,e)}for(;d<a.length;d++)a.__setDigit(d,0)}},{key:"__toStringBasePowerOfTwo",value:function(a,b){var c=a.length,d=b-1;d=(85&d>>>1)+(85&d),d=(51&d>>>2)+(51&d),d=(15&d>>>4)+(15&d);d=d;b=b-1;var e=a.__digit(c-1),f=k(e);f=0|(32*c-f+d-1)/d;if(a.sign&&f++,268435456<f)throw new Error("string too long");for(var h=Array(f),f=f-1,l=0,n=0,o=0;o<c-1;o++){var p=a.__digit(o),q=(l|p<<n)&b;h[f--]=g.__kConversionChars[q];q=d-n;for(l=p>>>q,n=32-q;n>=d;)h[f--]=g.__kConversionChars[l&b],l>>>=d,n-=d}p=(l|e<<n)&b;for(h[f--]=g.__kConversionChars[p],l=e>>>d-n;0!==l;)h[f--]=g.__kConversionChars[l&b],l>>>=d;if(a.sign&&(h[f--]="-"),-1!==f)throw new Error("implementation bug");return h.join("")}},{key:"__toStringGeneric",value:function(a,b,c){var d=a.length;if(0===d)return"";if(1===d){var e=a.__unsignedDigit(0).toString(b);return!1===c&&a.sign&&(e="-"+e),e}e=32*d-k(a.__digit(d-1));d=g.__kMaxBitsPerChar[b];d=d-1;e=e*g.__kBitsPerCharTableMultiplier;e+=d-1,e=0|e/d;var f;d=e+1>>1;e=g.exponentiate(g.__oneDigit(b,!1),g.__oneDigit(d,!1));var h=e.__unsignedDigit(0);if(1===e.length&&65535>=h){f=new g(a.length,!1),f.__initializeDigits();for(var i,j=0,l=2*a.length-1;0<=l;l--)i=j<<16|a.__halfDigit(l),f.__setHalfDigit(l,0|i/h),j=0|i%h;i=j.toString(b)}else{h=g.__absoluteDivLarge(a,e,!0,!0);f=h.quotient;l=h.remainder.__trim();i=g.__toStringGeneric(l,b,!0)}f.__trim();for(j=g.__toStringGeneric(f,b,!0);i.length<d;)i="0"+i;return!1===c&&a.sign&&(j="-"+j),j+i}},{key:"__unequalSign",value:function(a){return a?-1:1}},{key:"__absoluteGreater",value:function(a){return a?-1:1}},{key:"__absoluteLess",value:function(a){return a?1:-1}},{key:"__compareToBigInt",value:function(a,b){var c=a.sign;if(c!==b.sign)return g.__unequalSign(c);a=g.__absoluteCompare(a,b);return 0<a?g.__absoluteGreater(c):0>a?g.__absoluteLess(c):0}},{key:"__compareToNumber",value:function(a,b){if(!0|b){var c=a.sign,d=0>b;if(c!==d)return g.__unequalSign(c);if(0===a.length){if(d)throw new Error("implementation bug");return 0===b?0:-1}if(1<a.length)return g.__absoluteGreater(c);d=h(b);var e=a.__unsignedDigit(0);return e>d?g.__absoluteGreater(c):e<d?g.__absoluteLess(c):0}return g.__compareToDouble(a,b)}},{key:"__compareToDouble",value:function(a,b){if(b!==b)return b;if(b===1/0)return-1;if(b===-Infinity)return 1;var c=a.sign;if(c!==0>b)return g.__unequalSign(c);if(0===b)throw new Error("implementation bug: should be handled elsewhere");if(0===a.length)return-1;g.__kBitConversionDouble[0]=b;b=2047&g.__kBitConversionInts[1]>>>20;if(2047==b)throw new Error("implementation bug: handled elsewhere");b=b-1023;if(0>b)return g.__absoluteGreater(c);var d=a.length,e=a.__digit(d-1),f=k(e),l=32*d-f;b=b+1;if(l<b)return g.__absoluteLess(c);if(l>b)return g.__absoluteGreater(c);b=1048576|1048575&g.__kBitConversionInts[1];var m=g.__kBitConversionInts[0],o=20;f=31-f;if(f!==(l-1)%31)throw new Error("implementation bug");var p;l=0;if(f<o){var q=o-f;l=q+32,p=b>>>q,b=b<<32-q|m>>>q,m<<=32-q}else if(f===o)l=32,p=b,b=m;else{q=f-o;l=32-q,p=b<<q|m>>>32-q,b=m<<q}if(e>>>=0,p>>>=0,e>p)return g.__absoluteGreater(c);if(e<p)return g.__absoluteLess(c);for(f=d-2;0<=f;f--){0<l?(l-=32,p=b>>>0,b=m,m=0):p=0;o=a.__unsignedDigit(f);if(o>p)return g.__absoluteGreater(c);if(o<p)return g.__absoluteLess(c)}if(0!==b||0!==m){if(0===l)throw new Error("implementation bug");return g.__absoluteLess(c)}return 0}},{key:"__equalToNumber",value:function(a,b){return b|0===b?0===b?0===a.length:1===a.length&&a.sign===0>b&&a.__unsignedDigit(0)===h(b):0===g.__compareToDouble(a,b)}},{key:"__comparisonResultToBool",value:function(a,b){switch(b){case 0:return 0>a;case 1:return 0>=a;case 2:return 0<a;case 3:return 0<=a}throw new Error("unreachable")}},{key:"__compare",value:function(a,b,c){if(a=g.__toPrimitive(a),b=g.__toPrimitive(b),"string"==typeof a&&"string"==typeof b)switch(c){case 0:return a<b;case 1:return a<=b;case 2:return a>b;case 3:return a>=b}if(g.__isBigInt(a)&&"string"==typeof b)return b=g.__fromString(b),null!==b&&g.__comparisonResultToBool(g.__compareToBigInt(a,b),c);if("string"==typeof a&&g.__isBigInt(b))return a=g.__fromString(a),null!==a&&g.__comparisonResultToBool(g.__compareToBigInt(a,b),c);if(a=g.__toNumeric(a),b=g.__toNumeric(b),g.__isBigInt(a)){if(g.__isBigInt(b))return g.__comparisonResultToBool(g.__compareToBigInt(a,b),c);if("number"!=typeof b)throw new Error("implementation bug");return g.__comparisonResultToBool(g.__compareToNumber(a,b),c)}if("number"!=typeof a)throw new Error("implementation bug");if(g.__isBigInt(b))return g.__comparisonResultToBool(g.__compareToNumber(b,a),2^c);if("number"!=typeof b)throw new Error("implementation bug");return 0===c?a<b:1===c?a<=b:2===c?a>b:3===c?a>=b:void 0}},{key:"__absoluteAdd",value:function(a,b,c){if(a.length<b.length)return g.__absoluteAdd(b,a,c);if(0===a.length)return a;if(0===b.length)return a.sign===c?a:g.unaryMinus(a);var d=a.length;(0===a.__clzmsd()||b.length===a.length&&0===b.__clzmsd())&&d++;for(var d=new g(d,c),c=0,e=0;e<b.length;e++){var f=b.__digit(e),h=a.__digit(e),m=(65535&h)+(65535&f)+c;h=(h>>>16)+(f>>>16)+(m>>>16);c=h>>>16,d.__setDigit(e,65535&m|h<<16)}for(;e<a.length;e++){f=a.__digit(e);m=(65535&f)+c;h=(f>>>16)+(m>>>16);c=h>>>16,d.__setDigit(e,65535&m|h<<16)}return e<d.length&&d.__setDigit(e,c),d.__trim()}},{key:"__absoluteSub",value:function(a,b,c){if(0===a.length)return a;if(0===b.length)return a.sign===c?a:g.unaryMinus(a);for(var c=new g(a.length,c),d=0,e=0;e<b.length;e++){var f=a.__digit(e),l=b.__digit(e),m=(65535&f)-(65535&l)-d;d=1&m>>>16;f=(f>>>16)-(l>>>16)-d;d=1&f>>>16,c.__setDigit(e,65535&m|f<<16)}for(;e<a.length;e++){l=a.__digit(e);m=(65535&l)-d;d=1&m>>>16;f=(l>>>16)-d;d=1&f>>>16,c.__setDigit(e,65535&m|f<<16)}return c.__trim()}},{key:"__absoluteAddOne",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=a.length;null===c?c=new g(d,b):c.sign=b;for(var e=!0,f=0;f<d;f++){var k=a.__digit(f),l=-1===k;e&&(k=0|k+1),e=l,c.__setDigit(f,k)}return e&&c.__setDigitGrow(d,1),c}},{key:"__absoluteSubOne",value:function(a,b){var c=a.length;b=b||c;for(var d=new g(b,!1),e=!0,f=0;f<c;f++){var k=a.__digit(f),l=0===k;e&&(k=0|k-1),e=l,d.__setDigit(f,k)}for(l=c;l<b;l++)d.__setDigit(l,0);return d}},{key:"__absoluteAnd",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=a.length,e=b.length,f=e;if(d<e){f=d;var m=a,n=d;a=b,e,b=m,n}var k=f;null===c?c=new g(k,!1):k=c.length;for(var l=0;l<f;l++)c.__setDigit(l,a.__digit(l)&b.__digit(l));for(;l<k;l++)c.__setDigit(l,0);return c}},{key:"__absoluteAndNot",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=a.length,e=b.length,f=e;d<e&&(f=d);var k=d;null===c?c=new g(k,!1):k=c.length;for(var l=0;l<f;l++)c.__setDigit(l,a.__digit(l)&~b.__digit(l));for(;l<d;l++)c.__setDigit(l,a.__digit(l));for(;l<k;l++)c.__setDigit(l,0);return c}},{key:"__absoluteOr",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=a.length,e=b.length,f=e;if(d<e){f=d;var m=a,n=d;a=b,d=e,b=m,n}var k=d;null===c?c=new g(k,!1):k=c.length;for(var l=0;l<f;l++)c.__setDigit(l,a.__digit(l)|b.__digit(l));for(;l<d;l++)c.__setDigit(l,a.__digit(l));for(;l<k;l++)c.__setDigit(l,0);return c}},{key:"__absoluteXor",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=a.length,e=b.length,f=e;if(d<e){f=d;var m=a,n=d;a=b,d=e,b=m,n}var k=d;null===c?c=new g(k,!1):k=c.length;for(var l=0;l<f;l++)c.__setDigit(l,a.__digit(l)^b.__digit(l));for(;l<d;l++)c.__setDigit(l,a.__digit(l));for(;l<k;l++)c.__setDigit(l,0);return c}},{key:"__absoluteCompare",value:function(a,b){var c=a.length-b.length;if(0!=c)return c;for(c=a.length-1;0<=c&&a.__digit(c)===b.__digit(c);)c--;return 0>c?0:a.__unsignedDigit(c)>b.__unsignedDigit(c)?1:-1}},{key:"__multiplyAccumulate",value:function(a,b,c,d){if(0!==b){for(var e=65535&b,b=b>>>16,f=0,g=0,k=0,l=0;l<a.length;l++,d++){var m=c.__digit(d),n=65535&m,o=m>>>16,p=a.__digit(l),q=65535&p;p=p>>>16;var r=j(q,e);q=j(q,b);var s=j(p,e);p=j(p,b);n+=g+(65535&r),o+=k+f+(n>>>16)+(r>>>16)+(65535&q)+(65535&s),f=o>>>16,g=(q>>>16)+(s>>>16)+(65535&p)+f,f=g>>>16,g&=65535,k=p>>>16,m=65535&n|o<<16,c.__setDigit(d,m)}for(;0!==f||0!==g||0!==k;d++){r=c.__digit(d);q=(65535&r)+g;s=(r>>>16)+(q>>>16)+k+f;g=0,k=0,f=s>>>16,r=65535&q|s<<16,c.__setDigit(d,r)}}}},{key:"__internalMultiplyAdd",value:function(a,b,c,d,e){for(var c=c,f=0,h=0;h<d;h++){var l=a.__digit(h),m=j(65535&l,b),n=(65535&m)+f+c;c=n>>>16;l=j(l>>>16,b);m=(65535&l)+(m>>>16)+c;c=m>>>16,f=l>>>16,e.__setDigit(h,m<<16|65535&n)}if(e.length>d)for(e.__setDigit(d++,c+f);d<e.length;)e.__setDigit(d++,0);else if(0!==c+f)throw new Error("implementation bug")}},{key:"__absoluteDivSmall",value:function(a,b,c){null===c&&(c=new g(a.length,!1));for(var d=0,e=2*a.length-1;0<=e;e-=2){var f=(d<<16|a.__halfDigit(e))>>>0,k=0|f/b;d=0|f%b,f=(d<<16|a.__halfDigit(e-1))>>>0;var l=0|f/b;d=0|f%b,c.__setDigit(e>>>1,k<<16|l)}return c}},{key:"__absoluteModSmall",value:function(a,b){for(var c,d=0,e=2*a.length-1;0<=e;e--)c=(d<<16|a.__halfDigit(e))>>>0,d=0|c%b;return d}},{key:"__absoluteDivLarge",value:function(a,b,c,d){var f=b.__halfDigitLength(),e=b.length,n=a.__halfDigitLength()-f,i=null;c&&(i=new g(n+2>>>1,!1),i.__initializeDigits());var l=new g(f+2>>>1,!1);l.__initializeDigits();var m=g.__clz16(b.__halfDigit(f-1));0<m&&(b=g.__specialLeftShift(b,m,0));for(var a=g.__specialLeftShift(a,m,1),k=b.__halfDigit(f-1),o=0,n=n;0<=n;n--){var p=65535,q=a.__halfDigit(n+f);if(q!==k){q=(q<<16|a.__halfDigit(n+f-1))>>>0;p=0|q/k;for(var q=0|q%k,r=b.__halfDigit(f-2),s=a.__halfDigit(n+f-2);j(p,r)>>>0>(q<<16|s)>>>0&&(p--,q+=k,!(65535<q)););}g.__internalMultiplyAdd(b,p,0,e,l);r=a.__inplaceSub(l,n,f+1);0!==r&&(r=a.__inplaceAdd(b,n,f),a.__setHalfDigit(n+f,a.__halfDigit(n+f)+r),p--),c&&(1&n?o=p<<16:i.__setDigit(n>>>1,o|p))}return d?(a.__inplaceRightShift(m),c?{quotient:i,remainder:a}:a):c?i:void 0}},{key:"__clz16",value:function(a){return k(a)-16}},{key:"__specialLeftShift",value:function(a,b,c){var e=a.length,d=new g(e+c,!1);if(0===b){for(var f=0;f<e;f++)d.__setDigit(f,a.__digit(f));return 0<c&&d.__setDigit(e,0),d}for(var j,f=0,l=0;l<e;l++)j=a.__digit(l),d.__setDigit(l,j<<b|f),f=j>>>32-b;return 0<c&&d.__setDigit(e,f),d}},{key:"__leftShiftByAbsolute",value:function(a,b){b=g.__toShiftAmount(b);if(0>b)throw new RangeError("BigInt too big");var c=b>>>5;b=31&b;var d=a.length,e=0!==b&&0!=a.__digit(d-1)>>>32-b,f=d+c+(e?1:0),m=new g(f,a.sign);if(0===b){for(var n=0;n<c;n++)m.__setDigit(n,0);for(;n<f;n++)m.__setDigit(n,a.__digit(n-c))}else{for(n=0,f=0;f<c;f++)m.__setDigit(f,0);for(var o,f=0;f<d;f++)o=a.__digit(f),m.__setDigit(f+c,o<<b|n),n=o>>>32-b;if(e)m.__setDigit(d+c,n);else if(0!==n)throw new Error("implementation bug")}return m.__trim()}},{key:"__rightShiftByAbsolute",value:function(a,b){var c=a.length,d=a.sign;b=g.__toShiftAmount(b);if(0>b)return g.__rightShiftByMaximum(d);var e=b>>>5;b=31&b;var f=c-e;if(0>=f)return g.__rightShiftByMaximum(d);var i=!1;if(d)if(0!=(a.__digit(e)&(1<<b)-1))i=!0;else for(var m=0;m<e;m++)if(0!==a.__digit(m)){i=!0;break}if(i&&0===b){m=a.__digit(c-1);0==~m&&f++}m=new g(f,d);if(0===b)for(f=e;f<c;f++)m.__setDigit(f-e,a.__digit(f));else{for(var n,d=a.__digit(e)>>>b,f=c-e-1,c=0;c<f;c++)n=a.__digit(c+e+1),m.__setDigit(c,n<<32-b|d),d=n>>>b;m.__setDigit(f,d)}return i&&(m=g.__absoluteAddOne(m,!0,m)),m.__trim()}},{key:"__rightShiftByMaximum",value:function(a){return a?g.__oneDigit(1,!0):g.__zero()}},{key:"__toShiftAmount",value:function(a){if(1<a.length)return-1;a=a.__unsignedDigit(0);return a>g.__kMaxLengthBits?-1:a}},{key:"__toPrimitive",value:function(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"default";if("object"!==a(b))return b;if(b.constructor===g)return b;var d=b[Symbol.toPrimitive];if(d){var e=d(c);if("object"!==a(e))return e;throw new TypeError("Cannot convert object to primitive value")}var f=b.valueOf;if(f){var k=f.call(b);if("object"!==a(k))return k}var l=b.toString;if(l){var m=l.call(b);if("object"!==a(m))return m}throw new TypeError("Cannot convert object to primitive value")}},{key:"__toNumeric",value:function(a){return g.__isBigInt(a)?a:+a}},{key:"__isBigInt",value:function(b){return"object"===a(b)&&b.constructor===g}},{key:"__truncateToNBits",value:function(a,b){for(var c=a+31>>>5,d=new g(c,b.sign),c=c-1,e=0;e<c;e++)d.__setDigit(e,b.__digit(e));e=b.__digit(c);if(0!=(31&a)){b=32-(31&a);e=e<<b>>>b}return d.__setDigit(c,e),d.__trim()}},{key:"__truncateAndSubFromPowerOfTwo",value:function(a,b,c){for(var d=Math.min,e=a+31>>>5,c=new g(e,c),f=0,e=e-1,h=0,d=d(e,b.length);f<d;f++){var j=b.__digit(f),l=0-(65535&j)-h;h=1&l>>>16;j=0-(j>>>16)-h;h=1&j>>>16,c.__setDigit(f,65535&l|j<<16)}for(;f<e;f++)c.__setDigit(f,0|-h);l=e<b.length?b.__digit(e):0;j=31&a;if(0===j){d=0-(65535&l)-h;h=1&d>>>16;f=0-(l>>>16)-h;b=65535&d|f<<16}else{a=32-j;l=l<<a>>>a;d=1<<32-a;f=(65535&d)-(65535&l)-h;h=1&f>>>16;j=(d>>>16)-(l>>>16)-h;b=65535&f|j<<16,b&=d-1}return c.__setDigit(e,b),c.__trim()}},{key:"__digitPow",value:function(a,b){for(var c=1;0<b;)1&b&&(c*=a),b>>>=1,a*=a;return c}}]),g}(k(Array));return n.__kMaxLength=33554432,n.__kMaxLengthBits=n.__kMaxLength<<5,n.__kMaxBitsPerChar=[0,0,32,51,64,75,83,90,96,102,107,111,115,119,122,126,128,131,134,136,139,141,143,145,147,149,151,153,154,156,158,159,160,162,163,165,166],n.__kBitsPerCharTableShift=5,n.__kBitsPerCharTableMultiplier=1<<n.__kBitsPerCharTableShift,n.__kConversionChars=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],n.__kBitConversionBuffer=new ArrayBuffer(8),n.__kBitConversionDouble=new Float64Array(n.__kBitConversionBuffer),n.__kBitConversionInts=new Int32Array(n.__kBitConversionBuffer),n})}),null);
__d("TCompactProtocolPolyfill",["StringToUtf8","ThriftTypes","Utf8ToString","jsbi"],(function(a,b,c,d,e,f,g){var h,i=Object.freeze({CT_STOP:0,CT_BOOLEAN_TRUE:1,CT_BOOLEAN_FALSE:2,CT_BYTE:3,CT_I16:4,CT_I32:5,CT_I64:6,CT_DOUBLE:7,CT_BINARY:8,CT_LIST:9,CT_SET:10,CT_MAP:11,CT_STRUCT:12,CT_FLOAT:13}),j=Object.freeze({NONE:-1,CT_BOOLEAN_TRUE:i.CT_BOOLEAN_TRUE,CT_BOOLEAN_FALSE:i.CT_BOOLEAN_FALSE}),k=[i.CT_STOP,0,i.CT_BOOLEAN_TRUE,i.CT_BYTE,i.CT_DOUBLE,0,i.CT_I16,0,i.CT_I32,0,i.CT_I64,i.CT_BINARY,i.CT_STRUCT,i.CT_MAP,i.CT_SET,i.CT_LIST,0,0,0,i.CT_FLOAT],l=Math.pow(2,7)-1,m=-1*Math.pow(2,7),n=Math.pow(2,15)-1,o=-1*Math.pow(2,15),p=Math.pow(2,31)-1,q=-1*Math.pow(2,31),r=Math.pow(2,32)-1,s=(a=c("jsbi")).BigInt("9223372036854775807"),t=a.BigInt("-9223372036854775808"),u=a.BigInt("18446744073709551615"),v=a.BigInt(63),w=a.BigInt(1),x=a.BigInt(0),y=a.BigInt(7),z=a.BigInt(70),A=a.BigInt(127),B=a.BigInt(128),C=Math.pow(2,4);b=function(){function a(a){this.$4=null,this.$5=null,this.$1=a,this.$2=[],this.$3=0,this.$6=new DataView(new ArrayBuffer(1))}var b=a.prototype;b.readStructBegin=function(){this.$2.push(this.$3),this.$3=0};b.readStructEnd=function(){this.$3=this.$2.pop();return 0};b.writeStructBegin=function(a){this.$2.push(this.$3);this.$3=0;return 0};b.writeStructEnd=function(){this.$3=this.$2.pop();return 0};b.writeFieldBegin=function(a){if(a.ftype===(h||(h=c("ThriftTypes"))).BOOL){this.$4={fid:a.fid,fname:a.fname,ftype:a.ftype};return 0}else return this.$7(a,j.NONE)};b.writeListBegin=function(a){return this.$8(a)};b.writeListEnd=function(){return 0};b.writeSetBegin=function(a){return this.$8(a)};b.writeSetEnd=function(){return 0};b.writeMapBegin=function(a){var b=0;if(a.size===0)b+=this.$1.writeByte(0);else{b+=this.writeVarint32(a.size);if(a.ktype!=null&&a.vtype!=null)b+=this.$1.writeByte(this.$9(a.ktype)<<4|this.$9(a.vtype));else throw new Error("received invalid map info: "+JSON.stringify(a))}return b};b.writeMapEnd=function(){return 0};b.$7=function(a,b){var c=0;b=b===j.NONE?this.$9(a.ftype):b;a.fid>this.$3&&a.fid-this.$3<=C-1?c+=this.$1.writeByte(a.fid-this.$3<<4|b):(c+=this.$1.writeByte(b),c+=this.writeI16(a.fid));this.$3=a.fid;return c};b.$8=function(a){var b=0,c=this.$9(a.etype);a.size<=C-2?b+=this.$1.writeByte(a.size<<4|c):(b+=this.$1.writeByte(240|c),b+=this.writeVarint32(a.size));return b};b.readFieldBegin=function(){var a=this.$1.readByte(),b=a&15;if(b===(h||(h=c("ThriftTypes"))).STOP)return{ftype:(h||(h=c("ThriftTypes"))).STOP,fid:0};a=(a&240)>>>4;var d;a===0?d=this.readI16():d=this.$3+a;a=this.$10(b);(b===i.CT_BOOLEAN_TRUE||b===i.CT_BOOLEAN_FALSE)&&(this.$5=b===i.CT_BOOLEAN_TRUE);this.$3=d;return{ftype:a,fid:d}};b.readListBegin=function(){return this.$11()};b.readListEnd=function(){return 0};b.readSetBegin=function(){return this.$11()};b.readSetEnd=function(){return 0};b.readMapBegin=function(){var a=this.readVarint32();if(a>0){var b=this.$1.readByte(),c=this.$12(b>>4,"readMapBegin:key");b=this.$12(b&15,"readMapBegin:value");return{ktype:this.$10(c),vtype:this.$10(b),size:a}}return{size:a}};b.readMapEnd=function(){return 0};b.$12=function(a,b){if(a<0||a>13)throw new Error(b+" read invalid compact type: "+a);return a};b.$11=function(){var a=this.$1.readByte(),b=this.$12(a&15,"_readListOrSetBegin");b=this.$10(b);a=a>>4&15;a===15&&(a=this.readVarint32());return{etype:b,size:a}};b.readFieldEnd=function(){return 0};b.readByte=function(){this.$6.setUint8(0,this.$1.readByte());return this.$6.getInt8(0)};b.writeByte=function(a){if(a<m||a>l)throw new Error("byte to write is out of range: "+a);this.$6.setInt8(0,a);return this.$1.writeByte(this.$6.getUint8(0))};b.readFloat=function(){return this.$1.readFloatBE()};b.writeFloat=function(a){return this.$1.writeFloatBE(a)};b.readDouble=function(){return this.$1.readDoubleBE()};b.writeDouble=function(a){return this.$1.writeDoubleBE(a)};b.writeString=function(a){return this.writeBinary(d("StringToUtf8").StringToUtf8(a))};b.skip=function(a){switch(a){case(h||(h=c("ThriftTypes"))).STOP:return;case(h||(h=c("ThriftTypes"))).BOOL:this.readBool();break;case(h||(h=c("ThriftTypes"))).BYTE:this.readByte();break;case(h||(h=c("ThriftTypes"))).DOUBLE:this.readDouble();break;case(h||(h=c("ThriftTypes"))).I16:this.readI16();break;case(h||(h=c("ThriftTypes"))).I32:this.readI32();break;case(h||(h=c("ThriftTypes"))).I64:this.readI64();break;case(h||(h=c("ThriftTypes"))).STRING:this.readString();break;case(h||(h=c("ThriftTypes"))).STRUCT:this.readStructBegin();var b;while(!0){b=this.readFieldBegin();if(b.ftype===(h||(h=c("ThriftTypes"))).STOP)break;this.skip(b.ftype)}this.readStructEnd();break;case(h||(h=c("ThriftTypes"))).MAP:b=this.readMapBegin();if(b.size>0&&b.ktype!=null&&b.vtype!=null){var d=b.ktype,e=b.vtype;for(var f=0;f<b.size;f++)this.skip(d),this.skip(e)}break;case(h||(h=c("ThriftTypes"))).SET:case(h||(h=c("ThriftTypes"))).LIST:f=this.$11();for(d=0;d<f.size;d++)this.skip(f.etype);break;case(h||(h=c("ThriftTypes"))).FLOAT:this.readFloat();break;default:throw new Error("encoutered unknow thrift type: "+a+" in skip")}};b.toByteArray=function(){return this.$1.toByteArray()};b.writeFieldEnd=function(){return 0};b.writeFieldStop=function(){return this.$1.writeByte((h||(h=c("ThriftTypes"))).STOP)};b.writeI16=function(a){if(a<o||a>n)throw new Error("trying to write i16 out of range: "+a);return this.writeVarint32(this.i32ToZigzag(a))};b.readI16=function(){var a=this.zigzagToI32(this.readVarint32());if(a<o||a>n)throw new Error("read invalid i16: "+a);return a};b.writeI32=function(a){if(a<q||a>p)throw new Error("i32 out of range: "+a);return this.writeVarint32(this.i32ToZigzag(a))};b.readI32=function(){return this.zigzagToI32(this.readVarint32())};b.writeI64=function(a){return this.writeVarint64(this.i64ToZigzag(a))};b.readI64=function(){return this.zigzagToI64(this.readVarint64())};b.readBool=function(){var a;this.$5!=null?(a=this.$5,this.$5=null):a=this.$1.readByte()===i.CT_BOOLEAN_TRUE;return a};b.writeBool=function(a){var b=0;this.$4!=null?(b+=this.$7(this.$4,a?j.CT_BOOLEAN_TRUE:j.CT_BOOLEAN_FALSE),this.$4=null):b+=this.$1.writeByte(a?i.CT_BOOLEAN_TRUE:i.CT_BOOLEAN_FALSE);return b};b.readBinary=function(){var a=this.readVarint32();return a===0?new Uint8Array(0):this.$1.readBytes(a)};b.writeBinary=function(a){var b=0;b+=this.writeVarint32(a.length);b+=this.$1.write(a);return b};b.i32ToZigzag=function(a){if(a<q||a>p)throw new Error("number: "+a+" is out of range of i32");return(a<<1^(a<0?4294967295:0))>>>0};b.zigzagToI32=function(a){if(a<0||a>r)throw new Error("number: "+a+" is out of range of uint32");return a>>>1^-1*(a&1)};b.i64ToZigzag=function(a){if(c("jsbi").greaterThan(a,s)||c("jsbi").lessThan(a,t))throw new Error("i64 out of range: "+a.toString());return c("jsbi").bitwiseXor(c("jsbi").signedRightShift(a,v),c("jsbi").leftShift(a,w))};b.zigzagToI64=function(a){if(c("jsbi").lessThan(a,0)||c("jsbi").greaterThan(a,u))throw new Error("invalid uint64: "+a.toString());return c("jsbi").equal(c("jsbi").bitwiseAnd(a,w),w)?c("jsbi").bitwiseNot(c("jsbi").signedRightShift(a,w)):c("jsbi").signedRightShift(a,w)};b.writeVarint32=function(a){if(a<0||a>r)throw new Error("writeVarint32 received out of range uint32: "+a);a=a;var b=0;while(!0)if(a>>>7===0){this.$1.writeByte(a);b++;break}else this.$1.writeByte(a&127|128),b++,a>>>=7;return b};b.readVarint32=function(){var a=0,b=0,c;while(!0){c=this.$1.readByte();a=(a|(c&127)<<b)>>>0;b+=7;if((c&128)==0){if(b===35&&(c&240)!=0)throw new Error("result exceeded 32 bit limit");break}if(b>28)throw new Error("result exceeded 32 bit limit")}return a};b.writeVarint64=function(a){if(c("jsbi").lessThan(a,x)||c("jsbi").greaterThan(a,u))throw new Error("invalid uint64: "+a.toString());a=a;var b=0;while(!0)if(c("jsbi").equal(c("jsbi").signedRightShift(a,y),x)){this.$1.writeByte(c("jsbi").toNumber(a));b++;break}else{var d,e=(d=c("jsbi")).toNumber(d.bitwiseOr(d.bitwiseAnd(a,A),B));this.$1.writeByte(e);b++;a=d.signedRightShift(a,y)}return b};b.readVarint64=function(){var a=x,b=x,d;while(!0){var e;d=(e=c("jsbi")).BigInt(this.$1.readByte());a=e.bitwiseOr(a,e.leftShift(e.bitwiseAnd(d,A),b));b=e.add(b,y);if(c("jsbi").equal(c("jsbi").bitwiseAnd(d,B),x)){if(c("jsbi").equal(b,z)&&c("jsbi").notEqual(d,w))throw new Error("result exceeded 64 bit limit");break}if(c("jsbi").greaterThan(b,v))throw new Error("result exceeded 64 bit limit")}return a};b.readString=function(){return d("Utf8ToString").Utf8ToString(this.readBinary())};b.getLastFieldId=function(){return this.$3};b.getLastField=function(){return this.$2};b.getBooleanFieldInfo=function(){return this.$4};b.getBooleanValue=function(){return this.$5};b.$9=function(a){return k[a]};b.$10=function(a){switch(a){case i.CT_STOP:return(h||(h=c("ThriftTypes"))).STOP;case i.CT_BOOLEAN_FALSE:case i.CT_BOOLEAN_TRUE:return(h||(h=c("ThriftTypes"))).BOOL;case i.CT_BYTE:return(h||(h=c("ThriftTypes"))).BYTE;case i.CT_I16:return(h||(h=c("ThriftTypes"))).I16;case i.CT_I32:return(h||(h=c("ThriftTypes"))).I32;case i.CT_I64:return(h||(h=c("ThriftTypes"))).I64;case i.CT_DOUBLE:return(h||(h=c("ThriftTypes"))).DOUBLE;case i.CT_FLOAT:return(h||(h=c("ThriftTypes"))).FLOAT;case i.CT_BINARY:return(h||(h=c("ThriftTypes"))).STRING;case i.CT_LIST:return(h||(h=c("ThriftTypes"))).LIST;case i.CT_SET:return(h||(h=c("ThriftTypes"))).SET;case i.CT_MAP:return(h||(h=c("ThriftTypes"))).MAP;case i.CT_STRUCT:return(h||(h=c("ThriftTypes"))).STRUCT;default:throw new Error("don't know what type")}};return a}();g["default"]=b}),98);
__d("TNoOpWriteBuffer",[],(function(a,b,c,d,e,f){a=function(){function a(){this.$1=0}var b=a.prototype;b.write=function(a){this.$1+=a.length;return a.length};b.writeByte=function(a){this.$1++;return 1};b.writeFloatBE=function(a){this.$1+=Float32Array.BYTES_PER_ELEMENT;return Float32Array.BYTES_PER_ELEMENT};b.writeDoubleBE=function(a){this.$1+=Float64Array.BYTES_PER_ELEMENT;return Float64Array.BYTES_PER_ELEMENT};b.toByteArray=function(){throw new Error("operation not supported")};b.currentSize=function(){return this.$1};b.readByte=function(){throw new Error("operation not supported")};b.readBytes=function(a){throw new Error("operation not supported")};b.readFloatBE=function(){throw new Error("operation not supported")};b.readDoubleBE=function(){throw new Error("operation not supported")};return a}();f["default"]=a}),66);
__d("TReadBuffer",[],(function(a,b,c,d,e,f){a=function(){function a(a){this.$1=a,this.$2=0}var b=a.prototype;b.readByte=function(){if(this.$2<this.$1.length)return this.$1[this.$2++];throw new Error("no available byte to read")};b.readBytes=function(a){if(a<0)throw new Error("cannot readBytes of negative length: "+a);if(a+this.$2>this.$1.length)throw new Error("not enough bytes to read");var b=new Uint8Array(this.$1.buffer,this.$3(),a);this.$2+=a;return b};b.readFloatBE=function(){if(Float32Array.BYTES_PER_ELEMENT+this.$2>this.$1.length)throw new Error("not enough bytes to read");var a=new DataView(this.$1.buffer).getFloat32(this.$3());this.$2+=Float32Array.BYTES_PER_ELEMENT;return a};b.readDoubleBE=function(){if(Float64Array.BYTES_PER_ELEMENT+this.$2>this.$1.length)throw new Error("not enough bytes to read");var a=new DataView(this.$1.buffer).getFloat64(this.$3());this.$2+=Float64Array.BYTES_PER_ELEMENT;return a};b.$3=function(){return this.$2+this.$1.byteOffset};b.getCurrentCursor=function(){return this.$2};b.writeByte=function(a){throw new Error("operation not supported")};b.write=function(a){throw new Error("operation not supported")};b.toByteArray=function(){throw new Error("operation not supported")};b.writeFloatBE=function(a){throw new Error("operation not supported")};b.writeDoubleBE=function(a){throw new Error("operation not supported")};return a}();f["default"]=a}),66);
__d("CompactSerializerPolyfill",["TCompactProtocolPolyfill","TNoOpWriteBuffer","TReadBuffer","TWriteBuffer"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){a=new(c("TReadBuffer"))(a);a=new(c("TCompactProtocolPolyfill"))(a);return b(a)}function a(a,b,c){try{return h(a,b)}catch(a){c!=null&&c(a)}return null}function i(a,b,d){d===void 0&&(d=!1);if(d){d=new(c("TNoOpWriteBuffer"))();var e=new(c("TCompactProtocolPolyfill"))(d);b(a,e);e=new(c("TWriteBuffer"))(d.currentSize())}else e=new(c("TWriteBuffer"))();d=new(c("TCompactProtocolPolyfill"))(e);b(a,d);return d.toByteArray()}function b(a,b,c,d){c===void 0&&(c=!1);try{return i(a,b,c)}catch(a){d!=null&&d(a)}return null}g.deserialize=h;g.deserializeNoThrow=a;g.serialize=i;g.serializeNoThrow=b}),98);
__d("CrossWindowEventEmitter",["CacheStorage","EventEmitter","cr:8958"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(d,a);function d(d){var e;e=a.call(this)||this;e.$CrossWindowEventEmitter$p_2=d;e.$CrossWindowEventEmitter$p_1=new(c("CacheStorage"))("localstorage",d+":");e.$CrossWindowEventEmitter$p_1.addValueChangeCallback(function(c,d,f){d=c.split(":")[1];try{c=b("cr:8958").parse(f)}catch(a){c=void 0}if(c&&c.__v){(f=a.prototype.emit).call.apply(f,[babelHelpers.assertThisInitialized(e),d].concat(c.__v))}});return e}var e=d.prototype;e.emit=function(b){var c;for(var d=arguments.length,e=new Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];this.emitRemote.apply(this,[b].concat(e));(c=a.prototype.emit).call.apply(c,[this,b].concat(e))};e.emitRemote=function(a){for(var b=arguments.length,c=new Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];this.$CrossWindowEventEmitter$p_1.set(a,c)};return d}(c("EventEmitter"));g["default"]=a}),98);
__d("EventListenerImplForCacheStorage",["CometEventListener"],(function(a,b,c,d,e,f){"use strict";f["default"]=b("CometEventListener")}),66);
__d("IrisSubscribeCheckerUtils",[],(function(a,b,c,d,e,f){"use strict";function a(){if(typeof window!=="undefined"){var a;a=(a=window.location)==null?void 0:a.hostname;if(a==="m.facebook.com"||a==="mobile.facebook.com"||a==="mtouch.facebook.com")return!1}return!0}f.getIrisSubscribeCheckerInitialRunningState=a}),66);
__d("MqttEnvWebSocket",[],(function(a,b,c,d,e,f){"use strict";function a(a){return new WebSocket(a)}f.createWebSocket=a}),66);
__d("MqttEnv",["MqttEnvWebSocket","clearTimeout","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";b=Object.freeze({mqtt_waterfall_log_client_sampling:1,mqtt_ws_polling_enabled:3,mqtt_lp_use_fetch:9,mqtt_fast_lp:11,mqtt_lp_no_delay:12,mqtt_enable_publish_over_polling:13,mqttweb_global_connection_counter:15});e=function(){var a=b.prototype;a.random=function(){return this.$1!=null?this.$1():Math.random()};a.isUserLoggedInNow=function(){return this.$2!=null?this.$2():!0};a.setIsUserLoggedInNow=function(a){this.$2=a};a.clearTimeout=function(a){if(this.$3!=null){this.$3(a);return}c("clearTimeout")(a)};a.setTimeout=function(a,b){for(var d=arguments.length,e=new Array(d>2?d-2:0),f=2;f<d;f++)e[f-2]=arguments[f];return this.$4!=null?this.$4.apply(null,arguments):c("setTimeout").apply(null,arguments)};a.getLoggerInstance=function(){return this.$5!=null?this.$5():h.getInstance()};a.genGk=function(a){return this.$6!=null?this.$6(a):!1};a.createSocket=function(a,b){return this.$7!=null?this.$7(a,b):d("MqttEnvWebSocket").createWebSocket(a)};a.scheduleCallback=function(a){return this.$8!=null?this.$8(a):a()};a.scheduleLoggingCallback=function(a){return this.$9!=null?this.$9(a):a()};a.configRead=function(a,b){return this.$10!=null?this.$10(a,b):b};a.configWrite=function(a,b){this.$11!=null&&this.$11(a,b)};function b(){this.$1=null,this.$2=null,this.$3=null,this.$4=null,this.$5=null,this.$6=null,this.$7=null,this.$8=null,this.$9=null,this.$10=null,this.$11=null}a.initialize=function(a,b,c,d,e,f,g,h,i,j,k){this.$1=a,this.$2=b,this.$3=c,this.$4=d,this.$5=e,this.$6=f,this.$7=g,this.$8=h,this.$9=i,this.$10=j,this.$11=k};return b}();var h=function(){function a(){}a.getInstance=function(){return new a()};var b=a.prototype;b.setAppId=function(a){};b.eventLogConnect=function(a){};b.eventLogPull=function(a){};b.eventLogPullFinish=function(a){};b.eventLogDisconnect=function(a){};b.eventLogOutgoingPublish=function(a){};b.eventLogIncomingPublish=function(a){};b.eventLogPublishTimeout=function(a){};b.eventLogMiscellaneousError=function(a){};b.logIfLoggedOut=function(){};b.logError=function(a){};b.logErrorWarn=function(a){};b.logWarn=function(a){};b.debugTrace=function(a){};b.bumpCounter=function(a){};b.getBrowserConnectivity=function(){return!0};return a}(),i=new e();function a(a){i.setIsUserLoggedInNow(a)}g.MqttGkNames=b;g.Env=i;g.setIsUserLoggedInNow=a}),98);
__d("IrisSubscribeChecker",["IrisSubscribeCheckerUtils","MqttEnv"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.$1=d("MqttEnv").Env.getLoggerInstance(),this.$2=null,this.$3=!1,this.$4=!1,this.$5=!1,this.$6=d("IrisSubscribeCheckerUtils").getIrisSubscribeCheckerInitialRunningState(),this.$7=0,this.$8=a}var b=a.prototype;b.start=function(){this.$6=!0};b.stop=function(){this.$6=!1,this.$9()};b.onConnectAttempt=function(){};b.onConnectFailure=function(){this.$9()};b.onConnected=function(){var a=this;this.$7++;this.$9();this.$3=!1;this.$4=!1;this.$5=!1;this.$6&&(this.$2=d("MqttEnv").Env.setTimeout(function(){a.$10()},8e3))};b.onConnectSuccess=function(){};b.onConnectionLost=function(){this.$9()};b.onConnectionDisconnect=function(){};b.onSubscribe=function(a){a==="/t_ms"&&(this.$3=!0)};b.onUnsubscribe=function(a){};b.onPublish=function(a){(a==="/messenger_sync_get_diffs"||a==="/messenger_sync_create_queue")&&(this.$4=!0,this.$3&&(this.$5=!0,this.$9()))};b.onMessage=function(a){};b.onWSFatal=function(){};b.$9=function(){this.$2&&(d("MqttEnv").Env.clearTimeout(this.$2),this.$2=null)};b.$10=function(){if(this.$4===!1){var a=this.$7==1?"no_iris_session_initialConnect":"no_iris_session";this.$1.bumpCounter(a);this.$8()?this.$1.bumpCounter(a+".withProvider"):this.$1.bumpCounter(a+".withoutProvider");this.$3===!0?this.$1.bumpCounter(a+".withTopicSubscribe"):this.$1.bumpCounter(a+".withoutTopicSubscribe")}this.$3===!1&&this.$1.bumpCounter("no_iris_topic_subscribe");this.$3===!0&&this.$4===!0&&this.$5===!1&&this.$1.bumpCounter("session_before_topic_subscribe")};return a}();g["default"]=a}),98);
__d("MqttGlobalStreamCounter",["CrossWindowEventEmitter","MqttEnv","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){var a=this;this.isTabClosed=!1;this.otherTabs=new Map();this.thisTab={totalConnectionStreams:0};this.broadcastChannel=new(c("CrossWindowEventEmitter"))("MqttGlobalStreamCounter");this.broadcastChannel.addListener("count-updated",function(b){b=JSON.parse(String(b));var c=!1;a.otherTabs.has(b.key)||(c=!0);b.event==="DELETE"?a.otherTabs["delete"](b.key):b.event==="UPDATE"&&b.value!=null&&(a.otherTabs.set(b.key,b.value),c&&a.$1())});this.tabID=c("uuidv4")()}var b=a.prototype;b.streamRequested=function(){this.thisTab.totalConnectionStreams++,this.$1()};b.streamClosed=function(){this.thisTab.totalConnectionStreams>0&&(this.thisTab.totalConnectionStreams--,this.$1())};b.tabClosed=function(){if(this.isTabClosed)return;this.isTabClosed=!0;var a={key:this.tabID,event:"DELETE"};this.broadcastChannel.emitRemote("count-updated",JSON.stringify(a))};b.getGlobalState=function(){var a={totalConnectionStreams:this.thisTab.totalConnectionStreams};this.otherTabs.forEach(function(b){a.totalConnectionStreams+=b.totalConnectionStreams});return a};b.$1=function(){var a={key:this.tabID,event:"UPDATE",value:this.thisTab};this.broadcastChannel.emitRemote("count-updated",JSON.stringify(a))};b.isEnabled=function(){return!0};return a}();var h=d("MqttEnv").Env.genGk(d("MqttEnv").MqttGkNames.mqttweb_global_connection_counter)?new a():{streamRequested:function(){},streamClosed:function(){},tabClosed:function(){},getGlobalState:function(){return{totalConnectionStreams:-1}},isEnabled:function(){return!1}};b=function(){return h};g.getInstance=b}),98);
__d("MqttAnalyticsHook",["MqttEnv","MqttGlobalStreamCounter"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$1=d("MqttEnv").Env.getLoggerInstance(),this.$2=d("MqttGlobalStreamCounter").getInstance(),this.$3=0,this.$4=0,this.$5=0,this.$6=0,this.$1.bumpCounter("session_start"),d("MqttEnv").Env.isUserLoggedInNow()||this.$1.bumpCounter("session_start.logout")}var b=a.prototype;b.onConnectAttempt=function(){this.$1.bumpCounter("ws_connect_attempt"),this.$2.streamRequested()};b.onConnectFailure=function(){this.$4++,this.$1.bumpCounter("ws_connect_failure"),this.$1.debugTrace("connect","Connect failed existing streams count "+this.$2.getGlobalState().totalConnectionStreams),this.$2.streamClosed()};b.onConnected=function(){this.$1.bumpCounter("ws_connect_connected")};b.onConnectSuccess=function(){this.$3===0&&this.$1.bumpCounter("ws_connect_first_success"),this.$3++,this.$1.bumpCounter("ws_connect_success")};b.onConnectionLost=function(){this.$1.bumpCounter("ws_disconnect")};b.onConnectionDisconnect=function(){this.$2.streamClosed()};b.onSubscribe=function(a){};b.onUnsubscribe=function(a){};b.onPublish=function(a){this.$1.bumpCounter("ws_publish."+a)};b.onMessage=function(a){this.$1.bumpCounter("message_arrived."+a)};b.onWSFatal=function(){this.$1.bumpCounter("ws_fatal")};b.onPollRequestSent=function(){this.$1.bumpCounter("polling_request_send"),this.$2.streamRequested()};b.onPollRequestSuccess=function(){this.$1.bumpCounter("polling_request_succeed"),this.$5===0&&this.$1.bumpCounter("polling_first_success"),this.$5++};b.onPollResponse=function(a){this.$1.bumpCounter("lp.message_arrived."+a)};b.onPollFinish=function(){this.$1.bumpCounter("polling_request_finish"),this.$2.streamRequested()};b.onPollRequestFailed=function(a){this.$1.bumpCounter("polling_request_failed"),this.$1.bumpCounter("polling_request_failed_"+a),this.$6++,this.$1.debugTrace("PollRequest","Request failed existing streams count "+this.$2.getGlobalState().totalConnectionStreams),this.$2.streamClosed()};b.onPollShutdownAbort=function(){this.$2.streamClosed()};b.onTabClose=function(){this.$2.tabClosed()};return a}();g["default"]=a}),98);
__d("MqttConnectionHookCollection",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1=new Set()}var b=a.prototype;b.addHook=function(a){this.$1.add(a)};b.removeHook=function(a){this.$1["delete"](a)};b.onConnectAttempt=function(){this.$1.forEach(function(a){a.onConnectAttempt()})};b.onConnectFailure=function(){this.$1.forEach(function(a){a.onConnectFailure()})};b.onConnected=function(){this.$1.forEach(function(a){a.onConnected()})};b.onConnectSuccess=function(){this.$1.forEach(function(a){a.onConnectSuccess()})};b.onConnectionLost=function(){this.$1.forEach(function(a){a.onConnectionLost()})};b.onConnectionDisconnect=function(){this.$1.forEach(function(a){a.onConnectionDisconnect()})};b.onSubscribe=function(a){this.$1.forEach(function(b){b.onSubscribe(a)})};b.onUnsubscribe=function(a){this.$1.forEach(function(b){b.onUnsubscribe(a)})};b.onPublish=function(a){this.$1.forEach(function(b){b.onPublish(a)})};b.onMessage=function(a){this.$1.forEach(function(b){b.onMessage(a)})};b.onWSFatal=function(){this.$1.forEach(function(a){a.onWSFatal()})};return a}();f["default"]=a}),66);
__d("MqttProtocolUtils",["MqttEnv"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(a==null)return b;var c=new Uint8Array(a.length+b.length);c.set(a);c.set(b,a.length);return c}function b(a,b){b=b;var c=0,d=1,e;do{if(b===a.length)return null;e=a[b++];c+=(e&127)*d;d*=128}while((e&128)!==0);return{offset:b,value:c}}function c(a){a=a;var b=new Array(1);for(var c=0;c<4;c++){var d=a%128;a>>=7;if(a>0)b[c]=d|128;else{b[c]=d;break}}return b}function h(a,b,c){c=c;b[c++]=a>>8;b[c++]=a%256;return c}function e(a,b){return 256*a[b]+a[b+1]}function f(a){var b=0;for(var c=0,d=a.length;c<d;c++){var e=a.charCodeAt(c);e<128?b+=1:e<2048?b+=2:e>=55296&&e<=56319?(b+=4,c++):b+=3}return b}function i(a,b,c,d){d=h(b,c,d);j(a,c,d);return d+b}function j(a,b,c){c=c;for(var d=0,e=a.length;d<e;d++){var f=a.charCodeAt(d);f<128?b[c++]=f:f<2048?(b[c++]=192|f>>6,b[c++]=128|f&63):f<55296||f>=57344?(b[c++]=224|f>>12,b[c++]=128|f>>6&63,b[c++]=128|f&63):(f=65536+((f&1023)<<10|a.charCodeAt(++d)&1023),b[c++]=240|f>>18,b[c++]=128|f>>12&63,b[c++]=128|f>>6&63,b[c++]=128|f&63)}}function k(a,b,c){var d=[],e=b,f=0;while(e<b+c){var g=a[e++];if(g<128)d[f++]=String.fromCharCode(g);else if(g>191&&g<224){var h=a[e++];d[f++]=String.fromCharCode((g&31)<<6|h&63)}else if(g>239&&g<365){h=a[e++];var i=a[e++],j=a[e++];h=((g&7)<<18|(h&63)<<12|(i&63)<<6|j&63)-65536;d[f++]=String.fromCharCode(55296+(h>>10));d[f++]=String.fromCharCode(56320+(h&1023))}else{i=a[e++];j=a[e++];d[f++]=String.fromCharCode((g&15)<<12|(i&63)<<6|j&63)}}return d.join("")}var l=function(){function a(a,b,c,d){this.$1=a,this.$2=b,this.$5=c,this.$6=d,this.$4=!1}var b=a.prototype;b.$7=function(){var a=this;this.$4?(this.$4=!1,this.$5(),this.$3=d("MqttEnv").Env.setTimeout(function(){a.$7()},this.$2()*1e3)):this.$6()};b.reset=function(){var a=this;this.$4=!0;this.$3&&(d("MqttEnv").Env.clearTimeout(this.$3),this.$3=null);var b=this.$1()*1e3;b>0&&(this.$3=d("MqttEnv").Env.setTimeout(function(){a.$7()},b))};b.cancel=function(){this.$3&&(d("MqttEnv").Env.clearTimeout(this.$3),this.$3=null)};return a}();g.UTF8Length=f;g.convertStringToUTF8=j;g.concatBuffers=a;g.decodeMultiByteInt=b;g.convertUTF8ToString=k;g.encodeMultiByteInt=c;g.writeUInt16BE=h;g.readUInt16BE=e;g.writeString=i;g.Pinger=l}),98);
__d("MqttUtils",["MqttEnv"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(a,"sid",b.toString())}function b(a,b){var c=a;b.forEach(function(a,b){c=h(c,b,a)});return c}function h(a,b,c){if(a.indexOf("?")>0)return a+"&"+b+"="+c;else return a+"?"+b+"="+c}function c(){return Math.floor(d("MqttEnv").Env.random()*Number.MAX_SAFE_INTEGER)}function i(a,b,c){var e=arguments.length>1?a.then(b,c):a;e.then(null,function(a){d("MqttEnv").Env.setTimeout(function(){if(a instanceof Error)throw a;else throw new Error("promiseDone")},0)})}function e(a,b,c,e){var f=!1;d("MqttEnv").Env.setTimeout(function(){f||(f=!0,c(new Error("promise timeout")))},e);i(a,function(a){f||(f=!0,b(a))},function(a){f||(f=!0,c(a))})}function f(a){for(var b=arguments.length,c=new Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];var e=0;return a.replace(/%s/g,function(){return String(c[e++])})}g.endpointWithSessionId=a;g.endpointWithExtraParameters=b;g.endpointWithExtraParameter=h;g.generateSessionId=c;g.promiseDone=i;g.promiseDoneWithTimeout=e;g.sprintf=f}),98);
__d("MqttProtocolCodec",["MqttProtocolUtils","MqttUtils","err"],(function(a,b,c,d,e,f,g){"use strict";var h=Object.freeze({CONNECT:1,CONNACK:2,PUBLISH:3,PUBACK:4,SUBSCRIBE:8,SUBACK:9,UNSUBSCRIBE:10,UNSUBACK:11,PINGREQ:12,PINGRESP:13,DISCONNECT:14}),i=[0,6,77,81,73,115,100,112,3];function j(a,b){b=b;var e=b,f=a[b],g=f>>4;b+=1;var i=d("MqttProtocolUtils").decodeMultiByteInt(a,b);if(i==null)return{position:e,wireMessage:null};b=i.offset;i=b+i.value;if(i>a.length)return{position:e,wireMessage:null};var j;switch(g){case h.CONNACK:e=a[b++];e=!!(e&1);var o=a[b++];j=new m(e,o);break;case h.PUBLISH:e=f&15;o=e>>1&3;f=d("MqttProtocolUtils").readUInt16BE(a,b);b+=2;var r=d("MqttProtocolUtils").convertUTF8ToString(a,b,f);b+=f;f=null;o===1&&(f=d("MqttProtocolUtils").readUInt16BE(a,b),b+=2);var s=p.createWithBytes(a.subarray(b,i)),t=(e&1)===1;e=(e&8)===8;j=new q(r,s,o,f,t,e);break;case h.PINGREQ:j=new k("PINGREQ");break;case h.PINGRESP:j=new k("PINGRESP");break;case h.PUBACK:case h.UNSUBACK:r=d("MqttProtocolUtils").readUInt16BE(a,b);j=new n(g===h.PUBACK?"PUBACK":"UNSUBACK",r);break;case h.SUBACK:s=d("MqttProtocolUtils").readUInt16BE(a,b);b+=2;o=a.subarray(b,i);j=new l(s,o);break;default:throw c("err")(d("MqttUtils").sprintf("Invalid MQTT message type %s.",g))}return{position:i,wireMessage:j}}function a(a){var b=[],c=0;while(c<a.length){var d=j(a,c),e=d.wireMessage;c=d.position;if(e)b.push(e);else break}d=null;c<a.length&&(d=a.subarray(c));return{messages:b,remaining:d}}b=function(){function a(a){this.messageType=h[a]}var b=a.prototype;b.encode=function(){throw new TypeError("Cannot abstract class WireMessage")};return a}();var k=function(b){babelHelpers.inheritsLoose(a,b);function a(a){return b.call(this,a)||this}var c=a.prototype;c.encode=function(){var a=new ArrayBuffer(2),b=new Uint8Array(a);b[0]=(this.messageType&15)<<4;return a};return a}(b);e=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.call(this,"DISCONNECT")||this}var c=b.prototype;c.encode=function(){var a=(this.messageType&15)<<4,b=new ArrayBuffer(2),c=new Uint8Array(b);c[0]=a;c.set(d("MqttProtocolUtils").encodeMultiByteInt(0),1);return b};return b}(b);var l=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){var d;d=b.call(this,"SUBACK")||this;d.messageIdentifier=a;d.returnCode=c;return d}return a}(b),m=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){var d;d=b.call(this,"CONNACK")||this;d.sessionPresent=a;d.returnCode=c;return d}return a}(b),n=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){a=b.call(this,a)||this;a.messageIdentifier=c;return a}var c=a.prototype;c.encode=function(){var a=(this.messageType&15)<<4,b=2,c=d("MqttProtocolUtils").encodeMultiByteInt(b),e=c.length+1;b=new ArrayBuffer(b+e);var f=new Uint8Array(b);f[0]=a;f.set(c,1);e=d("MqttProtocolUtils").writeUInt16BE(this.messageIdentifier,f,e);return b};return a}(b);f=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){var d;d=a.call(this,"CONNECT")||this;d.clientId=b;d.connectOptions=c;return d}var c=b.prototype;c.encode=function(){var a,b=(this.messageType&15)<<4,c=i.length+3;c+=(a=d("MqttProtocolUtils")).UTF8Length(this.clientId)+2;c+=a.UTF8Length(this.connectOptions.userName)+2;var e=a.encodeMultiByteInt(c);c=new ArrayBuffer(1+e.length+c);var f=new Uint8Array(c);f[0]=b;b=1;f.set(e,1);b+=e.length;f.set(i,b);b+=i.length;e=2|128;f[b++]=e;b=a.writeUInt16BE(this.connectOptions.getKeepAliveIntervalSeconds(),f,b);b=a.writeString(this.clientId,a.UTF8Length(this.clientId),f,b);b=a.writeString(this.connectOptions.userName,a.UTF8Length(this.connectOptions.userName),f,b);return c};return b}(b);var o=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c,e,f){var g;g=b.call(this,a)||this;g.topic=c;if(e<0&&e>1||e===1&&f==null)throw new TypeError(d("MqttUtils").sprintf("Argument Invalid. qos: %s messageType: %s.",e,a));g.qos=e;g.messageIdentifier=f;return g}var c=a.prototype;c.encode=function(){var a=(this.messageType&15)<<4;a|=2;var b=d("MqttProtocolUtils").UTF8Length(this.topic),c=2+b+2;this.messageType===h.SUBSCRIBE&&(c+=1);var e=d("MqttProtocolUtils").encodeMultiByteInt(c);c=new ArrayBuffer(1+e.length+c);var f=new Uint8Array(c);f[0]=a;a=1;f.set(e,1);a+=e.length;this.messageIdentifier!=null&&(a=d("MqttProtocolUtils").writeUInt16BE(this.messageIdentifier,f,a));a=d("MqttProtocolUtils").writeString(this.topic,b,f,a);this.messageType===h.SUBSCRIBE&&this.qos!=null&&(f[a++]=this.qos);return c};return a}(b),p=function(){function a(a,b){this.payloadString=a,this.payloadBytes=b}a.createWithString=function(b){var c=new Uint8Array(new ArrayBuffer(d("MqttProtocolUtils").UTF8Length(b)));d("MqttProtocolUtils").convertStringToUTF8(b,c,0);return new a(b,c)};a.createWithBytes=function(b){var c=d("MqttProtocolUtils").convertUTF8ToString(b,0,b.length);return new a(c,b)};var b=a.prototype;b.string=function(){return this.payloadString};b.bytes=function(){return this.payloadBytes};return a}(),q=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c,d,e,f,g){var h;h=b.call(this,"PUBLISH")||this;h.topic=a;h.payloadMessage=c;h.qos=d;h.messageIdentifier=e;h.retained=f!=null?f:!1;h.duplicate=g!=null?g:!1;if(h.qos===1&&h.messageIdentifier==null)throw new TypeError("Argument Invalid. messageIdentifier: null and qos: 1");return h}var c=a.prototype;c.encode=function(){var a=(this.messageType&15)<<4;this.duplicate&&(a|=8);a=a|=this.qos<<1;this.retained&&a!=1;var b=d("MqttProtocolUtils").UTF8Length(this.topic),c=b+2,e=this.qos===0?0:2;c+=e;e=this.payloadMessage.bytes();c+=e.byteLength;var f=d("MqttProtocolUtils").encodeMultiByteInt(c);c=new ArrayBuffer(1+f.length+c);var g=new Uint8Array(c);g[0]=a;g.set(f,1);a=1+f.length;a=d("MqttProtocolUtils").writeString(this.topic,b,g,a);this.qos!==0&&this.messageIdentifier!=null&&(a=d("MqttProtocolUtils").writeUInt16BE(this.messageIdentifier,g,a));g.set(e,a);return c};return a}(b),r=p.createWithString,s=p.createWithBytes;b={Base:b,ConnAck:m,Connect:f,Disconnect:e,Ping:k,PubAckUnsubAck:n,Publish:q,Subscription:o};g.MESSAGE_TYPE=h;g.decodeMessage=j;g.decodeByteMessages=a;g.Message=p;g.createMessageWithString=r;g.createMessageWithBytes=s;g.WireMessage=b}),98);
__d("MqttTypes",[],(function(a,b,c,d,e,f){"use strict";a=function(a,b,c){this.errorCode=a,this.errorName=b,this.errorMessage=c};b=Object.freeze({APP_DISCONNECT:new a(7,"APP_DISCONNECT","Disconnect initiated by app"),BROWSER_CLOSE:new a(11,"BROWSER_CLOSE","Browser closed"),CONNACK_FAILURE:new a(5,"CONNACK_FAILURE","Connection failure due to connack"),CONNECT_TIMEOUT:new a(4,"CONNECT_TIMEOUT","Connect timed out"),INVALID_DATA_TYPE:new a(3,"INVALID_DATA_TYPE","Received non-arraybuffer from socket."),PING_TIMEOUT:new a(6,"PING_TIMEOUT","Ping timeout"),RECONNECT:new a(10,"RECONNECT","Reconnecting"),SERVER_DISCONNECT:new a(8,"SERVER_DISCONNECT","Disconnect message sent my server"),SOCKET_CLOSE:new a(9,"SOCKET_CLOSE","Socket connection closed"),SOCKET_ERROR:new a(1,"SOCKET_ERROR","Socket error"),SOCKET_MESSAGE:new a(2,"SOCKET_MESSAGE","Unable to parse invalid socket message")});c=function(a,b){this.mqttError=a,this.connAck=b};d=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c,d){d===void 0&&(d=null);c=a.call(this,c)||this;c.isRecoverable=b;c.originalError=d;return c}return b}(babelHelpers.wrapNativeSuper(Error));f.MqttError=a;f.MqttErrors=b;f.ConnectFailure=c;f.MqttChannelError=d}),66);
__d("MqttProtocolClient",["ErrorSerializer","MqttEnv","MqttProtocolCodec","MqttProtocolUtils","MqttTypes","err","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h=20,i=6e4;a=function(){function a(a){var b=this;this.$12=function(a,c,e){c===void 0&&(c=null);b.$9.bumpCounter("protocol.debug.disconnect.internal."+a.errorName);b.$9.bumpCounter("protocol.debug.disconnect.internal");var f=b.$5,g=b.$2,h=g.onConnectFailure,i=g.onConnectionLost;b.setConnected(!1);b.$14();f?d("MqttEnv").Env.scheduleCallback(function(){i(a,c)}):d("MqttEnv").Env.scheduleCallback(function(){h(b.$11,new(d("MqttTypes").ConnectFailure)(a,e!=null?e:-1),c)})};this.$13=function(a){var c=b.$6;if(c==null){b.$9.bumpCounter("protocol.socket_send.failed.socket_null.<message type>");return 0}if(c.readyState!==c.OPEN){b.$9.bumpCounter("protocol.socket_send.failed.socket_not_open.<message type>");return 0}a=a.encode();var d=a.byteLength;c.send(a);return d};this.$3=a;this.$2={getKeepAliveIntervalSeconds:function(){return 10},getKeepAliveTimeoutSeconds:function(){return 10},ignoreSubProtocol:!1,mqttVersion:3,onConnectFailure:function(a,b,c){},onConnection:function(){},onConnectionLost:function(a,b){},onConnectSuccess:function(a){},onMessageArrived:function(a,b,c){},onMessageDelivered:function(a){},userName:""};this.$1="mqttwsclient";this.$4=0;this.$5=!1;this.$9=d("MqttEnv").Env.getLoggerInstance();this.$11=0}var b=a.prototype;b.connect=function(a){var b=this;if(this.$5)throw c("err")("Invalid state: connect - already connected");this.$2=a;this.setConnected(!1);this.$7!=null&&(d("MqttEnv").Env.clearTimeout(this.$7),this.$7=null);this.$7=d("MqttEnv").Env.setTimeout(function(){b.$9.bumpCounter("protocol.error.connect.timeout"),b.$12(d("MqttTypes").MqttErrors.CONNECT_TIMEOUT)},h*1e3);this.$6=d("MqttEnv").Env.createSocket(this.$3);this.$6.binaryType="arraybuffer";this.$6.onopen=function(){b.setConnected(!0),b.$9.debugTrace("Socket-Open","MQTTProtocolClient Socket Open"),b.$11=b.$13(new(d("MqttProtocolCodec").WireMessage.Connect)(b.$1,a)),a.onConnection()};this.$6.onmessage=function(a){a=a.data;if(!(a instanceof ArrayBuffer)){b.$9.bumpCounter("protocol.error.onmessage.type");b.$12(d("MqttTypes").MqttErrors.INVALID_DATA_TYPE);return}try{a=new Uint8Array(a);b.$10!=null&&(a=d("MqttProtocolUtils").concatBuffers(b.$10,a),b.$9.bumpCounter("protocol.debug.usingMessagesBuffer"),delete b.$10,b.$10=null);a=d("MqttProtocolCodec").decodeByteMessages(a);var c=a.messages;b.$10=a.remaining;for(a=0;a<c.length;a++)b.handleMessage(c[a])}catch(a){b.$10=null,b.$9.logError(a,d("MqttTypes").MqttErrors.SOCKET_MESSAGE.errorMessage),b.$9.bumpCounter("protocol.error.onmessage.parse"),b.$12(d("MqttTypes").MqttErrors.SOCKET_MESSAGE,a.message)}};this.$6.onerror=function(a){b.$9.bumpCounter("protocol.error.socket");b.$9.debugTrace("Socket-Error","MQTTProtocolClient Socket Error");a=typeof a==="object"&&a!=null&&"error"in a&&!("message"in a)?a.error:a;b.$12(d("MqttTypes").MqttErrors.SOCKET_ERROR,c("ErrorSerializer").toReadableMessage(c("getErrorSafe")(a)))};this.$6.onclose=function(a){b.$9.bumpCounter("protocol.socket.close"),a.wasClean||b.$9.debugTrace("Socket-Unclean-Close","MQTTProtocolClient error code: "+a.code+" reason: "+a.reason),b.$12(d("MqttTypes").MqttErrors.SOCKET_CLOSE,a.code+" : "+a.reason)};this.$8!=null&&this.$8.cancel();this.$8=new(d("MqttProtocolUtils").Pinger)(a.getKeepAliveIntervalSeconds,a.getKeepAliveTimeoutSeconds,this.$13.bind(this,new(d("MqttProtocolCodec").WireMessage.Ping)("PINGREQ")),function(a,c){return b.$12(d("MqttTypes").MqttErrors.PING_TIMEOUT,a,c)})};b.$14=function(){var a=this;this.setConnected(!1);this.$8!=null&&this.$8.cancel();this.$7!=null&&(d("MqttEnv").Env.clearTimeout(this.$7),this.$7=null);this.$6!=null&&(this.$6.onopen=function(b){a.$9.debugTrace("Socket Open After Teardown","Socket opening after teardown")},this.$6.onmessage=function(a){},this.$6.onerror=function(a){},this.$6.onclose=function(b){a.$9.debugTrace("Socket Close After Teardown","code: "+b.code+", reason: "+b.reason)},this.$6.close(),this.$6=null);this.$2.onConnectSuccess=function(a){};this.$2.onConnectFailure=function(a,b){};this.$2.onConnection=function(){};this.$2.onConnectionLost=function(a){};this.$2.onMessageArrived=function(a,b,c){};this.$2.onMessageDelivered=function(a){}};b.disconnect=function(a){if(this.$6==null||this.$6.readyState!==this.$6.OPEN||!this.$5){this.$14();return}this.$13(new(d("MqttProtocolCodec").WireMessage.Disconnect)());this.$9.bumpCounter("protocol.debug.disconnect");this.$12(a)};b.isConnected=function(){return this.$5};b.setConnected=function(a){this.$5=a};b.subscribe=function(a){if(!this.$5){this.$9.bumpCounter("protocol.error.subscribe.notconnected");throw c("err")("Invalid state: subscribe - not connected")}this.$9.bumpCounter("protocol.subscribe."+a);a=new(d("MqttProtocolCodec").WireMessage.Subscription)("SUBSCRIBE",a,0,this.$15());this.$13(a)};b.unsubscribe=function(a){if(!this.$5){this.$9.bumpCounter("protocol.error.unsubscribe.notconnected");throw c("err")("Invalid state: unsubscribe - not connected")}this.$9.bumpCounter("protocol.unsubscribe."+a);a=new(d("MqttProtocolCodec").WireMessage.Subscription)("UNSUBSCRIBE",a,0,this.$15());this.$13(a)};b.publish=function(a,b,c){return this.$16(a,d("MqttProtocolCodec").createMessageWithString(b),c)};b.publishBinary=function(a,b,c){return this.$16(a,d("MqttProtocolCodec").createMessageWithBytes(b),c)};b.$16=function(a,b,c){this.$5||this.$9.bumpCounter("protocol.error.publish.notconnected");this.$9.bumpCounter("protocol.publish."+a);var e=this.$15();a=new(d("MqttProtocolCodec").WireMessage.Publish)(a,b,c,e);this.$13(a);return e};b.$15=function(){++this.$4===i&&(this.$4=1);return this.$4};b.handleMessage=function(a){var b=this;switch(a.messageType){case d("MqttProtocolCodec").MESSAGE_TYPE.CONNACK:this.$7!=null&&(d("MqttEnv").Env.clearTimeout(this.$7),this.$7=null);if(a instanceof d("MqttProtocolCodec").WireMessage.ConnAck){var e=a;if(e.returnCode!==0){this.$9.bumpCounter("protocol.error.connack.invalidreturncode");this.setConnected(!1);this.$12(d("MqttTypes").MqttErrors.CONNACK_FAILURE,"connack code="+e.returnCode,e.returnCode);return}d("MqttEnv").Env.scheduleCallback(function(){b.$2.onConnectSuccess(b.$11)});this.$8!=null&&this.$8.reset()}break;case d("MqttProtocolCodec").MESSAGE_TYPE.PUBLISH:if(a instanceof d("MqttProtocolCodec").WireMessage.Publish){var f=a;d("MqttEnv").Env.scheduleCallback(function(){b.$2.onMessageArrived(f.topic,f.payloadMessage,f.qos)});e=f.messageIdentifier;this.$9.bumpCounter("protocol.publish.received");if(f.qos===1&&e!=null){e=new(d("MqttProtocolCodec").WireMessage.PubAckUnsubAck)("PUBACK",e);this.$13(e)}}break;case d("MqttProtocolCodec").MESSAGE_TYPE.PUBACK:if(a instanceof d("MqttProtocolCodec").WireMessage.PubAckUnsubAck){e=a;var g=e.messageIdentifier;this.$9.bumpCounter("protocol.puback.received");d("MqttEnv").Env.scheduleCallback(function(){b.$2.onMessageDelivered(g)})}break;case d("MqttProtocolCodec").MESSAGE_TYPE.PINGRESP:this.$8!=null&&this.$8.reset();break;case d("MqttProtocolCodec").MESSAGE_TYPE.DISCONNECT:this.$12(d("MqttTypes").MqttErrors.SERVER_DISCONNECT);break;case d("MqttProtocolCodec").MESSAGE_TYPE.SUBACK:this.$9.bumpCounter("protocol.suback.received");break;case d("MqttProtocolCodec").MESSAGE_TYPE.UNSUBACK:this.$9.bumpCounter("protocol.unsuback.received");break;default:this.$9.logError(c("err")("MqttProtocolClient: Received unhandled message type: "+a.messageType),"Received unhandled message type");this.$9.bumpCounter("protocol.error.handlemessage.unsupportedtype");break}};return a}();g["default"]=a}),98);
__d("MqttPublishListener",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({NOT_CONNECTED:"NOT_CONNECTED",PUBLISH_ERROR:"PUBLISH_ERROR",QUEUED:"QUEUED",SENT:"SENT",ACKED:"ACKED",NOT_ACKED:"NOT_ACKED"});f.MqttPublishEvent=a}),66);
__d("MqttUserNameUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a!=null?a:typeof document==="object"&&document&&document.hasFocus&&document.hasFocus()}function b(){return navigator.userAgent}f.getMqttForegroundStatus=a;f.getUserAgent=b}),66);
__d("MqttUserName",["MqttUserNameUtils"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b,c,e,f,g,h,i,j,k,l,m){h===void 0&&(h=null),i===void 0&&(i=""),j===void 0&&(j="websocket"),k===void 0&&(k=null),l===void 0&&(l=null),m===void 0&&(m=null),this.$1=a,this.$2=b,this.$3=c,this.$4=e,this.$5=f,this.$6=g,this.$7=d("MqttUserNameUtils").getMqttForegroundStatus(),this.$8=h,this.$9=i,this.$10=j,this.$11=k,this.$12=l,this.$13=m}var b=a.prototype;b.gen=function(a,b,c,e){e===void 0&&(e=[]);var f=d("MqttUserNameUtils").getMqttForegroundStatus(this.$7);c=c.map(function(a){a={isBase64Publish:!1,messageId:a.messageId,payload:a.payload,qos:a.qos,topic:a.topic};typeof a.payload!=="string"&&(a.payload=btoa(String.fromCharCode.apply(null,a.payload)),a.isBase64Publish=!0);return a});f={a:d("MqttUserNameUtils").getUserAgent(),asi:this.$13,aid:this.$5,aids:this.$12!=null?Object.fromEntries(this.$12):null,chat_on:this.$6,cp:this.$3,ct:this.$10,d:this.$4,dc:"",ecp:this.$2,fg:f,gas:this.$8,mqtt_sid:"",no_auto_fg:!0,p:this.$11,pack:e,php_override:this.$9,pm:c,s:a,st:b,u:this.$1};return JSON.stringify(f)};b.setForegroundState=function(a){this.$7=a};b.setChatVisibility=function(a){this.$6=a};b.getEndpointCapabilities=function(){return this.$2};b.getDeviceId=function(){return this.$4};b.setEndpointCapabilities=function(a){this.$2=a};b.getIsGuestAuthStringPresent=function(){return this.$8!==null};return a}();g["default"]=a}),98);
__d("MqttConnection",["MqttConnectionHookCollection","MqttEnv","MqttProtocolClient","MqttPublishListener","MqttTypes","MqttUserName","MqttUtils","Promise","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i=15,j=15,k=1,l=1,m=64,n="publish",o="subscribe",p="unsubscribe",q=function(a){},r=18e4,s=5*1e3,t=15,u=21;a=function(){function a(){var a=this;this.$38=function(){return a.$20};this.$39=function(){return a.$21};this.$8=!1;this.$10=d("MqttEnv").Env.getLoggerInstance();this.$11="Disconnected";this.$17=new Set();this.$24=new Map();this.$12=0;this.$13=0;this.$14=0;this.$15=0;this.$16=0;this.$8=!1;this.$5="";this.$6=new(c("MqttUserName"))("",0,1,"",0,!0);this.$9=0;this.$18=0;this.$19=!1;this.$7=null;var b=function(){};this.$1=b;this.$2=b;this.$3=b;this.$25=!1;this.$26=!1;this.$27=new(c("MqttConnectionHookCollection"))();this.$4=function(){return[]};this.$20=i;this.$21=j;this.$22=null;this.$23=0}var e=a.prototype;e.run=function(a){var b=this,c=a.endpoint,d=a.extraConnectMessageProvider,e=a.mqttUserName,f=a.onJSError,g=a.onMessageReceived,h=a.onStateChange;a=a.subscribedTopics;if(this.$8){this.$10.debugTrace("run","Run called while in running state.");return}this.$1=h;this.$3=g;this.$5=c;this.$6=e;this.$8=!0;this.$18=Date.now();this.$12=0;this.$13=0;this.$2=f||q;a&&a.forEach(function(a){return b.$17.add(a)});this.$4=d;this.$20=i;this.$21=j;this.$28()};e.shutdown=function(a){this.$29(a),this.$30("shutdown"),this.$8=!1,this.$10.debugTrace("shutdown","Shutdown")};e.subscribe=function(a){this.$17.add(a);this.ensureConnected(o)&&this.$31(a);return!0};e.publish=function(a,b,c,d){return this.$32(a,b,c,d)};e.publishBinary=function(a,b,c,d){return this.$32(a,b,c,d)};e.$32=function(a,e,f,g){var i={reject:function(a){},resolve:function(){}};g!=null&&(i.listener=g);var j=new(h||(h=b("Promise")))(function(a,b){i.resolve=a,i.reject=b}),k=this.ensureConnected(n);!k?(g==null?void 0:g.onEvent(d("MqttPublishListener").MqttPublishEvent.NOT_CONNECTED),i.reject(c("err")("Client disconnected"))):this.$33(a,e,f,i);return j};e.unsubscribe=function(a){this.$17["delete"](a);this.ensureConnected(p)&&this.$34(a);return!0};e.addHook=function(a){this.$27.addHook(a)};e.removeHook=function(a){this.$27.removeHook(a)};e.isRunning=function(){return this.$8};e.getSessionId=function(){return this.$9};e.hasFatal=function(){return this.$25};e.hasConnectSuccess=function(){return this.$26};e.canPublish=function(){return this.ensureConnected("canPublish")};e.ensureConnected=function(a){return!this.$8||this.$7==null||!this.$7.isConnected()?!1:!0};e.connectionState=function(){return this.$11};e.mqttStateFromConnectionState=function(a){switch(a){case"Connecting":case"TransportConnected":return"Connecting";case"Connected":return"Connected";case"Disconnected":return"Disconnected"}throw c("err")("Unknown state "+a)};e.testOnlyGetSubscribedTopics=function(){return this.$17};e.getDisconnectCount=function(){return this.$23};e.$29=function(a){this.$8&&this.$7!=null&&(this.$35("Disconnected"),this.$7!=null&&(this.$7.disconnect(a),this.$27.onConnectionDisconnect()),this.$7=null)};e.$36=function(a){if(this.$11==="Connected"&&a==="Disconnected"&&this.$18===0){this.$18=Date.now();return}if(a==="Connecting"&&this.$18!==0&&!this.$19){this.$10.bumpCounter("protocol.reconnectstarted");this.$19=!0;return}if(a==="Connected"&&this.$18!==0){a=Date.now()-this.$18;switch(Math.floor(a/3e4)){case 0:this.$10.bumpCounter("protocol.reconnectedwithin30s");break;case 1:this.$10.bumpCounter("protocol.reconnectedwithin60s");break;case 2:this.$10.bumpCounter("protocol.reconnectedwithin90s");break;case 3:this.$10.bumpCounter("protocol.reconnectedwithin120s");break;default:this.$10.bumpCounter("protocol.reconnectedmorethan120s");break}this.$18=0;this.$19=!1;return}};e.$35=function(a){a!==this.$11&&(this.$10.debugTrace("MQTTConnection-updateState","State changed to: "+a),this.$36(a),this.$11=a,this.$1(a))};e.$28=function(){var a=this;if(!this.$8)return;this.$11!=="Disconnected"&&this.$10.debugTrace("Reconnect","Current State not disconnected: "+this.$11);this.$35("Connecting");var b=Date.now(),e=this.$10.getBrowserConnectivity();this.$9=d("MqttUtils").generateSessionId();var f=Array.from(this.$17),g=d("MqttUtils").endpointWithSessionId(this.$5,this.$9);g=d("MqttUtils").endpointWithExtraParameter(g,"cid",this.$6.getDeviceId());try{this.$7=new(c("MqttProtocolClient"))(g);var h=this.$37(),i=h.map(function(a){return a.topic});g=this.$6.gen(this.$9,f,h);this.$7!=null&&(this.$13+=1,this.$7.connect({getKeepAliveIntervalSeconds:this.$38,getKeepAliveTimeoutSeconds:this.$39,ignoreSubProtocol:!0,mqttVersion:3,onConnectFailure:function(c,d,g){return a.$40(d,b,a.$18,f,i,e,c,g)},onConnection:function(){return a.$41(h,f)},onConnectionLost:function(b,c){return a.$42(b,c)},onConnectSuccess:function(c){return a.$43(b,a.$18,f,i,e,c)},onMessageArrived:function(b,c,d){return a.$44(b,c,d)},onMessageDelivered:function(b){return a.$45(b)},userName:g}),this.$10.bumpCounter("protocol.connectattempt"),this.$6.getIsGuestAuthStringPresent()&&this.$10.bumpCounter("guestAuthentication.connectattempt"),this.$27.onConnectAttempt())}catch(a){this.$10.bumpCounter("js_error_in_init_exception"),this.$35("Disconnected"),this.$46(!1,!1,b,this.$18,f,[],e,null,14,"init error - "+a.message),a&&this.$10.logErrorWarn(a,"ws_js_error"),this.$27.onWSFatal(),this.$47(new(d("MqttTypes").MqttChannelError)(!1,"ws_js_error",a),"client_init")}};e.$37=function(){var a=this.$4(),b=65536;return a.map(function(a){a.messageId=b--;return a})};e.$31=function(a){try{if(this.$7!=null){this.$7.subscribe(a);this.$10.debugTrace("#doSubscribe","Subscribing to "+a);this.$27.onSubscribe(a);this.$10.bumpCounter("protocol.subscribe");return!0}}catch(b){this.$10.logError(b,"Exception subscribing"),this.$10.bumpCounter("subscribe_exception."+a),this.$10.bumpCounter("protocol.subscribe.error")}return!1};e.$34=function(a){try{if(this.$7!=null){this.$7.unsubscribe(a);this.$10.debugTrace("#doUnsubscribe","Unsubscribing to "+a);this.$27.onUnsubscribe(a);this.$10.bumpCounter("protocol.unsubscribe");return!0}}catch(b){this.$10.logError(b,"Exception unsubscribing"),this.$10.bumpCounter("unsubscribe_exception."+a),this.$10.bumpCounter("protocol.unsubscribe.error")}return!1};e.$33=function(a,b,c,e){if(this.$7!=null)try{var f;typeof b==="string"?f=this.$7.publish(a,b,c):f=this.$7.publishBinary(a,b,c);this.$10.bumpCounter("protocol.publish");b=f!=null?f:"null";this.$10.debugTrace("#doPublish","publish "+a+" with messageId:"+b+" qos:"+c);this.$27.onPublish(a);(b=e.listener)==null?void 0:b.onEvent(d("MqttPublishListener").MqttPublishEvent.SENT);f!=null?(this.$10.bumpCounter("publish.ack_expected"),this.$24.set(f,e)):e.resolve();return!0}catch(b){this.$10.logError(b,"Exception publishing");this.$10.bumpCounter("publish_exception."+a);e.reject(b);this.$10.bumpCounter("protocol.publish.error");return!1}else return!1};e.$48=function(a){var b=this;a===void 0&&(a=null);if(!this.$8)return;this.$29(d("MqttTypes").MqttErrors.RECONNECT);this.$30("reconnect");this.$49();this.$9=-1;this.$16=0;a=a;a==null&&(a=k*Math.pow(2,this.$12));a=Math.max(a,l);a=Math.min(a,m);a=a*(1e3+d("MqttEnv").Env.random()*200);this.$10.debugTrace("#scheduleReconnect","Reconnect in "+a+" ms");this.$22=d("MqttEnv").Env.setTimeout(function(){b.$28()},a);this.$12+=1};e.$49=function(){var a=Date.now()-this.$16,b=this.$16!==0&&a>s,c=this.$12>t;(b||c)&&(this.$12=0);this.$16!==0&&a<=s&&this.$10.bumpCounter("short_lived_session");c&&this.$10.bumpCounter("connection_attempt_limit")};e.$46=function(a,b,c,d,e,f,g,h,i,j){a?this.$14++:this.$15++;var k=Date.now();this.$10.eventLogConnect({ackReceived:b,attemptNumber:this.$13,connectionState:this.mqttStateFromConnectionState(this.$11),connectionStatus:a,disconnectCount:this.$23,duration:k-c,errorCode:i,errorMessage:j,failTotal:this.$15,hostname:this.$5,messageSizeBytes:h,osConnectivity:g,publishes:f,sessionID:this.$9,subscribedTopics:e,successTotal:this.$14,total_duration:k-d});a&&(this.$13=0)};e.$40=function(a,b,c,d,e,f,g,h){var i=a.mqttError;h=h!=null?i.errorMessage+" - "+h:i.errorMessage;this.$10.debugTrace("connect","Connect failed "+h);this.$10.bumpCounter("protocol.onconnectfailure");this.$6.getIsGuestAuthStringPresent()&&this.$10.bumpCounter("guestAuthentication.onconnectfailure");this.$27.onConnectFailure();this.$46(!1,a.connAck!==-1,b,c,d,e,f,g,i.errorCode,h);if(a.connAck!=null){this.$10.bumpCounter("protocol.connect_failure."+a.connAck);if(a.connAck===u){this.$48(r);return}}this.$48()};e.$41=function(a,b){var c=this;this.$10.bumpCounter("protocol.onconnection");this.$10.debugTrace("Connect","Socket established");this.$27.onConnected();this.$6.getIsGuestAuthStringPresent()&&this.$10.bumpCounter("guestAuthentication.onconnection");b.forEach(function(a){c.$27.onSubscribe(a)});a.forEach(function(a){c.$27.onPublish(a.topic)});this.$35("TransportConnected")};e.$43=function(a,b,c,d,e,f){this.$10.bumpCounter("protocol.onconnectsuccess"),this.$10.debugTrace("connect","Connect success"),this.$6.getIsGuestAuthStringPresent()&&this.$10.bumpCounter("guestAuthentication.onconnectsucess"),this.$27.onConnectSuccess(),this.$26=!0,this.$35("Connected"),this.$46(!0,!0,a,b,c,d,e,f),this.$50(c),this.$16=Date.now()};e.$42=function(a,b){this.$10.bumpCounter("protocol.onconnectionlost");this.$23++;if(a.errorCode){b=b!=null?a.errorMessage+" - "+b:a.errorMessage;this.$10.eventLogDisconnect({disconnectCount:this.$23,duration:Date.now()-this.$16,errorCode:a.errorCode,errorMessage:b,sessionID:this.$9})}this.$10.debugTrace("connect","connection lost");this.$27.onConnectionLost();this.$6.getIsGuestAuthStringPresent()&&this.$10.bumpCounter("guestAuthentication.onconnectionlost");this.$48()};e.$44=function(a,b,c){this.$10.bumpCounter("protocol.onmessagearrived");this.$6.getIsGuestAuthStringPresent()&&this.$10.bumpCounter("guestAuthentication.onmessagearrived");this.$10.debugTrace("onMessageArrived","Message received on "+a);this.$27.onMessage(a);try{this.$3(a,b,c)}catch(b){this.$10.logError(b,"Listener threw error"),this.$10.bumpCounter("listener_error."+a)}};e.$45=function(a){this.$10.bumpCounter("protocol.onmessagedelivered");var b=a!=null?a:"null";this.$10.debugTrace("onMessageDelivered","Delivered Message {ID: "+b+"}");if(a==null)return;b=this.$24.get(a);if(b==null){this.$10.bumpCounter("protocol.message_with_unknown_id");return}this.$24["delete"](a);(a=b.listener)==null?void 0:a.onEvent(d("MqttPublishListener").MqttPublishEvent.ACKED);b.resolve();this.$10.bumpCounter("publish.ack_received")};e.$30=function(a){this.$10.bumpCounter("protocol.fail_all_unacked_publishes."+a),this.$24.forEach(function(b,e,f){(e=b.listener)==null?void 0:e.onEvent(d("MqttPublishListener").MqttPublishEvent.NOT_ACKED);b.reject(c("err")(a))}),this.$24.clear()};e.$50=function(a){var b=this,c=new Set(a);c.forEach(function(a){b.$17.has(a)||b.unsubscribe(a)});a=new Set(this.$17);a.forEach(function(a){c.has(a)||b.subscribe(a)})};e.$47=function(a,b){try{this.$10.bumpCounter("js_error_in_init");this.$10.bumpCounter(b+".error");this.$25=!0;var c=a?a.message:"error";this.$10.debugTrace("onError",b+": "+c);this.$2(a)}catch(a){this.$10.bumpCounter("js_error_in_error_logging"),this.$10.logError(a,"JS error while trying to log previous error")}};e.setRunning_OnlyForTests=function(a){this.$8=a};return a}();g["default"]=a}),98);
__d("MqttWebSocketUtils",[],(function(a,b,c,d,e,f){"use strict";function b(){return"WebSocket"in a&&a.WebSocket!=null&&"CLOSING"in a.WebSocket.prototype}f.hasWSSupport=b}),66);
__d("isFastRefreshEnabledForCurrentDomain",[],(function(a,b,c,d,e,f){"use strict";function a(){return!1}f["default"]=a}),66);
__d("MqttChannel",["ChannelClientID","IrisSubscribeChecker","MetaConfig","MqttAnalyticsHook","MqttConnection","MqttEnv","MqttPublishListener","MqttTypes","MqttUserName","MqttUtils","MqttWebSocketUtils","Promise","Run","err","isFastRefreshEnabledForCurrentDomain","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=29125;a=function(){function a(a){var b=this,e=a.endpoint,f=a.pollingEndpoint,g=a.userFbid,h=a.appId,i=a.initialSubscribedTopics,j=a.capabilities,k=a.clientCapabilities,l=a.chatVisibility;l=l===void 0?!0:l;var m=a.guestAuthString;m=m===void 0?null:m;var n=a.phpOverride;n=n===void 0?"":n;var o=a.clientType;o=o===void 0?"websocket":o;var p=a.deviceId;p=p===void 0?c("ChannelClientID").getID():p;var q=a.pageId;q=q===void 0?null:q;var r=a.assetIds;r=r===void 0?null:r;a=a.appSpecificInfo;a=a===void 0?null:a;this.$11=d("MqttEnv").Env.getLoggerInstance();this.$11.setAppId(h);this.$12=new(c("MqttUserName"))(g,j,k,p,h,l,m,n,o,q,r,a);this.$1=e;this.$2=f;this.$5="Disconnected";this.$7="LPInactive";this.$6="Disconnected";this.$3=[];this.$4=new Set();this.$8=new Map();this.$9=new Map();this.$10=new(c("MqttConnection"))();this.$13=null;this.$16=new(c("MqttAnalyticsHook"))();this.$15=new Map();this.$14=[];if(!d("MqttEnv").Env.isUserLoggedInNow()&&!c("isFastRefreshEnabledForCurrentDomain")()&&(m==null||m=="")){this.$11.bumpCounter("logged_out_init");return}this.$10.addHook(this.$16);this.$10.addHook(new(c("IrisSubscribeChecker"))(function(){return b.$4.size>0}));this.$17(i);this.$18()}var e=a.prototype;e.$17=function(a){var b=this;if(this.$10.isRunning()){this.$19("run","Connection started calling run again");return}if(d("MqttEnv").Env.genGk(d("MqttEnv").MqttGkNames.mqtt_ws_polling_enabled))if(c("MetaConfig")._("15")){this.$19("MqttChannel","Websocket disabled, will do long polling only");return}else if(!d("MqttWebSocketUtils").hasWSSupport()){this.$19("MqttChannel","Websocket Unavailable, will do long polling only");this.$11.bumpCounter("ws_unavailable_polling");return}this.$10.run({endpoint:this.$1,extraConnectMessageProvider:function(){return b.$20()},mqttUserName:this.$12,onJSError:function(a){b.$21(a)},onMessageReceived:function(a,c,d){b.$22(a,c,d)},onStateChange:function(a){b.$23(a)},subscribedTopics:a});this.$24()};e.$24=function(){var a=this;d("Run").onUnload(function(){a.$25(d("MqttTypes").MqttErrors.BROWSER_CLOSE)})};e.shutdown=function(){this.$25(d("MqttTypes").MqttErrors.APP_DISCONNECT)};e.$25=function(a){this.$10&&this.$10.shutdown(a),this.$13&&this.$13.shutdown(),this.$16.onTabClose()};e.publish=function(a,b,c){c===void 0&&(c={qos:1,skipBuffer:!1});return this.$26(a,b,c)};e.publishBinary=function(a,b,c){c===void 0&&(c={qos:1,skipBuffer:!1});return this.$26(a,b,c)};e.$26=function(a,b,c){c===void 0&&(c={qos:1,skipBuffer:!1});var e;c.qos===0?e=this.$27(a,b,c.listener):e=this.$28(a,b,c);d("MqttUtils").promiseDone(e,function(){},function(a){(a=c.listener)==null?void 0:a.onEvent(d("MqttPublishListener").MqttPublishEvent.PUBLISH_ERROR)});return e};e.$27=function(a,b,c){return this.$29(a,b,0,c,1,null)};e.$28=function(a,c,e){var f={reject:function(a){},resolve:function(){}},g=new(h||(h=b("Promise")))(function(a,b){f.resolve=a,f.reject=b}),i=d("MqttEnv").Env.random();c={ack:f,attempt:0,options:e,payload:c,publishToken:i,startTime:Date.now(),timeoutId:null,topic:a};if(e.skipBuffer)if(this.$10.connectionState()==="Connecting"){this.$14.push(c);(a=e.listener)==null?void 0:a.onEvent(d("MqttPublishListener").MqttPublishEvent.QUEUED)}else this.$30(c);else{c.timeoutId=this.$31(i);this.$15.set(i,c);(a=e.listener)==null?void 0:a.onEvent(d("MqttPublishListener").MqttPublishEvent.QUEUED);this.$32(c)}return g};e.$30=function(a){a.attempt+=1,d("MqttUtils").promiseDone(this.$29(a.topic,a.payload,a.options.qos,a.options.listener,a.attempt,a.startTime),function(){a.ack.resolve()},function(b){a.ack.reject(b)})};e.$32=function(a){var b=this;a.attempt+=1;d("MqttUtils").promiseDone(this.$29(a.topic,a.payload,a.options.qos,a.options.listener,a.attempt,a.startTime),function(){return b.$33(a)},function(a){})};e.$29=function(a,b,e,f,g,h){var i=this,j,k,l=this.getConnectionState(),m=Date.now();!this.$10.canPublish()&&this.$13&&this.$13.canPublish()?(typeof b==="string"?j=this.$13.publish(a,b,e):j=this.$13.publishBinary(a,b,e),k="lp",f!=null&&(j=j.then(function(){return f.onEvent(d("MqttPublishListener").MqttPublishEvent.SENT)})),this.$11.bumpCounter("try_publish_lp")):(typeof b==="string"?j=this.$10.publish(a,b,e,f):j=this.$10.publishBinary(a,b,e,f),k="ws",this.$11.bumpCounter("try_publish_ws"));c("promiseDone")(j,function(){i.$11.eventLogOutgoingPublish({attempt:g,connectionState:l,disconnectCount:i.$10.getDisconnectCount(),errorMessage:null,firstAttemptStartTime:h,payloadSizeBytes:b.length*2,protocol:k,qos:e,sessionID:i.$10.getSessionId(),success:!0,thisAttemptStartTime:m,topic:a})},function(c){i.$11.eventLogOutgoingPublish({attempt:g,connectionState:l,disconnectCount:i.$10.getDisconnectCount(),errorMessage:c!=null?c.toString():null,firstAttemptStartTime:h,payloadSizeBytes:b.length*2,protocol:k,qos:e,sessionID:i.$10.getSessionId(),success:!1,thisAttemptStartTime:m,topic:a})});return j};e.subscribe=function(a,b){var c=this;this.$10.subscribe(a);var d=this.$8.get(a);!d?(d=[b],this.$8.set(a,d)):d.push(b);return function(){var d=c.$8.get(a)||[];d=d.filter(function(a){return a!==b});c.$8.set(a,d);d.length===0&&c.unsubscribeAll(a)}};e.subscribeBinary=function(a,b){var c=this;this.$10.subscribe(a);var d=this.$9.get(a);!d?(d=[b],this.$9.set(a,d)):d.push(b);return function(){var d=c.$9.get(a)||[];d=d.filter(function(a){return a!==b});c.$9.set(a,d);d.length===0&&c.unsubscribeAll(a)}};e.subscribeChannelEvents=function(a){var b=this;this.$3.push(a);return function(){b.unsubscribeChannelEvents(a)}};e.unsubscribeChannelEvents=function(a){a=this.$3.indexOf(a);a>-1&&this.$3.splice(a,1)};e.registerExtraConnectPayloadProvider=function(a){var b=this;this.$19("MqttChannel","registerExtraConnectPayloadProvider called");this.$4.add(a);if(this.$10.isRunning()){a=a.getPublishMessages();a.forEach(function(a){typeof a.payload==="string"?b.publish(a.topic,a.payload,{qos:a.qos,skipBuffer:!0}):b.publishBinary(a.topic,a.payload,{qos:a.qos,skipBuffer:!0})})}};e.unregisterExtraConnectPayloadProvider=function(a){this.$4["delete"](a)};e.unsubscribeAll=function(a){this.$10.unsubscribe(a),this.$8["delete"](a),this.$9["delete"](a)};e.getConnectionState=function(){return this.$5};e.getLongPollingStatus=function(){return this.$7};e.getEndpoint=function(){return this.$1};e.addHook=function(a){this.$10.addHook(a)};e.removeHook=function(a){this.$10.removeHook(a)};e.testOnlyMessageReceived=function(a,b){this.$22(a,b,-1)};e.$34=function(a){var b=this.$15.get(a);b!=null&&b.timeoutId!=null&&d("MqttEnv").Env.clearTimeout(b.timeoutId);this.$15["delete"](a)};e.$31=function(a){var b=this;return d("MqttEnv").Env.setTimeout(function(a){var d=b.$15.get(a);if(!d)return;var e=d.topic;b.$11.bumpCounter("publish_timeout."+e);b.$11.debugTrace("publish_timeout","Timeout publishing topic: "+e+" publishToken: "+a);b.$34(a);d.ack.reject(c("err")("Publish Timed Out"))},i,a)};e.$33=function(a){var b=a.publishToken,c=this.$15.get(b);if(!c)return;this.$34(b);a.ack.resolve();this.$11.debugTrace("publish_success","Topic: "+a.topic+" publishToken: "+a.publishToken);this.$11.bumpCounter("publish_success."+a.topic)};e.$22=function(a,b,c){var d=this.$8.get(a);this.$11.eventLogIncomingPublish({connectionState:this.getConnectionState(),disconnectCount:this.$10.getDisconnectCount(),payloadSizeBytes:b.payloadString.length*2,qos:c,sessionID:this.$10.getSessionId(),topic:a});if(!d)this.$11.debugTrace("_onMessageReceived",a+" being dropped, no listeners");else for(var d=d,e=Array.isArray(d),f=0,d=e?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{f=d.next();if(f.done)break;g=f.value}g=g;try{g(b.payloadString)}catch(a){this.$11.logError(a,"Listener exception"),this.$11.bumpCounter("listener_error")}}g=this.$9.get(a);this.$11.eventLogIncomingPublish({connectionState:this.getConnectionState(),disconnectCount:this.$10.getDisconnectCount(),payloadSizeBytes:b.payloadBytes.length,qos:c,sessionID:this.$10.getSessionId(),topic:a});if(!g)this.$11.debugTrace("_onMessageReceived",a+" being dropped, no binary listeners");else for(f=g,e=Array.isArray(f),d=0,f=e?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(e){if(d>=f.length)break;c=f[d++]}else{d=f.next();if(d.done)break;c=d.value}a=c;try{a(b.payloadBytes)}catch(a){this.$11.logError(a,"Binary Listener exception"),this.$11.bumpCounter("listener_error")}}};e.$21=function(a){if(d("MqttEnv").Env.genGk(d("MqttEnv").MqttGkNames.mqtt_ws_polling_enabled)){a.isRecoverable?this.$11.bumpCounter("recoverable_error_skipped"):this.$11.bumpCounter("unrecoverable_error_skipped");return}a.isRecoverable?this.$11.bumpCounter("recoverable_error_not_skipped"):this.$11.bumpCounter("unrecoverable_error_not_skipped");this.$35(a)};e.$36=function(a){this.$35(a)};e.$35=function(a){for(var b=this.$3,c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{d=b.next();if(d.done)break;e=d.value}e=e;e.onJSError&&e.onJSError(a)}};e.$37=function(){var a=this;this.$14.forEach(function(b){a.$30(b),a.$11.bumpCounter("publish_from_temp_buffer."+b.topic)});this.$14=[];this.$15.forEach(function(b,c,d){a.$32(b),a.$11.bumpCounter("publish_from_buffer."+b.topic)})};e.$23=function(a){a==="Connecting"?(this.$14.forEach(function(a){a.ack.reject(c("err")("Client Reconnecting - "+a.topic))}),this.$14=[]):a==="TransportConnected"&&this.$37(),this.$19("_changeState","Connection state = "+a),this.$38(a,this.$7)};e.$39=function(a,b){this.$13&&this.$13.canPublish()&&this.$37(),this.$19("_changeLPStatus","LP status = "+a+", LP Request status = "+b),this.$38(this.$6,a)};e.$38=function(a,b){var c=this.$10.mqttStateFromConnectionState(a);this.$13&&this.$13.canPublish()&&(c="Connected");this.$6=a;(c!==this.$5||b!=this.$7)&&(this.$5=c,this.$7=b,this.$40(c))};e.$40=function(a){for(var b=this.$3,c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{d=b.next();if(d.done)break;e=d.value}e=e;e.onMQTTStateChanged(a)}};e.$20=function(){var a=this,b=[];this.$4.forEach(function(c){try{c=c.getPublishMessages();Array.prototype.push.apply(b,c)}catch(b){a.$11.logError(b,"ConnectPayload provider exception"),a.$11.bumpCounter("connectPayloadProvider_error")}});return b};e.$18=function(){var a=this;d("MqttEnv").Env.genGk(d("MqttEnv").MqttGkNames.mqtt_ws_polling_enabled)&&this.$2&&this.$2!=""&&c("requireDeferred")("MqttLongPollingRunner").__setRef("MqttChannel").onReady(function(b){b=new b(a.$2,a.$12,a.$10.hasFatal(),a.$10.hasConnectSuccess(),function(b,c,d){return a.$22(b,c,d)},function(){var b=Array.from(a.$8.keys()),c=Array.from(a.$9.keys());return Array.from(new Set(b.concat(c)))},function(){return a.$20()},function(b){a.$36(b)},function(b,c){a.$39(b,c)});b.start();a.$10.addHook(b);b.addHook(a.$16);a.$13=b;a.$11.debugTrace("MqttChannel","longPollingRunner loaded")})};e.$19=function(a,b){this.$11.debugTrace(a,"Mqtt channel: "+b)};e.setForegroundState=function(a){this.$12&&this.$12.setForegroundState(a)};e.setChatVisibility=function(a){this.$12&&this.$12.setChatVisibility(a)};e.getEndpointCapabilities=function(){return this.$12.getEndpointCapabilities()};e.setEndpointCapabilities=function(a){this.$12.setEndpointCapabilities(a)};e.getConnection_OnlyForTests=function(){return this.$10};return a}();g["default"]=a}),98);
__d("MqttConfig",["MqttWebConfig"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=c("MqttWebConfig")}),98);
__d("MqttEnvConfigStorage",["WebStorage"],(function(a,b,c,d,e,f,g){var h,i="mqtt:";function a(a,b){var d=(h||(h=c("WebStorage"))).getLocalStorage();if(d){d=d.getItem(i+a);if(d!=null)return d}return b}function b(a,b){var d=(h||(h=c("WebStorage"))).getLocalStorage();d&&(b==null?d.removeItem(i+a):(h||(h=c("WebStorage"))).setItemGuarded(d,i+a,b))}g.configRead=a;g.configWrite=b}),98);
__d("MqttUnifiedClientConnectFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1744057");b=d("FalcoLoggerInternal").create("mqtt_unified_client_connect",a);e=b;g["default"]=e}),98);
__d("MqttUnifiedClientDisconnectFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1744058");b=d("FalcoLoggerInternal").create("mqtt_unified_client_disconnect",a);e=b;g["default"]=e}),98);
__d("MqttUnifiedClientIncomingPublishFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1744059");b=d("FalcoLoggerInternal").create("mqtt_unified_client_incoming_publish",a);e=b;g["default"]=e}),98);
__d("MqttUnifiedClientOutgoingPublishFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1744060");b=d("FalcoLoggerInternal").create("mqtt_unified_client_outgoing_publish",a);e=b;g["default"]=e}),98);
__d("MqttWsClientTypedLoggerLite",["generateLiteTypedLogger"],(function(a,b,c,d,e,f){"use strict";e.exports=b("generateLiteTypedLogger")("logger:MqttWsClientLoggerConfig")}),null);
__d("MqttLogger",["ChannelClientID","FBLogger","LogHistory","MetaConfig","MqttEnv","MqttGlobalStreamCounter","MqttUnifiedClientConnectFalcoEvent","MqttUnifiedClientDisconnectFalcoEvent","MqttUnifiedClientIncomingPublishFalcoEvent","MqttUnifiedClientOutgoingPublishFalcoEvent","MqttWsClientTypedLoggerLite","NetworkStatus","ODS","Random"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("MetaConfig")._("99"),j="mqtt_client",k=100,l="WEBSOCKET",m=typeof window!=="undefined"?window:self,n=null,o={CLIENT_ERROR:"mqtt_client_error",CONNECT:"mqtt_client_connect",DISCONNECT:"mqtt_client_disconnect",PUBLISH:"mqtt_client_publish",PUBLISH_TIMEOUT:"mqtt_qos1_publish_timeout",SOCKET_DISCONNECT:"mqtt_protocol_error"},p={CONNECT:"connect",DISCONNECT:"disconnect",INCOMING_PUBLISH:"incoming_publish",OUTGOING_PUBLISH:"outgoing_publish"};a=function(){a.getInstance=function(){n||(n=new a());return n};function a(){this.$1=d("LogHistory").getInstance(j),this.$2=0,this.$3=Date.now(),this.$4=c("ChannelClientID").getID(),this.$6(),this.$5=d("MqttGlobalStreamCounter").getInstance(),this.$5.isEnabled()||(this.$5=null)}var b=a.prototype;b.setAppId=function(a){this.$2===0&&(this.$2=a)};b.eventLogConnect=function(a){var b=a.ackReceived,d=a.attemptNumber,e=a.connectionState,f=a.connectionStatus,g=a.disconnectCount,h=a.duration,i=a.errorMessage,j=a.failTotal,k=a.hostname,m=a.messageSizeBytes,n=a.osConnectivity,q=a.sessionID,r=a.successTotal;a=a.total_duration;f=f?"success":"failed";this.bumpCounter(o.CONNECT+"."+f);f=r/(r+j);r=n&&this.getBrowserConnectivity();var s={acked:b,attempt_number:d.toString(),client_type:l,connection_state:e,disconnect_count:g.toString(),duration:h.toString(),error:i,event_type:p.CONNECT,extra_data:{connect_success_rate:f.toString(),device_id:this.$4,hostname:k},os_connectivity:r,payload_size:m==null?void 0:m.toString(),session_id:q.toString(),total_duration:a.toString(),ws_count:(j=this.$5)==null?void 0:j.getGlobalState().totalConnectionStreams.toString()};this.$7(function(){c("MqttUnifiedClientConnectFalcoEvent").log(function(){return s})})};b.eventLogPull=function(a){var b=a.duration,c=a.errorMessage,e=a.hostname,f=a.pullEventName,g=a.sessionID;a=a.status;a={connection_status:a,device_id:this.$4,duration:b,error_message:c,hostname:e,href:m.location.hostname,logged_in:d("MqttEnv").Env.isUserLoggedInNow(),session_id:g};this.$8(f,a)};b.eventLogPullFinish=function(a){var b=a.duration,c=a.errorMessage,e=a.publishReceived,f=a.publishSent,g=a.pullEventName;a=a.sessionID;b={device_id:this.$4,duration:b,error_message:c,href:m.location.hostname,logged_in:d("MqttEnv").Env.isUserLoggedInNow(),publish_received:e,publish_sent:f,session_id:a};this.$8(g,b)};b.eventLogDisconnect=function(a){var b=a.disconnectCount,d=a.duration,e=a.errorMessage;a=a.sessionID;this.bumpCounter(o.DISCONNECT);var f={client_type:l,connection_state:"Disconnected",disconnect_count:b.toString(),duration:d.toString(),error:e,event_type:p.DISCONNECT,extra_data:{device_id:this.$4},os_connectivity:this.getBrowserConnectivity(),session_id:a.toString(),ws_count:(b=this.$5)==null?void 0:b.getGlobalState().totalConnectionStreams.toString()};this.$7(function(){c("MqttUnifiedClientDisconnectFalcoEvent").log(function(){return f})})};b.eventLogOutgoingPublish=function(a){var b=a.attempt,d=a.connectionState,e=a.disconnectCount,f=a.errorMessage,g=a.firstAttemptStartTime,h=a.payloadSizeBytes,i=a.protocol,j=a.qos,k=a.sessionID,m=a.success,n=a.thisAttemptStartTime;a=a.topic;this.bumpCounter(o.PUBLISH+"."+a);var q=Date.now(),r={acked:j===1?m:null,attempt_number:b.toString(),client_type:l,connection_state:d,disconnect_count:e.toString(),duration:(q-n).toString(),error:f,event_type:p.OUTGOING_PUBLISH,extra_data:{device_id:this.$4,protocol:i},os_connectivity:this.getBrowserConnectivity(),payload_size:h.toString(),qos:j.toString(),session_id:k.toString(),topic:a,total_duration:g!=null?(q-g).toString():null};this.$7(function(){c("MqttUnifiedClientIncomingPublishFalcoEvent").log(function(){return r})})};b.eventLogIncomingPublish=function(a){var b=a.connectionState,d=a.disconnectCount,e=a.payloadSizeBytes,f=a.qos,g=a.sessionID;a=a.topic;var h={client_type:l,connection_state:b,disconnect_count:d.toString(),event_type:p.INCOMING_PUBLISH,extra_data:{device_id:this.$4},os_connectivity:this.getBrowserConnectivity(),payload_size:e.toString(),qos:f.toString(),session_id:g.toString(),topic:a};b=a=="/webrtc"||a=="/rtc_multi";this.$9(function(){c("MqttUnifiedClientOutgoingPublishFalcoEvent").log(function(){return h})},50,b)};b.logError=function(a,b){d("MqttEnv").Env.scheduleLoggingCallback(function(){try{c("FBLogger")(j).catching(a).mustfix(b)}catch(a){}})};b.logErrorWarn=function(a,b){d("MqttEnv").Env.scheduleLoggingCallback(function(){try{c("FBLogger")(j).catching(a).warn(b)}catch(a){}})};b.logWarn=function(a,b){var c=this;d("MqttEnv").Env.scheduleLoggingCallback(function(){try{c.$1.warn(a,b)}catch(a){}})};b.debugTrace=function(a,b){var c=this;d("MqttEnv").Env.scheduleLoggingCallback(function(){try{c.$1.debug(a,b)}catch(a){}})};b.bumpCounter=function(a){var b=this;if(!d("Random").coinflip(k))return;d("MqttEnv").Env.scheduleLoggingCallback(function(){b.$2!==0&&(h||(h=d("ODS"))).bumpEntityKey(2966,"mqtt_ws_client",b.$2+"."+a,k),(h||(h=d("ODS"))).bumpEntityKey(2966,"mqtt_ws_client",a,k)})};b.$8=function(a,b,e){var f=this;d("MqttEnv").Env.scheduleLoggingCallback(function(){b.event_type=a;b.app_id=f.$2;b.online=f.$10();var d=JSON.stringify(b);f.$1.log(a,d,{weight:e});a!==o.DISCONNECT&&c("MqttWsClientTypedLoggerLite").log(b)})};b.$9=function(a,b,c){i&&b!==0?c=c||d("Random").coinflip(b):c=!0;c&&d("MqttEnv").Env.scheduleCallback(a)};b.$7=function(a){this.$9(a,0,!1)};b.$10=function(){return m.navigator&&m.navigator.onLine!==void 0?m.navigator.onLine:!1};b.getBrowserConnectivity=function(){return c("NetworkStatus").isOnline()};b.$6=function(){var a=this;if(m.navigator&&m.navigator.onLine!==void 0){var b=function(b){b=b.online;b||a.bumpCounter("browser_disconnect")};c("NetworkStatus").onChange(b)}};return a}();g["default"]=a}),98);
__d("MqttEnvGk",["MqttEnv","MqttLogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case d("MqttEnv").MqttGkNames.mqtt_waterfall_log_client_sampling:return c("gkx")("21119");case d("MqttEnv").MqttGkNames.mqtt_ws_polling_enabled:return!0;case d("MqttEnv").MqttGkNames.mqtt_lp_use_fetch:return c("gkx")("21120");case d("MqttEnv").MqttGkNames.mqtt_fast_lp:return c("gkx")("21121");case d("MqttEnv").MqttGkNames.mqtt_lp_no_delay:return c("gkx")("21122");case d("MqttEnv").MqttGkNames.mqtt_enable_publish_over_polling:return c("gkx")("21123");case d("MqttEnv").MqttGkNames.mqttweb_global_connection_counter:return c("gkx")("21124");default:c("MqttLogger").getInstance().logError(new Error("unknown gk"),"Unknown GK value "+a);return!1}}g["default"]=a}),98);
__d("MqttEnvInitializer",["CurrentMessengerUser","MqttEnv","MqttEnvConfigStorage","MqttEnvGk","MqttLogger","Random","clearTimeout","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g){"use strict";function a(){d("MqttEnv").Env.initialize(c("Random").random,d("CurrentMessengerUser").isLoggedInNow,c("clearTimeout"),c("setTimeoutAcrossTransitions"),function(){return c("MqttLogger").getInstance()},c("MqttEnvGk"),null,null,null,d("MqttEnvConfigStorage").configRead,d("MqttEnvConfigStorage").configWrite)}b={genGk:c("MqttEnvGk"),initialize:a};g["default"]=b}),98);
__d("FBMqttChannel",["MqttChannel","MqttConfig","MqttEnvInitializer"],(function(a,b,c,d,e,f,g){"use strict";c("MqttEnvInitializer").initialize();b=new(c("MqttChannel"))({appId:(a=c("MqttConfig")).appID,capabilities:a.capabilities,chatVisibility:!1,clientCapabilities:a.clientCapabilities,endpoint:a.endpoint,initialSubscribedTopics:a.subscribedTopics,phpOverride:a.hostNameOverride,pollingEndpoint:a.pollingEndpoint,userFbid:a.fbid});g["default"]=b}),98);
__d("FbtLogging",["cr:1094907","cr:8828"],(function(a,b,c,d,e,f,g){"use strict";a=b("cr:1094907")==null?void 0:b("cr:1094907").logImpression;c=b("cr:8828")==null?void 0:b("cr:8828").logImpressionV2;g.logImpression=a;g.logImpressionV2=c}),98);
__d("GeneratedLoggerUtils",["invariant","Banzai","JstlMigrationFalcoEvent","getDataWithLoggerOptions"],(function(a,b,c,d,e,f,g){"use strict";var h=window.location.search.indexOf("showlog")>-1;function a(a,c,d,e){var f=b("getDataWithLoggerOptions")(c,e);c=a.split(":")[0];var g=a.split(":")[1];c=="logger"?b("JstlMigrationFalcoEvent").log(function(){return{logger_config_name:g,payload:f}}):b("Banzai").post(a,f,d);h}c={log:a,serializeVector:function(a){if(!a)return a;if(Array.isArray(a))return a;if(a.toArray){var b=a;return b.toArray()}if(typeof a==="object"&&a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"])return Array.from(a);g(0,3874,a)},serializeMap:function(a){if(!a)return a;if(a.toJS){var b=a;return b.toJS()}if(typeof a==="object"&&a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]){b=a;var c={};for(var b=b,d=Array.isArray(b),e=0,b=d?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=b.length)break;f=b[e++]}else{e=b.next();if(e.done)break;f=e.value}f=f;c[f[0]]=f[1]}return c}if(Object.prototype.toString.call(a)==="[object Object]")return a;g(0,3875,a)},checkExtraDataFieldNames:function(a,b){Object.keys(a).forEach(function(a){Object.prototype.hasOwnProperty.call(b,a)&&g(0,3876,a)})},warnForInvalidFieldNames:function(a,b,c,d){},throwIfNull:function(a,b){a||g(0,3877,b);return a}};e.exports=c}),null);
__d("IGDOverLSMqttChannel",["CurrentUser","Env","MqttChannel","MqttEnv","MqttEnvInitializer","MqttWebConfig","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i;c("MqttEnvInitializer").initialize();function j(a){d("MqttEnv").setIsUserLoggedInNow(c("CurrentUser").isLoggedIn);var b=c("CurrentUser").getAppID()==null?936619743392459:Number(c("CurrentUser").getAppID());return new(c("MqttChannel"))({appId:b,capabilities:c("MqttWebConfig").capabilities,chatVisibility:!0,clientCapabilities:c("MqttWebConfig").clientCapabilities,clientType:"cookie_auth",deviceId:a,endpoint:(i||(i=c("Env"))).ig_mqtt_wss_endpoint||"wss://edge-chat.instagram.com/chat",initialSubscribedTopics:c("MqttWebConfig").subscribedTopics,phpOverride:c("MqttWebConfig").hostNameOverride,pollingEndpoint:(i||(i=c("Env"))).ig_mqtt_polling_endpoint||"https://edge-chat.instagram.com/mqtt/pull",userFbid:c("CurrentUser").getPossiblyNonFacebookUserID()})}var k=null,l;function m(a){k==null&&(k=j(a));a=k;l==null?void 0:l(a);return a}function a(){return new(h||(h=b("Promise")))(function(a){k?a(m()):l=function(b){a(b)}})}function e(){k!=null&&(k.shutdown(),k=null)}g.getInstance=m;g.waitAndGetInstance=a;g.shutdownAndClear=e}),98);
__d("IGWebCallWindowControllerLoader",["FBLogger","JSResourceForInteraction","Promise","asyncToGeneratorRuntime","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("RTWebCallWindowOpener").__setRef("IGWebCallWindowControllerLoader"),j=c("requireDeferred")("ZenonCallWindowController").__setRef("IGWebCallWindowControllerLoader"),k=function(b){babelHelpers.inheritsLoose(a,b);function a(){return b.apply(this,arguments)||this}return a}(babelHelpers.wrapNativeSuper(Error));a=function(){function a(a,b){this.$1=null,this.$2=a,this.$3=b}var d=a.prototype;d.init=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a=(yield (h||(h=b("Promise"))).all([j.load(),i.load()])),d=a[0];a=a[1];this.$1=new d(this.$2,{callWindowInitializerResource:this.$3,callWindowOpener:new a(),uriBuilderResource:c("JSResourceForInteraction")("IGCallUriBuilder").__setRef("IGWebCallWindowControllerLoader")})}catch(a){c("FBLogger")("rtc_www").catching(a).warn("Failed to initialize call window controller")}});function d(){return a.apply(this,arguments)}return d}();d.initCall=function(a){if(this.$1)return this.$1.initCall(a);else throw new k()};return a}();a.ResourceNotReadyError=k;g["default"]=a}),98);
__d("IGWebPreCallContext",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=(h||d("react")).createContext;b=a(null);g["default"]=b}),98);
__d("ZenonCallInviteModelLoader",["BaseEventEmitter","Promise","asyncToGeneratorRuntime","emptyFunction","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("ZenonCallInviteModel").__setRef("ZenonCallInviteModelLoader"),j=c("requireDeferred")("delegateZenonCallInviteModel").__setRef("ZenonCallInviteModelLoader");a=function(a){babelHelpers.inheritsLoose(d,a);function d(b){var d;d=a.call(this)||this;d.$ZenonCallInviteModelLoader$p_1=null;d.getCurrentInvite=function(){return null};d.startListening=function(a){this.$ZenonCallInviteModelLoader$p_1=a};d.stopListening=function(){this.$ZenonCallInviteModelLoader$p_1=null};d.dismiss=c("emptyFunction");d.accept=c("emptyFunction");d.decline=c("emptyFunction");d.$ZenonCallInviteModelLoader$p_2=b;return d}var e=d.prototype;e.init=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield (h||(h=b("Promise"))).all([i.load(),j.load()])),c=a[0];a=a[1];c=new c(this.$ZenonCallInviteModelLoader$p_2);a(this,c);this.$ZenonCallInviteModelLoader$p_1!==null&&c.startListening(this.$ZenonCallInviteModelLoader$p_1)});function c(){return a.apply(this,arguments)}return c}();return d}(c("BaseEventEmitter"));g["default"]=a}),98);
__d("MWSCastingCenterUtils",["UserAgent","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("8702")&&c("UserAgent").isBrowser("Chrome for iOS")}g.isBrowserSupportedForMobileManagedCasting=a}),98);
__d("OCCastingZenonUtils",["UserAgent","gkx"],(function(a,b,c,d,e,f,g){"use strict";b=function(a){return a==="Connected"||a==="Connecting"};function a(){return c("gkx")("1930")||c("gkx")("25763")&&(c("UserAgent").isBrowser("Chrome for iOS")||c("UserAgent").isBrowser("Mobile Safari"))}g.hasCallStarted=b;g.isBrowserSupportedForMobileWebCasting=a}),98);
__d("RTWebIncomingRingConfiguration",["MWSCastingCenterUtils","OCCastingZenonUtils","UserAgent","ZenonRTWebBrowserFeatureSupport","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return(c("gkx")("5285")?c("UserAgent").isBrowser("Chrome >= 87"):c("UserAgent").isBrowser("Chrome >= 77"))||c("UserAgent").isBrowser("Edge (Chromium Based) >= 79")||c("UserAgent").isBrowser("Edge PWA (Chromium Based) >= 79")||c("UserAgent").isBrowser("Opera >= 67")||c("UserAgent").isBrowser("Firefox >= 70")||c("UserAgent").isBrowser("Safari >= 16")&&c("gkx")("24226")||c("UserAgent").isBrowser("Safari >= 15.4")&&c("gkx")("24227")||c("UserAgent").isBrowser("Oculus Browser >= 7")&&c("gkx")("24228")||d("OCCastingZenonUtils").isBrowserSupportedForMobileWebCasting()||d("MWSCastingCenterUtils").isBrowserSupportedForMobileManagedCasting()}function b(){return c("gkx")("23430")&&d("ZenonRTWebBrowserFeatureSupport").isInsertableStreamsSupported()}g.isSupportedClient=a;g.isE2EESupportedClient=b}),98);
__d("ZenonIncomingRingSDK",["BaseEventEmitter","RTWebIncomingRingConfiguration","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("ZenonParentCallsManager").__setRef("ZenonIncomingRingSDK"),i=[1,2,15,16];a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.$ZenonIncomingRingSDK$p_1=[],c.$ZenonIncomingRingSDK$p_2=[],b)||babelHelpers.assertThisInitialized(c)}var c=b.prototype;c.init=function(a){var b=this;this.$ZenonIncomingRingSDK$p_3=a;h.onReady(function(c){b.callsManager==null&&(b.callsManager=new c(a));c=b.callsManager;c.addListener("unsupportedRing",function(a){return b.emit("unsupportedRing",a)});c.addListener("incomingRing",function(a){var c;if(a.actorID!=null&&!((c=b.$ZenonIncomingRingSDK$p_3)==null?void 0:c.enableIncomingActorCalls))return;b.emit("incomingRing",a)});c.addListener("ringCancel",function(a){return b.emit("ringCancel",a)});c.initListeners(b.$ZenonIncomingRingSDK$p_1);while(b.$ZenonIncomingRingSDK$p_2.length>0){var d=b.$ZenonIncomingRingSDK$p_2.shift();c.startOutgoingCallIntent(d.nonce,d.callParams)}})};c.initListeners=function(a){var b=this.callsManager;if(b!=null)b.initListeners(a);else{(b=this.$ZenonIncomingRingSDK$p_1).push.apply(b,a)}};c.removeListeners=function(a){var b=this;if(this.callsManager!=null)this.callsManager.removeListeners(a);else{var c=function(){if(e){if(f>=d.length)return"break";g=d[f++]}else{f=d.next();if(f.done)return"break";g=f.value}var a=g;b.$ZenonIncomingRingSDK$p_1=b.$ZenonIncomingRingSDK$p_1.filter(function(b){return b!==a})};for(var d=a,e=Array.isArray(d),f=0,d=e?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;a=c();if(a==="break")break}}};c.isCallSupported=function(a){switch(a.type){case"thread":if(this.$ZenonIncomingRingSDK$p_3&&i.includes(a.threadType)){return(a=d("RTWebIncomingRingConfiguration").isSupportedClient())!=null?a:!1}break;default:return!1}return!1};c.startCallIntent=function(a,b){this.callsManager?this.callsManager.startOutgoingCallIntent(a,b):this.$ZenonIncomingRingSDK$p_2.push({callParams:b,nonce:a})};return b}(c("BaseEventEmitter"));g["default"]=a}),98);
__d("IGWebPreCallContextSingleton",["FBLogger","IGWebCallWindowControllerLoader","JSResource","ZenonCallInviteModelLoader","ZenonIncomingRingSDK","gkx","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("IgSignalingListener").__setRef("IGWebPreCallContextSingleton"),i=!1,j;function a(a){if(!c("gkx")("25307"))return null;if(j!=null)return j;try{var b=new(c("ZenonIncomingRingSDK"))();j={callInviteModel:new(c("ZenonCallInviteModelLoader"))(b),callWindowController:new(c("IGWebCallWindowControllerLoader"))(a,c("JSResource")("IGWebCallWindowInitializer").__setRef("IGWebPreCallContextSingleton")),incomingRingSDK:b};return j}catch(a){c("FBLogger")("rtc_www").catching(a).mustfix("Pre-call context initialization failed! This breaks all calling!");return null}}function b(a){if(!c("gkx")("25307"))return null;if(i)return j;i=!0;c("promiseDone")(j.callInviteModel.init());c("promiseDone")(j.callWindowController.init());j.incomingRingSDK.init({enableIncomingActorCalls:!1,relayEnvironment:a});c("promiseDone")(h.load(),function(a){j.incomingRingSDK.initListeners([new a()])});return j}g.create=a;g.init=b}),98);
__d("IGWebPreCallProvider.react",["CometRelay","IGWebPreCallContext","IGWebPreCallContextSingleton","react","react-compiler-runtime","useStable"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useEffect;function a(a){var b=d("react-compiler-runtime").c(9);a=a.children;var e=d("CometRelay").useRelayEnvironment(),f;b[0]!==e?(f=function(){return d("IGWebPreCallContextSingleton").create({relayEnvironment:e})},b[0]=e,b[1]=f):f=b[1];var g=c("useStable")(f),h;b[2]!==g||b[3]!==e?(f=function(){g&&(d("IGWebPreCallContextSingleton").init(e),g.callInviteModel.startListening({callsBlocked:!1}))},h=[g,e],b[2]=g,b[3]=e,b[4]=f,b[5]=h):(f=b[4],h=b[5]);j(f,h);b[6]!==a||b[7]!==g?(f=i.jsx(c("IGWebPreCallContext").Provider,{value:g,children:a}),b[6]=a,b[7]=g,b[8]=f):f=b[8];return f}g["default"]=a}),98);
__d("InstagramODSObserver",["BaseEventEmitter"],(function(a,b,c,d,e,f,g){"use strict";a=new(c("BaseEventEmitter"))();b=a;g["default"]=b}),98);
__d("InstagramODSImpl",["InstagramODSObserver","ODS"],(function(a,b,c,d,e,f,g){"use strict";var h,i="instagram",j={addListener:function(a){c("InstagramODSObserver").addListener("event",a)},incr:function(a,b){b===void 0&&(b=1),(h||(h=d("ODS"))).bumpEntityKey(5588,i,a,b),c("InstagramODSObserver").emit("event",{count:b,key:a})},incr_CAREFUL_WHEN_USE_DYNAMIC_KEY:function(a,b){j.incr(a,b)}};a=j;g["default"]=a}),98);
__d("IntlQtEventFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1848815");b=d("FalcoLoggerInternal").create("intl_qt_event",a);e=b;g["default"]=e}),98);
__d("PromiseResult",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;a=function(){function a(){var a=this;this.promise=new(g||(g=b("Promise")))(function(b,c){a.$1=b,a.$2=c})}var c=a.prototype;c.resolve=function(a){this.$1(a)};c.reject=function(a){this.$2(a)};return a}();f["default"]=a}),66);
__d("MqttFetchClient",["MqttEnv","MqttProtocolCodec","MqttUserName","MqttUtils","Promise","PromiseResult"],(function(a,b,c,d,e,f,g){"use strict";var h,i="fetch_pull",j="fetch_pull_finish",k="fetch_",l=6e4,m="action",n="chunked",o="send",p="true",q=5,r=20,s=10,t=5e3,u=typeof window!=="undefined"?window:self;a=function(){function a(){this.$1="",this.$2=d("MqttEnv").Env.getLoggerInstance(),this.$3=0,this.$4="",this.$5=new(c("MqttUserName"))("",0,1,"",0,!0),this.$6=function(){},this.$7=function(a){},this.$8=function(){},this.$9=function(a){},this.$10=0,this.$11=0,this.$12=0,this.$13=0,this.$14="Ready",this.$15=[],this.$16=[],this.$17=null,this.$18=!1,this.$19=0}a.isSupported=function(){return typeof u.fetch==="function"};var e=a.prototype;e.run=function(a,b,c,e,f,g,h,i){this.$1=d("MqttUtils").endpointWithSessionId(a,b),this.$3=b,this.$4=c,this.$5=e,this.$6=f,this.$7=g,this.$8=h,this.$9=i,this.$20()};e.isTopicSupported=function(a){return!0};e.publish=function(a,b){return this.$21(a,b)};e.publishBinary=function(a,b){return this.$21(a,b)};e.$21=function(a,d){if(this.$14!=="ReceivingData"){this.$2.bumpCounter(k+"publish."+a+".invalidstate");return(h||(h=b("Promise"))).reject("not connected")}else{this.$2.bumpCounter(k+"publish."+a+".publish");var e=new(c("PromiseResult"))();a={topic:a,payload:d,promiseResult:e};this.$15.push(a);this.$22();return e.promise}};e.abort=function(){this.$6=function(){},this.$7=function(a){},this.$8=function(){},this.$9=function(a){}};e.$23=function(a){var b=this;a.forEach(function(a){b.$2.bumpCounter(k+"publish."+a.topic+".resolved"),a.promiseResult.resolve()});this.$12+=a.length};e.$24=function(a,b){var c=this;a.forEach(function(a){c.$2.bumpCounter(k+"publish."+a.topic+".rejected"),a.promiseResult.reject(b)})};e.$25=function(a,b,c,d){var e=a.map(function(a){return a.topic}).join(",");this.$2.debugTrace("FetchClient","Fetch publish request failed. Publishes:"+e+", retry:"+c);this.$2.bumpCounter(k+"publish_request_failed");this.$14!=="ReceivingData"||c===q?(this.$24(a,d),this.$18=!1,this.$2.bumpCounter(k+"publish_request_failed_final"),this.$22()):this.$26(a,b,c+1)};e.$27=function(a,b,c,d){if(!d.ok){this.$2.bumpCounter(k+"publish_request_failed.http."+d.status);if(d.status===409){this.$19++;if(this.$19>=s){this.$2.bumpCounter(k+"409_reset");this.$28(new Error("Too many 409 errors"));return}}this.$25(a,b,c,this.$29(d));return}this.$2.bumpCounter(k+"publish_request_success");b=a.map(function(a){return a.topic}).join(",");this.$2.debugTrace("FetchClient","Fetch publish request success. Publishes:"+b+", retry:"+c);this.$23(a);this.$18=!1;this.$22()};e.$22=function(){if(this.$14!=="ReceivingData")return;if(this.$18)return;if(this.$15.length===0&&this.$16.length===0)return;this.$18=!0;var a=this.$15.slice(0,r);this.$15=this.$15.slice(r,this.$15.length);this.$17!=null&&d("MqttEnv").Env.clearTimeout(this.$17);this.$17=null;var b=this.$16.slice(0,r);this.$16=this.$16.slice(r,this.$16.length);this.$26(a,b,0)};e.$26=function(a,b,c){var e=this,f=a.map(function(a){return a.topic}).join(",");this.$2.debugTrace("FetchClient","Fetch publish request sent. Publishes:"+f+", retry:"+c);f=d("MqttUtils").endpointWithExtraParameter(this.$1,m,o);var g=a.map(function(a){return{topic:a.topic,payload:a.payload,qos:0,messageId:d("MqttEnv").Env.random()}});g=this.$5.gen(this.$3,[],g,b);this.$2.bumpCounter(k+"publish_request");d("MqttUtils").promiseDoneWithTimeout(u.fetch(f,{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",referrer:"no-referrer",body:g,keepalive:!1}),function(d){return e.$27(a,b,c,d)},function(d){return e.$25(a,b,c,d)},l)};e.$30=function(a){a=a.message;this.$2.debugTrace("FetchClient","Fetch request failed with error:"+a);this.$9(a);this.$31(!1,a);this.$2.bumpCounter(k+"error");this.$14="Error"};e.$32=function(a){var b=this;this.$2.debugTrace("FetchClient","Fetch response data received");a=d("MqttProtocolCodec").decodeByteMessages(new Uint8Array(a));a=a.messages;var c=a.filter(function(a){return a.messageType===d("MqttProtocolCodec").MESSAGE_TYPE.PINGREQ});a=a.filter(function(a){return a.messageType===d("MqttProtocolCodec").MESSAGE_TYPE.PUBLISH}).map(function(a){if(!(a instanceof d("MqttProtocolCodec").WireMessage.Publish))return{};a=a;a.qos===1&&a.messageIdentifier!=null&&(b.$16.push(a.messageIdentifier),b.$17==null&&(b.$17=d("MqttEnv").Env.setTimeout(function(){b.$22()},t)));return{topic:a.topic,payload:a.payloadMessage,qos:a.qos}});for(var e=a,f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=e.length)break;h=e[g++]}else{g=e.next();if(g.done)break;h=g.value}h=h;this.$2.bumpCounter(k+"response_"+((h=h.topic)!=null?h:"void"))}a&&a.length>0&&(this.$13+=a.length,this.$7(a));c&&c.length>0&&this.$33()};e.$33=function(){this.$2.debugTrace("FetchClient","Got server ping request"),this.$2.bumpCounter(k+"ping")};e.$28=function(a){this.$2.debugTrace("FetchClient","Fetch request ended: "+a.toString()),this.$2.bumpCounter(k+"done"),this.$34(a.message),this.$8(),this.$14="Done"};e.$35=function(a,b,c){var e=this;if(c!=null)try{this.$32(c)}catch(a){this.$28(a);this.$2.bumpCounter(k+"dataDecodeException");return}if(b){this.$28(new Error("EOF"));return}d("MqttUtils").promiseDone(a.read(),function(c){var b=c.done;c=c.value;return e.$35(a,b,c)},function(a){return e.$28(a)})};e.$36=function(a){if(!a.ok){this.$2.bumpCounter(k+"error.http."+a.status);this.$30(this.$29(a));return}a=a.body;if(!a){this.$30(new Error("Empty body"));return}a=a.getReader();this.$6();this.$2.bumpCounter(k+"success");this.$31(!0,null);this.$11=Date.now();this.$14="ReceivingData";this.$2.debugTrace("FetchClient","Fetch request success");this.$35(a,!1,null)};e.$34=function(a){this.$2.eventLogPullFinish({pullEventName:j,sessionID:this.$3,duration:Date.now()-this.$11,errorMessage:a,publishReceived:this.$13,publishSent:this.$12})};e.$31=function(a,b){this.$2.eventLogPull({pullEventName:i,sessionID:this.$3,status:a,duration:Date.now()-this.$10,hostname:this.$1,errorMessage:b})};e.$20=function(){var a=this;if(this.$14!=="Ready")return;this.$2.debugTrace("FetchClient","Sending fetch request");this.$2.bumpCounter(k+"request");this.$10=Date.now();var b=d("MqttUtils").endpointWithExtraParameter(this.$1,n,p);d("MqttUtils").promiseDoneWithTimeout(u.fetch(b,{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",referrer:"no-referrer",body:this.$4,keepalive:!1}),function(b){return a.$36(b)},function(b){return a.$30(b)},l)};e.$29=function(a){return new Error("Http error, status="+a.status)};return a}();g["default"]=a}),98);
__d("MqttLongPollingClient",["MqttEnv","MqttProtocolCodec","MqttUserName","Promise","XHRRequest","getCrossOriginTransport"],(function(a,b,c,d,e,f,g){"use strict";var h,i=120*1e3,j="simple_pull",k="longpolling_";a=function(){function a(){this.$3="",this.$4=0,this.$2=d("MqttEnv").Env.getLoggerInstance(),this.$1="Ready",this.$5="",this.$6=new(c("MqttUserName"))("",0,1,"",0,!0),this.$7=function(){},this.$8=function(a){},this.$9=function(){},this.$10=function(a){},this.$11=0,this.$12=null,this.$13=new Set(["/t_ms","/messenger_sync_get_diffs","/messenger_sync_create_queue","/webrtc","/rtc_multi"])}var e=a.prototype;e.run=function(a,b,c,d,e,f,g,h){this.$3=a,this.$4=b,this.$5=c,this.$6=d,this.$7=e,this.$8=f,this.$9=g,this.$10=h,this.$14(this.$5)};e.isTopicSupported=function(a){return this.$13.has(a)};e.publish=function(a,c){return(h||(h=b("Promise"))).reject("not supported")};e.publishBinary=function(a,c){return(h||(h=b("Promise"))).reject("not supported")};e.abort=function(){this.$12!=null&&this.$12.abort("Disconnected")};e.$15=function(a,b){if(this.$1===a)return;this.$1=a;a==="Error"&&b!=null&&this.$10(b);this.$2.debugTrace("LongPollingClient","_changeStatus : "+a)};e.$16=function(a){if(this.$1!=="RequestSend")return;if(!a){this.$17("EmptyResponse",null);return}this.$7();this.$2.bumpCounter(k+"success");this.$18(!0,null);this.$15("ResponseReceived");a=d("MqttProtocolCodec").decodeByteMessages(new Uint8Array(a));a=a.messages.filter(function(a){return a instanceof d("MqttProtocolCodec").WireMessage.Publish}).map(function(a){if(a instanceof d("MqttProtocolCodec").WireMessage.Publish){a=a;return{topic:a.topic,payload:a.payloadMessage,qos:a.qos}}else return{}});this.$8(a);this.$9()};e.$17=function(a,b){b=b!=null?b.message:"null";this.$2.debugTrace("LongPollingClient Error","Poll failed with error:"+a+", errorMsg:"+b);this.$18(!1,a+":"+b);this.$2.bumpCounter(k+"error."+a);this.$15("Error",a)};e.$18=function(a,b){this.$2.eventLogPull({pullEventName:j,sessionID:this.$4,status:a,duration:Date.now()-this.$11,hostname:this.$3,errorMessage:b})};e.$14=function(a){var b=this;if(this.$1!=="Ready"||this.$12)return;this.$2.bumpCounter(k+"request");try{this.$11=Date.now(),this.$12=new(c("XHRRequest"))(this.$3).setResponseType("arraybuffer").setRawData(a).setTransportBuilder(c("getCrossOriginTransport").withCredentials).setResponseHandler(function(a){return b.$16(a)}).setNetworkFailureHandler(function(a){b.$17("Network",a)}).setErrorHandler(function(a){b.$17("Error",a)}).setAbortHandler(function(a){b.$17("Abort",null)}).setTimeoutHandler(function(){b.$17("Timeout",null)}).setTimeout(i).send(),this.$15("RequestSend")}catch(a){this.$17("Error",a)}};return a}();g["default"]=a}),98);
__d("MqttLongPollingHookCollection",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1=new Set()}var b=a.prototype;b.addHook=function(a){this.$1.add(a)};b.removeHook=function(a){this.$1["delete"](a)};b.onPollRequestSent=function(){this.$1.forEach(function(a){a.onPollRequestSent()})};b.onPollRequestSuccess=function(){this.$1.forEach(function(a){a.onPollRequestSuccess()})};b.onPollResponse=function(a){this.$1.forEach(function(b){b.onPollResponse(a)})};b.onPollFinish=function(){this.$1.forEach(function(a){a.onPollFinish()})};b.onPollRequestFailed=function(a){this.$1.forEach(function(b){b.onPollRequestFailed(a)})};b.onPollShutdownAbort=function(){this.$1.forEach(function(a){a.onPollShutdownAbort()})};return a}();f["default"]=a}),66);
__d("exponentialBackoff",["MqttEnv"],(function(a,b,c,d,e,f,g){function a(a,b){b===void 0&&(b=null);var c=null,e=0;function f(){for(var f=arguments.length,g=new Array(f),h=0;h<f;h++)g[h]=arguments[h];var i=function(){a.apply(b,g)};if(c===null){var j=Math.max(0,Math.pow(2,Math.min(e,6))*(1e3+d("MqttEnv").Env.random()*100)-2e3);c=d("MqttEnv").Env.setTimeout(function(){i(),c=null},j)}e++}f.reset=function(){e=0,c!=null&&(d("MqttEnv").Env.clearTimeout(c),c=null)};f.isPending=function(){return c!=null};return f}g["default"]=a}),98);
__d("MqttLongPollingRunner",["MqttEnv","MqttFetchClient","MqttLongPollingClient","MqttLongPollingHookCollection","MqttTypes","MqttUtils","MqttWebSocketUtils","Promise","exponentialBackoff"],(function(a,b,c,d,e,f,g){"use strict";var h,i=4,j=1e3,k=3e3,l="mqtt_should_longpoll",m="last_lp",n="yes",o="no";a=function(){function a(a,b,e,f,g,h,i,j,k){var l=this;this.$23=function(){try{if(!l.$30())return;l.$5.debugTrace("LongPollingRunner","_startPollingIfNecessary called");var a=l.$31();l.$14=a;var b=l.$9(),c=l.$10();b=b.filter(function(b){return a.isTopicSupported(b)});c=c.filter(function(b){return a.isTopicSupported(b.topic)});if(b.length===0&&c.length===0){l.$5.debugTrace("LongPollingRunner","Poll skipped, nothing to do");l.$14=null;d("MqttEnv").Env.setTimeout(function(){l.$23()},1e3);return}var e=d("MqttUtils").generateSessionId();a.run(l.$6,e,l.$7.gen(e,b,c),l.$7,function(){return l.$32()},function(a){return l.$33(a)},function(){return l.$34()},function(a){return l.$35(a)});l.$19.onPollRequestSent();e=b.join(",");b=c.map(function(a){return a.topic}).join(",");l.$5.debugTrace("LongPollingRunner","Making a poll request to "+l.$6+". SubscribedTopics:"+e+". Publishes:"+b)}catch(a){a&&l.$5.logErrorWarn(a,"lp_js_error"),l.$11(new(d("MqttTypes").MqttChannelError)(!1,"js error lp",a)),l.$35("lp_js_error")}};this.$6=a;this.$7=b;this.$1=f;this.$2=0;this.$3=e;this.$4=d("MqttWebSocketUtils").hasWSSupport();this.$5=d("MqttEnv").Env.getLoggerInstance();this.$8=g;this.$9=h;this.$10=i;this.$11=j;this.$12=k;this.$13=!1;this.$14=null;this.$15="LPInactive";this.$16="NotSent";this.$17=0;this.$19=new(c("MqttLongPollingHookCollection"))();this.$18=c("exponentialBackoff")(this.$23,this);this.$20=0;this.$21=o;a=d("MqttEnv").Env.genGk(d("MqttEnv").MqttGkNames.mqtt_lp_use_fetch);b=c("MqttFetchClient").isSupported();a?this.$5.bumpCounter("fetch_gk_pass"):this.$5.bumpCounter("fetch_gk_fail");b?this.$5.bumpCounter("fetch_api_supported"):this.$5.bumpCounter("fetch_api_not_supported");this.$22=a&&b}var e=a.prototype;e.addHook=function(a){this.$19.addHook(a)};e.start=function(){var a=this;this.$21=d("MqttEnv").Env.configRead(m,o);this.$5.debugTrace("LongPollingRunner","Runner loaded, last status "+this.$21);this.$20=Date.now();this.$23();d("MqttEnv").Env.setTimeout(function(){a.$23()},j+100);d("MqttEnv").Env.setTimeout(function(){a.$23()},k+100)};e.shutdown=function(){this.$5.debugTrace("LongPollingRunner","Shutdown called"),this.$14&&this.$14.abort(),this.$19.onPollShutdownAbort(),this.$14=null};e.canPublish=function(){return this.$15==="LPActive"&&this.$16==="ReceivingData"};e.publish=function(a,b,c){return this.$24(a,b)};e.publishBinary=function(a,b,c){return this.$24(a,b)};e.$24=function(a,c){if(d("MqttEnv").Env.genGk(d("MqttEnv").MqttGkNames.mqtt_enable_publish_over_polling)&&(this.$14&&this.$14.isTopicSupported(a)))if(typeof c==="string")return this.$14.publish(a,c);else return this.$14.publishBinary(a,c);return(h||(h=b("Promise"))).reject()};e.onConnectAttempt=function(){};e.onConnectFailure=function(){this.$2++,this.$23()};e.onConnected=function(){};e.onConnectSuccess=function(){this.$1=!0,d("MqttEnv").Env.configWrite(m,null)};e.onConnectionLost=function(){};e.onConnectionDisconnect=function(){};e.onSubscribe=function(a){};e.onUnsubscribe=function(a){};e.onPublish=function(a){};e.onMessage=function(a){};e.onWSFatal=function(){this.$3=!0,this.$23()};e.getStatus=function(){return this.$15};e.getRequestStatus=function(){return this.$16};e.$25=function(a){a!==this.$15&&(this.$5.debugTrace("LongPollingRunner","status changed to "+a+" from "+this.$15),this.$15=a,this.$12(this.$15,this.$16))};e.$26=function(a){if(!this.$22)return;a!==this.$16&&(this.$5.debugTrace("LongPollingRunner","request status changed to "+a+" from "+this.$16),this.$16=a,this.$12(this.$15,this.$16))};e.$27=function(){this.$17=0};e.$28=function(){this.$17++,this.$17>=i&&this.$25("LPError")};e.$29=function(){var a,b=(a=d("MqttEnv")).Env.genGk(a.MqttGkNames.mqtt_lp_no_delay),c=a.Env.genGk(a.MqttGkNames.mqtt_ws_polling_enabled);a=a.Env.genGk(a.MqttGkNames.mqtt_fast_lp);this.$5.debugTrace("LongPollingRunner","_shouldPoll? pollNow:"+String(b)+" enabled:"+String(c)+" fastPoll:"+String(a)+" hasWSSupport:"+String(this.$4)+" hasWsSuccessBefore:"+String(this.$1)+" failureCount:"+this.$2+" wsFatal:"+String(this.$3));if(!c)return!1;if(b){this.$5.bumpCounter(l+".nd");return!0}if(!this.$4){this.$5.bumpCounter(l+".na");return!0}if(this.$3){this.$5.bumpCounter(l+".fatal");return!0}if(this.$1)return!1;if(a){c=Date.now()-this.$20;if(this.$21===n){if(this.$2>=1)return!0;if(c>j){this.$5.bumpCounter(l+".fastdelay");return!0}}else if(c>k){this.$5.bumpCounter(l+".regulardelay");return!0}}if(this.$2>=3){this.$5.bumpCounter(l+".failure");return!0}return!1};e.$30=function(){if(this.$14!=null)return!1;var a=this.$29();!this.$13&&a&&(this.$5.bumpCounter("polling_kickin"),this.$13=!0,this.$25("LPActive"),this.$27());this.$13&&!a&&(this.$5.bumpCounter("polling_stopped"),this.$13=!1,this.$25("LPInactive"),this.$27());return a};e.$31=function(){if(this.$22){this.$5.debugTrace("LongPollingRunner","Creating polling client using Fetch API");return new(c("MqttFetchClient"))()}else{this.$5.debugTrace("LongPollingRunner","Creating regular Polling client");return new(c("MqttLongPollingClient"))()}};e.$32=function(){this.$5.debugTrace("LongPollingRunner","Poll success"),this.$19.onPollRequestSuccess(),this.$18.reset(),this.$25("LPActive"),this.$27(),d("MqttEnv").Env.configWrite(m,n),this.$26("ReceivingData")};e.$33=function(a){var b=a.map(function(a){return a.topic}).join(",");this.$5.debugTrace("LongPollingRunner","Poll response received, message received:"+b);for(b=0;b<a.length;b++){var c=a[b];this.$19.onPollResponse(c.topic);this.$8(c.topic,c.payload,c.qos)}};e.$34=function(){this.$5.debugTrace("LongPollingRunner","Poll finish"),this.$19.onPollFinish(),this.$14&&this.$14.abort(),this.$14=null,this.$23(),this.$26("NotSent")};e.$35=function(a){this.$19.onPollRequestFailed(a),this.$14&&this.$14.abort(),this.$14=null,this.$18(),this.$28(),this.$26("NotSent")};return a}();g["default"]=a}),98);
__d("PolarisCallGatingHelpers",["PolarisUA","RTWebIncomingRingConfiguration","gkx","justknobx","qex"],(function(a,b,c,d,e,f,g){"use strict";function h(){return i()||j()?!1:!0}function a(){return c("gkx")("24007")}function i(){return c("gkx")("24007")}function j(){return!d("PolarisUA").isDesktop()||!d("RTWebIncomingRingConfiguration").isSupportedClient()}function b(){return!h()?!1:!c("justknobx")._("471")}function e(){return c("qex")._("83")===!0}g.isWebCallingEnabled=h;g.isVerifiedUserAndCallingEnabled=a;g.isIncomingCallEnabled=b;g.isCallsPathMigrationEnabled=e}),98);
__d("PolarisSwitchAccountsModalLazy.react",["CometPlaceholder.react","IGCoreModal.react","IGDSBox.react","IGDSSpinner.react","JSResourceForInteraction","lazyLoadComponent","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("lazyLoadComponent")(c("JSResourceForInteraction")("PolarisSwitchAccountsModal.react").__setRef("PolarisSwitchAccountsModalLazy.react"));function a(){var a=d("react-compiler-runtime").c(1),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=i.jsx(c("CometPlaceholder.react"),{fallback:i.jsx(c("IGCoreModal.react"),{children:i.jsx(c("IGDSBox.react"),{alignItems:"center",height:112,justifyContent:"center",position:"relative",width:"100%",children:i.jsx(c("IGDSSpinner.react"),{size:"medium"})})}),children:i.jsx(j,{})}),a[0]=b):b=a[0];return b}g["default"]=a}),98);
__d("RpWebInfraActionsLoggerEventFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1744334");b=d("FalcoLoggerInternal").create("rp_web_infra_actions_logger_event",a);e=b;g["default"]=e}),98);
__d("RtcWebUserActionsDebugFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1744337");b=d("FalcoLoggerInternal").create("rtc_web_user_actions_debug",a);e=b;g["default"]=e}),98);
__d("RtcWebUserActionsFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1744338");b=d("FalcoLoggerInternal").create("rtc_web_user_actions",a);e=b;g["default"]=e}),98);
__d("StateSyncSerializers",["ThriftTypes"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return{version:0}}function b(){return{stateStore:{}}}function i(a,b){b.writeStructBegin("State");b.writeFieldBegin({fname:"version",ftype:(h||(h=c("ThriftTypes"))).I32,fid:1});if(a.version!=null)b.writeI32(a.version);else{var d=0;b.writeI32(d)}b.writeFieldEnd();a.data!=null&&(b.writeFieldBegin({fname:"data",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:2}),b.writeBinary(a.data),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function d(a,b){b.writeStructBegin("Snapshot");b.writeFieldBegin({fname:"stateStore",ftype:(h||(h=c("ThriftTypes"))).MAP,fid:1});if(a.stateStore!=null){b.writeMapBegin({ktype:(h||(h=c("ThriftTypes"))).STRING,vtype:h.STRUCT,size:Object.keys(a.stateStore).length});a=Object.entries(a.stateStore);for(var d=0;d<a.length;d++){var e=a[d],f=e[0];e=e[1];b.writeString(f);i(e,b)}b.writeMapEnd()}else{f={};b.writeMapBegin({ktype:(h||(h=c("ThriftTypes"))).STRING,vtype:h.STRUCT,size:Object.keys(f).length});e=Object.entries(f);for(a=0;a<e.length;a++){d=e[a];f=d[0];d=d[1];b.writeString(f);i(d,b)}b.writeMapEnd()}b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd()}function j(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).I32?b.version=a.readI32():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).STRING?b.data=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.version===void 0&&(b.version=0);return b}function e(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:if(e===(h||(h=c("ThriftTypes"))).MAP){b.stateStore={};d=a.readMapBegin();for(var f=0;f<d.size;f++){var g=a.readString(),i=j(a);b.stateStore[g]=i}}else a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.stateStore===void 0&&(b.stateStore={});return b}g.State$DefaultConstructor=a;g.Snapshot$DefaultConstructor=b;g.serializeState=i;g.serializeSnapshot=d;g.deserializeState=j;g.deserializeSnapshot=e}),98);
__d("TrustedTypesNoOpPolicy_DO_NOT_USE",["TrustedTypes","TrustedTypesUtils"],(function(a,b,c,d,e,f,g){"use strict";a={createScriptURL:d("TrustedTypesUtils").noop,createHTML:d("TrustedTypesUtils").noop,createScript:d("TrustedTypesUtils").noop};b=c("TrustedTypes").createPolicy("noop-do-not-use",a);e=b;g["default"]=e}),98);
__d("VideoPlayerWithLiveVideoInterruptedOverlay.react",["fbt","FDSLoadingAnimation.react","FDSTextPairing.react","VideoPlayerHooks","VideoPlayerInteractionOverlay.react","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=i||d("react");function a(){var a=(j||(j=d("VideoPlayerHooks"))).useStreamInterrupted(),b=j.useIsLiveRewindActive();return!a||b?null:k.jsx(d("VideoPlayerInteractionOverlay.react").VideoPlayerInteractionOverlay,{children:k.jsxs("div",babelHelpers["extends"]({className:"x6s0dn4 x18l40ae x1ey2m1c x9f619 x78zum5 xdt5ytf xds687c x17qophe xl56j7k x10l6tqk x13vifvy"},{children:[k.jsx("div",{children:k.jsx(c("FDSTextPairing.react"),{body:h._(/*BTDS*/"__JHASH__VF7_ry1JLc___JHASH__"),bodyColor:"white",headline:h._(/*BTDS*/"__JHASH__BFvlG3IxPd7__JHASH__"),headlineColor:"white",level:2,textAlign:"center"})}),k.jsx("div",babelHelpers["extends"]({className:"xc9qbxq x1sy10c2 x1n2onr6 x14qfxbe"},{children:k.jsx(c("FDSLoadingAnimation.react"),{size:36})}))]}))})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("WebStorageCleanupReason",[],(function(a,b,c,d,e,f){"use strict";var g=null;function a(){return g}function b(a){g=a}f.getLastCleanupReason=a;f.setLastCleanupReason=b}),66);
__d("XAsyncRequest",["cr:1042"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:1042")}),98);
__d("XAsyncRequestWWW",["AsyncRequest"],(function(a,b,c,d,e,f,g){a=function(){function a(a){var b=this;this.setAllowCrossPageTransition=function(a){b.$1.setAllowCrossPageTransition(a);return b};this.$1=new(c("AsyncRequest"))(a)}var b=a.prototype;b.setURI=function(a){this.$1.setURI(a);return this};b.setTimeoutHandler=function(a,b){this.$1.setTimeoutHandler(a,b);return this};b.setOption=function(a,b){this.$1.setOption(a,b);return this};b.setMethod=function(a){this.$1.setMethod(a);return this};b.setAutoProcess=function(a){this.$1.setOption("suppressEvaluation",a);return this};b.setData=function(a){this.$1.setData(a);return this};b.setHandler=function(a){this.$1.setHandler(a);return this};b.setPayloadHandler=function(a){this.setHandler(function(b){return a(b.payload)});return this};b.setErrorHandler=function(a){this.$1.setErrorHandler(a);return this};b.send=function(){this.$1.send();return this};b.abort=function(){this.$1.abort()};b.setReadOnly=function(a){this.$1.setReadOnly(a);return this};b.setAllowCrossOrigin=function(a){this.$1.setAllowCrossOrigin(a);return this};b.setAllowCredentials=function(a){this.$1.setAllowCredentials(a);return this};return a}();g["default"]=a}),98);
__d("ZenonAppProvider",["IGDWebUtils","ZenonActorHooks"],(function(a,b,c,d,e,f,g){"use strict";function a(){return d("IGDWebUtils").isInstagramWebSupportedApp(j())}function b(){return k(j())}function c(){return j()===351299233827255}function e(){return j()===2057013231240274}function f(){return j()===518491789147974}function h(){var a=d("ZenonActorHooks").ZenonActor.getAppID();return a==null?!1:Number(a)===2763362503905702||Number(a)===1013624499181349||Number(a)===218968626708284}function i(){var a=d("ZenonActorHooks").ZenonActor.getAppID();return a==null?!1:Number(a)===772021112871879||Number(a)===2220391788200892}function j(){var a=d("ZenonActorHooks").ZenonActor.getAppID();return a==null?null:Number(a)}function k(a){return a!=null?a===2763362503905702||a===1013624499181349||a===218968626708284:!1}g.isInstagramApp=a;g.isOculusApp=b;g.isHorizonApp=c;g.isHorizonWorldsApp=e;g.isCastingCenterApp=f;g.isOculusCastingSite=h;g.isMessengerWebApp=i}),98);
__d("ZenonActorHooks",["CurrentUser","FBLogger","ZenonAppProvider","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=null,i=null,j=null,k=!1,l=!1,m=new Set();function n(a,b){b===void 0&&(b="Fallback to CurrentUser"),m.has(a)||(c("FBLogger")("rtc_www").blameToPreviousFrame().info("ZenonActor."+a+" - "+b),m.add(a))}function a(){return[o.getID(),function(a){n("useZenonActor:setter","This setter should not be used as Zenon should currently doesn't allow switching Actor"),h=a}]}function b(a,b,c){b===void 0&&(b=!1);c===void 0&&(c=!1);if(h!==null){if(l)return;n("initZenonActor","ZenonActor is being reinitalized. This may indicate unneccessary ZenonActorProvider's to RelayEnvironmentProvider's in the component tree.")}l=l||b;k=k||c;typeof a==="string"||typeof a==="number"?(h=a.toString(),i=null,j=null):(a==null?void 0:a.actorID)!=null&&(h=a.actorID.toString(),i=a.name,j=a.shortName)}var o={getAccountID:function(){if(o.isInstagramUser())return c("CurrentUser").getEIMU();return o.isOculusCastingUser()?c("CurrentUser").getEOCPU():c("CurrentUser").getAccountID()},getAppID:function(){return c("CurrentUser").getAppID()},getID:function(){if(o.isInstagramUser())return c("CurrentUser").getEIMU();if(o.isOculusCastingUser())return c("CurrentUser").getEOCPU();if(o.isHorizonWebUser()&&!c("gkx")("5683"))return c("CurrentUser").getEPOU();if(h===null){n("getID");return c("CurrentUser").getID()}else return h},getName:function(){var a;return(a=i)!=null?a:c("CurrentUser").getName()},getShortName:function(){var a;return(a=j)!=null?a:c("CurrentUser").getShortName()},isEmployee:function(){return c("CurrentUser").isEmployee()},isHorizonWebUser:function(){return c("CurrentUser").getEPOU()!==0&&d("ZenonAppProvider").isHorizonApp()},isInstagramUser:function(){return c("CurrentUser").getEIMU()!==0&&d("ZenonAppProvider").isInstagramApp()},isLoggedIn:function(){return c("CurrentUser").isLoggedIn()},isLoggedInNow:function(){return c("CurrentUser").isLoggedInNow()},isManagedMetaAccount:function(){return c("CurrentUser").isManagedMetaAccount()},isMessengerCallGuestUser:function(){return c("CurrentUser").isMessengerCallGuestUser()},isOculusCastingUser:function(){return c("CurrentUser").getEOCPU()!==0&&d("ZenonAppProvider").isOculusApp()},isOculusUser:function(){return c("CurrentUser").getEPOU()!==0&&d("ZenonAppProvider").isOculusApp()},isPage:function(){return k},isTestUser:function(){return c("CurrentUser").isTestUser()},isWorkishUser:function(){return c("CurrentUser").isWorkroomsUser()||c("CurrentUser").isWorkUser()},isWorkroomsUser:function(){return c("CurrentUser").isWorkroomsUser()},isWorkUser:function(){return c("CurrentUser").isWorkUser()}};g.useZenonActor=a;g.initZenonActor=b;g.ZenonActor=o}),98);
__d("ZenonAuditedCheckpointLogId",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["RP_ROOMS_INFRA_WWW__E2EE","RP_ROOMS_INFRA_WWW__WASM","RP_ROOMS_INFRA_WWW__LOGGER_INFRA","RP_ROOMS_INFRA_WWW__STATE_MACHINE","RP_ROOMS_INFRA_WWW__ERROR","RP_ROOMS_INFRA_WWW__E2EE_DEVICE_VERIFIER","RP_ROOMS_INFRA_WWW__PLATFORM"]);c=a;f["default"]=c}),66);
__d("ZenonCallWindowErrors",[],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="ZenonOpeningAnotherCallError",b)||babelHelpers.assertThisInitialized(c)}return b}(babelHelpers.wrapNativeSuper(Error));b=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="ZenonConferenceNameMutationFailedError",b)||babelHelpers.assertThisInitialized(c)}return b}(babelHelpers.wrapNativeSuper(Error));c=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="ZenonIncompleteControllerParamsError",b)||babelHelpers.assertThisInitialized(c)}return b}(babelHelpers.wrapNativeSuper(Error));d=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="ZenonUnsupportedThreadTypeError",b)||babelHelpers.assertThisInitialized(c)}return b}(babelHelpers.wrapNativeSuper(Error));e=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="ZenonCannotAcceptInviteError",b)||babelHelpers.assertThisInitialized(c)}return b}(babelHelpers.wrapNativeSuper(Error));var g=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="ZenonInviteNotFoundError",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error)),h=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="ZenonUninitializedError",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error));f.OpeningAnotherCallError=a;f.ConferenceNameMutationFailedError=b;f.IncompleteControllerParamsError=c;f.UnsupportedThreadTypeError=d;f.CannotAcceptInviteError=e;f.InviteNotFoundError=g;f.UninitializedError=h}),66);
__d("isEmployeeTestUserZenonLogging",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("25162")||c("gkx")("25152")||c("gkx")("25209")}g["default"]=a}),98);
__d("ZenonInfraActionsLogger",["Log","RpWebInfraActionsLoggerEventFalcoEvent","ZenonAuditedCheckpointLogId","formatDate","isEmployeeTestUserZenonLogging","justknobx"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$1={callTrigger:void 0,conferenceName:void 0,deviceID:void 0,mediaPath:"sfu",peerID:void 0,serverInfoData:void 0,signalingID:void 0},this.$2=new Set(),this.$3=new Map(),this.$4=new Map()}var b=a.prototype;b.updateCachedValues=function(a){Object.assign(this.$1,a)};b.setE2eeIsMandatedForCall=function(a){this.$3.set(a,!0)};b.logCheckpointEmployeesTestUsersOnly=function(a){if(!c("isEmployeeTestUserZenonLogging")())return;this.logCheckpoint(a)};b.logCheckpoint=function(a){this.logEvent(babelHelpers["extends"]({},a))};b.logCheckpointOnceForDomain=function(a){var b=a.checkpoint;this.$2.has(b)||(this.$2.add(b),this.logCheckpoint(a))};b.logError=function(a){this.logEvent(babelHelpers["extends"]({},a))};b.startTimer=function(a){var b=Date.now();this.$4.set(a,b);this.logEvent({checkpoint:a+"_timerStart"})};b.stopTimer=function(a){var b=this.$4.get(a);this.$4["delete"](a);b=b!=null?Date.now()-b:null;this.logEvent({checkpoint:a+"_timerEnd",eventTimeElapsed:b});return parseInt(b,10)};b.logEvent=function(a){var b;if(c("justknobx")._("854"))return;b=(b=this.$3.get((b=this.$1.signalingID)!=null?b:""))!=null?b:!1;if(b&&!c("justknobx")._("1021"))return;if(b&&a.auditId==null){b="Encountered an unaudited log line, dropping it.";a.error!=null?this.logEvent({auditId:c("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__LOGGER_INFRA,error:b}):this.logEvent({auditId:c("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__LOGGER_INFRA,checkpoint:b});return}if(((b=a.checkpoint)==null?void 0:b.length)!=null&&a.checkpoint.length>3e5)return;var d={call_id:(b=a.signalingID)!=null?b:this.$1.signalingID==null?void 0:String(this.$1.signalingID),call_trigger:this.$1.callTrigger,call_type:(b=a.callType)!=null?b:null,checkpoint:a.checkpoint,client_session_id:this.$1.signalingID,client_time:Date.now().toString(),conference_name:(b=a.conferenceName)!=null?b:this.$1.conferenceName,connection:(b=a.connectionState)!=null?b:this.$1.connectionState,device_id:this.$1.deviceID,error:a.error,error_domain:a.errorDomain,event_time_elapsed:(b=a.eventTimeElapsed)==null?void 0:b.toString(),is_caller:(b=a.isCaller)!=null?b:null,media_path:(b=a.mediaPath)!=null?b:this.$1.mediaPath,message_id:a.messageID,peer_connection:(b=a.peerConnectionState)!=null?b:this.$1.peerConnectionState,peer_id:this.$1.peerID,sdp_format:(b=a.sdpFormat)!=null?b:null,server_info_data:(b=a.serverInfoData)!=null?b:this.$1.serverInfoData,signaling:(b=a.signalingState)!=null?b:this.$1.signalingState,state_machine_id:a.stateMachineID};c("RpWebInfraActionsLoggerEventFalcoEvent").log(function(){return d})};return a}();b=new a();g["default"]=b}),98);
__d("ZenonLoggingUtils",["ZenonAppProvider"],(function(a,b,c,d,e,f,g){"use strict";function a(){return d("ZenonAppProvider").isHorizonApp()||d("ZenonAppProvider").isHorizonWorldsApp()?!1:!0}g.shouldAllowLogging=a}),98);
__d("ZenonMachineToQPLEvent",["qpl"],(function(a,b,c,d,e,f,g){"use strict";b={ConnectionStateMachine:(a=c("qpl"))._(64243854,"2452"),ParentSignalingClient:a._(64234815,"1094"),PeerConnectionStateMachine:a._(64239068,"6172"),SignalingStateMachine:a._(64245348,"8823")};g["default"]=b}),98);
__d("ZenonODSLogger",["ODS"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(){}var b=a.prototype;b.logCounter=function(a){(h||(h=d("ODS"))).bumpEntityKey(4083,"zenon_multiway",a),h.flush()};b.logE2eeCounter=function(a){(h||(h=d("ODS"))).bumpEntityKey(4083,"zenon_e2ee",a),h.flush()};return a}();b=new a();g["default"]=b}),98);
__d("ZenonDebugLogger",["ChannelClientID","CurrentUser","FBLogger","IGDWebUtils","Log","LogHistory","ODS","QuickLogActionType","QuickPerformanceLogger","RpWebStateMachineLoggingBlocklist","UserAgentData","ZenonAuditedCheckpointLogId","ZenonInfraActionsLogger","ZenonLoggingUtils","ZenonMachineToQPLEvent","ZenonODSLogger","formatDate","isEmployeeTestUserZenonLogging"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=null;a=function(){a.getInstance=function(){j||(j=new a());return j};a.getFBLogger=function(a){var b;a===void 0&&(a={});return c("FBLogger")("rpweb").addMetadata("RT_WEB","CALL_ID",""+((b=a.signalingID)!=null?b:"null")).addMetadata("RT_WEB","PEER_ID",""+((b=a.peerID)!=null?b:"null"))};function a(){var a;this.$1=d("LogHistory").getInstance("webrtc");this.$2=d("ChannelClientID").getID();this.$3=JSON.stringify({browser:(a=c("UserAgentData")).browserName,browser_version:a.browserFullVersion,device:a.deviceName,msg_source:"web",os:a.platformName,os_version:a.platformFullVersion,version:2});a=c("CurrentUser").getAppID();a!=null&&d("IGDWebUtils").isInstagramWebSupportedApp(Number(a))?this.$4=parseInt(a,10):this.$4=219994525426954;this.$5=new Set(c("RpWebStateMachineLoggingBlocklist").EVENT_TYPES);this.$6=new Set(c("RpWebStateMachineLoggingBlocklist").STATES)}var b=a.prototype;b.$7=function(a,b,d){b===void 0&&(b=!0);var e=c("formatDate")(new Date(),"[H:i:s:X]",{skipPatternLocalization:!0});this.$1.log("Console",e+" "+a);b&&c("ZenonInfraActionsLogger").logCheckpoint({auditId:c("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__PLATFORM,checkpoint:"[ZP] "+a,messageID:d})};b.$8=function(a,b,d){var e=c("formatDate")(new Date(),"[H:i:s:X]",{skipPatternLocalization:!0});this.$1.log("Console",e+" "+a+". StateMachineID:  "+((e=b)!=null?e:""));e={auditId:c("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__STATE_MACHINE,checkpoint:"[ZP] "+a+".",stateMachineID:b};d!=null&&(e.messageID=d);c("ZenonInfraActionsLogger").logCheckpoint(e)};b.$9=function(a,b,e,f){f===void 0&&(f=0);a=c("ZenonMachineToQPLEvent")==null?void 0:c("ZenonMachineToQPLEvent")[a];if(!(a&&(i||(i=c("QuickPerformanceLogger")))&&c("QuickLogActionType")&&d("ZenonLoggingUtils").shouldAllowLogging()))return;e==="terminated"?(i||(i=c("QuickPerformanceLogger"))).markerEnd(a,2,f):(i||(i=c("QuickPerformanceLogger"))).markerPoint(a,b,{data:{string:{data:e}},instanceKey:f})};b.$10=function(a){return isNaN(+a)?0:+a};b.getLogHistory=function(){return this.$1};b.logStateMachine=function(a,b,d,e,f){if(!c("isEmployeeTestUserZenonLogging")())return;if(this.$5.has(d))return;var g="["+a+"] [Current State: "+b+"] Processing event: "+d;g={auditId:c("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__STATE_MACHINE,checkpoint:""+g,stateMachineID:e};f!=null&&(g.messageID=f);c("ZenonInfraActionsLogger").logCheckpoint(g);this.$9(a,d,b,this.$10(e))};b.logStateMachineTransition=function(a,b,d,e,f,g,h,i){if(this.$6.has(d)||this.$5.has(f))return;if(!c("isEmployeeTestUserZenonLogging")())return;var j="";g!=null&&g.length===1&&g[0].type==="defer"?j="["+a+"] [[DEFERRED] "+f+" did not trigger transition. Current state remains "+d:d!==e?j="["+a+"] [[PROCESSED] "+f+" caused transition from "+(e||"")+" to "+d+".":b?j="["+a+"] [[PROCESSED] "+f+" did not trigger transition. Current state remains "+d:(j="["+a+"] [[DROPPED] "+f+" did not trigger transition. Current state remains "+d,this.$11(a));this.$8(j,h,i)};b.startQPL=function(a,b){b===void 0&&(b=0),(i||(i=c("QuickPerformanceLogger")))&&d("ZenonLoggingUtils").shouldAllowLogging()&&(i||(i=c("QuickPerformanceLogger"))).markerStart(a,this.$10(b))};b.endQPL=function(a,b){b===void 0&&(b=0),(i||(i=c("QuickPerformanceLogger")))&&c("QuickLogActionType")&&d("ZenonLoggingUtils").shouldAllowLogging()&&(i||(i=c("QuickPerformanceLogger"))).markerEnd(a,2,this.$10(b))};b.logConsole=function(a){this.$7(a,!1)};b.logMQTTStateChange=function(a){var b="mqtt_client_state_"+a;c("ZenonODSLogger").logCounter(b);c("isEmployeeTestUserZenonLogging")()&&c("ZenonInfraActionsLogger").logCheckpoint({auditId:c("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__PLATFORM,checkpoint:"[ZP] onMQTTStateChanged: "+a+", document.visibility: "+document.visibilityState+", document.hasFocus: "+String(document.hasFocus())+", navigator.onLine: "+String(navigator.onLine)})};b.logMQTTConnectStats=function(a,b){c("ZenonInfraActionsLogger").logCheckpoint({auditId:c("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__PLATFORM,checkpoint:"[ZP] MQTT Connection time: "+String(a)+"ms, Retry Count: "+String(b)})};b.$11=function(a){(h||(h=d("ODS"))).bumpEntityKey(4083,"zenon_state_machine",a+"_event_dropped"),h.flush()};return a}();g["default"]=a}),98);
__d("ZenonIGMediaUtil",["ZenonAppProvider","gkx"],(function(a,b,c,d,e,f,g){"use strict";a={shouldUseSFUOnly:function(){return d("ZenonAppProvider").isInstagramApp()&&!c("gkx")("2274")}};b=a;g["default"]=b}),98);
__d("ZenonPeerID",["invariant"],(function(a,b,c,d,e,f,g,h){"use strict";var i="MW_PEER_ID";function a(a){a.length>0||h(0,33504);if(a==="MW_PEER_ID")return i;isNaN(a)===!1||h(0,33551,a);return a}function b(a){return isNaN(a)||a===i?null:a}g.ZenonMWPeerID=i;g.convertStringToPeerID=a;g.convertPeerIDForLogging=b}),98);
__d("ZenonSDESKeyDetector",[],(function(a,b,c,d,e,f){"use strict";var g=/inline:\s*[0-9a-zA-z+/]{40}(\b|\s|$)/;function a(a){return g.test(JSON.stringify(a))}f["default"]=a}),66);
__d("ZenonSignalingMessage",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b){this.$1=a,this.$2=b}var b=a.prototype;b.getHeader=function(){return this.$1};b.getEvents=function(){return this.$2};b.setSignalingID=function(a){this.$1.signalingID=a};b.setRetryCount=function(a){this.$1.retryCount=a};return a}();f["default"]=a}),66);
__d("ZenonSignalingProtocol",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({MW:"mw",MWPP:"mw++"});c=a;f["default"]=c}),66);
__d("ZenonSignalingTypes",[],(function(a,b,c,d,e,f){"use strict";a={OK:0,REJECTED_FROM_VERSION_DOES_NOT_MATCH:1,METHOD_NOT_ALLOWED:2};b={CLIENT_TERMINATED:0};f.ZenonSignalingStatusCode=a;f.ZenonSignalingStatusSubCode=b}),66);
__d("ZenonUserActionLogger",["RtcWebUserActionsDebugFalcoEvent","RtcWebUserActionsFalcoEvent","ZenonDebugLogger","ZenonSDESKeyDetector","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h=new Map(),i=window.location.hostname.search("facebook")!==-1?"facebook":window.location.hostname.search("messenger")!==-1?"messenger_dot_com":null,j={logCheckpoint:function(a){j.logEvent(babelHelpers["extends"]({},a,{event:"checkpoint"}))},logClick:function(a){j.logEvent(babelHelpers["extends"]({},a,{event:"tap"}))},logError:function(a){j.logEvent(babelHelpers["extends"]({},a,{event:"error"}))},logEvent:function(a){var b;if(c("ZenonSDESKeyDetector")(a))throw c("unrecoverableViolation")("ZenonUserActionLogger event contains SDES crypto key! This log entry must be removed!","rtc_www");b=babelHelpers["extends"]({},a,{page:(b=a.page)!=null?b:i});var d=babelHelpers["extends"]({},b,{client_time:Date.now().toString()});c("RtcWebUserActionsDebugFalcoEvent").log(function(){return d});c("RtcWebUserActionsFalcoEvent").log(function(){return d});c("ZenonDebugLogger").getInstance().getLogHistory().log((a=a.event)!=null?a:"null",JSON.stringify(b))},logImpression:function(a){j.logEvent(babelHelpers["extends"]({},a,{event:"impression"}))},logPreCallClick:function(a){j.logEvent(babelHelpers["extends"]({},a,{event:"tap"}))},logPreCallImpression:function(a){j.logEvent(babelHelpers["extends"]({},a,{event:"impression"}))},startTimer:function(a){var b=Date.now();h=h.set(a,b);j.logCheckpoint({checkpoint:a+"_timerStart"})},stopTimer:function(a){var b=a.checkpointName===void 0?a.timerName:a.checkpointName,c=a.event||{},d=function(a){var b=h.get(a);if(b!=null){h["delete"](a);return parseInt(Date.now()-b,10)}return null};d=d(a.timerName);j.logCheckpoint(babelHelpers["extends"]({},c,{checkpoint:b+"_timerEnd",event_time_elapsed:d==null?void 0:d.toString()}));return parseInt(d,10)}};f.exports=j}),34);
__d("shouldUseSFUMediaPath",["ZenonAppProvider","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=c("gkx")("25249");if(b)return!0;return d("ZenonAppProvider").isMessengerWebApp()&&a&&((b=c("gkx")("3298"))!=null?b:!1)?!0:!1}g["default"]=a}),98);